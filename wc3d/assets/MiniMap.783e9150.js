var e=Object.defineProperty,t=(t,a,i)=>(((t,a,i)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i})(t,"symbol"!=typeof a?a+"":a,i),i);import{bl as a,a7 as i,aD as o,bm as n,aX as s}from"./vendor.d2781f4b.js";class m{constructor(e={scene:scene,target:target,mapSize:mapSize,mapRenderSize:mapRenderSize,mapRotateZ:mapRotateZ,mapSyncRotateZ:mapSyncRotateZ,position:position}){if(t(this,"_miniMapCamera",null),t(this,"_miniMapRenderer",null),t(this,"_followTarget",null),this.scene=e.scene,this.mapSize=e.mapSize||10,this.mapRenderSize=e.mapRenderSize||120,this.mapRotateZ=e.mapRotateZ||0,this.mapSyncRotateZ=e.mapSyncRotateZ||!1,this._followTarget=e.target,this.position=e.position||"top right",!this.scene)throw new Error("scene不能为空");if(!this._followTarget)throw new Error("target不能为空，表示小地图画面主要跟随对象");this.add()}add(){const{mapSize:e,mapRenderSize:t,mapRotateZ:s}=this,m=new a({alpha:!0});m.setSize(t,t),m.shadowMap.enabled=!0,m.shadowMap.type=i,m.physicallyCorrectLights=!0,m.outputEncoding=o,this._miniMapRenderer=m;let[r,p]=this.position.split(" ");m.domElement.id="mapcanvas",m.domElement.style.position="absolute",m.domElement.style[p]="5px",m.domElement.style[r]="5px",m.domElement.style.zIndex="1001",m.domElement.style.boxShadow="inset 0 0 6px 1px #000",m.domElement.style.transform=`rotateZ(${s}deg)`,m.domElement.style.borderRadius="16px",this._miniMapDomEl=m.domElement,document.body.appendChild(m.domElement);const l=new n(-e/2,e/2,e/2,-e/2,1,1e3);this._miniMapCamera=l,this.updateCamera()}updateCamera(){if(this.mapSyncRotateZ){let e=s.radToDeg(this._followTarget.rotation.y);this._miniMapDomEl.style.transform=`rotateZ(${this.mapRotateZ+e}deg)`}let e=this._followTarget.position;this._miniMapCamera.position.set(e.x,e.y+10,e.z),this._miniMapCamera.lookAt(e.x,3,e.z)}update(){this._miniMapCamera&&this.updateCamera(),this._miniMapRenderer&&this._miniMapRenderer.render(this.scene,this._miniMapCamera)}destory(){this._miniMapCamera=null,this._miniMapRenderer=null,document.body.removeChild(document.querySelector("#mapcanvas"))}}export{m as M};
