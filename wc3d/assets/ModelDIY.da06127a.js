var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{a9 as s,a0 as a,z as i,m as n,a2 as o,aP as r,a4 as l,a3 as h,a1 as c,bA as d,bB as m,bC as u,bD as p,bE as g,aM as b,C as w,r as P,K as M,U as x,c as v,a as y,F as _,ao as C,u as f,o as j,w as k,ap as O,p as L,g as D,e as B}from"./vendor.d2781f4b.js";import{B as E}from"./Base.f46e7956.js";import{_ as A}from"./index.ed1235c5.js";class z extends E{constructor(e){super(e),t(this,"gltfLoader",(new s).setPath(this.publicPath.model)),t(this,"rgbLoader",(new a).setPath(this.publicPath.hdr)),t(this,"textureLoader",(new i).setPath(this.publicPath.texture)),t(this,"chairModel",null),t(this,"chairModelParts",[]),t(this,"selectedObjects",[]),t(this,"outlinePass",null),t(this,"composer",null)}init(){this.camera=new n(45,this.width/this.height,.1,1e3),this.camera.position.set(0,2,5);const e=15856113;this.scene.background=new o(e),this.scene.fog=new r(e,20,100),this.addListeners(),this.createObject()}addListeners(){document.addEventListener("click",this.handleClick.bind(this)),document.addEventListener("contextmenu",this.handleRightClick.bind(this))}createObject(){this.initOutline(),this.loadMainModel()}loadMainModel(){this.gltfLoader.load("chair.glb",(e=>{this.chairModel=e.scene,this.chairModel.position.set(0,0,0),this.chairModel.scale.set(.9,.9,.9),this.chairModel.rotation.y=-Math.PI,this.scene.add(this.chairModel),this.createOrbitControls(document.querySelector("#modelcover")),this.setupControls(),this.chairModel.traverse((e=>{this.chairModelParts.push(e.name),"back"==e.name&&(e.material.map=this.textureLoader.load("chair/wood_.jpg"))}))}),(e=>{}),(e=>{}))}setupControls(){this.controls.target.set(0,0,0),this.controls.enableDamping=!0,this.controls.enablePan=!1,this.controls.maxPolarAngle=2,this.controls.minPolarAngle=.75,this.controls.autoRotate=!0}handleClick(e){let t=new l;t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1;const s=new h;s.setFromCamera(t,this.camera);let a=s.intersectObjects(this.chairModel.children,!0);if(a.length){let e=a[0];this.setChangeMesh(e.object)}}handleRightClick(e){e.preventDefault(),this.renderOutline(),this.changeMesh&&c.to(this.changeMesh.position,{y:0,z:0,duration:.2})}setChangeMesh(e){this.changeMesh&&(this.changeMesh.position.y=0,this.changeMesh.position.z=0),this.renderOutline(e),this.changeMesh=e,c.to(this.changeMesh.position,{y:.5,z:-.5,duration:.2})}initOutline(){let e=new d(this.scene,this.camera);this.outlinePass=new m(new l(window.innerWidth,window.innerHeight),this.scene,this.camera),this.outlinePass.selectedObjects=[],this.outlinePass.usePatternTexture=!1,this.outlinePass.edgeStrength=10,this.outlinePass.edgeGlow=2,this.outlinePass.edgeThickness=1,this.outlinePass.pulsePeriod=4,this.outlinePass.visibleEdgeColor.set("green"),this.outlinePass.hiddenEdgeColor.set("red"),this.outlinePass.clear=!0;let t=new u(p);t.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),this.composer=new g(this.renderer),this.composer.addPass(e),this.composer.addPass(t),this.composer.addPass(this.outlinePass)}renderOutline(e){this.selectedObjects=e?[e]:[],this.outlinePass.selectedObjects=this.selectedObjects,this.outlinePass.selectedObjectsNeedUpdate=!0}setMaterial(e,t){if(this.changeMesh){if("color"==e)this.changeMesh.material=new b({color:t,shininess:10});else if("map"==e){let e=this.textureLoader.load(`chair/${t}`);e.repeat.set(3,3,3),e.wrapS=w,e.wrapT=w,this.changeMesh.material=new b({map:e})}}else alert("先点击椅子要修改外观的一个部位")}update(e,t){this.composer&&this.composer.render()}hide(){document.removeEventListener("click",this.handleClick),document.removeEventListener("contextmenu",this.handleRightClick)}}const R=e=>(L("data-v-38e6638c"),e=e(),D(),e),F=R((()=>y("div",{id:"modelcover"},null,-1))),H=R((()=>y("div",{class:"tips"},[B("1.点击椅子选择要更改的部位"),y("br"),B("2.点击底部的某个材质以应用"),y("br"),B("3.推拽｜缩放球型区域以查看细节"),y("br"),B("4.右键取消选中效果")],-1))),I={id:"materials"},S=["onClick"],T=["src"],U=A({__name:"ModelDIY",setup(e){const t=new z(".container");let s=P(null),a=P(""),i=P([{name:"mat_xx",type:"color",material:"#C7BDBD"},{name:"mat_xx",type:"color",material:"#A3AB84"},{name:"mat_xx",type:"color",material:"#D6CCB1"},{name:"mat_xx",type:"color",material:"#F8D5C4"},{name:"mat_xx",type:"map",material:"denim_.jpg"},{name:"mat_xx",type:"map",material:"fabric_.jpg"},{name:"mat_xx",type:"map",material:"pattern_.jpg"},{name:"mat_xx",type:"map",material:"quilt_.jpg"},{name:"mat_xx",type:"map",material:"wood_.jpg"}]);return M((()=>{t.onMounted()})),x((()=>{t.onUnmounted()})),(e,n)=>(j(),v(_,null,[F,H,y("div",I,[(j(!0),v(_,null,C(f(i),((e,s)=>(j(),v("div",{key:e,class:"matitem",onClick:k((s=>(e=>{const{type:s,material:i}=e;a.value=i,t.setMaterial(s,i)})(e)),["prevent"])},["map"==e.type?(j(),v("img",{key:0,class:"img_mat",src:`images/texture/chair/${e.material}`,alt:""},null,8,T)):(j(),v("div",{key:1,class:"color_mat",style:O(`background:${e.material}`)},null,4))],8,S)))),128))]),y("div",{class:"container",ref_key:"container",ref:s},null,512)],64))}},[["__scopeId","data-v-38e6638c"]]);export{U as default};
