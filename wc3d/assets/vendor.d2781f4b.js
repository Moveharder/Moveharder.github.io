/**
* @vue/shared v3.4.31
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
/*! #__NO_SIDE_EFFECTS__ */
function t(t,e){const n=new Set(t.split(","));return e?t=>n.has(t.toLowerCase()):t=>n.has(t)}const e={},n=[],i=()=>{},r=()=>!1,s=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),o=t=>t.startsWith("onUpdate:"),a=Object.assign,l=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},c=Object.prototype.hasOwnProperty,u=(t,e)=>c.call(t,e),h=Array.isArray,d=t=>"[object Map]"===x(t),p=t=>"[object Set]"===x(t),f=t=>"[object Date]"===x(t),m=t=>"function"==typeof t,g=t=>"string"==typeof t,v=t=>"symbol"==typeof t,y=t=>null!==t&&"object"==typeof t,_=t=>(y(t)||m(t))&&m(t.then)&&m(t.catch),b=Object.prototype.toString,x=t=>b.call(t),w=t=>x(t).slice(8,-1),S=t=>"[object Object]"===x(t),M=t=>g(t)&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,C=t(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),A=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},T=/-(\w)/g,E=A((t=>t.replace(T,((t,e)=>e?e.toUpperCase():"")))),I=/\B([A-Z])/g,R=A((t=>t.replace(I,"-$1").toLowerCase())),N=A((t=>t.charAt(0).toUpperCase()+t.slice(1))),D=A((t=>t?`on${N(t)}`:"")),L=(t,e)=>!Object.is(t,e),O=(t,...e)=>{for(let n=0;n<t.length;n++)t[n](...e)},k=(t,e,n,i=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:i,value:n})},P=t=>{const e=parseFloat(t);return isNaN(e)?t:e},F=t=>{const e=g(t)?Number(t):NaN;return isNaN(e)?t:e};let B;const z=()=>B||(B="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});function U(t){if(h(t)){const e={};for(let n=0;n<t.length;n++){const i=t[n],r=g(i)?H(i):U(i);if(r)for(const t in r)e[t]=r[t]}return e}if(g(t)||y(t))return t}const V=/;(?![^(]*\))/g,W=/:([^]+)/,G=/\/\*[^]*?\*\//g;function H(t){const e={};return t.replace(G,"").split(V).forEach((t=>{if(t){const n=t.split(W);n.length>1&&(e[n[0].trim()]=n[1].trim())}})),e}function j(t){let e="";if(g(t))e=t;else if(h(t))for(let n=0;n<t.length;n++){const i=j(t[n]);i&&(e+=i+" ")}else if(y(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const q=t("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function X(t){return!!t||""===t}function Y(t,e){if(t===e)return!0;let n=f(t),i=f(e);if(n||i)return!(!n||!i)&&t.getTime()===e.getTime();if(n=v(t),i=v(e),n||i)return t===e;if(n=h(t),i=h(e),n||i)return!(!n||!i)&&function(t,e){if(t.length!==e.length)return!1;let n=!0;for(let i=0;n&&i<t.length;i++)n=Y(t[i],e[i]);return n}(t,e);if(n=y(t),i=y(e),n||i){if(!n||!i)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t){const i=t.hasOwnProperty(n),r=e.hasOwnProperty(n);if(i&&!r||!i&&r||!Y(t[n],e[n]))return!1}}return String(t)===String(e)}function Z(t,e){return t.findIndex((t=>Y(t,e)))}const K=t=>!(!t||!0!==t.__v_isRef),$=t=>g(t)?t:null==t?"":h(t)||y(t)&&(t.toString===b||!m(t.toString))?K(t)?$(t.value):JSON.stringify(t,J,2):String(t),J=(t,e)=>K(e)?J(t,e.value):d(e)?{[`Map(${e.size})`]:[...e.entries()].reduce(((t,[e,n],i)=>(t[Q(e,i)+" =>"]=n,t)),{})}:p(e)?{[`Set(${e.size})`]:[...e.values()].map((t=>Q(t)))}:v(e)?Q(e):!y(e)||h(e)||S(e)?e:String(e),Q=(t,e="")=>{var n;return v(t)?`Symbol(${null!=(n=t.description)?n:e})`:t};
/**
* @vue/reactivity v3.4.31
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
let tt,et;class nt{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=tt,!t&&tt&&(this.index=(tt.scopes||(tt.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const e=tt;try{return tt=this,t()}finally{tt=e}}}on(){tt=this}off(){tt=this.parent}stop(t){if(this._active){let e,n;for(e=0,n=this.effects.length;e<n;e++)this.effects[e].stop();for(e=0,n=this.cleanups.length;e<n;e++)this.cleanups[e]();if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0,this._active=!1}}}class it{constructor(t,e,n,i){this.fn=t,this.trigger=e,this.scheduler=n,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,function(t,e=tt){e&&e.active&&e.effects.push(t)}(this,i)}get dirty(){if(2===this._dirtyLevel||3===this._dirtyLevel){this._dirtyLevel=1,ut();for(let t=0;t<this._depsLength;t++){const e=this.deps[t];if(e.computed&&(e.computed.value,this._dirtyLevel>=4))break}1===this._dirtyLevel&&(this._dirtyLevel=0),ht()}return this._dirtyLevel>=4}set dirty(t){this._dirtyLevel=t?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let t=at,e=et;try{return at=!0,et=this,this._runnings++,rt(this),this.fn()}finally{st(this),this._runnings--,et=e,at=t}}stop(){this.active&&(rt(this),st(this),this.onStop&&this.onStop(),this.active=!1)}}function rt(t){t._trackId++,t._depsLength=0}function st(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)ot(t.deps[e],t);t.deps.length=t._depsLength}}function ot(t,e){const n=t.get(e);void 0!==n&&e._trackId!==n&&(t.delete(e),0===t.size&&t.cleanup())}let at=!0,lt=0;const ct=[];function ut(){ct.push(at),at=!1}function ht(){const t=ct.pop();at=void 0===t||t}function dt(){lt++}function pt(){for(lt--;!lt&&mt.length;)mt.shift()()}function ft(t,e,n){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const n=t.deps[t._depsLength];n!==e?(n&&ot(n,t),t.deps[t._depsLength++]=e):t._depsLength++}}const mt=[];function gt(t,e,n){dt();for(const i of t.keys()){let n;i._dirtyLevel<e&&(null!=n?n:n=t.get(i)===i._trackId)&&(i._shouldSchedule||(i._shouldSchedule=0===i._dirtyLevel),i._dirtyLevel=e),i._shouldSchedule&&(null!=n?n:n=t.get(i)===i._trackId)&&(i.trigger(),i._runnings&&!i.allowRecurse||2===i._dirtyLevel||(i._shouldSchedule=!1,i.scheduler&&mt.push(i.scheduler)))}pt()}const vt=(t,e)=>{const n=new Map;return n.cleanup=t,n.computed=e,n},yt=new WeakMap,_t=Symbol(""),bt=Symbol("");function xt(t,e,n){if(at&&et){let e=yt.get(t);e||yt.set(t,e=new Map);let i=e.get(n);i||e.set(n,i=vt((()=>e.delete(n)))),ft(et,i)}}function wt(t,e,n,i,r,s){const o=yt.get(t);if(!o)return;let a=[];if("clear"===e)a=[...o.values()];else if("length"===n&&h(t)){const t=Number(i);o.forEach(((e,n)=>{("length"===n||!v(n)&&n>=t)&&a.push(e)}))}else switch(void 0!==n&&a.push(o.get(n)),e){case"add":h(t)?M(n)&&a.push(o.get("length")):(a.push(o.get(_t)),d(t)&&a.push(o.get(bt)));break;case"delete":h(t)||(a.push(o.get(_t)),d(t)&&a.push(o.get(bt)));break;case"set":d(t)&&a.push(o.get(_t))}dt();for(const l of a)l&&gt(l,4);pt()}const St=t("__proto__,__v_isRef,__isVue"),Mt=new Set(Object.getOwnPropertyNames(Symbol).filter((t=>"arguments"!==t&&"caller"!==t)).map((t=>Symbol[t])).filter(v)),Ct=At();function At(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const n=pe(this);for(let e=0,r=this.length;e<r;e++)xt(n,0,e+"");const i=n[e](...t);return-1===i||!1===i?n[e](...t.map(pe)):i}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){ut(),dt();const n=pe(this)[e].apply(this,t);return pt(),ht(),n}})),t}function Tt(t){v(t)||(t=String(t));const e=pe(this);return xt(e,0,t),e.hasOwnProperty(t)}class Et{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,n){const i=this._isReadonly,r=this._isShallow;if("__v_isReactive"===e)return!i;if("__v_isReadonly"===e)return i;if("__v_isShallow"===e)return r;if("__v_raw"===e)return n===(i?r?re:ie:r?ne:ee).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const s=h(t);if(!i){if(s&&u(Ct,e))return Reflect.get(Ct,e,n);if("hasOwnProperty"===e)return Tt}const o=Reflect.get(t,e,n);return(v(e)?Mt.has(e):St(e))?o:(i||xt(t,0,e),r?o:be(o)?s&&M(e)?o:o.value:y(o)?i?ae(o):se(o):o)}}class It extends Et{constructor(t=!1){super(!1,t)}set(t,e,n,i){let r=t[e];if(!this._isShallow){const e=ue(r);if(he(n)||ue(n)||(r=pe(r),n=pe(n)),!h(t)&&be(r)&&!be(n))return!e&&(r.value=n,!0)}const s=h(t)&&M(e)?Number(e)<t.length:u(t,e),o=Reflect.set(t,e,n,i);return t===pe(i)&&(s?L(n,r)&&wt(t,"set",e,n):wt(t,"add",e,n)),o}deleteProperty(t,e){const n=u(t,e);t[e];const i=Reflect.deleteProperty(t,e);return i&&n&&wt(t,"delete",e,void 0),i}has(t,e){const n=Reflect.has(t,e);return v(e)&&Mt.has(e)||xt(t,0,e),n}ownKeys(t){return xt(t,0,h(t)?"length":_t),Reflect.ownKeys(t)}}class Rt extends Et{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const Nt=new It,Dt=new Rt,Lt=new It(!0),Ot=t=>t,kt=t=>Reflect.getPrototypeOf(t);function Pt(t,e,n=!1,i=!1){const r=pe(t=t.__v_raw),s=pe(e);n||(L(e,s)&&xt(r,0,e),xt(r,0,s));const{has:o}=kt(r),a=i?Ot:n?ge:me;return o.call(r,e)?a(t.get(e)):o.call(r,s)?a(t.get(s)):void(t!==r&&t.get(e))}function Ft(t,e=!1){const n=this.__v_raw,i=pe(n),r=pe(t);return e||(L(t,r)&&xt(i,0,t),xt(i,0,r)),t===r?n.has(t):n.has(t)||n.has(r)}function Bt(t,e=!1){return t=t.__v_raw,!e&&xt(pe(t),0,_t),Reflect.get(t,"size",t)}function zt(t){t=pe(t);const e=pe(this);return kt(e).has.call(e,t)||(e.add(t),wt(e,"add",t,t)),this}function Ut(t,e){e=pe(e);const n=pe(this),{has:i,get:r}=kt(n);let s=i.call(n,t);s||(t=pe(t),s=i.call(n,t));const o=r.call(n,t);return n.set(t,e),s?L(e,o)&&wt(n,"set",t,e):wt(n,"add",t,e),this}function Vt(t){const e=pe(this),{has:n,get:i}=kt(e);let r=n.call(e,t);r||(t=pe(t),r=n.call(e,t)),i&&i.call(e,t);const s=e.delete(t);return r&&wt(e,"delete",t,void 0),s}function Wt(){const t=pe(this),e=0!==t.size,n=t.clear();return e&&wt(t,"clear",void 0,void 0),n}function Gt(t,e){return function(n,i){const r=this,s=r.__v_raw,o=pe(s),a=e?Ot:t?ge:me;return!t&&xt(o,0,_t),s.forEach(((t,e)=>n.call(i,a(t),a(e),r)))}}function Ht(t,e,n){return function(...i){const r=this.__v_raw,s=pe(r),o=d(s),a="entries"===t||t===Symbol.iterator&&o,l="keys"===t&&o,c=r[t](...i),u=n?Ot:e?ge:me;return!e&&xt(s,0,l?bt:_t),{next(){const{value:t,done:e}=c.next();return e?{value:t,done:e}:{value:a?[u(t[0]),u(t[1])]:u(t),done:e}},[Symbol.iterator](){return this}}}}function jt(t){return function(...e){return"delete"!==t&&("clear"===t?void 0:this)}}function qt(){const t={get(t){return Pt(this,t)},get size(){return Bt(this)},has:Ft,add:zt,set:Ut,delete:Vt,clear:Wt,forEach:Gt(!1,!1)},e={get(t){return Pt(this,t,!1,!0)},get size(){return Bt(this)},has:Ft,add:zt,set:Ut,delete:Vt,clear:Wt,forEach:Gt(!1,!0)},n={get(t){return Pt(this,t,!0)},get size(){return Bt(this,!0)},has(t){return Ft.call(this,t,!0)},add:jt("add"),set:jt("set"),delete:jt("delete"),clear:jt("clear"),forEach:Gt(!0,!1)},i={get(t){return Pt(this,t,!0,!0)},get size(){return Bt(this,!0)},has(t){return Ft.call(this,t,!0)},add:jt("add"),set:jt("set"),delete:jt("delete"),clear:jt("clear"),forEach:Gt(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach((r=>{t[r]=Ht(r,!1,!1),n[r]=Ht(r,!0,!1),e[r]=Ht(r,!1,!0),i[r]=Ht(r,!0,!0)})),[t,n,e,i]}const[Xt,Yt,Zt,Kt]=qt();function $t(t,e){const n=e?t?Kt:Zt:t?Yt:Xt;return(e,i,r)=>"__v_isReactive"===i?!t:"__v_isReadonly"===i?t:"__v_raw"===i?e:Reflect.get(u(n,i)&&i in e?n:e,i,r)}const Jt={get:$t(!1,!1)},Qt={get:$t(!1,!0)},te={get:$t(!0,!1)},ee=new WeakMap,ne=new WeakMap,ie=new WeakMap,re=new WeakMap;function se(t){return ue(t)?t:le(t,!1,Nt,Jt,ee)}function oe(t){return le(t,!1,Lt,Qt,ne)}function ae(t){return le(t,!0,Dt,te,ie)}function le(t,e,n,i,r){if(!y(t))return t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const s=r.get(t);if(s)return s;const o=(a=t).__v_skip||!Object.isExtensible(a)?0:function(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(w(a));var a;if(0===o)return t;const l=new Proxy(t,2===o?i:n);return r.set(t,l),l}function ce(t){return ue(t)?ce(t.__v_raw):!(!t||!t.__v_isReactive)}function ue(t){return!(!t||!t.__v_isReadonly)}function he(t){return!(!t||!t.__v_isShallow)}function de(t){return!!t&&!!t.__v_raw}function pe(t){const e=t&&t.__v_raw;return e?pe(e):t}function fe(t){return Object.isExtensible(t)&&k(t,"__v_skip",!0),t}const me=t=>y(t)?se(t):t,ge=t=>y(t)?ae(t):t;class ve{constructor(t,e,n,i){this.getter=t,this._setter=e,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new it((()=>t(this._value)),(()=>_e(this,2===this.effect._dirtyLevel?2:3))),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const t=pe(this);return t._cacheable&&!t.effect.dirty||!L(t._value,t._value=t.effect.run())||_e(t,4),ye(t),t.effect._dirtyLevel>=2&&_e(t,2),t._value}set value(t){this._setter(t)}get _dirty(){return this.effect.dirty}set _dirty(t){this.effect.dirty=t}}function ye(t){var e;at&&et&&(t=pe(t),ft(et,null!=(e=t.dep)?e:t.dep=vt((()=>t.dep=void 0),t instanceof ve?t:void 0)))}function _e(t,e=4,n,i){const r=(t=pe(t)).dep;r&&gt(r,e)}function be(t){return!(!t||!0!==t.__v_isRef)}function xe(t){return we(t,!1)}function we(t,e){return be(t)?t:new Se(t,e)}class Se{constructor(t,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?t:pe(t),this._value=e?t:me(t)}get value(){return ye(this),this._value}set value(t){const e=this.__v_isShallow||he(t)||ue(t);t=e?t:pe(t),L(t,this._rawValue)&&(this._rawValue,this._rawValue=t,this._value=e?t:me(t),_e(this,4))}}function Me(t){return be(t)?t.value:t}const Ce={get:(t,e,n)=>Me(Reflect.get(t,e,n)),set:(t,e,n,i)=>{const r=t[e];return be(r)&&!be(n)?(r.value=n,!0):Reflect.set(t,e,n,i)}};function Ae(t){return ce(t)?t:new Proxy(t,Ce)}
/**
* @vue/runtime-core v3.4.31
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Te(t,e,n,i){try{return i?t(...i):t()}catch(r){Ie(r,e,n)}}function Ee(t,e,n,i){if(m(t)){const r=Te(t,e,n,i);return r&&_(r)&&r.catch((t=>{Ie(t,e,n)})),r}if(h(t)){const r=[];for(let s=0;s<t.length;s++)r.push(Ee(t[s],e,n,i));return r}}function Ie(t,e,n,i=!0){e&&e.vnode;if(e){let i=e.parent;const r=e.proxy,s=`https://vuejs.org/error-reference/#runtime-${n}`;for(;i;){const e=i.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,r,s))return;i=i.parent}const o=e.appContext.config.errorHandler;if(o)return ut(),Te(o,null,10,[t,r,s]),void ht()}}let Re=!1,Ne=!1;const De=[];let Le=0;const Oe=[];let ke=null,Pe=0;const Fe=Promise.resolve();let Be=null;function ze(t){const e=Be||Fe;return t?e.then(this?t.bind(this):t):e}function Ue(t){De.length&&De.includes(t,Re&&t.allowRecurse?Le+1:Le)||(null==t.id?De.push(t):De.splice(function(t){let e=Le+1,n=De.length;for(;e<n;){const i=e+n>>>1,r=De[i],s=He(r);s<t||s===t&&r.pre?e=i+1:n=i}return e}(t.id),0,t),Ve())}function Ve(){Re||Ne||(Ne=!0,Be=Fe.then(qe))}function We(t,e,n=(Re?Le+1:0)){for(;n<De.length;n++){const e=De[n];if(e&&e.pre){if(t&&e.id!==t.uid)continue;De.splice(n,1),n--,e()}}}function Ge(t){if(Oe.length){const t=[...new Set(Oe)].sort(((t,e)=>He(t)-He(e)));if(Oe.length=0,ke)return void ke.push(...t);for(ke=t,Pe=0;Pe<ke.length;Pe++){const t=ke[Pe];!1!==t.active&&t()}ke=null,Pe=0}}const He=t=>null==t.id?1/0:t.id,je=(t,e)=>{const n=He(t)-He(e);if(0===n){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function qe(t){Ne=!1,Re=!0,De.sort(je);try{for(Le=0;Le<De.length;Le++){const t=De[Le];t&&!1!==t.active&&Te(t,null,14)}}finally{Le=0,De.length=0,Ge(),Re=!1,Be=null,(De.length||Oe.length)&&qe()}}function Xe(t,n,...i){if(t.isUnmounted)return;const r=t.vnode.props||e;let s=i;const o=n.startsWith("update:"),a=o&&n.slice(7);if(a&&a in r){const t=`${"modelValue"===a?"model":a}Modifiers`,{number:n,trim:o}=r[t]||e;o&&(s=i.map((t=>g(t)?t.trim():t))),n&&(s=i.map(P))}let l,c=r[l=D(n)]||r[l=D(E(n))];!c&&o&&(c=r[l=D(R(n))]),c&&Ee(c,t,6,s);const u=r[l+"Once"];if(u){if(t.emitted){if(t.emitted[l])return}else t.emitted={};t.emitted[l]=!0,Ee(u,t,6,s)}}function Ye(t,e,n=!1){const i=e.emitsCache,r=i.get(t);if(void 0!==r)return r;const s=t.emits;let o={},l=!1;if(!m(t)){const i=t=>{const n=Ye(t,e,!0);n&&(l=!0,a(o,n))};!n&&e.mixins.length&&e.mixins.forEach(i),t.extends&&i(t.extends),t.mixins&&t.mixins.forEach(i)}return s||l?(h(s)?s.forEach((t=>o[t]=null)):a(o,s),y(t)&&i.set(t,o),o):(y(t)&&i.set(t,null),null)}function Ze(t,e){return!(!t||!s(e))&&(e=e.slice(2).replace(/Once$/,""),u(t,e[0].toLowerCase()+e.slice(1))||u(t,R(e))||u(t,e))}let Ke=null,$e=null;function Je(t){const e=Ke;return Ke=t,$e=t&&t.type.__scopeId||null,e}function Qe(t){$e=t}function tn(){$e=null}function en(t,e=Ke,n){if(!e)return t;if(t._n)return t;const i=(...n)=>{i._d&&ur(-1);const r=Je(e);let s;try{s=t(...n)}finally{Je(r),i._d&&ur(1)}return s};return i._n=!0,i._c=!0,i._d=!0,i}function nn(t){const{type:e,vnode:n,proxy:i,withProxy:r,propsOptions:[s],slots:a,attrs:l,emit:c,render:u,renderCache:h,props:d,data:p,setupState:f,ctx:m,inheritAttrs:g}=t,v=Je(t);let y,_;try{if(4&n.shapeFlag){const t=r||i,e=t;y=Sr(u.call(e,t,h,d,f,p,m)),_=l}else{const t=e;0,y=Sr(t.length>1?t(d,{attrs:l,slots:a,emit:c}):t(d,null)),_=e.props?l:rn(l)}}catch(x){or.length=0,Ie(x,t,1),y=yr(rr)}let b=y;if(_&&!1!==g){const t=Object.keys(_),{shapeFlag:e}=b;t.length&&7&e&&(s&&t.some(o)&&(_=sn(_,s)),b=_r(b,_,!1,!0))}return n.dirs&&(b=_r(b,null,!1,!0),b.dirs=b.dirs?b.dirs.concat(n.dirs):n.dirs),n.transition&&(b.transition=n.transition),y=b,Je(v),y}const rn=t=>{let e;for(const n in t)("class"===n||"style"===n||s(n))&&((e||(e={}))[n]=t[n]);return e},sn=(t,e)=>{const n={};for(const i in t)o(i)&&i.slice(9)in e||(n[i]=t[i]);return n};function on(t,e,n){const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!0;for(let r=0;r<i.length;r++){const s=i[r];if(e[s]!==t[s]&&!Ze(n,s))return!0}return!1}const an="components";function ln(t,e){return function(t,e,n=!0,i=!1){const r=Ke||Rr;if(r){const n=r.type;if(t===an){const t=Gr(n,!1);if(t&&(t===e||t===E(e)||t===N(E(e))))return n}const s=un(r[t]||n[t],e)||un(r.appContext[t],e);return!s&&i?n:s}}(an,t,!0,e)||t}const cn=Symbol.for("v-ndc");function un(t,e){return t&&(t[e]||t[E(e)]||t[N(E(e))])}function hn(t,e,n=Rr,i=!1){if(n){const r=n[t]||(n[t]=[]),s=e.__weh||(e.__weh=(...i)=>{ut();const r=Or(n),s=Ee(e,n,t,i);return r(),ht(),s});return i?r.unshift(s):r.push(s),s}}const dn=t=>(e,n=Rr)=>{Br&&"sp"!==t||hn(t,((...t)=>e(...t)),n)},pn=dn("bm"),fn=dn("m"),mn=dn("bu"),gn=dn("u"),vn=dn("bum"),yn=dn("um"),_n=dn("sp"),bn=dn("rtg"),xn=dn("rtc");function wn(t,e=Rr){hn("ec",t,e)}function Sn(t,n){if(null===Ke)return t;const i=Wr(Ke),r=t.dirs||(t.dirs=[]);for(let s=0;s<n.length;s++){let[t,o,a,l=e]=n[s];t&&(m(t)&&(t={mounted:t,updated:t}),t.deep&&Ii(o),r.push({dir:t,instance:i,value:o,oldValue:void 0,arg:a,modifiers:l}))}return t}function Mn(t,e,n,i){const r=t.dirs,s=e&&e.dirs;for(let o=0;o<r.length;o++){const a=r[o];s&&(a.oldValue=s[o].value);let l=a.dir[i];l&&(ut(),Ee(l,n,8,[t.el,a,t,e]),ht())}}function Cn(t,e,n,i){let r;const s=n&&n[i];if(h(t)||g(t)){r=new Array(t.length);for(let n=0,i=t.length;n<i;n++)r[n]=e(t[n],n,void 0,s&&s[n])}else if("number"==typeof t){r=new Array(t);for(let n=0;n<t;n++)r[n]=e(n+1,n,void 0,s&&s[n])}else if(y(t))if(t[Symbol.iterator])r=Array.from(t,((t,n)=>e(t,n,void 0,s&&s[n])));else{const n=Object.keys(t);r=new Array(n.length);for(let i=0,o=n.length;i<o;i++){const o=n[i];r[i]=e(t[o],o,i,s&&s[i])}}else r=[];return n&&(n[i]=r),r}
/*! #__NO_SIDE_EFFECTS__ */function An(t,e){return m(t)?(()=>a({name:t.name},e,{setup:t}))():t}const Tn=t=>!!t.type.__asyncLoader,En=t=>t?Pr(t)?Wr(t):En(t.parent):null,In=a(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>En(t.parent),$root:t=>En(t.root),$emit:t=>t.emit,$options:t=>Fn(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,Ue(t.update)}),$nextTick:t=>t.n||(t.n=ze.bind(t.proxy)),$watch:t=>Ti.bind(t)}),Rn=(t,n)=>t!==e&&!t.__isScriptSetup&&u(t,n),Nn={get({_:t},n){if("__v_skip"===n)return!0;const{ctx:i,setupState:r,data:s,props:o,accessCache:a,type:l,appContext:c}=t;let h;if("$"!==n[0]){const l=a[n];if(void 0!==l)switch(l){case 1:return r[n];case 2:return s[n];case 4:return i[n];case 3:return o[n]}else{if(Rn(r,n))return a[n]=1,r[n];if(s!==e&&u(s,n))return a[n]=2,s[n];if((h=t.propsOptions[0])&&u(h,n))return a[n]=3,o[n];if(i!==e&&u(i,n))return a[n]=4,i[n];Ln&&(a[n]=0)}}const d=In[n];let p,f;return d?("$attrs"===n&&xt(t.attrs,0,""),d(t)):(p=l.__cssModules)&&(p=p[n])?p:i!==e&&u(i,n)?(a[n]=4,i[n]):(f=c.config.globalProperties,u(f,n)?f[n]:void 0)},set({_:t},n,i){const{data:r,setupState:s,ctx:o}=t;return Rn(s,n)?(s[n]=i,!0):r!==e&&u(r,n)?(r[n]=i,!0):!u(t.props,n)&&(("$"!==n[0]||!(n.slice(1)in t))&&(o[n]=i,!0))},has({_:{data:t,setupState:n,accessCache:i,ctx:r,appContext:s,propsOptions:o}},a){let l;return!!i[a]||t!==e&&u(t,a)||Rn(n,a)||(l=o[0])&&u(l,a)||u(r,a)||u(In,a)||u(s.config.globalProperties,a)},defineProperty(t,e,n){return null!=n.get?t._.accessCache[e]=0:u(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function Dn(t){return h(t)?t.reduce(((t,e)=>(t[e]=null,t)),{}):t}let Ln=!0;function On(t){const e=Fn(t),n=t.proxy,r=t.ctx;Ln=!1,e.beforeCreate&&kn(e.beforeCreate,t,"bc");const{data:s,computed:o,methods:a,watch:l,provide:c,inject:u,created:d,beforeMount:p,mounted:f,beforeUpdate:g,updated:v,activated:_,deactivated:b,beforeDestroy:x,beforeUnmount:w,destroyed:S,unmounted:M,render:C,renderTracked:A,renderTriggered:T,errorCaptured:E,serverPrefetch:I,expose:R,inheritAttrs:N,components:D,directives:L,filters:O}=e;if(u&&function(t,e,n=i){h(t)&&(t=Vn(t));for(const i in t){const n=t[i];let r;r=y(n)?"default"in n?Kn(n.from||i,n.default,!0):Kn(n.from||i):Kn(n),be(r)?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>r.value,set:t=>r.value=t}):e[i]=r}}(u,r,null),a)for(const i in a){const t=a[i];m(t)&&(r[i]=t.bind(n))}if(s){const e=s.call(n,n);y(e)&&(t.data=se(e))}if(Ln=!0,o)for(const h in o){const t=o[h],e=m(t)?t.bind(n,n):m(t.get)?t.get.bind(n,n):i,s=!m(t)&&m(t.set)?t.set.bind(n):i,a=Hr({get:e,set:s});Object.defineProperty(r,h,{enumerable:!0,configurable:!0,get:()=>a.value,set:t=>a.value=t})}if(l)for(const i in l)Pn(l[i],r,n,i);if(c){const t=m(c)?c.call(n):c;Reflect.ownKeys(t).forEach((e=>{Zn(e,t[e])}))}function k(t,e){h(e)?e.forEach((e=>t(e.bind(n)))):e&&t(e.bind(n))}if(d&&kn(d,t,"c"),k(pn,p),k(fn,f),k(mn,g),k(gn,v),k(Ni,_),k(Di,b),k(wn,E),k(xn,A),k(bn,T),k(vn,w),k(yn,M),k(_n,I),h(R))if(R.length){const e=t.exposed||(t.exposed={});R.forEach((t=>{Object.defineProperty(e,t,{get:()=>n[t],set:e=>n[t]=e})}))}else t.exposed||(t.exposed={});C&&t.render===i&&(t.render=C),null!=N&&(t.inheritAttrs=N),D&&(t.components=D),L&&(t.directives=L)}function kn(t,e,n){Ee(h(t)?t.map((t=>t.bind(e.proxy))):t.bind(e.proxy),e,n)}function Pn(t,e,n,i){const r=i.includes(".")?Ei(n,i):()=>n[i];if(g(t)){const n=e[t];m(n)&&Ci(r,n)}else if(m(t))Ci(r,t.bind(n));else if(y(t))if(h(t))t.forEach((t=>Pn(t,e,n,i)));else{const i=m(t.handler)?t.handler.bind(n):e[t.handler];m(i)&&Ci(r,i,t)}}function Fn(t){const e=t.type,{mixins:n,extends:i}=e,{mixins:r,optionsCache:s,config:{optionMergeStrategies:o}}=t.appContext,a=s.get(e);let l;return a?l=a:r.length||n||i?(l={},r.length&&r.forEach((t=>Bn(l,t,o,!0))),Bn(l,e,o)):l=e,y(e)&&s.set(e,l),l}function Bn(t,e,n,i=!1){const{mixins:r,extends:s}=e;s&&Bn(t,s,n,!0),r&&r.forEach((e=>Bn(t,e,n,!0)));for(const o in e)if(i&&"expose"===o);else{const i=zn[o]||n&&n[o];t[o]=i?i(t[o],e[o]):e[o]}return t}const zn={data:Un,props:Hn,emits:Hn,methods:Gn,computed:Gn,beforeCreate:Wn,created:Wn,beforeMount:Wn,mounted:Wn,beforeUpdate:Wn,updated:Wn,beforeDestroy:Wn,beforeUnmount:Wn,destroyed:Wn,unmounted:Wn,activated:Wn,deactivated:Wn,errorCaptured:Wn,serverPrefetch:Wn,components:Gn,directives:Gn,watch:function(t,e){if(!t)return e;if(!e)return t;const n=a(Object.create(null),t);for(const i in e)n[i]=Wn(t[i],e[i]);return n},provide:Un,inject:function(t,e){return Gn(Vn(t),Vn(e))}};function Un(t,e){return e?t?function(){return a(m(t)?t.call(this,this):t,m(e)?e.call(this,this):e)}:e:t}function Vn(t){if(h(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function Wn(t,e){return t?[...new Set([].concat(t,e))]:e}function Gn(t,e){return t?a(Object.create(null),t,e):e}function Hn(t,e){return t?h(t)&&h(e)?[...new Set([...t,...e])]:a(Object.create(null),Dn(t),Dn(null!=e?e:{})):e}function jn(){return{app:null,config:{isNativeTag:r,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qn=0;function Xn(t,e){return function(n,i=null){m(n)||(n=a({},n)),null==i||y(i)||(i=null);const r=jn(),s=new WeakSet;let o=!1;const l=r.app={_uid:qn++,_component:n,_props:i,_container:null,_context:r,_instance:null,version:qr,get config(){return r.config},set config(t){},use:(t,...e)=>(s.has(t)||(t&&m(t.install)?(s.add(t),t.install(l,...e)):m(t)&&(s.add(t),t(l,...e))),l),mixin:t=>(r.mixins.includes(t)||r.mixins.push(t),l),component:(t,e)=>e?(r.components[t]=e,l):r.components[t],directive:(t,e)=>e?(r.directives[t]=e,l):r.directives[t],mount(s,a,c){if(!o){const u=yr(n,i);return u.appContext=r,!0===c?c="svg":!1===c&&(c=void 0),a&&e?e(u,s):t(u,s,c),o=!0,l._container=s,s.__vue_app__=l,Wr(u.component)}},unmount(){o&&(t(null,l._container),delete l._container.__vue_app__)},provide:(t,e)=>(r.provides[t]=e,l),runWithContext(t){const e=Yn;Yn=l;try{return t()}finally{Yn=e}}};return l}}let Yn=null;function Zn(t,e){if(Rr){let n=Rr.provides;const i=Rr.parent&&Rr.parent.provides;i===n&&(n=Rr.provides=Object.create(i)),n[t]=e}else;}function Kn(t,e,n=!1){const i=Rr||Ke;if(i||Yn){const r=i?null==i.parent?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:Yn._context.provides;if(r&&t in r)return r[t];if(arguments.length>1)return n&&m(e)?e.call(i&&i.proxy):e}}const $n={},Jn=()=>Object.create($n),Qn=t=>Object.getPrototypeOf(t)===$n;function ti(t,n,i,r){const[s,o]=t.propsOptions;let a,l=!1;if(n)for(let e in n){if(C(e))continue;const c=n[e];let h;s&&u(s,h=E(e))?o&&o.includes(h)?(a||(a={}))[h]=c:i[h]=c:Ze(t.emitsOptions,e)||e in r&&c===r[e]||(r[e]=c,l=!0)}if(o){const n=pe(i),r=a||e;for(let e=0;e<o.length;e++){const a=o[e];i[a]=ei(s,n,a,r[a],t,!u(r,a))}}return l}function ei(t,e,n,i,r,s){const o=t[n];if(null!=o){const t=u(o,"default");if(t&&void 0===i){const t=o.default;if(o.type!==Function&&!o.skipFactory&&m(t)){const{propsDefaults:s}=r;if(n in s)i=s[n];else{const o=Or(r);i=s[n]=t.call(null,e),o()}}else i=t}o[0]&&(s&&!t?i=!1:!o[1]||""!==i&&i!==R(n)||(i=!0))}return i}function ni(t,i,r=!1){const s=i.propsCache,o=s.get(t);if(o)return o;const l=t.props,c={},d=[];let p=!1;if(!m(t)){const e=t=>{p=!0;const[e,n]=ni(t,i,!0);a(c,e),n&&d.push(...n)};!r&&i.mixins.length&&i.mixins.forEach(e),t.extends&&e(t.extends),t.mixins&&t.mixins.forEach(e)}if(!l&&!p)return y(t)&&s.set(t,n),n;if(h(l))for(let n=0;n<l.length;n++){const t=E(l[n]);ii(t)&&(c[t]=e)}else if(l)for(const e in l){const t=E(e);if(ii(t)){const n=l[e],i=c[t]=h(n)||m(n)?{type:n}:a({},n);if(i){const e=oi(Boolean,i.type),n=oi(String,i.type);i[0]=e>-1,i[1]=n<0||e<n,(e>-1||u(i,"default"))&&d.push(t)}}}const f=[c,d];return y(t)&&s.set(t,f),f}function ii(t){return"$"!==t[0]&&!C(t)}function ri(t){if(null===t)return"null";if("function"==typeof t)return t.name||"";if("object"==typeof t){return t.constructor&&t.constructor.name||""}return""}function si(t,e){return ri(t)===ri(e)}function oi(t,e){return h(e)?e.findIndex((e=>si(e,t))):m(e)&&si(e,t)?0:-1}const ai=t=>"_"===t[0]||"$stable"===t,li=t=>h(t)?t.map(Sr):[Sr(t)],ci=(t,e,n)=>{if(e._n)return e;const i=en(((...t)=>li(e(...t))),n);return i._c=!1,i},ui=(t,e,n)=>{const i=t._ctx;for(const r in t){if(ai(r))continue;const n=t[r];if(m(n))e[r]=ci(0,n,i);else if(null!=n){const t=li(n);e[r]=()=>t}}},hi=(t,e)=>{const n=li(e);t.slots.default=()=>n},di=(t,e)=>{const n=t.slots=Jn();if(32&t.vnode.shapeFlag){const t=e._;t?(a(n,e),k(n,"_",t,!0)):ui(e,n)}else e&&hi(t,e)},pi=(t,n,i)=>{const{vnode:r,slots:s}=t;let o=!0,l=e;if(32&r.shapeFlag){const t=n._;t?i&&1===t?o=!1:(a(s,n),i||1!==t||delete s._):(o=!n.$stable,ui(n,s)),l=n}else n&&(hi(t,n),l={default:1});if(o)for(const e in s)ai(e)||null!=l[e]||delete s[e]};function fi(t,n,i,r,s=!1){if(h(t))return void t.forEach(((t,e)=>fi(t,n&&(h(n)?n[e]:n),i,r,s)));if(Tn(r)&&!s)return;const o=4&r.shapeFlag?Wr(r.component):r.el,a=s?null:o,{i:c,r:d}=t,p=n&&n.r,f=c.refs===e?c.refs={}:c.refs,v=c.setupState;if(null!=p&&p!==d&&(g(p)?(f[p]=null,u(v,p)&&(v[p]=null)):be(p)&&(p.value=null)),m(d))Te(d,c,12,[a,f]);else{const e=g(d),n=be(d);if(e||n){const r=()=>{if(t.f){const n=e?u(v,d)?v[d]:f[d]:d.value;s?h(n)&&l(n,o):h(n)?n.includes(o)||n.push(o):e?(f[d]=[o],u(v,d)&&(v[d]=f[d])):(d.value=[o],t.k&&(f[t.k]=d.value))}else e?(f[d]=a,u(v,d)&&(v[d]=a)):n&&(d.value=a,t.k&&(f[t.k]=a))};a?(r.id=-1,mi(r,i)):r()}}}const mi=function(t,e){var n;e&&e.pendingBranch?h(t)?e.effects.push(...t):e.effects.push(t):(h(n=t)?Oe.push(...n):ke&&ke.includes(n,n.allowRecurse?Pe+1:Pe)||Oe.push(n),Ve())};function gi(t){return function(t,r){"boolean"!=typeof __VUE_PROD_HYDRATION_MISMATCH_DETAILS__&&(z().__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1);z().__VUE__=!0;const{insert:s,remove:o,patchProp:a,createElement:l,createText:c,createComment:h,setText:d,setElementText:p,parentNode:f,nextSibling:m,setScopeId:g=i,insertStaticContent:v}=t,y=(t,e,n,i=null,r=null,s=null,o=void 0,a=null,l=!!e.dynamicChildren)=>{if(t===e)return;t&&!fr(t,e)&&(i=J(t),X(t,r,s,!0),t=null),-2===e.patchFlag&&(l=!1,e.dynamicChildren=null);const{type:c,ref:u,shapeFlag:h}=e;switch(c){case ir:b(t,e,n,i);break;case rr:x(t,e,n,i);break;case sr:null==t&&w(e,n,i,o);break;case nr:P(t,e,n,i,r,s,o,a,l);break;default:1&h?A(t,e,n,i,r,s,o,a,l):6&h?F(t,e,n,i,r,s,o,a,l):(64&h||128&h)&&c.process(t,e,n,i,r,s,o,a,l,et)}null!=u&&r&&fi(u,t&&t.ref,s,e||t,!e)},b=(t,e,n,i)=>{if(null==t)s(e.el=c(e.children),n,i);else{const n=e.el=t.el;e.children!==t.children&&d(n,e.children)}},x=(t,e,n,i)=>{null==t?s(e.el=h(e.children||""),n,i):e.el=t.el},w=(t,e,n,i)=>{[t.el,t.anchor]=v(t.children,e,n,i,t.el,t.anchor)},S=({el:t,anchor:e},n,i)=>{let r;for(;t&&t!==e;)r=m(t),s(t,n,i),t=r;s(e,n,i)},M=({el:t,anchor:e})=>{let n;for(;t&&t!==e;)n=m(t),o(t),t=n;o(e)},A=(t,e,n,i,r,s,o,a,l)=>{"svg"===e.type?o="svg":"math"===e.type&&(o="mathml"),null==t?T(e,n,i,r,s,o,a,l):D(t,e,r,s,o,a,l)},T=(t,e,n,i,r,o,c,u)=>{let h,d;const{props:f,shapeFlag:m,transition:g,dirs:v}=t;if(h=t.el=l(t.type,o,f&&f.is,f),8&m?p(h,t.children):16&m&&N(t.children,h,null,i,r,vi(t,o),c,u),v&&Mn(t,null,i,"created"),I(h,t,t.scopeId,c,i),f){for(const e in f)"value"===e||C(e)||a(h,e,null,f[e],o,t.children,i,r,$);"value"in f&&a(h,"value",null,f.value,o),(d=f.onVnodeBeforeMount)&&Tr(d,i,t)}v&&Mn(t,null,i,"beforeMount");const y=function(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}(r,g);y&&g.beforeEnter(h),s(h,e,n),((d=f&&f.onVnodeMounted)||y||v)&&mi((()=>{d&&Tr(d,i,t),y&&g.enter(h),v&&Mn(t,null,i,"mounted")}),r)},I=(t,e,n,i,r)=>{if(n&&g(t,n),i)for(let s=0;s<i.length;s++)g(t,i[s]);if(r){if(e===r.subTree){const e=r.vnode;I(t,e,e.scopeId,e.slotScopeIds,r.parent)}}},N=(t,e,n,i,r,s,o,a,l=0)=>{for(let c=l;c<t.length;c++){const l=t[c]=a?Mr(t[c]):Sr(t[c]);y(null,l,e,n,i,r,s,o,a)}},D=(t,n,i,r,s,o,l)=>{const c=n.el=t.el;let{patchFlag:u,dynamicChildren:h,dirs:d}=n;u|=16&t.patchFlag;const f=t.props||e,m=n.props||e;let g;if(i&&yi(i,!1),(g=m.onVnodeBeforeUpdate)&&Tr(g,i,n,t),d&&Mn(n,t,i,"beforeUpdate"),i&&yi(i,!0),h?L(t.dynamicChildren,h,c,i,r,vi(n,s),o):l||G(t,n,c,null,i,r,vi(n,s),o,!1),u>0){if(16&u)k(c,n,f,m,i,r,s);else if(2&u&&f.class!==m.class&&a(c,"class",null,m.class,s),4&u&&a(c,"style",f.style,m.style,s),8&u){const e=n.dynamicProps;for(let n=0;n<e.length;n++){const o=e[n],l=f[o],u=m[o];u===l&&"value"!==o||a(c,o,l,u,s,t.children,i,r,$)}}1&u&&t.children!==n.children&&p(c,n.children)}else l||null!=h||k(c,n,f,m,i,r,s);((g=m.onVnodeUpdated)||d)&&mi((()=>{g&&Tr(g,i,n,t),d&&Mn(n,t,i,"updated")}),r)},L=(t,e,n,i,r,s,o)=>{for(let a=0;a<e.length;a++){const l=t[a],c=e[a],u=l.el&&(l.type===nr||!fr(l,c)||70&l.shapeFlag)?f(l.el):n;y(l,c,u,null,i,r,s,o,!0)}},k=(t,n,i,r,s,o,l)=>{if(i!==r){if(i!==e)for(const e in i)C(e)||e in r||a(t,e,i[e],null,l,n.children,s,o,$);for(const e in r){if(C(e))continue;const c=r[e],u=i[e];c!==u&&"value"!==e&&a(t,e,u,c,l,n.children,s,o,$)}"value"in r&&a(t,"value",i.value,r.value,l)}},P=(t,e,n,i,r,o,a,l,u)=>{const h=e.el=t?t.el:c(""),d=e.anchor=t?t.anchor:c("");let{patchFlag:p,dynamicChildren:f,slotScopeIds:m}=e;m&&(l=l?l.concat(m):m),null==t?(s(h,n,i),s(d,n,i),N(e.children||[],n,d,r,o,a,l,u)):p>0&&64&p&&f&&t.dynamicChildren?(L(t.dynamicChildren,f,n,r,o,a,l),(null!=e.key||r&&e===r.subTree)&&_i(t,e,!0)):G(t,e,n,d,r,o,a,l,u)},F=(t,e,n,i,r,s,o,a,l)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?r.ctx.activate(e,n,i,o,l):B(e,n,i,r,s,o,l):U(t,e,l)},B=(t,n,i,r,s,o,a)=>{const l=t.component=function(t,n,i){const r=t.type,s=(n?n.appContext:t.appContext)||Er,o={uid:Ir++,vnode:t,type:r,parent:n,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new nt(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ni(r,s),emitsOptions:Ye(r,s),emit:null,emitted:null,propsDefaults:e,inheritAttrs:r.inheritAttrs,ctx:e,data:e,props:e,attrs:e,slots:e,refs:e,setupState:e,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};o.ctx={_:o},o.root=n?n.root:o,o.emit=Xe.bind(null,o),t.ce&&t.ce(o);return o}(t,r,s);if(Ri(t)&&(l.ctx.renderer=et),function(t,e=!1){e&&Lr(e);const{props:n,children:i}=t.vnode,r=Pr(t);(function(t,e,n,i=!1){const r={},s=Jn();t.propsDefaults=Object.create(null),ti(t,e,r,s);for(const o in t.propsOptions[0])o in r||(r[o]=void 0);n?t.props=i?r:oe(r):t.type.props?t.props=r:t.props=s,t.attrs=s})(t,n,r,e),di(t,i);const s=r?function(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Nn);const{setup:i}=n;if(i){const n=t.setupContext=i.length>1?function(t){const e=e=>{t.exposed=e||{}};return{attrs:new Proxy(t.attrs,Vr),slots:t.slots,emit:t.emit,expose:e}}(t):null,r=Or(t);ut();const s=Te(i,t,0,[t.props,n]);if(ht(),r(),_(s)){if(s.then(kr,kr),e)return s.then((n=>{zr(t,n,e)})).catch((e=>{Ie(e,t,0)}));t.asyncDep=s}else zr(t,s,e)}else Ur(t,e)}(t,e):void 0;e&&Lr(!1)}(l),l.asyncDep){if(s&&s.registerDep(l,V,a),!t.el){const t=l.subTree=yr(rr);x(null,t,n,i)}}else V(l,t,n,i,s,o,a)},U=(t,e,n)=>{const i=e.component=t.component;if(function(t,e,n){const{props:i,children:r,component:s}=t,{props:o,children:a,patchFlag:l}=e,c=s.emitsOptions;if(e.dirs||e.transition)return!0;if(!(n&&l>=0))return!(!r&&!a||a&&a.$stable)||i!==o&&(i?!o||on(i,o,c):!!o);if(1024&l)return!0;if(16&l)return i?on(i,o,c):!!o;if(8&l){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const n=t[e];if(o[n]!==i[n]&&!Ze(c,n))return!0}}return!1}(t,e,n)){if(i.asyncDep&&!i.asyncResolved)return void W(i,e,n);i.next=e,function(t){const e=De.indexOf(t);e>Le&&De.splice(e,1)}(i.update),i.effect.dirty=!0,i.update()}else e.el=t.el,i.vnode=e},V=(t,e,n,r,s,o,a)=>{const l=()=>{if(t.isMounted){let{next:e,bu:n,u:i,parent:r,vnode:c}=t;{const n=bi(t);if(n)return e&&(e.el=c.el,W(t,e,a)),void n.asyncDep.then((()=>{t.isUnmounted||l()}))}let u,h=e;yi(t,!1),e?(e.el=c.el,W(t,e,a)):e=c,n&&O(n),(u=e.props&&e.props.onVnodeBeforeUpdate)&&Tr(u,r,e,c),yi(t,!0);const d=nn(t),p=t.subTree;t.subTree=d,y(p,d,f(p.el),J(p),t,s,o),e.el=d.el,null===h&&function({vnode:t,parent:e},n){for(;e;){const i=e.subTree;if(i.suspense&&i.suspense.activeBranch===t&&(i.el=t.el),i!==t)break;(t=e.vnode).el=n,e=e.parent}}(t,d.el),i&&mi(i,s),(u=e.props&&e.props.onVnodeUpdated)&&mi((()=>Tr(u,r,e,c)),s)}else{let i;const{el:a,props:l}=e,{bm:c,m:u,parent:h}=t,d=Tn(e);if(yi(t,!1),c&&O(c),!d&&(i=l&&l.onVnodeBeforeMount)&&Tr(i,h,e),yi(t,!0),a&&st){const n=()=>{t.subTree=nn(t),st(a,t.subTree,t,s,null)};d?e.type.__asyncLoader().then((()=>!t.isUnmounted&&n())):n()}else{const i=t.subTree=nn(t);y(null,i,n,r,t,s,o),e.el=i.el}if(u&&mi(u,s),!d&&(i=l&&l.onVnodeMounted)){const t=e;mi((()=>Tr(i,h,t)),s)}(256&e.shapeFlag||h&&Tn(h.vnode)&&256&h.vnode.shapeFlag)&&t.a&&mi(t.a,s),t.isMounted=!0,e=n=r=null}},c=t.effect=new it(l,i,(()=>Ue(u)),t.scope),u=t.update=()=>{c.dirty&&c.run()};u.id=t.uid,yi(t,!0),u()},W=(t,e,n)=>{e.component=t;const i=t.vnode.props;t.vnode=e,t.next=null,function(t,e,n,i){const{props:r,attrs:s,vnode:{patchFlag:o}}=t,a=pe(r),[l]=t.propsOptions;let c=!1;if(!(i||o>0)||16&o){let i;ti(t,e,r,s)&&(c=!0);for(const s in a)e&&(u(e,s)||(i=R(s))!==s&&u(e,i))||(l?!n||void 0===n[s]&&void 0===n[i]||(r[s]=ei(l,a,s,void 0,t,!0)):delete r[s]);if(s!==a)for(const t in s)e&&u(e,t)||(delete s[t],c=!0)}else if(8&o){const n=t.vnode.dynamicProps;for(let i=0;i<n.length;i++){let o=n[i];if(Ze(t.emitsOptions,o))continue;const h=e[o];if(l)if(u(s,o))h!==s[o]&&(s[o]=h,c=!0);else{const e=E(o);r[e]=ei(l,a,e,h,t,!1)}else h!==s[o]&&(s[o]=h,c=!0)}}c&&wt(t.attrs,"set","")}(t,e.props,i,n),pi(t,e.children,n),ut(),We(t),ht()},G=(t,e,n,i,r,s,o,a,l=!1)=>{const c=t&&t.children,u=t?t.shapeFlag:0,h=e.children,{patchFlag:d,shapeFlag:f}=e;if(d>0){if(128&d)return void j(c,h,n,i,r,s,o,a,l);if(256&d)return void H(c,h,n,i,r,s,o,a,l)}8&f?(16&u&&$(c,r,s),h!==c&&p(n,h)):16&u?16&f?j(c,h,n,i,r,s,o,a,l):$(c,r,s,!0):(8&u&&p(n,""),16&f&&N(h,n,i,r,s,o,a,l))},H=(t,e,i,r,s,o,a,l,c)=>{e=e||n;const u=(t=t||n).length,h=e.length,d=Math.min(u,h);let p;for(p=0;p<d;p++){const n=e[p]=c?Mr(e[p]):Sr(e[p]);y(t[p],n,i,null,s,o,a,l,c)}u>h?$(t,s,o,!0,!1,d):N(e,i,r,s,o,a,l,c,d)},j=(t,e,i,r,s,o,a,l,c)=>{let u=0;const h=e.length;let d=t.length-1,p=h-1;for(;u<=d&&u<=p;){const n=t[u],r=e[u]=c?Mr(e[u]):Sr(e[u]);if(!fr(n,r))break;y(n,r,i,null,s,o,a,l,c),u++}for(;u<=d&&u<=p;){const n=t[d],r=e[p]=c?Mr(e[p]):Sr(e[p]);if(!fr(n,r))break;y(n,r,i,null,s,o,a,l,c),d--,p--}if(u>d){if(u<=p){const t=p+1,n=t<h?e[t].el:r;for(;u<=p;)y(null,e[u]=c?Mr(e[u]):Sr(e[u]),i,n,s,o,a,l,c),u++}}else if(u>p)for(;u<=d;)X(t[u],s,o,!0),u++;else{const f=u,m=u,g=new Map;for(u=m;u<=p;u++){const t=e[u]=c?Mr(e[u]):Sr(e[u]);null!=t.key&&g.set(t.key,u)}let v,_=0;const b=p-m+1;let x=!1,w=0;const S=new Array(b);for(u=0;u<b;u++)S[u]=0;for(u=f;u<=d;u++){const n=t[u];if(_>=b){X(n,s,o,!0);continue}let r;if(null!=n.key)r=g.get(n.key);else for(v=m;v<=p;v++)if(0===S[v-m]&&fr(n,e[v])){r=v;break}void 0===r?X(n,s,o,!0):(S[r-m]=u+1,r>=w?w=r:x=!0,y(n,e[r],i,null,s,o,a,l,c),_++)}const M=x?function(t){const e=t.slice(),n=[0];let i,r,s,o,a;const l=t.length;for(i=0;i<l;i++){const l=t[i];if(0!==l){if(r=n[n.length-1],t[r]<l){e[i]=r,n.push(i);continue}for(s=0,o=n.length-1;s<o;)a=s+o>>1,t[n[a]]<l?s=a+1:o=a;l<t[n[s]]&&(s>0&&(e[i]=n[s-1]),n[s]=i)}}s=n.length,o=n[s-1];for(;s-- >0;)n[s]=o,o=e[o];return n}(S):n;for(v=M.length-1,u=b-1;u>=0;u--){const t=m+u,n=e[t],d=t+1<h?e[t+1].el:r;0===S[u]?y(null,n,i,d,s,o,a,l,c):x&&(v<0||u!==M[v]?q(n,i,d,2):v--)}}},q=(t,e,n,i,r=null)=>{const{el:o,type:a,transition:l,children:c,shapeFlag:u}=t;if(6&u)return void q(t.component.subTree,e,n,i);if(128&u)return void t.suspense.move(e,n,i);if(64&u)return void a.move(t,e,n,et);if(a===nr){s(o,e,n);for(let t=0;t<c.length;t++)q(c[t],e,n,i);return void s(t.anchor,e,n)}if(a===sr)return void S(t,e,n);if(2!==i&&1&u&&l)if(0===i)l.beforeEnter(o),s(o,e,n),mi((()=>l.enter(o)),r);else{const{leave:t,delayLeave:i,afterLeave:r}=l,a=()=>s(o,e,n),c=()=>{t(o,(()=>{a(),r&&r()}))};i?i(o,a,c):c()}else s(o,e,n)},X=(t,e,n,i=!1,r=!1)=>{const{type:s,props:o,ref:a,children:l,dynamicChildren:c,shapeFlag:u,patchFlag:h,dirs:d,memoIndex:p}=t;if(-2===h&&(r=!1),null!=a&&fi(a,null,n,t,!0),null!=p&&(e.renderCache[p]=void 0),256&u)return void e.ctx.deactivate(t);const f=1&u&&d,m=!Tn(t);let g;if(m&&(g=o&&o.onVnodeBeforeUnmount)&&Tr(g,e,t),6&u)K(t.component,n,i);else{if(128&u)return void t.suspense.unmount(n,i);f&&Mn(t,null,e,"beforeUnmount"),64&u?t.type.remove(t,e,n,et,i):c&&(s!==nr||h>0&&64&h)?$(c,e,n,!1,!0):(s===nr&&384&h||!r&&16&u)&&$(l,e,n),i&&Y(t)}(m&&(g=o&&o.onVnodeUnmounted)||f)&&mi((()=>{g&&Tr(g,e,t),f&&Mn(t,null,e,"unmounted")}),n)},Y=t=>{const{type:e,el:n,anchor:i,transition:r}=t;if(e===nr)return void Z(n,i);if(e===sr)return void M(t);const s=()=>{o(n),r&&!r.persisted&&r.afterLeave&&r.afterLeave()};if(1&t.shapeFlag&&r&&!r.persisted){const{leave:e,delayLeave:i}=r,o=()=>e(n,s);i?i(t.el,s,o):o()}else s()},Z=(t,e)=>{let n;for(;t!==e;)n=m(t),o(t),t=n;o(e)},K=(t,e,n)=>{const{bum:i,scope:r,update:s,subTree:o,um:a,m:l,a:c}=t;xi(l),xi(c),i&&O(i),r.stop(),s&&(s.active=!1,X(o,t,e,n)),a&&mi(a,e),mi((()=>{t.isUnmounted=!0}),e),e&&e.pendingBranch&&!e.isUnmounted&&t.asyncDep&&!t.asyncResolved&&t.suspenseId===e.pendingId&&(e.deps--,0===e.deps&&e.resolve())},$=(t,e,n,i=!1,r=!1,s=0)=>{for(let o=s;o<t.length;o++)X(t[o],e,n,i,r)},J=t=>6&t.shapeFlag?J(t.component.subTree):128&t.shapeFlag?t.suspense.next():m(t.anchor||t.el);let Q=!1;const tt=(t,e,n)=>{null==t?e._vnode&&X(e._vnode,null,null,!0):y(e._vnode||null,t,e,null,null,null,n),Q||(Q=!0,We(),Ge(),Q=!1),e._vnode=t},et={p:y,um:X,m:q,r:Y,mt:B,mc:N,pc:G,pbc:L,n:J,o:t};let rt,st;r&&([rt,st]=r(et));return{render:tt,hydrate:rt,createApp:Xn(tt,rt)}}(t)}function vi({type:t,props:e},n){return"svg"===n&&"foreignObject"===t||"mathml"===n&&"annotation-xml"===t&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function yi({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function _i(t,e,n=!1){const i=t.children,r=e.children;if(h(i)&&h(r))for(let s=0;s<i.length;s++){const t=i[s];let e=r[s];1&e.shapeFlag&&!e.dynamicChildren&&((e.patchFlag<=0||32===e.patchFlag)&&(e=r[s]=Mr(r[s]),e.el=t.el),n||-2===e.patchFlag||_i(t,e)),e.type===ir&&(e.el=t.el)}}function bi(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:bi(e)}function xi(t){if(t)for(let e=0;e<t.length;e++)t[e].active=!1}const wi=Symbol.for("v-scx"),Si=()=>Kn(wi);const Mi={};function Ci(t,e,n){return Ai(t,e,n)}function Ai(t,n,{immediate:r,deep:s,flush:o,once:a,onTrack:c,onTrigger:u}=e){if(n&&a){const t=n;n=(...e)=>{t(...e),A()}}const d=Rr,p=t=>!0===s?t:Ii(t,!1===s?1:void 0);let f,g,v=!1,y=!1;if(be(t)?(f=()=>t.value,v=he(t)):ce(t)?(f=()=>p(t),v=!0):h(t)?(y=!0,v=t.some((t=>ce(t)||he(t))),f=()=>t.map((t=>be(t)?t.value:ce(t)?p(t):m(t)?Te(t,d,2):void 0))):f=m(t)?n?()=>Te(t,d,2):()=>(g&&g(),Ee(t,d,3,[b])):i,n&&s){const t=f;f=()=>Ii(t())}let _,b=t=>{g=M.onStop=()=>{Te(t,d,4),g=M.onStop=void 0}};if(Br){if(b=i,n?r&&Ee(n,d,3,[f(),y?[]:void 0,b]):f(),"sync"!==o)return i;{const t=Si();_=t.__watcherHandles||(t.__watcherHandles=[])}}let x=y?new Array(t.length).fill(Mi):Mi;const w=()=>{if(M.active&&M.dirty)if(n){const t=M.run();(s||v||(y?t.some(((t,e)=>L(t,x[e]))):L(t,x)))&&(g&&g(),Ee(n,d,3,[t,x===Mi?void 0:y&&x[0]===Mi?[]:x,b]),x=t)}else M.run()};let S;w.allowRecurse=!!n,"sync"===o?S=w:"post"===o?S=()=>mi(w,d&&d.suspense):(w.pre=!0,d&&(w.id=d.uid),S=()=>Ue(w));const M=new it(f,i,S),C=tt,A=()=>{M.stop(),C&&l(C.effects,M)};return n?r?w():x=M.run():"post"===o?mi(M.run.bind(M),d&&d.suspense):M.run(),_&&_.push(A),A}function Ti(t,e,n){const i=this.proxy,r=g(t)?t.includes(".")?Ei(i,t):()=>i[t]:t.bind(i,i);let s;m(e)?s=e:(s=e.handler,n=e);const o=Or(this),a=Ai(r,s.bind(i),n);return o(),a}function Ei(t,e){const n=e.split(".");return()=>{let e=t;for(let t=0;t<n.length&&e;t++)e=e[n[t]];return e}}function Ii(t,e=1/0,n){if(e<=0||!y(t)||t.__v_skip)return t;if((n=n||new Set).has(t))return t;if(n.add(t),e--,be(t))Ii(t.value,e,n);else if(h(t))for(let i=0;i<t.length;i++)Ii(t[i],e,n);else if(p(t)||d(t))t.forEach((t=>{Ii(t,e,n)}));else if(S(t)){for(const i in t)Ii(t[i],e,n);for(const i of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,i)&&Ii(t[i],e,n)}return t}const Ri=t=>t.type.__isKeepAlive;function Ni(t,e){Li(t,"a",e)}function Di(t,e){Li(t,"da",e)}function Li(t,e,n=Rr){const i=t.__wdc||(t.__wdc=()=>{let e=n;for(;e;){if(e.isDeactivated)return;e=e.parent}return t()});if(hn(e,i,n),n){let t=n.parent;for(;t&&t.parent;)Ri(t.parent.vnode)&&Oi(i,e,n,t),t=t.parent}}function Oi(t,e,n,i){const r=hn(e,t,i,!0);yn((()=>{l(i[e],r)}),n)}const ki=Symbol("_leaveCb"),Pi=Symbol("_enterCb");const Fi=[Function,Array],Bi={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Fi,onEnter:Fi,onAfterEnter:Fi,onEnterCancelled:Fi,onBeforeLeave:Fi,onLeave:Fi,onAfterLeave:Fi,onLeaveCancelled:Fi,onBeforeAppear:Fi,onAppear:Fi,onAfterAppear:Fi,onAppearCancelled:Fi},zi=t=>{const e=t.subTree;return e.component?zi(e.component):e},Ui={name:"BaseTransition",props:Bi,setup(t,{slots:e}){const n=Nr(),i=function(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return fn((()=>{t.isMounted=!0})),vn((()=>{t.isUnmounting=!0})),t}();return()=>{const r=e.default&&Xi(e.default(),!0);if(!r||!r.length)return;let s=r[0];if(r.length>1)for(const t of r)if(t.type!==rr){s=t;break}const o=pe(t),{mode:a}=o;if(i.isLeaving)return Hi(s);const l=ji(s);if(!l)return Hi(s);let c=Gi(l,o,i,n,(t=>c=t));qi(l,c);const u=n.subTree,h=u&&ji(u);if(h&&h.type!==rr&&!fr(l,h)&&zi(n).type!==rr){const t=Gi(h,o,i,n);if(qi(h,t),"out-in"===a&&l.type!==rr)return i.isLeaving=!0,t.afterLeave=()=>{i.isLeaving=!1,!1!==n.update.active&&(n.effect.dirty=!0,n.update())},Hi(s);"in-out"===a&&l.type!==rr&&(t.delayLeave=(t,e,n)=>{Wi(i,h)[String(h.key)]=h,t[ki]=()=>{e(),t[ki]=void 0,delete c.delayedLeave},c.delayedLeave=n})}return s}}},Vi=Ui;function Wi(t,e){const{leavingVNodes:n}=t;let i=n.get(e.type);return i||(i=Object.create(null),n.set(e.type,i)),i}function Gi(t,e,n,i,r){const{appear:s,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:p,onLeave:f,onAfterLeave:m,onLeaveCancelled:g,onBeforeAppear:v,onAppear:y,onAfterAppear:_,onAppearCancelled:b}=e,x=String(t.key),w=Wi(n,t),S=(t,e)=>{t&&Ee(t,i,9,e)},M=(t,e)=>{const n=e[1];S(t,e),h(t)?t.every((t=>t.length<=1))&&n():t.length<=1&&n()},C={mode:o,persisted:a,beforeEnter(e){let i=l;if(!n.isMounted){if(!s)return;i=v||l}e[ki]&&e[ki](!0);const r=w[x];r&&fr(t,r)&&r.el[ki]&&r.el[ki](),S(i,[e])},enter(t){let e=c,i=u,r=d;if(!n.isMounted){if(!s)return;e=y||c,i=_||u,r=b||d}let o=!1;const a=t[Pi]=e=>{o||(o=!0,S(e?r:i,[t]),C.delayedLeave&&C.delayedLeave(),t[Pi]=void 0)};e?M(e,[t,a]):a()},leave(e,i){const r=String(t.key);if(e[Pi]&&e[Pi](!0),n.isUnmounting)return i();S(p,[e]);let s=!1;const o=e[ki]=n=>{s||(s=!0,i(),S(n?g:m,[e]),e[ki]=void 0,w[r]===t&&delete w[r])};w[r]=t,f?M(f,[e,o]):o()},clone(t){const s=Gi(t,e,n,i,r);return r&&r(s),s}};return C}function Hi(t){if(Ri(t))return(t=_r(t)).children=null,t}function ji(t){if(!Ri(t))return t;const{shapeFlag:e,children:n}=t;if(n){if(16&e)return n[0];if(32&e&&m(n.default))return n.default()}}function qi(t,e){6&t.shapeFlag&&t.component?qi(t.component.subTree,e):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function Xi(t,e=!1,n){let i=[],r=0;for(let s=0;s<t.length;s++){let o=t[s];const a=null==n?o.key:String(n)+String(null!=o.key?o.key:s);o.type===nr?(128&o.patchFlag&&r++,i=i.concat(Xi(o.children,e,a))):(e||o.type!==rr)&&i.push(null!=a?_r(o,{key:a}):o)}if(r>1)for(let s=0;s<i.length;s++)i[s].patchFlag=-2;return i}const Yi=t=>t&&(t.disabled||""===t.disabled),Zi=t=>"undefined"!=typeof SVGElement&&t instanceof SVGElement,Ki=t=>"function"==typeof MathMLElement&&t instanceof MathMLElement,$i=(t,e)=>{const n=t&&t.to;if(g(n)){if(e){return e(n)}return null}return n},Ji={name:"Teleport",__isTeleport:!0,process(t,e,n,i,r,s,o,a,l,c){const{mc:u,pc:h,pbc:d,o:{insert:p,querySelector:f,createText:m,createComment:g}}=c,v=Yi(e.props);let{shapeFlag:y,children:_,dynamicChildren:b}=e;if(null==t){const t=e.el=m(""),c=e.anchor=m("");p(t,n,i),p(c,n,i);const h=e.target=$i(e.props,f),d=e.targetAnchor=m("");h&&(p(d,h),"svg"===o||Zi(h)?o="svg":("mathml"===o||Ki(h))&&(o="mathml"));const g=(t,e)=>{16&y&&u(_,t,e,r,s,o,a,l)};v?g(n,c):h&&g(h,d)}else{e.el=t.el;const i=e.anchor=t.anchor,u=e.target=t.target,p=e.targetAnchor=t.targetAnchor,m=Yi(t.props),g=m?n:u,y=m?i:p;if("svg"===o||Zi(u)?o="svg":("mathml"===o||Ki(u))&&(o="mathml"),b?(d(t.dynamicChildren,b,g,r,s,o,a),_i(t,e,!0)):l||h(t,e,g,y,r,s,o,a,!1),v)m?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Qi(e,n,i,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const t=e.target=$i(e.props,f);t&&Qi(e,t,null,c,0)}else m&&Qi(e,u,p,c,1)}er(e)},remove(t,e,n,{um:i,o:{remove:r}},s){const{shapeFlag:o,children:a,anchor:l,targetAnchor:c,target:u,props:h}=t;if(u&&r(c),s&&r(l),16&o){const t=s||!Yi(h);for(let r=0;r<a.length;r++){const s=a[r];i(s,e,n,t,!!s.dynamicChildren)}}},move:Qi,hydrate:function(t,e,n,i,r,s,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const u=e.target=$i(e.props,l);if(u){const l=u._lpa||u.firstChild;if(16&e.shapeFlag)if(Yi(e.props))e.anchor=c(o(t),e,a(t),n,i,r,s),e.targetAnchor=l;else{e.anchor=o(t);let a=l;for(;a;)if(a=o(a),a&&8===a.nodeType&&"teleport anchor"===a.data){e.targetAnchor=a,u._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(l,e,u,n,i,r,s)}er(e)}return e.anchor&&o(e.anchor)}};function Qi(t,e,n,{o:{insert:i},m:r},s=2){0===s&&i(t.targetAnchor,e,n);const{el:o,anchor:a,shapeFlag:l,children:c,props:u}=t,h=2===s;if(h&&i(o,e,n),(!h||Yi(u))&&16&l)for(let d=0;d<c.length;d++)r(c[d],e,n,2);h&&i(a,e,n)}const tr=Ji;function er(t){const e=t.ctx;if(e&&e.ut){let n=t.children[0].el;for(;n&&n!==t.targetAnchor;)1===n.nodeType&&n.setAttribute("data-v-owner",e.uid),n=n.nextSibling;e.ut()}}const nr=Symbol.for("v-fgt"),ir=Symbol.for("v-txt"),rr=Symbol.for("v-cmt"),sr=Symbol.for("v-stc"),or=[];let ar=null;function lr(t=!1){or.push(ar=t?null:[])}let cr=1;function ur(t){cr+=t}function hr(t){return t.dynamicChildren=cr>0?ar||n:null,or.pop(),ar=or[or.length-1]||null,cr>0&&ar&&ar.push(t),t}function dr(t,e,n,i,r,s){return hr(vr(t,e,n,i,r,s,!0))}function pr(t){return!!t&&!0===t.__v_isVNode}function fr(t,e){return t.type===e.type&&t.key===e.key}const mr=({key:t})=>null!=t?t:null,gr=({ref:t,ref_key:e,ref_for:n})=>("number"==typeof t&&(t=""+t),null!=t?g(t)||be(t)||m(t)?{i:Ke,r:t,k:e,f:!!n}:t:null);function vr(t,e=null,n=null,i=0,r=null,s=(t===nr?0:1),o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&mr(e),ref:e&&gr(e),scopeId:$e,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Ke};return a?(Cr(l,n),128&s&&t.normalize(l)):n&&(l.shapeFlag|=g(n)?8:16),cr>0&&!o&&ar&&(l.patchFlag>0||6&s)&&32!==l.patchFlag&&ar.push(l),l}const yr=function(t,e=null,n=null,i=0,r=null,s=!1){t&&t!==cn||(t=rr);if(pr(t)){const i=_r(t,e,!0);return n&&Cr(i,n),cr>0&&!s&&ar&&(6&i.shapeFlag?ar[ar.indexOf(t)]=i:ar.push(i)),i.patchFlag=-2,i}o=t,m(o)&&"__vccOpts"in o&&(t=t.__vccOpts);var o;if(e){e=function(t){return t?de(t)||Qn(t)?a({},t):t:null}(e);let{class:t,style:n}=e;t&&!g(t)&&(e.class=j(t)),y(n)&&(de(n)&&!h(n)&&(n=a({},n)),e.style=U(n))}const l=g(t)?1:(t=>t.__isSuspense)(t)?128:(t=>t.__isTeleport)(t)?64:y(t)?4:m(t)?2:0;return vr(t,e,n,i,r,l,s,!0)};function _r(t,e,n=!1,i=!1){const{props:r,ref:s,patchFlag:o,children:a,transition:l}=t,c=e?Ar(r||{},e):r,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&mr(c),ref:e&&e.ref?n&&s?h(s)?s.concat(gr(e)):[s,gr(e)]:gr(e):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==nr?-1===o?16:16|o:o,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&_r(t.ssContent),ssFallback:t.ssFallback&&_r(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&i&&qi(u,l.clone(u)),u}function br(t=" ",e=0){return yr(ir,null,t,e)}function xr(t,e){const n=yr(sr,null,t);return n.staticCount=e,n}function wr(t="",e=!1){return e?(lr(),hr(yr(rr,null,t,n,i,!0))):yr(rr,null,t);var n,i}function Sr(t){return null==t||"boolean"==typeof t?yr(rr):h(t)?yr(nr,null,t.slice()):"object"==typeof t?Mr(t):yr(ir,null,String(t))}function Mr(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:_r(t)}function Cr(t,e){let n=0;const{shapeFlag:i}=t;if(null==e)e=null;else if(h(e))n=16;else if("object"==typeof e){if(65&i){const n=e.default;return void(n&&(n._c&&(n._d=!1),Cr(t,n()),n._c&&(n._d=!0)))}{n=32;const i=e._;i||Qn(e)?3===i&&Ke&&(1===Ke.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=Ke}}else m(e)?(e={default:e,_ctx:Ke},n=32):(e=String(e),64&i?(n=16,e=[br(e)]):n=8);t.children=e,t.shapeFlag|=n}function Ar(...t){const e={};for(let n=0;n<t.length;n++){const i=t[n];for(const t in i)if("class"===t)e.class!==i.class&&(e.class=j([e.class,i.class]));else if("style"===t)e.style=U([e.style,i.style]);else if(s(t)){const n=e[t],r=i[t];!r||n===r||h(n)&&n.includes(r)||(e[t]=n?[].concat(n,r):r)}else""!==t&&(e[t]=i[t])}return e}function Tr(t,e,n,i=null){Ee(t,e,7,[n,i])}const Er=jn();let Ir=0;let Rr=null;const Nr=()=>Rr||Ke;let Dr,Lr;{const t=z(),e=(e,n)=>{let i;return(i=t[e])||(i=t[e]=[]),i.push(n),t=>{i.length>1?i.forEach((e=>e(t))):i[0](t)}};Dr=e("__VUE_INSTANCE_SETTERS__",(t=>Rr=t)),Lr=e("__VUE_SSR_SETTERS__",(t=>Br=t))}const Or=t=>{const e=Rr;return Dr(t),t.scope.on(),()=>{t.scope.off(),Dr(e)}},kr=()=>{Rr&&Rr.scope.off(),Dr(null)};function Pr(t){return 4&t.vnode.shapeFlag}let Fr,Br=!1;function zr(t,e,n){m(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:y(e)&&(t.setupState=Ae(e)),Ur(t,n)}function Ur(t,e,n){const r=t.type;if(!t.render){if(!e&&Fr&&!r.render){const e=r.template||Fn(t).template;if(e){const{isCustomElement:n,compilerOptions:i}=t.appContext.config,{delimiters:s,compilerOptions:o}=r,l=a(a({isCustomElement:n,delimiters:s},i),o);r.render=Fr(e,l)}}t.render=r.render||i}{const e=Or(t);ut();try{On(t)}finally{ht(),e()}}}const Vr={get:(t,e)=>(xt(t,0,""),t[e])};function Wr(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Ae(fe(t.exposed)),{get:(e,n)=>n in e?e[n]:n in In?In[n](t):void 0,has:(t,e)=>e in t||e in In})):t.proxy}function Gr(t,e=!0){return m(t)?t.displayName||t.name:t.name||e&&t.__name}const Hr=(t,e)=>{const n=function(t,e,n=!1){let r,s;const o=m(t);return o?(r=t,s=i):(r=t.get,s=t.set),new ve(r,s,o||!s,n)}(t,0,Br);return n};function jr(t,e,n){const i=arguments.length;return 2===i?y(e)&&!h(e)?pr(e)?yr(t,null,[e]):yr(t,e):yr(t,null,e):(i>3?n=Array.prototype.slice.call(arguments,2):3===i&&pr(n)&&(n=[n]),yr(t,e,n))}const qr="3.4.31",Xr="undefined"!=typeof document?document:null,Yr=Xr&&Xr.createElement("template"),Zr={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,i)=>{const r="svg"===e?Xr.createElementNS("http://www.w3.org/2000/svg",t):"mathml"===e?Xr.createElementNS("http://www.w3.org/1998/Math/MathML",t):n?Xr.createElement(t,{is:n}):Xr.createElement(t);return"select"===t&&i&&null!=i.multiple&&r.setAttribute("multiple",i.multiple),r},createText:t=>Xr.createTextNode(t),createComment:t=>Xr.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Xr.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,i,r,s){const o=n?n.previousSibling:e.lastChild;if(r&&(r===s||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),n),r!==s&&(r=r.nextSibling););else{Yr.innerHTML="svg"===i?`<svg>${t}</svg>`:"mathml"===i?`<math>${t}</math>`:t;const r=Yr.content;if("svg"===i||"mathml"===i){const t=r.firstChild;for(;t.firstChild;)r.appendChild(t.firstChild);r.removeChild(t)}e.insertBefore(r,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},Kr="transition",$r="animation",Jr=Symbol("_vtc"),Qr=(t,{slots:e})=>jr(Vi,function(t){const e={};for(const a in t)a in ts||(e[a]=t[a]);if(!1===t.css)return e;const{name:n="v",type:i,duration:r,enterFromClass:s=`${n}-enter-from`,enterActiveClass:o=`${n}-enter-active`,enterToClass:l=`${n}-enter-to`,appearFromClass:c=s,appearActiveClass:u=o,appearToClass:h=l,leaveFromClass:d=`${n}-leave-from`,leaveActiveClass:p=`${n}-leave-active`,leaveToClass:f=`${n}-leave-to`}=t,m=function(t){if(null==t)return null;if(y(t))return[is(t.enter),is(t.leave)];{const e=is(t);return[e,e]}}(r),g=m&&m[0],v=m&&m[1],{onBeforeEnter:_,onEnter:b,onEnterCancelled:x,onLeave:w,onLeaveCancelled:S,onBeforeAppear:M=_,onAppear:C=b,onAppearCancelled:A=x}=e,T=(t,e,n)=>{ss(t,e?h:l),ss(t,e?u:o),n&&n()},E=(t,e)=>{t._isLeaving=!1,ss(t,d),ss(t,f),ss(t,p),e&&e()},I=t=>(e,n)=>{const r=t?C:b,o=()=>T(e,t,n);es(r,[e,o]),os((()=>{ss(e,t?c:s),rs(e,t?h:l),ns(r)||ls(e,i,g,o)}))};return a(e,{onBeforeEnter(t){es(_,[t]),rs(t,s),rs(t,o)},onBeforeAppear(t){es(M,[t]),rs(t,c),rs(t,u)},onEnter:I(!1),onAppear:I(!0),onLeave(t,e){t._isLeaving=!0;const n=()=>E(t,e);rs(t,d),rs(t,p),document.body.offsetHeight,os((()=>{t._isLeaving&&(ss(t,d),rs(t,f),ns(w)||ls(t,i,v,n))})),es(w,[t,n])},onEnterCancelled(t){T(t,!1),es(x,[t])},onAppearCancelled(t){T(t,!0),es(A,[t])},onLeaveCancelled(t){E(t),es(S,[t])}})}(t),e);
/**
* @vue/runtime-dom v3.4.31
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/Qr.displayName="Transition";const ts={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Qr.props=a({},Bi,ts);const es=(t,e=[])=>{h(t)?t.forEach((t=>t(...e))):t&&t(...e)},ns=t=>!!t&&(h(t)?t.some((t=>t.length>1)):t.length>1);function is(t){return F(t)}function rs(t,e){e.split(/\s+/).forEach((e=>e&&t.classList.add(e))),(t[Jr]||(t[Jr]=new Set)).add(e)}function ss(t,e){e.split(/\s+/).forEach((e=>e&&t.classList.remove(e)));const n=t[Jr];n&&(n.delete(e),n.size||(t[Jr]=void 0))}function os(t){requestAnimationFrame((()=>{requestAnimationFrame(t)}))}let as=0;function ls(t,e,n,i){const r=t._endId=++as,s=()=>{r===t._endId&&i()};if(n)return setTimeout(s,n);const{type:o,timeout:a,propCount:l}=function(t,e){const n=window.getComputedStyle(t),i=t=>(n[t]||"").split(", "),r=i(`${Kr}Delay`),s=i(`${Kr}Duration`),o=cs(r,s),a=i(`${$r}Delay`),l=i(`${$r}Duration`),c=cs(a,l);let u=null,h=0,d=0;e===Kr?o>0&&(u=Kr,h=o,d=s.length):e===$r?c>0&&(u=$r,h=c,d=l.length):(h=Math.max(o,c),u=h>0?o>c?Kr:$r:null,d=u?u===Kr?s.length:l.length:0);const p=u===Kr&&/\b(transform|all)(,|$)/.test(i(`${Kr}Property`).toString());return{type:u,timeout:h,propCount:d,hasTransform:p}}(t,e);if(!o)return i();const c=o+"end";let u=0;const h=()=>{t.removeEventListener(c,d),s()},d=e=>{e.target===t&&++u>=l&&h()};setTimeout((()=>{u<l&&h()}),a+1),t.addEventListener(c,d)}function cs(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map(((e,n)=>us(e)+us(t[n]))))}function us(t){return"auto"===t?0:1e3*Number(t.slice(0,-1).replace(",","."))}const hs=Symbol("_vod"),ds=Symbol("_vsh"),ps={beforeMount(t,{value:e},{transition:n}){t[hs]="none"===t.style.display?"":t.style.display,n&&e?n.beforeEnter(t):fs(t,e)},mounted(t,{value:e},{transition:n}){n&&e&&n.enter(t)},updated(t,{value:e,oldValue:n},{transition:i}){!e!=!n&&(i?e?(i.beforeEnter(t),fs(t,!0),i.enter(t)):i.leave(t,(()=>{fs(t,!1)})):fs(t,e))},beforeUnmount(t,{value:e}){fs(t,e)}};function fs(t,e){t.style.display=e?t[hs]:"none",t[ds]=!e}const ms=Symbol(""),gs=/(^|;)\s*display\s*:/;const vs=/\s*!important$/;function ys(t,e,n){if(h(n))n.forEach((n=>ys(t,e,n)));else if(null==n&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const i=function(t,e){const n=bs[e];if(n)return n;let i=E(e);if("filter"!==i&&i in t)return bs[e]=i;i=N(i);for(let r=0;r<_s.length;r++){const n=_s[r]+i;if(n in t)return bs[e]=n}return e}(t,e);vs.test(n)?t.setProperty(R(i),n.replace(vs,""),"important"):t[i]=n}}const _s=["Webkit","Moz","ms"],bs={};const xs="http://www.w3.org/1999/xlink";function ws(t,e,n,i,r,s=q(e)){i&&e.startsWith("xlink:")?null==n?t.removeAttributeNS(xs,e.slice(6,e.length)):t.setAttributeNS(xs,e,n):null==n||s&&!X(n)?t.removeAttribute(e):t.setAttribute(e,s?"":v(n)?String(n):n)}function Ss(t,e,n,i){t.addEventListener(e,n,i)}const Ms=Symbol("_vei");function Cs(t,e,n,i,r=null){const s=t[Ms]||(t[Ms]={}),o=s[e];if(i&&o)o.value=i;else{const[n,a]=function(t){let e;if(As.test(t)){let n;for(e={};n=t.match(As);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}const n=":"===t[2]?t.slice(3):R(t.slice(2));return[n,e]}(e);if(i){const o=s[e]=function(t,e){const n=t=>{if(t._vts){if(t._vts<=n.attached)return}else t._vts=Date.now();Ee(function(t,e){if(h(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map((t=>e=>!e._stopped&&t&&t(e)))}return e}(t,n.value),e,5,[t])};return n.value=t,n.attached=Is(),n}(i,r);Ss(t,n,o,a)}else o&&(!function(t,e,n,i){t.removeEventListener(e,n,i)}(t,n,o,a),s[e]=void 0)}}const As=/(?:Once|Passive|Capture)$/;let Ts=0;const Es=Promise.resolve(),Is=()=>Ts||(Es.then((()=>Ts=0)),Ts=Date.now());const Rs=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123;const Ns=t=>{const e=t.props["onUpdate:modelValue"]||!1;return h(e)?t=>O(e,t):e},Ds=Symbol("_assign"),Ls={deep:!0,created(t,{value:e,modifiers:{number:n}},i){const r=p(e);Ss(t,"change",(()=>{const e=Array.prototype.filter.call(t.options,(t=>t.selected)).map((t=>n?P(ks(t)):ks(t)));t[Ds](t.multiple?r?new Set(e):e:e[0]),t._assigning=!0,ze((()=>{t._assigning=!1}))})),t[Ds]=Ns(i)},mounted(t,{value:e,modifiers:{number:n}}){Os(t,e)},beforeUpdate(t,e,n){t[Ds]=Ns(n)},updated(t,{value:e,modifiers:{number:n}}){t._assigning||Os(t,e)}};function Os(t,e,n){const i=t.multiple,r=h(e);if(!i||r||p(e)){for(let n=0,s=t.options.length;n<s;n++){const s=t.options[n],o=ks(s);if(i)if(r){const t=typeof o;s.selected="string"===t||"number"===t?e.some((t=>String(t)===String(o))):Z(e,o)>-1}else s.selected=e.has(o);else if(Y(ks(s),e))return void(t.selectedIndex!==n&&(t.selectedIndex=n))}i||-1===t.selectedIndex||(t.selectedIndex=-1)}}function ks(t){return"_value"in t?t._value:t.value}const Ps=["ctrl","shift","alt","meta"],Fs={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&0!==t.button,middle:t=>"button"in t&&1!==t.button,right:t=>"button"in t&&2!==t.button,exact:(t,e)=>Ps.some((n=>t[`${n}Key`]&&!e.includes(n)))},Bs=(t,e)=>{const n=t._withMods||(t._withMods={}),i=e.join(".");return n[i]||(n[i]=(n,...i)=>{for(let t=0;t<e.length;t++){const i=Fs[e[t]];if(i&&i(n,e))return}return t(n,...i)})},zs=a({patchProp:(t,e,n,i,r,a,l,c,u)=>{const h="svg"===r;"class"===e?function(t,e,n){const i=t[Jr];i&&(e=(e?[e,...i]:[...i]).join(" ")),null==e?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}(t,i,h):"style"===e?function(t,e,n){const i=t.style,r=g(n);let s=!1;if(n&&!r){if(e)if(g(e))for(const t of e.split(";")){const e=t.slice(0,t.indexOf(":")).trim();null==n[e]&&ys(i,e,"")}else for(const t in e)null==n[t]&&ys(i,t,"");for(const t in n)"display"===t&&(s=!0),ys(i,t,n[t])}else if(r){if(e!==n){const t=i[ms];t&&(n+=";"+t),i.cssText=n,s=gs.test(n)}}else e&&t.removeAttribute("style");hs in t&&(t[hs]=s?i.display:"",t[ds]&&(i.display="none"))}(t,n,i):s(e)?o(e)||Cs(t,e,0,i,l):("."===e[0]?(e=e.slice(1),1):"^"===e[0]?(e=e.slice(1),0):function(t,e,n,i){if(i)return"innerHTML"===e||"textContent"===e||!!(e in t&&Rs(e)&&m(n));if("spellcheck"===e||"draggable"===e||"translate"===e)return!1;if("form"===e)return!1;if("list"===e&&"INPUT"===t.tagName)return!1;if("type"===e&&"TEXTAREA"===t.tagName)return!1;if("width"===e||"height"===e){const e=t.tagName;if("IMG"===e||"VIDEO"===e||"CANVAS"===e||"SOURCE"===e)return!1}if(Rs(e)&&g(n))return!1;return e in t}(t,e,i,h))?(!function(t,e,n,i,r,s,o){if("innerHTML"===e||"textContent"===e)return i&&o(i,r,s),void(t[e]=null==n?"":n);const a=t.tagName;if("value"===e&&"PROGRESS"!==a&&!a.includes("-")){const i="OPTION"===a?t.getAttribute("value")||"":t.value,r=null==n?"":String(n);return i===r&&"_value"in t||(t.value=r),null==n&&t.removeAttribute(e),void(t._value=n)}let l=!1;if(""===n||null==n){const i=typeof t[e];"boolean"===i?n=X(n):null==n&&"string"===i?(n="",l=!0):"number"===i&&(n=0,l=!0)}try{t[e]=n}catch(xW){}l&&t.removeAttribute(e)}(t,e,i,a,l,c,u),t.tagName.includes("-")||"value"!==e&&"checked"!==e&&"selected"!==e||ws(t,e,i,h,0,"value"!==e)):("true-value"===e?t._trueValue=i:"false-value"===e&&(t._falseValue=i),ws(t,e,i,h))}},Zr);let Us;const Vs=(...t)=>{const e=(Us||(Us=gi(zs))).createApp(...t),{mount:n}=e;return e.mount=t=>{const i=function(t){if(g(t)){return document.querySelector(t)}return t}(t);if(!i)return;const r=e._component;m(r)||r.render||r.template||(r.template=i.innerHTML),i.innerHTML="";const s=n(i,!1,function(t){if(t instanceof SVGElement)return"svg";if("function"==typeof MathMLElement&&t instanceof MathMLElement)return"mathml"}(i));return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),s},e};
/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */
const Ws=Symbol();var Gs,Hs;function js(){const t=new nt(!0);const e=t.run((()=>xe({})));let n=[],i=[];const r=fe({install(t){r._a=t,t.provide(Ws,r),t.config.globalProperties.$pinia=r,i.forEach((t=>n.push(t))),i=[]},use(t){return this._a?n.push(t):i.push(t),this},_p:n,_a:null,_e:t,_s:new Map,state:e});return r}function qs(){}(Hs=Gs||(Gs={})).direct="direct",Hs.patchObject="patch object",Hs.patchFunction="patch function";const Xs=Object.assign,Ys="undefined"!=typeof window,Zs=t=>null!==t&&"object"==typeof t,Ks=t=>null!=t,$s=t=>"function"==typeof t,Js=t=>Zs(t)&&$s(t.then)&&$s(t.catch),Qs=t=>"number"==typeof t||/^\d+(\.\d+)?$/.test(t);function to(t,e){const n=e.split(".");let i=t;return n.forEach((t=>{var e;i=Zs(i)&&null!=(e=i[t])?e:""})),i}function eo(t,e,n){return e.reduce(((e,i)=>(n&&void 0===t[i]||(e[i]=t[i]),e)),{})}const no=t=>Array.isArray(t)?t:[t],io=null,ro=[Number,String],so={type:Boolean,default:!0},oo=t=>({type:String,default:t});var ao,lo,co="undefined"!=typeof window;function uo(t){let e;fn((()=>{t(),ze((()=>{e=!0}))})),Ni((()=>{e&&t()}))}function ho(t,e,n={}){if(!co)return;const{target:i=window,passive:r=!1,capture:s=!1}=n;let o,a=!1;const l=n=>{if(a)return;const i=Me(n);i&&!o&&(i.addEventListener(t,e,{capture:s,passive:r}),o=!0)},c=n=>{if(a)return;const i=Me(n);i&&o&&(i.removeEventListener(t,e,s),o=!1)};let u;return yn((()=>c(i))),Di((()=>c(i))),uo((()=>l(i))),be(i)&&(u=Ci(i,((t,e)=>{c(e),l(t)}))),()=>{null==u||u(),c(i),a=!0}}var po=/scroll|auto|overlay/i,fo=co?window:void 0;function mo(t){return"HTML"!==t.tagName&&"BODY"!==t.tagName&&1===t.nodeType}var go=Symbol("van-field");function vo(t,e){"scrollTop"in t?t.scrollTop=e:t.scrollTo(t.scrollX,e)}function yo(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function _o(t){vo(window,t),vo(document.body,t)}const bo=!!Ys&&/ios|iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());const xo=t=>t.stopPropagation();function wo(t,e){("boolean"!=typeof t.cancelable||t.cancelable)&&t.preventDefault(),e&&xo(t)}function So(t){if(Ks(t))return Qs(t)?`${t}px`:String(t)}!function(){if(!ao&&(ao=xe(0),lo=xe(0),co)){const t=()=>{ao.value=window.innerWidth,lo.value=window.innerHeight};t(),window.addEventListener("resize",t,{passive:!0}),window.addEventListener("orientationchange",t,{passive:!0})}}();const Mo=/-(\w)/g,Co=t=>t.replace(Mo,((t,e)=>e.toUpperCase()));function Ao(t,e,n){const i=t.indexOf(e);return-1===i?t:"-"===e&&0!==i?t.slice(0,i):t.slice(0,i+1)+t.slice(i).replace(n,"")}const{hasOwnProperty:To}=Object.prototype;function Eo(t,e){return Object.keys(e).forEach((n=>{!function(t,e,n){const i=e[n];Ks(i)&&(To.call(t,n)&&Zs(i)?t[n]=Eo(Object(t[n]),i):t[n]=i)}(t,e,n)})),t}const Io=xe("zh-CN"),Ro=se({"zh-CN":{name:"",tel:"",save:"",clear:"",cancel:"",confirm:"",delete:"",loading:"...",noCoupon:"",nameEmpty:"",addContact:"",telInvalid:"",vanCalendar:{end:"",start:"",title:"",weekdays:["","","","","","",""],monthTitle:(t,e)=>`${t}${e}`,rangePrompt:t=>` ${t} `},vanCascader:{select:""},vanPagination:{prev:"",next:""},vanPullRefresh:{pulling:"...",loosing:"..."},vanSubmitBar:{label:":"},vanCoupon:{unlimited:"",discount:t=>`${t}`,condition:t=>`${t}`},vanCouponCell:{title:"",count:t=>`${t}`},vanCouponList:{exchange:"",close:"",enable:"",disabled:"",placeholder:""},vanAddressEdit:{area:"",areaEmpty:"",addressEmpty:"",addressDetail:"",defaultAddress:""},vanAddressList:{add:""}}});var No={messages:()=>Ro[Io.value],use(t,e){Io.value=t,this.add({[t]:e})},add(t={}){Eo(Ro,t)}};function Do(t){const e=Co(t)+".";return(t,...n)=>{const i=No.messages(),r=to(i,e+t)||to(i,t);return $s(r)?r(...n):r}}function Lo(t,e){return e?"string"==typeof e?` ${t}--${e}`:Array.isArray(e)?e.reduce(((e,n)=>e+Lo(t,n)),""):Object.keys(e).reduce(((n,i)=>n+(e[i]?Lo(t,i):"")),""):""}function Oo(t){return(e,n)=>(e&&"string"!=typeof e&&(n=e,e=""),`${e=e?`${t}__${e}`:t}${Lo(e,n)}`)}function ko(t){const e=`van-${t}`;return[e,Oo(e),Do(e)]}const Po="van-hairline--surround",Fo=Symbol("van-form"),Bo=5;function zo(t){return t.install=e=>{const{name:n}=t;n&&(e.component(n,t),e.component(Co(`-${n}`),t))},t}const Uo=Symbol();function Vo(t){const e=Nr();e&&Xs(e.proxy,t)}const Wo={to:[String,Object],url:String,replace:Boolean};function Go(){const t=Nr().proxy;return()=>function({to:t,url:e,replace:n,$router:i}){t&&i?i[n?"replace":"push"](t):e&&(n?location.replace(e):location.href=e)}(t)}const[Ho,jo]=ko("badge");const qo=zo(An({name:Ho,props:{dot:Boolean,max:ro,tag:oo("div"),color:String,offset:Array,content:ro,showZero:so,position:oo("top-right")},setup(t,{slots:e}){const n=()=>{if(e.content)return!0;const{content:n,showZero:i}=t;return Ks(n)&&""!==n&&(i||0!==n&&"0"!==n)},i=()=>{const{dot:i,max:r,content:s}=t;if(!i&&n())return e.content?e.content():Ks(r)&&Qs(s)&&+s>+r?`${r}+`:s},r=t=>t.startsWith("-")?t.replace("-",""):`-${t}`,s=Hr((()=>{const n={background:t.color};if(t.offset){const[i,s]=t.offset,{position:o}=t,[a,l]=o.split("-");e.default?(n[a]="number"==typeof s?So("top"===a?s:-s):"top"===a?So(s):r(s),n[l]="number"==typeof i?So("left"===l?i:-i):"left"===l?So(i):r(i)):(n.marginTop=So(s),n.marginLeft=So(i))}return n})),o=()=>{if(n()||t.dot)return yr("div",{class:jo([t.position,{dot:t.dot,fixed:!!e.default}]),style:s.value},[i()])};return()=>{if(e.default){const{tag:n}=t;return yr(n,{class:jo("wrapper")},{default:()=>[e.default(),o()]})}return o()}}}));let Xo=2e3;const[Yo,Zo]=ko("config-provider"),Ko=Symbol(Yo);function $o(t={},e={}){Object.keys(t).forEach((n=>{t[n]!==e[n]&&document.documentElement.style.setProperty(n,t[n])})),Object.keys(e).forEach((e=>{t[e]||document.documentElement.style.removeProperty(e)}))}An({name:Yo,props:{tag:oo("div"),theme:oo("light"),zIndex:Number,themeVars:Object,themeVarsDark:Object,themeVarsLight:Object,themeVarsScope:oo("local"),iconPrefix:String},setup(t,{slots:e}){const n=Hr((()=>function(t){const e={};return Object.keys(t).forEach((n=>{const i=n.replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"").replace(/([a-zA-Z])(\d)/g,"$1-$2");e[`--van-${i}`]=t[n]})),e}(Xs({},t.themeVars,"dark"===t.theme?t.themeVarsDark:t.themeVarsLight))));if(Ys){const e=()=>{document.documentElement.classList.add(`van-theme-${t.theme}`)},i=(e=t.theme)=>{document.documentElement.classList.remove(`van-theme-${e}`)};Ci((()=>t.theme),((t,n)=>{n&&i(n),e()}),{immediate:!0}),Ni(e),Di(i),vn(i),Ci(n,((e,n)=>{"global"===t.themeVarsScope&&$o(e,n)})),Ci((()=>t.themeVarsScope),((t,e)=>{"global"===e&&$o({},n.value),"global"===t&&$o(n.value,{})})),"global"===t.themeVarsScope&&$o(n.value,{})}var i;return Zn(Ko,t),Ai((()=>{var e;void 0!==t.zIndex&&(e=t.zIndex,Xo=e)}),null,i),()=>yr(t.tag,{class:Zo(),style:"local"===t.themeVarsScope?n.value:void 0},{default:()=>{var t;return[null==(t=e.default)?void 0:t.call(e)]}})}});const[Jo,Qo]=ko("icon");const ta=zo(An({name:Jo,props:{dot:Boolean,tag:oo("i"),name:String,size:ro,badge:ro,color:String,badgeProps:Object,classPrefix:String},setup(t,{slots:e}){const n=Kn(Ko,null),i=Hr((()=>t.classPrefix||(null==n?void 0:n.iconPrefix)||Qo()));return()=>{const{tag:n,dot:r,name:s,size:o,badge:a,color:l}=t,c=(t=>null==t?void 0:t.includes("/"))(s);return yr(qo,Ar({dot:r,tag:n,class:[i.value,c?"":`${i.value}-${s}`],style:{color:l,fontSize:So(o)},content:a},t.badgeProps),{default:()=>{var t;return[null==(t=e.default)?void 0:t.call(e),c&&yr("img",{class:Qo("image"),src:s},null)]}})}}})),[ea,na]=ko("loading"),ia=Array(12).fill(null).map(((t,e)=>yr("i",{class:na("line",String(e+1))},null))),ra=yr("svg",{class:na("circular"),viewBox:"25 25 50 50"},[yr("circle",{cx:"50",cy:"50",r:"20",fill:"none"},null)]);const sa=zo(An({name:ea,props:{size:ro,type:oo("circular"),color:String,vertical:Boolean,textSize:ro,textColor:String},setup(t,{slots:e}){const n=Hr((()=>Xs({color:t.color},function(t){if(Ks(t)){if(Array.isArray(t))return{width:So(t[0]),height:So(t[1])};const e=So(t);return{width:e,height:e}}}(t.size)))),i=()=>{const i="spinner"===t.type?ia:ra;return yr("span",{class:na("spinner",t.type),style:n.value},[e.icon?e.icon():i])},r=()=>{var n;if(e.default)return yr("span",{class:na("text"),style:{fontSize:So(t.textSize),color:null!=(n=t.textColor)?n:t.color}},[e.default()])};return()=>{const{type:e,vertical:n}=t;return yr("div",{class:na([e,{vertical:n}]),"aria-live":"polite","aria-busy":!0},[i(),r()])}}})),[oa,aa]=ko("button");const la=zo(An({name:oa,props:Xs({},Wo,{tag:oo("button"),text:String,icon:String,type:oo("default"),size:oo("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:oo("button"),loadingSize:ro,loadingText:String,loadingType:String,iconPosition:oo("left")}),emits:["click"],setup(t,{emit:e,slots:n}){const i=Go(),r=()=>t.loading?n.loading?n.loading():yr(sa,{size:t.loadingSize,type:t.loadingType,class:aa("loading")},null):n.icon?yr("div",{class:aa("icon")},[n.icon()]):t.icon?yr(ta,{name:t.icon,class:aa("icon"),classPrefix:t.iconPrefix},null):void 0,s=()=>{let e;if(e=t.loading?t.loadingText:n.default?n.default():t.text,e)return yr("span",{class:aa("text")},[e])},o=()=>{const{color:e,plain:n}=t;if(e){const t={color:n?e:"white"};return n||(t.background=e),e.includes("gradient")?t.border=0:t.borderColor=e,t}},a=n=>{t.loading?wo(n):t.disabled||(e("click",n),i())};return()=>{const{tag:e,type:n,size:i,block:l,round:c,plain:u,square:h,loading:d,disabled:p,hairline:f,nativeType:m,iconPosition:g}=t,v=[aa([n,i,{plain:u,block:l,round:c,square:h,loading:d,disabled:p,hairline:f}]),{[Po]:f}];return yr(e,{type:m,class:v,style:o(),disabled:p,onClick:a},{default:()=>[yr("div",{class:aa("content")},["left"===g&&r(),s(),"right"===g&&r()])]})}}})),ca={show:Boolean,zIndex:ro,overlay:so,duration:ro,teleport:[String,Object],lockScroll:so,lazyRender:so,beforeClose:Function,overlayStyle:Object,overlayClass:io,transitionAppear:Boolean,closeOnClickOverlay:so};let ua=0;const ha="van-overflow-hidden";function da(t,e){const n=function(){const t=xe(0),e=xe(0),n=xe(0),i=xe(0),r=xe(0),s=xe(0),o=xe(""),a=xe(!0),l=()=>{n.value=0,i.value=0,r.value=0,s.value=0,o.value="",a.value=!0};return{move:l=>{const c=l.touches[0];var u,h;n.value=(c.clientX<0?0:c.clientX)-t.value,i.value=c.clientY-e.value,r.value=Math.abs(n.value),s.value=Math.abs(i.value),(!o.value||r.value<10&&s.value<10)&&(o.value=(u=r.value)>(h=s.value)?"horizontal":h>u?"vertical":""),a.value&&(r.value>Bo||s.value>Bo)&&(a.value=!1)},start:n=>{l(),t.value=n.touches[0].clientX,e.value=n.touches[0].clientY},reset:l,startX:t,startY:e,deltaX:n,deltaY:i,offsetX:r,offsetY:s,direction:o,isVertical:()=>"vertical"===o.value,isHorizontal:()=>"horizontal"===o.value,isTap:a}}(),i=e=>{n.move(e);const i=n.deltaY.value>0?"10":"01",r=function(t,e=fo){let n=t;for(;n&&n!==e&&mo(n);){const{overflowY:t}=window.getComputedStyle(n);if(po.test(t))return n;n=n.parentNode}return e}(e.target,t.value),{scrollHeight:s,offsetHeight:o,scrollTop:a}=r;let l="11";0===a?l=o>=s?"00":"01":a+o>=s&&(l="10"),"11"===l||!n.isVertical()||parseInt(l,2)&parseInt(i,2)||wo(e,!0)},r=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",i,{passive:!1}),ua||document.body.classList.add(ha),ua++},s=()=>{ua&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",i),ua--,ua||document.body.classList.remove(ha))},o=()=>e()&&s();uo((()=>e()&&r())),Di(o),vn(o),Ci(e,(t=>{t?r():s()}))}function pa(t){const e=xe(!1);return Ci(t,(t=>{t&&(e.value=t)}),{immediate:!0}),t=>()=>e.value?t():null}const fa=()=>{var t;const{scopeId:e}=(null==(t=Nr())?void 0:t.vnode)||{};return e?{[e]:""}:null},[ma,ga]=ko("overlay");const va=zo(An({name:ma,props:{show:Boolean,zIndex:ro,duration:ro,className:io,lockScroll:so,lazyRender:so,customStyle:Object},setup(t,{slots:e}){const n=xe(),i=pa((()=>t.show||!t.lazyRender))((()=>{var i;const r=Xs(function(t){const e={};return void 0!==t&&(e.zIndex=+t),e}(t.zIndex),t.customStyle);return Ks(t.duration)&&(r.animationDuration=`${t.duration}s`),Sn(yr("div",{ref:n,style:r,class:[ga(),t.className]},[null==(i=e.default)?void 0:i.call(e)]),[[ps,t.show]])}));return ho("touchmove",(e=>{t.lockScroll&&wo(e,!0)}),{target:n}),()=>yr(Qr,{name:"van-fade",appear:!0},{default:i})}})),ya=Xs({},ca,{round:Boolean,position:oo("center"),closeIcon:oo("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:oo("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[_a,ba]=ko("popup");const xa=zo(An({name:_a,inheritAttrs:!1,props:ya,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(t,{emit:e,attrs:n,slots:i}){let r,s;const o=xe(),a=xe(),l=pa((()=>t.show||!t.lazyRender)),c=Hr((()=>{const e={zIndex:o.value};if(Ks(t.duration)){e["center"===t.position?"animationDuration":"transitionDuration"]=`${t.duration}s`}return e})),u=()=>{r||(r=!0,o.value=void 0!==t.zIndex?+t.zIndex:++Xo,e("open"))},h=()=>{r&&function(t,{args:e=[],done:n,canceled:i,error:r}){if(t){const s=t.apply(null,e);Js(s)?s.then((t=>{t?n():i&&i()})).catch(r||qs):s?n():i&&i()}else n()}(t.beforeClose,{done(){r=!1,e("close"),e("update:show",!1)}})},d=n=>{e("clickOverlay",n),t.closeOnClickOverlay&&h()},p=()=>{if(t.overlay)return yr(va,Ar({show:t.show,class:t.overlayClass,zIndex:o.value,duration:t.duration,customStyle:t.overlayStyle,role:t.closeOnClickOverlay?"button":void 0,tabindex:t.closeOnClickOverlay?0:void 0},fa(),{onClick:d}),{default:i["overlay-content"]})},f=t=>{e("clickCloseIcon",t),h()},m=()=>{if(t.closeable)return yr(ta,{role:"button",tabindex:0,name:t.closeIcon,class:[ba("close-icon",t.closeIconPosition),"van-haptics-feedback"],classPrefix:t.iconPrefix,onClick:f},null)};let g;const v=()=>{g&&clearTimeout(g),g=setTimeout((()=>{e("opened")}))},y=()=>e("closed"),_=t=>e("keydown",t),b=l((()=>{var e;const{round:r,position:s,safeAreaInsetTop:o,safeAreaInsetBottom:l}=t;return Sn(yr("div",Ar({ref:a,style:c.value,role:"dialog",tabindex:0,class:[ba({round:r,[s]:s}),{"van-safe-area-top":o,"van-safe-area-bottom":l}],onKeydown:_},n,fa()),[null==(e=i.default)?void 0:e.call(i),m()]),[[ps,t.show]])})),x=()=>{const{position:e,transition:n,transitionAppear:i}=t;return yr(Qr,{name:n||("center"===e?"van-fade":`van-popup-slide-${e}`),appear:i,onAfterEnter:v,onAfterLeave:y},{default:b})};return Ci((()=>t.show),(t=>{t&&!r&&(u(),0===n.tabindex&&ze((()=>{var t;null==(t=a.value)||t.focus()}))),!t&&r&&(r=!1,e("close"))})),Vo({popupRef:a}),da(a,(()=>t.show&&t.lockScroll)),ho("popstate",(()=>{t.closeOnPopstate&&(h(),s=!1)})),fn((()=>{t.show&&u()})),Ni((()=>{s&&(e("update:show",!0),s=!1)})),Di((()=>{t.show&&t.teleport&&(h(),s=!0)})),Zn(Uo,(()=>t.show)),()=>t.teleport?yr(tr,{to:t.teleport},{default:()=>[p(),x()]}):yr(nr,null,[p(),x()])}}));let wa=0;const[Sa,Ma]=ko("cell"),Ca={tag:oo("div"),icon:String,size:String,title:ro,value:ro,label:ro,center:Boolean,isLink:Boolean,border:so,iconPrefix:String,valueClass:io,labelClass:io,titleClass:io,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}};const Aa=zo(An({name:Sa,props:Xs({},Ca,Wo),setup(t,{slots:e}){const n=Go(),i=()=>{if(e.label||Ks(t.label))return yr("div",{class:[Ma("label"),t.labelClass]},[e.label?e.label():t.label])},r=()=>{var n;if(e.title||Ks(t.title)){const r=null==(n=e.title)?void 0:n.call(e);if(Array.isArray(r)&&0===r.length)return;return yr("div",{class:[Ma("title"),t.titleClass],style:t.titleStyle},[r||yr("span",null,[t.title]),i()])}},s=()=>{const n=e.value||e.default;if(n||Ks(t.value))return yr("div",{class:[Ma("value"),t.valueClass]},[n?n():yr("span",null,[t.value])])},o=()=>{if(e["right-icon"])return e["right-icon"]();if(t.isLink){const e=t.arrowDirection&&"right"!==t.arrowDirection?`arrow-${t.arrowDirection}`:"arrow";return yr(ta,{name:e,class:Ma("right-icon")},null)}};return()=>{var i;const{tag:a,size:l,center:c,border:u,isLink:h,required:d}=t,p=null!=(i=t.clickable)?i:h,f={center:c,required:!!d,clickable:p,borderless:!u};return l&&(f[l]=!!l),yr(a,{class:Ma(f),role:p?"button":void 0,tabindex:p?0:void 0,onClick:n},{default:()=>{var n;return[e.icon?e.icon():t.icon?yr(ta,{name:t.icon,class:Ma("left-icon"),classPrefix:t.iconPrefix},null):void 0,r(),s(),o(),null==(n=e.extra)?void 0:n.call(e)]}})}}}));function Ta(t){return Array.isArray(t)?!t.length:0!==t&&!t}function Ea(t,e){const{message:n}=e;return $s(n)?n(t,e):n||""}function Ia({target:t}){t.composing=!0}function Ra({target:t}){t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}function Na(t){return[...t].length}function Da(t,e){return[...t].slice(0,e).join("")}const[La,Oa]=ko("field"),ka={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:ro,formatter:Function,clearIcon:oo("clear"),modelValue:(Pa="",{type:ro,default:Pa}),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:oo("focus"),formatTrigger:oo("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}};var Pa;const Fa=zo(An({name:La,props:Xs({},Ca,ka,{rows:ro,type:oo("text"),rules:Array,autosize:[Boolean,Object],labelWidth:ro,labelClass:io,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(t,{emit:e,slots:n}){const i=function(){const t=Nr(),{name:e="unknown"}=(null==t?void 0:t.type)||{};return`${e}-${++wa}`}(),r=se({status:"unvalidated",focused:!1,validateMessage:""}),s=xe(),o=xe(),a=xe(),{parent:l}=function(t){const e=Kn(t,null);if(e){const t=Nr(),{link:n,unlink:i,internalChildren:r}=e;return n(t),yn((()=>i(t))),{parent:e,index:Hr((()=>r.indexOf(t)))}}return{parent:null,index:xe(-1)}}(Fo),c=()=>{var e;return String(null!=(e=t.modelValue)?e:"")},u=e=>Ks(t[e])?t[e]:l&&Ks(l.props[e])?l.props[e]:void 0,h=Hr((()=>{const e=u("readonly");if(t.clearable&&!e){const e=""!==c(),n="always"===t.clearTrigger||"focus"===t.clearTrigger&&r.focused;return e&&n}return!1})),d=Hr((()=>a.value&&n.input?a.value():t.modelValue)),p=Hr((()=>{var e;const n=u("required");return"auto"===n?null==(e=t.rules)?void 0:e.some((t=>t.required)):n})),f=t=>t.reduce(((t,e)=>t.then((()=>{if("failed"===r.status)return;let{value:t}=d;if(e.formatter&&(t=e.formatter(t,e)),!function(t,e){if(Ta(t)){if(e.required)return!1;if(!1===e.validateEmpty)return!0}return!(e.pattern&&!e.pattern.test(String(t)))}(t,e))return r.status="failed",void(r.validateMessage=Ea(t,e));if(e.validator){if(Ta(t)&&!1===e.validateEmpty)return;return function(t,e){return new Promise((n=>{const i=e.validator(t,e);Js(i)?i.then(n):n(i)}))}(t,e).then((n=>{n&&"string"==typeof n?(r.status="failed",r.validateMessage=n):!1===n&&(r.status="failed",r.validateMessage=Ea(t,e))}))}}))),Promise.resolve()),m=()=>{r.status="unvalidated",r.validateMessage=""},g=()=>e("endValidate",{status:r.status,message:r.validateMessage}),v=(n=t.rules)=>new Promise((i=>{m(),n?(e("startValidate"),f(n).then((()=>{"failed"===r.status?(i({name:t.name,message:r.validateMessage}),g()):(r.status="passed",i(),g())}))):i()})),y=e=>{if(l&&t.rules){const{validateTrigger:n}=l.props,i=no(n).includes(e),r=t.rules.filter((t=>t.trigger?no(t.trigger).includes(e):i));r.length&&v(r)}},_=(n,i="onChange")=>{const o=n;n=(e=>{var n;const{maxlength:i}=t;if(Ks(i)&&Na(e)>+i){const t=c();if(t&&Na(t)===+i)return t;const o=null==(n=s.value)?void 0:n.selectionEnd;if(r.focused&&o){const t=[...e],n=t.length-+i;return t.splice(o-n,n),t.join("")}return Da(e,+i)}return e})(n);const a=Na(o)-Na(n);if("number"===t.type||"digit"===t.type){const e="number"===t.type;n=function(t,e=!0,n=!0){t=e?Ao(t,".",/\./g):t.split(".")[0];const i=e?/[^-0-9.]/g:/[^-0-9]/g;return(t=n?Ao(t,"-",/-/g):t.replace(/-/,"")).replace(i,"")}(n,e,e)}let l=0;if(t.formatter&&i===t.formatTrigger){const{formatter:e,maxlength:i}=t;if(n=e(n),Ks(i)&&Na(n)>+i&&(n=Da(n,+i)),s.value&&r.focused){const{selectionEnd:t}=s.value,n=Da(o,t);l=Na(e(n))-Na(n)}}if(s.value&&s.value.value!==n)if(r.focused){let{selectionStart:t,selectionEnd:e}=s.value;if(s.value.value=n,Ks(t)&&Ks(e)){const i=Na(n);a?(t-=a,e-=a):l&&(t+=l,e+=l),s.value.setSelectionRange(Math.min(t,i),Math.min(e,i))}}else s.value.value=n;n!==t.modelValue&&e("update:modelValue",n)},b=t=>{t.target.composing||_(t.target.value)},x=()=>{var t;return null==(t=s.value)?void 0:t.blur()},w=()=>{var t;return null==(t=s.value)?void 0:t.focus()},S=()=>{const e=s.value;"textarea"===t.type&&t.autosize&&e&&function(t,e){const n=yo();t.style.height="auto";let i=t.scrollHeight;if(Zs(e)){const{maxHeight:t,minHeight:n}=e;void 0!==t&&(i=Math.min(i,t)),void 0!==n&&(i=Math.max(i,n))}i&&(t.style.height=`${i}px`,_o(n))}(e,t.autosize)},M=t=>{r.focused=!0,e("focus",t),ze(S),u("readonly")&&x()},C=t=>{r.focused=!1,_(c(),"onBlur"),e("blur",t),u("readonly")||(y("onBlur"),ze(S),bo&&_o(yo()))},A=t=>e("clickInput",t),T=t=>e("clickLeftIcon",t),E=t=>e("clickRightIcon",t),I=Hr((()=>"boolean"==typeof t.error?t.error:!(!l||!l.props.showError||"failed"!==r.status)||void 0)),R=Hr((()=>{const t=u("labelWidth"),e=u("labelAlign");if(t&&"top"!==e)return{width:So(t)}})),N=n=>{if(13===n.keyCode){l&&l.props.submitOnEnter||"textarea"===t.type||wo(n),"search"===t.type&&x()}e("keypress",n)},D=()=>t.id||`${i}-input`,L=()=>{const e=Oa("control",[u("inputAlign"),{error:I.value,custom:!!n.input,"min-height":"textarea"===t.type&&!t.autosize}]);if(n.input)return yr("div",{class:e,onClick:A},[n.input()]);const r={id:D(),ref:s,name:t.name,rows:void 0!==t.rows?+t.rows:void 0,class:e,disabled:u("disabled"),readonly:u("readonly"),autofocus:t.autofocus,placeholder:t.placeholder,autocomplete:t.autocomplete,autocapitalize:t.autocapitalize,autocorrect:t.autocorrect,enterkeyhint:t.enterkeyhint,spellcheck:t.spellcheck,"aria-labelledby":t.label?`${i}-label`:void 0,onBlur:C,onFocus:M,onInput:b,onClick:A,onChange:Ra,onKeypress:N,onCompositionend:Ra,onCompositionstart:Ia};return"textarea"===t.type?yr("textarea",r,null):yr("input",Ar("number"===(o=t.type)?{type:"text",inputmode:"decimal"}:"digit"===o?{type:"tel",inputmode:"numeric"}:{type:o},r),null);var o},O=()=>{const e=n["right-icon"];if(t.rightIcon||e)return yr("div",{class:Oa("right-icon"),onClick:E},[e?e():yr(ta,{name:t.rightIcon,classPrefix:t.iconPrefix},null)])},k=()=>{if(t.showWordLimit&&t.maxlength){const e=Na(c());return yr("div",{class:Oa("word-limit")},[yr("span",{class:Oa("word-num")},[e]),br("/"),t.maxlength])}},P=()=>{if(l&&!1===l.props.showErrorMessage)return;const e=t.errorMessage||r.validateMessage;if(e){const t=n["error-message"],i=u("errorMessageAlign");return yr("div",{class:Oa("error-message",i)},[t?t({message:e}):e])}},F=()=>[yr("div",{class:Oa("body")},[L(),h.value&&yr(ta,{ref:o,name:t.clearIcon,class:Oa("clear")},null),O(),n.button&&yr("div",{class:Oa("button")},[n.button()])]),k(),P()];return Vo({blur:x,focus:w,validate:v,formValue:d,resetValidation:m,getValidationStatus:()=>r.status}),Zn(go,{customValue:a,resetValidation:m,validateWithTrigger:y}),Ci((()=>t.modelValue),(()=>{_(c()),m(),y("onChange"),ze(S)})),fn((()=>{_(c(),t.formatTrigger),ze(S)})),ho("touchstart",(t=>{wo(t),e("update:modelValue",""),e("clear",t)}),{target:Hr((()=>{var t;return null==(t=o.value)?void 0:t.$el}))}),()=>{const e=u("disabled"),r=u("labelAlign"),s=(()=>{const e=n["left-icon"];if(t.leftIcon||e)return yr("div",{class:Oa("left-icon"),onClick:T},[e?e():yr(ta,{name:t.leftIcon,classPrefix:t.iconPrefix},null)])})();return yr(Aa,{size:t.size,class:Oa({error:I.value,disabled:e,[`label-${r}`]:r}),center:t.center,border:t.border,isLink:t.isLink,clickable:t.clickable,titleStyle:R.value,valueClass:Oa("value"),titleClass:[Oa("label",[r,{required:p.value}]),t.labelClass],arrowDirection:t.arrowDirection},{icon:s&&"top"!==r?()=>s:null,title:()=>{const e=(()=>{const e=u("labelWidth"),r=u("labelAlign"),s=u("colon")?":":"";return n.label?[n.label(),s]:t.label?yr("label",{id:`${i}-label`,for:n.input?void 0:D(),onClick:t=>{wo(t),w()},style:"top"===r&&e?{width:So(e)}:void 0},[t.label+s]):void 0})();return"top"===r?[s,e].filter(Boolean):e||[]},value:F,extra:n.extra})}}}));let Ba=0;const[za,Ua]=ko("toast"),Va=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Wa={icon:String,show:Boolean,type:oo("text"),overlay:Boolean,message:ro,iconSize:ro,duration:(t=>({type:Number,default:t}))(2e3),position:oo("middle"),teleport:[String,Object],wordBreak:String,className:io,iconPrefix:String,transition:oo("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:io,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:ro};var Ga=An({name:za,props:Wa,emits:["update:show"],setup(t,{emit:e,slots:n}){let i,r=!1;const s=()=>{const e=t.show&&t.forbidClick;r!==e&&(r=e,r?(Ba||document.body.classList.add("van-toast--unclickable"),Ba++):Ba&&(Ba--,Ba||document.body.classList.remove("van-toast--unclickable")))},o=t=>e("update:show",t),a=()=>{t.closeOnClick&&o(!1)},l=()=>clearTimeout(i),c=()=>{const{icon:e,type:n,iconSize:i,iconPrefix:r,loadingType:s}=t;return e||"success"===n||"fail"===n?yr(ta,{name:e||n,size:i,class:Ua("icon"),classPrefix:r},null):"loading"===n?yr(sa,{class:Ua("loading"),size:i,type:s},null):void 0},u=()=>{const{type:e,message:i}=t;return n.message?yr("div",{class:Ua("text")},[n.message()]):Ks(i)&&""!==i?"html"===e?yr("div",{key:0,class:Ua("text"),innerHTML:String(i)},null):yr("div",{class:Ua("text")},[i]):void 0};return Ci((()=>[t.show,t.forbidClick]),s),Ci((()=>[t.show,t.type,t.message,t.duration]),(()=>{l(),t.show&&t.duration>0&&(i=setTimeout((()=>{o(!1)}),t.duration))})),fn(s),yn(s),()=>yr(xa,Ar({class:[Ua([t.position,"normal"===t.wordBreak?"break-normal":t.wordBreak,{[t.type]:!t.icon}]),t.className],lockScroll:!1,onClick:a,onClosed:l,"onUpdate:show":o},eo(t,Va)),{default:()=>[c(),u()]})}});let Ha=[],ja=!1,qa=Xs({},{icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1});const Xa=new Map;function Ya(){const{instance:t,unmount:e}=function(t){const e=Vs(t),n=document.createElement("div");return document.body.appendChild(n),{instance:e.mount(n),unmount(){e.unmount(),document.body.removeChild(n)}}}({setup(){const t=xe(""),{open:e,state:n,close:i,toggle:r}=function(){const t=se({show:!1}),e=e=>{t.show=e},n=n=>{Xs(t,n,{transitionAppear:!0}),e(!0)},i=()=>e(!1);return Vo({open:n,close:i,toggle:e}),{open:n,close:i,state:t,toggle:e}}(),s=()=>{};return Ci(t,(t=>{n.message=t})),Nr().render=()=>yr(Ga,Ar(n,{onClosed:s,"onUpdate:show":r}),null),{open:e,close:i,message:t}}});return t}function Za(t={}){if(!Ys)return{};const e=function(){if(!Ha.length||ja){const t=Ya();Ha.push(t)}return Ha[Ha.length-1]}(),n=Zs(i=t)?i:{message:i};var i;return e.open(Xs({},qa,Xa.get(n.type||qa.type),n)),e}const Ka=zo(Ga),[$a,Ja]=ko("notify"),Qa=["lockScroll","position","show","teleport","zIndex"];const tl=zo(An({name:$a,props:Xs({},ca,{type:oo("danger"),color:String,message:ro,position:oo("top"),className:io,background:String,lockScroll:Boolean}),emits:["update:show"],setup(t,{emit:e,slots:n}){const i=t=>e("update:show",t);return()=>yr(xa,Ar({class:[Ja([t.type]),t.className],style:{color:t.color,background:t.background},overlay:!1,duration:.2,"onUpdate:show":i},eo(t,Qa)),{default:()=>[n.default?n.default():t.message]})}})),el="undefined"!=typeof document;const nl=Object.assign;function il(t,e){const n={};for(const i in e){const r=e[i];n[i]=sl(r)?r.map(t):t(r)}return n}const rl=()=>{},sl=Array.isArray,ol=/#/g,al=/&/g,ll=/\//g,cl=/=/g,ul=/\?/g,hl=/\+/g,dl=/%5B/g,pl=/%5D/g,fl=/%5E/g,ml=/%60/g,gl=/%7B/g,vl=/%7C/g,yl=/%7D/g,_l=/%20/g;function bl(t){return encodeURI(""+t).replace(vl,"|").replace(dl,"[").replace(pl,"]")}function xl(t){return bl(t).replace(hl,"%2B").replace(_l,"+").replace(ol,"%23").replace(al,"%26").replace(ml,"`").replace(gl,"{").replace(yl,"}").replace(fl,"^")}function wl(t){return null==t?"":function(t){return bl(t).replace(ol,"%23").replace(ul,"%3F")}(t).replace(ll,"%2F")}function Sl(t){try{return decodeURIComponent(""+t)}catch(e){}return""+t}const Ml=/\/$/,Cl=t=>t.replace(Ml,"");function Al(t,e,n="/"){let i,r={},s="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(i=e.slice(0,l),s=e.slice(l+1,a>-1?a:e.length),r=t(s)),a>-1&&(i=i||e.slice(0,a),o=e.slice(a,e.length)),i=function(t,e){if(t.startsWith("/"))return t;if(!t)return e;const n=e.split("/"),i=t.split("/"),r=i[i.length-1];".."!==r&&"."!==r||i.push("");let s,o,a=n.length-1;for(s=0;s<i.length;s++)if(o=i[s],"."!==o){if(".."!==o)break;a>1&&a--}return n.slice(0,a).join("/")+"/"+i.slice(s).join("/")}(null!=i?i:e,n),{fullPath:i+(s&&"?")+s+o,path:i,query:r,hash:Sl(o)}}function Tl(t,e){return e&&t.toLowerCase().startsWith(e.toLowerCase())?t.slice(e.length)||"/":t}function El(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function Il(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!Rl(t[n],e[n]))return!1;return!0}function Rl(t,e){return sl(t)?Nl(t,e):sl(e)?Nl(e,t):t===e}function Nl(t,e){return sl(e)?t.length===e.length&&t.every(((t,n)=>t===e[n])):1===t.length&&t[0]===e}const Dl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ll,Ol,kl,Pl;(Ol=Ll||(Ll={})).pop="pop",Ol.push="push",(Pl=kl||(kl={})).back="back",Pl.forward="forward",Pl.unknown="";const Fl=/^[^#]+#/;function Bl(t,e){return t.replace(Fl,"#")+e}const zl=()=>({left:window.scrollX,top:window.scrollY});function Ul(t){let e;if("el"in t){const n=t.el,i="string"==typeof n&&n.startsWith("#"),r="string"==typeof n?i?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!r)return;e=function(t,e){const n=document.documentElement.getBoundingClientRect(),i=t.getBoundingClientRect();return{behavior:e.behavior,left:i.left-n.left-(e.left||0),top:i.top-n.top-(e.top||0)}}(r,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(null!=e.left?e.left:window.scrollX,null!=e.top?e.top:window.scrollY)}function Vl(t,e){return(history.state?history.state.position-e:-1)+t}const Wl=new Map;let Gl=()=>location.protocol+"//"+location.host;function Hl(t,e){const{pathname:n,search:i,hash:r}=e,s=t.indexOf("#");if(s>-1){let e=r.includes(t.slice(s))?t.slice(s).length:1,n=r.slice(e);return"/"!==n[0]&&(n="/"+n),Tl(n,"")}return Tl(n,t)+i+r}function jl(t,e,n,i=!1,r=!1){return{back:t,current:e,forward:n,replaced:i,position:window.history.length,scroll:r?zl():null}}function ql(t){const e=function(t){const{history:e,location:n}=window,i={value:Hl(t,n)},r={value:e.state};function s(i,s,o){const a=t.indexOf("#"),l=a>-1?(n.host&&document.querySelector("base")?t:t.slice(a))+i:Gl()+t+i;try{e[o?"replaceState":"pushState"](s,"",l),r.value=s}catch(c){n[o?"replace":"assign"](l)}}return r.value||s(i.value,{back:null,current:i.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0),{location:i,state:r,push:function(t,n){const o=nl({},r.value,e.state,{forward:t,scroll:zl()});s(o.current,o,!0),s(t,nl({},jl(i.value,t,null),{position:o.position+1},n),!1),i.value=t},replace:function(t,n){s(t,nl({},e.state,jl(r.value.back,t,r.value.forward,!0),n,{position:r.value.position}),!0),i.value=t}}}(t=function(t){if(!t)if(el){const e=document.querySelector("base");t=(t=e&&e.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return"/"!==t[0]&&"#"!==t[0]&&(t="/"+t),Cl(t)}(t)),n=function(t,e,n,i){let r=[],s=[],o=null;const a=({state:s})=>{const a=Hl(t,location),l=n.value,c=e.value;let u=0;if(s){if(n.value=a,e.value=s,o&&o===l)return void(o=null);u=c?s.position-c.position:0}else i(a);r.forEach((t=>{t(n.value,l,{delta:u,type:Ll.pop,direction:u?u>0?kl.forward:kl.back:kl.unknown})}))};function l(){const{history:t}=window;t.state&&t.replaceState(nl({},t.state,{scroll:zl()}),"")}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:function(){o=n.value},listen:function(t){r.push(t);const e=()=>{const e=r.indexOf(t);e>-1&&r.splice(e,1)};return s.push(e),e},destroy:function(){for(const t of s)t();s=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",l)}}}(t,e.state,e.location,e.replace);const i=nl({location:"",base:t,go:function(t,e=!0){e||n.pauseListeners(),history.go(t)},createHref:Bl.bind(null,t)},e,n);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>e.state.value}),i}function Xl(t){return(t=location.host?t||location.pathname+location.search:"").includes("#")||(t+="#"),ql(t)}function Yl(t){return"string"==typeof t||"symbol"==typeof t}const Zl=Symbol("");var Kl,$l;function Jl(t,e){return nl(new Error,{type:t,[Zl]:!0},e)}function Ql(t,e){return t instanceof Error&&Zl in t&&(null==e||!!(t.type&e))}($l=Kl||(Kl={}))[$l.aborted=4]="aborted",$l[$l.cancelled=8]="cancelled",$l[$l.duplicated=16]="duplicated";const tc="[^/]+?",ec={sensitive:!1,strict:!1,start:!0,end:!0},nc=/[.+*?^${}()[\]/\\]/g;function ic(t,e){let n=0;for(;n<t.length&&n<e.length;){const i=e[n]-t[n];if(i)return i;n++}return t.length<e.length?1===t.length&&80===t[0]?-1:1:t.length>e.length?1===e.length&&80===e[0]?1:-1:0}function rc(t,e){let n=0;const i=t.score,r=e.score;for(;n<i.length&&n<r.length;){const t=ic(i[n],r[n]);if(t)return t;n++}if(1===Math.abs(r.length-i.length)){if(sc(i))return 1;if(sc(r))return-1}return r.length-i.length}function sc(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const oc={type:0,value:""},ac=/[a-zA-Z0-9_]/;function lc(t,e,n){const i=function(t,e){const n=nl({},ec,e),i=[];let r=n.start?"^":"";const s=[];for(const l of t){const t=l.length?[]:[90];n.strict&&!l.length&&(r+="/");for(let e=0;e<l.length;e++){const i=l[e];let o=40+(n.sensitive?.25:0);if(0===i.type)e||(r+="/"),r+=i.value.replace(nc,"\\$&"),o+=40;else if(1===i.type){const{value:t,repeatable:n,optional:c,regexp:u}=i;s.push({name:t,repeatable:n,optional:c});const h=u||tc;if(h!==tc){o+=10;try{new RegExp(`(${h})`)}catch(a){throw new Error(`Invalid custom RegExp for param "${t}" (${h}): `+a.message)}}let d=n?`((?:${h})(?:/(?:${h}))*)`:`(${h})`;e||(d=c&&l.length<2?`(?:/${d})`:"/"+d),c&&(d+="?"),r+=d,o+=20,c&&(o+=-8),n&&(o+=-20),".*"===h&&(o+=-50)}t.push(o)}i.push(t)}if(n.strict&&n.end){const t=i.length-1;i[t][i[t].length-1]+=.7000000000000001}n.strict||(r+="/?"),n.end?r+="$":n.strict&&(r+="(?:/|$)");const o=new RegExp(r,n.sensitive?"":"i");return{re:o,score:i,keys:s,parse:function(t){const e=t.match(o),n={};if(!e)return null;for(let i=1;i<e.length;i++){const t=e[i]||"",r=s[i-1];n[r.name]=t&&r.repeatable?t.split("/"):t}return n},stringify:function(e){let n="",i=!1;for(const r of t){i&&n.endsWith("/")||(n+="/"),i=!1;for(const t of r)if(0===t.type)n+=t.value;else if(1===t.type){const{value:s,repeatable:o,optional:a}=t,l=s in e?e[s]:"";if(sl(l)&&!o)throw new Error(`Provided param "${s}" is an array but it is not repeatable (* or + modifiers)`);const c=sl(l)?l.join("/"):l;if(!c){if(!a)throw new Error(`Missing required param "${s}"`);r.length<2&&(n.endsWith("/")?n=n.slice(0,-1):i=!0)}n+=c}}return n||"/"}}}(function(t){if(!t)return[[]];if("/"===t)return[[oc]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(t){throw new Error(`ERR (${n})/"${c}": ${t}`)}let n=0,i=n;const r=[];let s;function o(){s&&r.push(s),s=[]}let a,l=0,c="",u="";function h(){c&&(0===n?s.push({type:0,value:c}):1===n||2===n||3===n?(s.length>1&&("*"===a||"+"===a)&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),s.push({type:1,value:c,regexp:u,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):e("Invalid state to consume buffer"),c="")}function d(){c+=a}for(;l<t.length;)if(a=t[l++],"\\"!==a||2===n)switch(n){case 0:"/"===a?(c&&h(),o()):":"===a?(h(),n=1):d();break;case 4:d(),n=i;break;case 1:"("===a?n=2:ac.test(a)?d():(h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&l--);break;case 2:")"===a?"\\"==u[u.length-1]?u=u.slice(0,-1)+a:n=3:u+=a;break;case 3:h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&l--,u="";break;default:e("Unknown state")}else i=n,n=4;return 2===n&&e(`Unfinished custom RegExp for param "${c}"`),h(),o(),r}(t.path),n),r=nl(i,{record:t,parent:e,children:[],alias:[]});return e&&!r.record.aliasOf==!e.record.aliasOf&&e.children.push(r),r}function cc(t,e){const n=[],i=new Map;function r(t,n,i){const a=!i,l=function(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:hc(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}(t);l.aliasOf=i&&i.record;const c=fc(e,t),u=[l];if("alias"in t){const e="string"==typeof t.alias?[t.alias]:t.alias;for(const t of e)u.push(nl({},l,{components:i?i.record.components:l.components,path:t,aliasOf:i?i.record:l}))}let h,d;for(const e of u){const{path:u}=e;if(n&&"/"!==u[0]){const t=n.record.path,i="/"===t[t.length-1]?"":"/";e.path=n.record.path+(u&&i+u)}if(h=lc(e,n,c),i?i.alias.push(h):(d=d||h,d!==h&&d.alias.push(h),a&&t.name&&!dc(h)&&s(t.name)),mc(h)&&o(h),l.children){const t=l.children;for(let e=0;e<t.length;e++)r(t[e],h,i&&i.children[e])}i=i||h}return d?()=>{s(d)}:rl}function s(t){if(Yl(t)){const e=i.get(t);e&&(i.delete(t),n.splice(n.indexOf(e),1),e.children.forEach(s),e.alias.forEach(s))}else{const e=n.indexOf(t);e>-1&&(n.splice(e,1),t.record.name&&i.delete(t.record.name),t.children.forEach(s),t.alias.forEach(s))}}function o(t){const e=function(t,e){let n=0,i=e.length;for(;n!==i;){const r=n+i>>1;rc(t,e[r])<0?i=r:n=r+1}const r=function(t){let e=t;for(;e=e.parent;)if(mc(e)&&0===rc(t,e))return e;return}(t);r&&(i=e.lastIndexOf(r,i-1));return i}(t,n);n.splice(e,0,t),t.record.name&&!dc(t)&&i.set(t.record.name,t)}return e=fc({strict:!1,end:!0,sensitive:!1},e),t.forEach((t=>r(t))),{addRoute:r,resolve:function(t,e){let r,s,o,a={};if("name"in t&&t.name){if(r=i.get(t.name),!r)throw Jl(1,{location:t});o=r.record.name,a=nl(uc(e.params,r.keys.filter((t=>!t.optional)).concat(r.parent?r.parent.keys.filter((t=>t.optional)):[]).map((t=>t.name))),t.params&&uc(t.params,r.keys.map((t=>t.name)))),s=r.stringify(a)}else if(null!=t.path)s=t.path,r=n.find((t=>t.re.test(s))),r&&(a=r.parse(s),o=r.record.name);else{if(r=e.name?i.get(e.name):n.find((t=>t.re.test(e.path))),!r)throw Jl(1,{location:t,currentLocation:e});o=r.record.name,a=nl({},e.params,t.params),s=r.stringify(a)}const l=[];let c=r;for(;c;)l.unshift(c.record),c=c.parent;return{name:o,path:s,params:a,matched:l,meta:pc(l)}},removeRoute:s,clearRoutes:function(){n.length=0,i.clear()},getRoutes:function(){return n},getRecordMatcher:function(t){return i.get(t)}}}function uc(t,e){const n={};for(const i of e)i in t&&(n[i]=t[i]);return n}function hc(t){const e={},n=t.props||!1;if("component"in t)e.default=n;else for(const i in t.components)e[i]="object"==typeof n?n[i]:n;return e}function dc(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function pc(t){return t.reduce(((t,e)=>nl(t,e.meta)),{})}function fc(t,e){const n={};for(const i in t)n[i]=i in e?e[i]:t[i];return n}function mc({record:t}){return!!(t.name||t.components&&Object.keys(t.components).length||t.redirect)}function gc(t){const e={};if(""===t||"?"===t)return e;const n=("?"===t[0]?t.slice(1):t).split("&");for(let i=0;i<n.length;++i){const t=n[i].replace(hl," "),r=t.indexOf("="),s=Sl(r<0?t:t.slice(0,r)),o=r<0?null:Sl(t.slice(r+1));if(s in e){let t=e[s];sl(t)||(t=e[s]=[t]),t.push(o)}else e[s]=o}return e}function vc(t){let e="";for(let n in t){const i=t[n];if(n=xl(n).replace(cl,"%3D"),null==i){void 0!==i&&(e+=(e.length?"&":"")+n);continue}(sl(i)?i.map((t=>t&&xl(t))):[i&&xl(i)]).forEach((t=>{void 0!==t&&(e+=(e.length?"&":"")+n,null!=t&&(e+="="+t))}))}return e}function yc(t){const e={};for(const n in t){const i=t[n];void 0!==i&&(e[n]=sl(i)?i.map((t=>null==t?null:""+t)):null==i?i:""+i)}return e}const _c=Symbol(""),bc=Symbol(""),xc=Symbol(""),wc=Symbol(""),Sc=Symbol("");function Mc(){let t=[];return{add:function(e){return t.push(e),()=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)}},list:()=>t.slice(),reset:function(){t=[]}}}function Cc(t,e,n,i,r,s=t=>t()){const o=i&&(i.enterCallbacks[r]=i.enterCallbacks[r]||[]);return()=>new Promise(((a,l)=>{const c=t=>{var s;!1===t?l(Jl(4,{from:n,to:e})):t instanceof Error?l(t):"string"==typeof(s=t)||s&&"object"==typeof s?l(Jl(2,{from:e,to:t})):(o&&i.enterCallbacks[r]===o&&"function"==typeof t&&o.push(t),a())},u=s((()=>t.call(i&&i.instances[r],e,n,c)));let h=Promise.resolve(u);t.length<3&&(h=h.then(c)),h.catch((t=>l(t)))}))}function Ac(t,e,n,i,r=t=>t()){const s=[];for(const a of t)for(const t in a.components){let l=a.components[t];if("beforeRouteEnter"===e||a.instances[t])if("object"==typeof(o=l)||"displayName"in o||"props"in o||"__vccOpts"in o){const o=(l.__vccOpts||l)[e];o&&s.push(Cc(o,n,i,a,t,r))}else{let o=l();s.push((()=>o.then((s=>{if(!s)return Promise.reject(new Error(`Couldn't resolve component "${t}" at "${a.path}"`));const o=(l=s).__esModule||"Module"===l[Symbol.toStringTag]?s.default:s;var l;a.components[t]=o;const c=(o.__vccOpts||o)[e];return c&&Cc(c,n,i,a,t,r)()}))))}}var o;return s}function Tc(t){const e=Kn(xc),n=Kn(wc),i=Hr((()=>{const n=Me(t.to);return e.resolve(n)})),r=Hr((()=>{const{matched:t}=i.value,{length:e}=t,r=t[e-1],s=n.matched;if(!r||!s.length)return-1;const o=s.findIndex(El.bind(null,r));if(o>-1)return o;const a=Ic(t[e-2]);return e>1&&Ic(r)===a&&s[s.length-1].path!==a?s.findIndex(El.bind(null,t[e-2])):o})),s=Hr((()=>r.value>-1&&function(t,e){for(const n in e){const i=e[n],r=t[n];if("string"==typeof i){if(i!==r)return!1}else if(!sl(r)||r.length!==i.length||i.some(((t,e)=>t!==r[e])))return!1}return!0}(n.params,i.value.params))),o=Hr((()=>r.value>-1&&r.value===n.matched.length-1&&Il(n.params,i.value.params)));return{route:i,href:Hr((()=>i.value.href)),isActive:s,isExactActive:o,navigate:function(n={}){return function(t){if(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)return;if(t.defaultPrevented)return;if(void 0!==t.button&&0!==t.button)return;if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}t.preventDefault&&t.preventDefault();return!0}(n)?e[Me(t.replace)?"replace":"push"](Me(t.to)).catch(rl):Promise.resolve()}}}const Ec=An({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Tc,setup(t,{slots:e}){const n=se(Tc(t)),{options:i}=Kn(xc),r=Hr((()=>({[Rc(t.activeClass,i.linkActiveClass,"router-link-active")]:n.isActive,[Rc(t.exactActiveClass,i.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive})));return()=>{const i=e.default&&e.default(n);return t.custom?i:jr("a",{"aria-current":n.isExactActive?t.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:r.value},i)}}});function Ic(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const Rc=(t,e,n)=>null!=t?t:null!=e?e:n;function Nc(t,e){if(!t)return null;const n=t(e);return 1===n.length?n[0]:n}const Dc=An({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:n}){const i=Kn(Sc),r=Hr((()=>t.route||i.value)),s=Kn(bc,0),o=Hr((()=>{let t=Me(s);const{matched:e}=r.value;let n;for(;(n=e[t])&&!n.components;)t++;return t})),a=Hr((()=>r.value.matched[o.value]));Zn(bc,Hr((()=>o.value+1))),Zn(_c,a),Zn(Sc,r);const l=xe();return Ci((()=>[l.value,a.value,t.name]),(([t,e,n],[i,r,s])=>{e&&(e.instances[n]=t,r&&r!==e&&t&&t===i&&(e.leaveGuards.size||(e.leaveGuards=r.leaveGuards),e.updateGuards.size||(e.updateGuards=r.updateGuards))),!t||!e||r&&El(e,r)&&i||(e.enterCallbacks[n]||[]).forEach((e=>e(t)))}),{flush:"post"}),()=>{const i=r.value,s=t.name,o=a.value,c=o&&o.components[s];if(!c)return Nc(n.default,{Component:c,route:i});const u=o.props[s],h=u?!0===u?i.params:"function"==typeof u?u(i):u:null,d=jr(c,nl({},h,e,{onVnodeUnmounted:t=>{t.component.isUnmounted&&(o.instances[s]=null)},ref:l}));return Nc(n.default,{Component:d,route:i})||d}}});function Lc(t){const e=cc(t.routes,t),n=t.parseQuery||gc,i=t.stringifyQuery||vc,r=t.history,s=Mc(),o=Mc(),a=Mc(),l=we(Dl,!0);let c=Dl;el&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=il.bind(null,(t=>""+t)),h=il.bind(null,wl),d=il.bind(null,Sl);function p(t,s){if(s=nl({},s||l.value),"string"==typeof t){const i=Al(n,t,s.path),o=e.resolve({path:i.path},s),a=r.createHref(i.fullPath);return nl(i,o,{params:d(o.params),hash:Sl(i.hash),redirectedFrom:void 0,href:a})}let o;if(null!=t.path)o=nl({},t,{path:Al(n,t.path,s.path).path});else{const e=nl({},t.params);for(const t in e)null==e[t]&&delete e[t];o=nl({},t,{params:h(e)}),s.params=h(s.params)}const a=e.resolve(o,s),c=t.hash||"";a.params=u(d(a.params));const p=function(t,e){const n=e.query?t(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}(i,nl({},t,{hash:(f=c,bl(f).replace(gl,"{").replace(yl,"}").replace(fl,"^")),path:a.path}));var f;const m=r.createHref(p);return nl({fullPath:p,hash:c,query:i===vc?yc(t.query):t.query||{}},a,{redirectedFrom:void 0,href:m})}function f(t){return"string"==typeof t?Al(n,t,l.value.path):nl({},t)}function m(t,e){if(c!==t)return Jl(8,{from:e,to:t})}function g(t){return y(t)}function v(t){const e=t.matched[t.matched.length-1];if(e&&e.redirect){const{redirect:n}=e;let i="function"==typeof n?n(t):n;return"string"==typeof i&&(i=i.includes("?")||i.includes("#")?i=f(i):{path:i},i.params={}),nl({query:t.query,hash:t.hash,params:null!=i.path?{}:t.params},i)}}function y(t,e){const n=c=p(t),r=l.value,s=t.state,o=t.force,a=!0===t.replace,u=v(n);if(u)return y(nl(f(u),{state:"object"==typeof u?nl({},s,u.state):s,force:o,replace:a}),e||n);const h=n;let d;return h.redirectedFrom=e,!o&&function(t,e,n){const i=e.matched.length-1,r=n.matched.length-1;return i>-1&&i===r&&El(e.matched[i],n.matched[r])&&Il(e.params,n.params)&&t(e.query)===t(n.query)&&e.hash===n.hash}(i,r,n)&&(d=Jl(16,{to:h,from:r}),N(r,r,!0,!1)),(d?Promise.resolve(d):x(h,r)).catch((t=>Ql(t)?Ql(t,2)?t:R(t):I(t,h,r))).then((t=>{if(t){if(Ql(t,2))return y(nl({replace:a},f(t.to),{state:"object"==typeof t.to?nl({},s,t.to.state):s,force:o}),e||h)}else t=S(h,r,!0,a,s);return w(h,r,t),t}))}function _(t,e){const n=m(t,e);return n?Promise.reject(n):Promise.resolve()}function b(t){const e=O.values().next().value;return e&&"function"==typeof e.runWithContext?e.runWithContext(t):t()}function x(t,e){let n;const[i,r,a]=function(t,e){const n=[],i=[],r=[],s=Math.max(e.matched.length,t.matched.length);for(let o=0;o<s;o++){const s=e.matched[o];s&&(t.matched.find((t=>El(t,s)))?i.push(s):n.push(s));const a=t.matched[o];a&&(e.matched.find((t=>El(t,a)))||r.push(a))}return[n,i,r]}
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */(t,e);n=Ac(i.reverse(),"beforeRouteLeave",t,e);for(const s of i)s.leaveGuards.forEach((i=>{n.push(Cc(i,t,e))}));const l=_.bind(null,t,e);return n.push(l),P(n).then((()=>{n=[];for(const i of s.list())n.push(Cc(i,t,e));return n.push(l),P(n)})).then((()=>{n=Ac(r,"beforeRouteUpdate",t,e);for(const i of r)i.updateGuards.forEach((i=>{n.push(Cc(i,t,e))}));return n.push(l),P(n)})).then((()=>{n=[];for(const i of a)if(i.beforeEnter)if(sl(i.beforeEnter))for(const r of i.beforeEnter)n.push(Cc(r,t,e));else n.push(Cc(i.beforeEnter,t,e));return n.push(l),P(n)})).then((()=>(t.matched.forEach((t=>t.enterCallbacks={})),n=Ac(a,"beforeRouteEnter",t,e,b),n.push(l),P(n)))).then((()=>{n=[];for(const i of o.list())n.push(Cc(i,t,e));return n.push(l),P(n)})).catch((t=>Ql(t,8)?t:Promise.reject(t)))}function w(t,e,n){a.list().forEach((i=>b((()=>i(t,e,n)))))}function S(t,e,n,i,s){const o=m(t,e);if(o)return o;const a=e===Dl,c=el?history.state:{};n&&(i||a?r.replace(t.fullPath,nl({scroll:a&&c&&c.scroll},s)):r.push(t.fullPath,s)),l.value=t,N(t,e,n,a),R()}let M;function C(){M||(M=r.listen(((t,e,n)=>{if(!k.listening)return;const i=p(t),s=v(i);if(s)return void y(nl(s,{replace:!0}),i).catch(rl);c=i;const o=l.value;var a,u;el&&(a=Vl(o.fullPath,n.delta),u=zl(),Wl.set(a,u)),x(i,o).catch((t=>Ql(t,12)?t:Ql(t,2)?(y(t.to,i).then((t=>{Ql(t,20)&&!n.delta&&n.type===Ll.pop&&r.go(-1,!1)})).catch(rl),Promise.reject()):(n.delta&&r.go(-n.delta,!1),I(t,i,o)))).then((t=>{(t=t||S(i,o,!1))&&(n.delta&&!Ql(t,8)?r.go(-n.delta,!1):n.type===Ll.pop&&Ql(t,20)&&r.go(-1,!1)),w(i,o,t)})).catch(rl)})))}let A,T=Mc(),E=Mc();function I(t,e,n){R(t);const i=E.list();return i.length&&i.forEach((i=>i(t,e,n))),Promise.reject(t)}function R(t){return A||(A=!t,C(),T.list().forEach((([e,n])=>t?n(t):e())),T.reset()),t}function N(e,n,i,r){const{scrollBehavior:s}=t;if(!el||!s)return Promise.resolve();const o=!i&&function(t){const e=Wl.get(t);return Wl.delete(t),e}(Vl(e.fullPath,0))||(r||!i)&&history.state&&history.state.scroll||null;return ze().then((()=>s(e,n,o))).then((t=>t&&Ul(t))).catch((t=>I(t,e,n)))}const D=t=>r.go(t);let L;const O=new Set,k={currentRoute:l,listening:!0,addRoute:function(t,n){let i,r;return Yl(t)?(i=e.getRecordMatcher(t),r=n):r=t,e.addRoute(r,i)},removeRoute:function(t){const n=e.getRecordMatcher(t);n&&e.removeRoute(n)},clearRoutes:e.clearRoutes,hasRoute:function(t){return!!e.getRecordMatcher(t)},getRoutes:function(){return e.getRoutes().map((t=>t.record))},resolve:p,options:t,push:g,replace:function(t){return g(nl(f(t),{replace:!0}))},go:D,back:()=>D(-1),forward:()=>D(1),beforeEach:s.add,beforeResolve:o.add,afterEach:a.add,onError:E.add,isReady:function(){return A&&l.value!==Dl?Promise.resolve():new Promise(((t,e)=>{T.add([t,e])}))},install(t){t.component("RouterLink",Ec),t.component("RouterView",Dc),t.config.globalProperties.$router=this,Object.defineProperty(t.config.globalProperties,"$route",{enumerable:!0,get:()=>Me(l)}),el&&!L&&l.value===Dl&&(L=!0,g(r.location).catch((t=>{})));const e={};for(const i in Dl)Object.defineProperty(e,i,{get:()=>l.value[i],enumerable:!0});t.provide(xc,this),t.provide(wc,oe(e)),t.provide(Sc,l);const n=t.unmount;O.add(t),t.unmount=function(){O.delete(t),O.size<1&&(c=Dl,M&&M(),M=null,l.value=Dl,L=!1,A=!1),n()}}};function P(t){return t.reduce(((t,e)=>t.then((()=>b(e)))),Promise.resolve())}return k}const Oc="147",kc=0,Pc=1,Fc=2,Bc=0,zc=1,Uc=2,Vc=3,Wc=0,Gc=1,Hc=2,jc=1,qc=2,Xc=3,Yc=0,Zc=1,Kc=2,$c=0,Jc=1,Qc=2,tu=3,eu=4,nu=5,iu=100,ru=101,su=102,ou=103,au=104,lu=200,cu=201,uu=202,hu=203,du=204,pu=205,fu=206,mu=207,gu=208,vu=209,yu=210,_u=0,bu=1,xu=2,wu=3,Su=4,Mu=5,Cu=6,Au=7,Tu=0,Eu=1,Iu=2,Ru=0,Nu=1,Du=2,Lu=3,Ou=4,ku=5,Pu=301,Fu=302,Bu=303,zu=304,Uu=306,Vu=1e3,Wu=1001,Gu=1002,Hu=1003,ju=1004,qu=1005,Xu=1006,Yu=1007,Zu=1008,Ku=1009,$u=1010,Ju=1011,Qu=1012,th=1013,eh=1014,nh=1015,ih=1016,rh=1017,sh=1018,oh=1020,ah=1021,lh=1022,ch=1023,uh=1024,hh=1025,dh=1026,ph=1027,fh=1028,mh=1029,gh=1030,vh=1031,yh=1033,_h=33776,bh=33777,xh=33778,wh=33779,Sh=35840,Mh=35841,Ch=35842,Ah=35843,Th=36196,Eh=37492,Ih=37496,Rh=37808,Nh=37809,Dh=37810,Lh=37811,Oh=37812,kh=37813,Ph=37814,Fh=37815,Bh=37816,zh=37817,Uh=37818,Vh=37819,Wh=37820,Gh=37821,Hh=36492,jh=2200,qh=2300,Xh=2301,Yh=2302,Zh=2400,Kh=2401,$h=2402,Jh=2500,Qh=3e3,td=3001,ed=3201,nd=0,id=1,rd="srgb",sd="srgb-linear",od=7680,ad=35044,ld="300 es",cd=1035;class ud{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const hd=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let dd=1234567;const pd=Math.PI/180,fd=180/Math.PI;function md(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(hd[255&t]+hd[t>>8&255]+hd[t>>16&255]+hd[t>>24&255]+"-"+hd[255&e]+hd[e>>8&255]+"-"+hd[e>>16&15|64]+hd[e>>24&255]+"-"+hd[63&n|128]+hd[n>>8&255]+"-"+hd[n>>16&255]+hd[n>>24&255]+hd[255&i]+hd[i>>8&255]+hd[i>>16&255]+hd[i>>24&255]).toLowerCase()}function gd(t,e,n){return Math.max(e,Math.min(n,t))}function vd(t,e){return(t%e+e)%e}function yd(t,e,n){return(1-n)*t+n*e}function _d(t){return!(t&t-1)&&0!==t}function bd(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function xd(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function wd(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Sd(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var Md=Object.freeze({__proto__:null,DEG2RAD:pd,RAD2DEG:fd,generateUUID:md,clamp:gd,euclideanModulo:vd,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:yd,damp:function(t,e,n,i){return yd(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(vd(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(dd=t);let e=dd+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*pd},radToDeg:function(t){return t*fd},isPowerOfTwo:_d,ceilPowerOfTwo:bd,floorPowerOfTwo:xd,setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+i)/2),u=o((e+i)/2),h=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":t.set(a*u,l*h,l*d,a*c);break;case"YZY":t.set(l*d,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*d,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*u,a*c)}},normalize:Sd,denormalize:wd});class Cd{constructor(t=0,e=0){Cd.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ad{constructor(){Ad.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,n,i,r,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=r,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],_=i[7],b=i[2],x=i[5],w=i[8];return r[0]=s*f+o*v+a*b,r[3]=s*m+o*y+a*x,r[6]=s*g+o*_+a*w,r[1]=l*f+c*v+u*b,r[4]=l*m+c*y+u*x,r[7]=l*g+c*_+u*w,r[2]=h*f+d*v+p*b,r[5]=h*m+d*y+p*x,r[8]=h*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*r*c+n*o*a+i*r*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*r,d=l*r-s*a,p=e*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(i*l-c*n)*f,t[2]=(o*n-i*s)*f,t[3]=h*f,t[4]=(c*e-i*a)*f,t[5]=(i*r-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-i*l,i*a,-i*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Td.makeScale(t,e)),this}rotate(t){return this.premultiply(Td.makeRotation(-t)),this}translate(t,e){return this.premultiply(Td.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Td=new Ad;function Ed(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function Id(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Rd(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Nd(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Dd={[rd]:{[sd]:Rd},[sd]:{[rd]:Nd}},Ld={legacyMode:!0,get workingColorSpace(){return sd},set workingColorSpace(t){},convert:function(t,e,n){if(this.legacyMode||e===n||!e||!n)return t;if(Dd[e]&&void 0!==Dd[e][n]){const i=Dd[e][n];return t.r=i(t.r),t.g=i(t.g),t.b=i(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Od={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kd={r:0,g:0,b:0},Pd={h:0,s:0,l:0},Fd={h:0,s:0,l:0};function Bd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function zd(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class Ud{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=rd){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Ld.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=Ld.workingColorSpace){return this.r=t,this.g=e,this.b=n,Ld.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=Ld.workingColorSpace){if(t=vd(t,1),e=gd(e,0,1),n=gd(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Bd(r,i,t+1/3),this.g=Bd(r,i,t),this.b=Bd(r,i,t-1/3)}return Ld.toWorkingColorSpace(this,i),this}setStyle(t,e=rd){function n(t){void 0!==t&&parseFloat(t)}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Ld.toWorkingColorSpace(this,e),n(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Ld.toWorkingColorSpace(this,e),n(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(t[1])/360,r=parseFloat(t[2])/100,s=parseFloat(t[3])/100;return n(t[4]),this.setHSL(i,r,s,e)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],n=t.length;if(3===n)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Ld.toWorkingColorSpace(this,e),this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Ld.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=rd){const n=Od[t.toLowerCase()];return void 0!==n&&this.setHex(n,e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Rd(t.r),this.g=Rd(t.g),this.b=Rd(t.b),this}copyLinearToSRGB(t){return this.r=Nd(t.r),this.g=Nd(t.g),this.b=Nd(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=rd){return Ld.fromWorkingColorSpace(zd(this,kd),t),gd(255*kd.r,0,255)<<16^gd(255*kd.g,0,255)<<8^gd(255*kd.b,0,255)}getHexString(t=rd){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ld.workingColorSpace){Ld.fromWorkingColorSpace(zd(this,kd),e);const n=kd.r,i=kd.g,r=kd.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=c<=.5?t/(s+o):t/(2-s-o),s){case n:a=(i-r)/t+(i<r?6:0);break;case i:a=(r-n)/t+2;break;case r:a=(n-i)/t+4}a/=6}return t.h=a,t.s=l,t.l=c,t}getRGB(t,e=Ld.workingColorSpace){return Ld.fromWorkingColorSpace(zd(this,kd),e),t.r=kd.r,t.g=kd.g,t.b=kd.b,t}getStyle(t=rd){return Ld.fromWorkingColorSpace(zd(this,kd),t),t!==rd?`color(${t} ${kd.r} ${kd.g} ${kd.b})`:`rgb(${255*kd.r|0},${255*kd.g|0},${255*kd.b|0})`}offsetHSL(t,e,n){return this.getHSL(Pd),Pd.h+=t,Pd.s+=e,Pd.l+=n,this.setHSL(Pd.h,Pd.s,Pd.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Pd),t.getHSL(Fd);const n=yd(Pd.h,Fd.h,e),i=yd(Pd.s,Fd.s,e),r=yd(Pd.l,Fd.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Vd;Ud.NAMES=Od;class Wd{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Vd&&(Vd=Id("canvas")),Vd.width=t.width,Vd.height=t.height;const n=Vd.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Vd}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Id("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*Rd(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Rd(e[t]/255)):e[t]=Rd(e[t]);return{data:e,width:t.width,height:t.height}}return t}}class Gd{constructor(t=null){this.isSource=!0,this.uuid=md(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Hd(i[e].image)):t.push(Hd(i[e]))}else t=Hd(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function Hd(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Wd.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}let jd=0;class qd extends ud{constructor(t=qd.DEFAULT_IMAGE,e=qd.DEFAULT_MAPPING,n=Wu,i=Wu,r=Xu,s=Zu,o=ch,a=Ku,l=qd.DEFAULT_ANISOTROPY,c=Qh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:jd++}),this.uuid=md(),this.name="",this.source=new Gd(t),this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Cd(0,0),this.repeat=new Cd(1,1),this.center=new Cd(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ad,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Vu:t.x=t.x-Math.floor(t.x);break;case Wu:t.x=t.x<0?0:1;break;case Gu:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Vu:t.y=t.y-Math.floor(t.y);break;case Wu:t.y=t.y<0?0:1;break;case Gu:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}qd.DEFAULT_IMAGE=null,qd.DEFAULT_MAPPING=300,qd.DEFAULT_ANISOTROPY=1;class Xd{constructor(t=0,e=0,n=0,i=1){Xd.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+h)/4,_=(u+f)/4,b=(p+m)/4;return t>a&&t>v?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=y/n,r=_/n):a>v?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=_/r,i=b/r),this.set(n,i,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Yd extends ud{constructor(t=1,e=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Xd(0,0,t,e),this.scissorTest=!1,this.viewport=new Xd(0,0,t,e);const i={width:t,height:e,depth:1};this.texture=new qd(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Xu,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Gd(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zd extends qd{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=Hu,this.minFilter=Hu,this.wrapR=Wu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Kd extends qd{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=Hu,this.minFilter=Hu,this.wrapR=Wu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $d{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-o;const e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*t+h*r,l=l*t+d*r,c=c*t+p*r,u=u*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,i=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(gd(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+i*l-r*a,this._y=i*c+s*a+r*o-n*l,this._z=r*c+s*l+n*a-i*o,this._w=s*c-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Jd{constructor(t=0,e=0,n=0){Jd.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(tp.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(tp.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*i-o*n,c=a*n+o*e-r*i,u=a*i+r*n-s*e,h=-r*e-s*n-o*i;return this.x=l*a+h*-r+c*-o-u*-s,this.y=c*a+h*-s+u*-r-l*-o,this.z=u*a+h*-o+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Qd.copy(this).projectOnVector(t),this.sub(Qd)}reflect(t){return this.sub(Qd.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(gd(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Qd=new Jd,tp=new $d;class ep{constructor(t=new Jd(1/0,1/0,1/0),e=new Jd(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=ip.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n)if(e&&null!=n.attributes&&void 0!==n.attributes.position){const e=n.attributes.position;for(let n=0,i=e.count;n<i;n++)ip.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint(ip)}else null===n.boundingBox&&n.computeBoundingBox(),rp.copy(n.boundingBox),rp.applyMatrix4(t.matrixWorld),this.union(rp);const i=t.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ip),ip.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(hp),dp.subVectors(this.max,hp),sp.subVectors(t.a,hp),op.subVectors(t.b,hp),ap.subVectors(t.c,hp),lp.subVectors(op,sp),cp.subVectors(ap,op),up.subVectors(sp,ap);let e=[0,-lp.z,lp.y,0,-cp.z,cp.y,0,-up.z,up.y,lp.z,0,-lp.x,cp.z,0,-cp.x,up.z,0,-up.x,-lp.y,lp.x,0,-cp.y,cp.x,0,-up.y,up.x,0];return!!mp(e,sp,op,ap,dp)&&(e=[1,0,0,0,1,0,0,0,1],!!mp(e,sp,op,ap,dp)&&(pp.crossVectors(lp,cp),e=[pp.x,pp.y,pp.z],mp(e,sp,op,ap,dp)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ip.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(ip).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(np[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),np[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),np[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),np[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),np[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),np[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),np[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),np[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(np)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const np=[new Jd,new Jd,new Jd,new Jd,new Jd,new Jd,new Jd,new Jd],ip=new Jd,rp=new ep,sp=new Jd,op=new Jd,ap=new Jd,lp=new Jd,cp=new Jd,up=new Jd,hp=new Jd,dp=new Jd,pp=new Jd,fp=new Jd;function mp(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){fp.fromArray(t,s);const o=r.x*Math.abs(fp.x)+r.y*Math.abs(fp.y)+r.z*Math.abs(fp.z),a=e.dot(fp),l=n.dot(fp),c=i.dot(fp);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const gp=new ep,vp=new Jd,yp=new Jd;class _p{constructor(t=new Jd,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):gp.setFromPoints(t).getCenter(n);let i=0;for(let r=0,s=t.length;r<s;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;vp.subVectors(t,this.center);const e=vp.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(vp,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(yp.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(vp.copy(t.center).add(yp)),this.expandByPoint(vp.copy(t.center).sub(yp))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const bp=new Jd,xp=new Jd,wp=new Jd,Sp=new Jd,Mp=new Jd,Cp=new Jd,Ap=new Jd;class Tp{constructor(t=new Jd,e=new Jd(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,bp)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=bp.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(bp.copy(this.direction).multiplyScalar(e).add(this.origin),bp.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){xp.copy(t).add(e).multiplyScalar(.5),wp.copy(e).sub(t).normalize(),Sp.copy(this.origin).sub(xp);const r=.5*t.distanceTo(e),s=-this.direction.dot(wp),o=Sp.dot(this.direction),a=-Sp.dot(wp),l=Sp.lengthSq(),c=Math.abs(1-s*s);let u,h,d,p;if(c>0)if(u=s*a-o,h=s*o-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-s*r+o)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(s*r+o)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(wp).multiplyScalar(h).add(xp),d}intersectSphere(t,e){bp.subVectors(t.center,this.origin);const n=bp.dot(this.direction),i=bp.dot(bp)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,bp)}intersectTriangle(t,e,n,i,r){Mp.subVectors(e,t),Cp.subVectors(n,t),Ap.crossVectors(Mp,Cp);let s,o=this.direction.dot(Ap);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Sp.subVectors(this.origin,t);const a=s*this.direction.dot(Cp.crossVectors(Sp,Cp));if(a<0)return null;const l=s*this.direction.dot(Mp.cross(Sp));if(l<0)return null;if(a+l>o)return null;const c=-s*Sp.dot(Ap);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ep{constructor(){Ep.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,n,i,r,s,o,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ep).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Ip.setFromMatrixColumn(t,0).length(),r=1/Ip.setFromMatrixColumn(t,1).length(),s=1/Ip.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=s*c,n=s*u,i=o*c,r=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,n=a*u,i=l*c,r=l*u;e[0]=t+r*o,e[4]=i*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,n=a*u,i=l*c,r=l*u;e[0]=t-r*o,e[4]=-s*u,e[8]=i+n*o,e[1]=n+i*o,e[5]=s*c,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,n=s*u,i=o*c,r=o*u;e[0]=a*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=a*u,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=r-t*u,e[8]=i*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+i,e[10]=t-r*u}else if("XZY"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=s*c,e[9]=n*u-i,e[2]=i*u-n,e[6]=o*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Np,t,Dp)}lookAt(t,e,n){const i=this.elements;return kp.subVectors(t,e),0===kp.lengthSq()&&(kp.z=1),kp.normalize(),Lp.crossVectors(n,kp),0===Lp.lengthSq()&&(1===Math.abs(n.z)?kp.x+=1e-4:kp.z+=1e-4,kp.normalize(),Lp.crossVectors(n,kp)),Lp.normalize(),Op.crossVectors(kp,Lp),i[0]=Lp.x,i[4]=Op.x,i[8]=kp.x,i[1]=Lp.y,i[5]=Op.y,i[9]=kp.y,i[2]=Lp.z,i[6]=Op.z,i[10]=kp.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=i[0],w=i[4],S=i[8],M=i[12],C=i[1],A=i[5],T=i[9],E=i[13],I=i[2],R=i[6],N=i[10],D=i[14],L=i[3],O=i[7],k=i[11],P=i[15];return r[0]=s*x+o*C+a*I+l*L,r[4]=s*w+o*A+a*R+l*O,r[8]=s*S+o*T+a*N+l*k,r[12]=s*M+o*E+a*D+l*P,r[1]=c*x+u*C+h*I+d*L,r[5]=c*w+u*A+h*R+d*O,r[9]=c*S+u*T+h*N+d*k,r[13]=c*M+u*E+h*D+d*P,r[2]=p*x+f*C+m*I+g*L,r[6]=p*w+f*A+m*R+g*O,r[10]=p*S+f*T+m*N+g*k,r[14]=p*M+f*E+m*D+g*P,r[3]=v*x+y*C+_*I+b*L,r[7]=v*w+y*A+_*R+b*O,r[11]=v*S+y*T+_*N+b*k,r[15]=v*M+y*E+_*D+b*P,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+r*a*u-i*l*u-r*o*h+n*l*h+i*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+r*s*h-i*s*d+i*l*c-r*a*c)+t[11]*(+e*l*u-e*o*d-r*s*u+n*s*d+r*o*c-n*l*c)+t[15]*(-i*o*c-e*a*u+e*o*h+i*s*u-n*s*h+n*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,y=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,_=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,x=e*v+n*y+i*_+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=v*w,t[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,t[2]=(o*m*r-f*a*r+f*i*l-n*m*l-o*i*g+n*a*g)*w,t[3]=(u*a*r-o*h*r-u*i*l+n*h*l+o*i*d-n*a*d)*w,t[4]=y*w,t[5]=(c*m*r-p*h*r+p*i*d-e*m*d-c*i*g+e*h*g)*w,t[6]=(p*a*r-s*m*r-p*i*l+e*m*l+s*i*g-e*a*g)*w,t[7]=(s*h*r-c*a*r+c*i*l-e*h*l-s*i*d+e*a*d)*w,t[8]=_*w,t[9]=(p*u*r-c*f*r-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(s*f*r-p*o*r+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(c*o*r-s*u*r-c*n*l+e*u*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*f*i-p*u*i+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*i-s*f*i-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*u*i-c*o*i+c*n*a-e*u*a-s*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,l=r*s,c=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*s,0,l*a-i*o,c*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,c=s+s,u=o+o,h=r*l,d=r*c,p=r*u,f=s*c,m=s*u,g=o*u,v=a*l,y=a*c,_=a*u,b=n.x,x=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+_)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-_)*x,i[5]=(1-(h+g))*x,i[6]=(m+v)*x,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Ip.set(i[0],i[1],i[2]).length();const s=Ip.set(i[4],i[5],i[6]).length(),o=Ip.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Rp.copy(this);const a=1/r,l=1/s,c=1/o;return Rp.elements[0]*=a,Rp.elements[1]*=a,Rp.elements[2]*=a,Rp.elements[4]*=l,Rp.elements[5]*=l,Rp.elements[6]*=l,Rp.elements[8]*=c,Rp.elements[9]*=c,Rp.elements[10]*=c,e.setFromRotationMatrix(Rp),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s){const o=this.elements,a=2*r/(e-t),l=2*r/(n-i),c=(e+t)/(e-t),u=(n+i)/(n-i),h=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s){const o=this.elements,a=1/(e-t),l=1/(n-i),c=1/(s-r),u=(e+t)*a,h=(n+i)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Ip=new Jd,Rp=new Ep,Np=new Jd(0,0,0),Dp=new Jd(1,1,1),Lp=new Jd,Op=new Jd,kp=new Jd,Pp=new Ep,Fp=new $d;class Bp{constructor(t=0,e=0,n=0,i=Bp.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(gd(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-gd(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(gd(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-gd(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(gd(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-gd(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Pp.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Pp,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Fp.setFromEuler(this),this.setFromQuaternion(Fp,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){}}Bp.DefaultOrder="XYZ",Bp.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class zp{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Up=0;const Vp=new Jd,Wp=new $d,Gp=new Ep,Hp=new Jd,jp=new Jd,qp=new Jd,Xp=new $d,Yp=new Jd(1,0,0),Zp=new Jd(0,1,0),Kp=new Jd(0,0,1),$p={type:"added"},Jp={type:"removed"};class Qp extends ud{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Up++}),this.uuid=md(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qp.DefaultUp.clone();const t=new Jd,e=new Bp,n=new $d,i=new Jd(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ep},normalMatrix:{value:new Ad}}),this.matrix=new Ep,this.matrixWorld=new Ep,this.matrixAutoUpdate=Qp.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Qp.DefaultMatrixWorldAutoUpdate,this.layers=new zp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Wp.setFromAxisAngle(t,e),this.quaternion.multiply(Wp),this}rotateOnWorldAxis(t,e){return Wp.setFromAxisAngle(t,e),this.quaternion.premultiply(Wp),this}rotateX(t){return this.rotateOnAxis(Yp,t)}rotateY(t){return this.rotateOnAxis(Zp,t)}rotateZ(t){return this.rotateOnAxis(Kp,t)}translateOnAxis(t,e){return Vp.copy(t).applyQuaternion(this.quaternion),this.position.add(Vp.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Yp,t)}translateY(t){return this.translateOnAxis(Zp,t)}translateZ(t){return this.translateOnAxis(Kp,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Gp.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Hp.copy(t):Hp.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),jp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Gp.lookAt(jp,Hp,this.up):Gp.lookAt(Hp,jp,this.up),this.quaternion.setFromRotationMatrix(Gp),i&&(Gp.extractRotation(i.matrixWorld),Wp.setFromRotationMatrix(Gp),this.quaternion.premultiply(Wp.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent($p)),this}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Jp)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Jp)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Gp.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Gp.multiply(t.parent.matrixWorld)),t.applyMatrix4(Gp),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(jp,t,qp),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(jp,Xp,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),u=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}Qp.DefaultUp=new Jd(0,1,0),Qp.DefaultMatrixAutoUpdate=!0,Qp.DefaultMatrixWorldAutoUpdate=!0;const tf=new Jd,ef=new Jd,nf=new Jd,rf=new Jd,sf=new Jd,of=new Jd,af=new Jd,lf=new Jd,cf=new Jd,uf=new Jd;class hf{constructor(t=new Jd,e=new Jd,n=new Jd){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),tf.subVectors(t,e),i.cross(tf);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){tf.subVectors(i,e),ef.subVectors(n,e),nf.subVectors(t,e);const s=tf.dot(tf),o=tf.dot(ef),a=tf.dot(nf),l=ef.dot(ef),c=ef.dot(nf),u=s*l-o*o;if(0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,rf),rf.x>=0&&rf.y>=0&&rf.x+rf.y<=1}static getUV(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,rf),a.set(0,0),a.addScaledVector(r,rf.x),a.addScaledVector(s,rf.y),a.addScaledVector(o,rf.z),a}static isFrontFacing(t,e,n,i){return tf.subVectors(n,e),ef.subVectors(t,e),tf.cross(ef).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return tf.subVectors(this.c,this.b),ef.subVectors(this.a,this.b),.5*tf.cross(ef).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return hf.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return hf.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return hf.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return hf.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return hf.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,o;sf.subVectors(i,n),of.subVectors(r,n),lf.subVectors(t,n);const a=sf.dot(lf),l=of.dot(lf);if(a<=0&&l<=0)return e.copy(n);cf.subVectors(t,i);const c=sf.dot(cf),u=of.dot(cf);if(c>=0&&u<=c)return e.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(n).addScaledVector(sf,s);uf.subVectors(t,r);const d=sf.dot(uf),p=of.dot(uf);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(of,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return af.subVectors(r,i),o=(u-c)/(u-c+(d-p)),e.copy(i).addScaledVector(af,o);const g=1/(m+f+h);return s=f*g,o=h*g,e.copy(n).addScaledVector(sf,s).addScaledVector(of,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let df=0;class pf extends ud{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:df++}),this.uuid=md(),this.name="",this.type="Material",this.blending=Jc,this.side=Yc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=du,this.blendDst=pu,this.blendEquation=iu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=wu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=od,this.stencilZFail=od,this.stencilZPass=od,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n)continue;const i=this[e];void 0!==i&&(i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Jc&&(n.blending=this.blending),this.side!==Yc&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class ff extends pf{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ud(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Tu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const mf=new Jd,gf=new Cd;class vf{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=ad,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)gf.fromBufferAttribute(this,e),gf.applyMatrix3(t),this.setXY(e,gf.x,gf.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)mf.fromBufferAttribute(this,e),mf.applyMatrix3(t),this.setXYZ(e,mf.x,mf.y,mf.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)mf.fromBufferAttribute(this,e),mf.applyMatrix4(t),this.setXYZ(e,mf.x,mf.y,mf.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)mf.fromBufferAttribute(this,e),mf.applyNormalMatrix(t),this.setXYZ(e,mf.x,mf.y,mf.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)mf.fromBufferAttribute(this,e),mf.transformDirection(t),this.setXYZ(e,mf.x,mf.y,mf.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=wd(e,this.array)),e}setX(t,e){return this.normalized&&(e=Sd(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=wd(e,this.array)),e}setY(t,e){return this.normalized&&(e=Sd(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=wd(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Sd(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=wd(e,this.array)),e}setW(t,e){return this.normalized&&(e=Sd(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Sd(e,this.array),n=Sd(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Sd(e,this.array),n=Sd(n,this.array),i=Sd(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Sd(e,this.array),n=Sd(n,this.array),i=Sd(i,this.array),r=Sd(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ad&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}copyColorsArray(){}copyVector2sArray(){}copyVector3sArray(){}copyVector4sArray(){}}class yf extends vf{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class _f extends vf{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class bf extends vf{constructor(t,e,n){super(new Float32Array(t),e,n)}}let xf=0;const wf=new Ep,Sf=new Qp,Mf=new Jd,Cf=new ep,Af=new ep,Tf=new Jd;class Ef extends ud{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:xf++}),this.uuid=md(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ed(t)?_f:yf)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Ad).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return wf.makeRotationFromQuaternion(t),this.applyMatrix4(wf),this}rotateX(t){return wf.makeRotationX(t),this.applyMatrix4(wf),this}rotateY(t){return wf.makeRotationY(t),this.applyMatrix4(wf),this}rotateZ(t){return wf.makeRotationZ(t),this.applyMatrix4(wf),this}translate(t,e,n){return wf.makeTranslation(t,e,n),this.applyMatrix4(wf),this}scale(t,e,n){return wf.makeScale(t,e,n),this.applyMatrix4(wf),this}lookAt(t){return Sf.lookAt(t),Sf.updateMatrix(),this.applyMatrix4(Sf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mf).negate(),this.translate(Mf.x,Mf.y,Mf.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new bf(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ep);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingBox.set(new Jd(-1/0,-1/0,-1/0),new Jd(1/0,1/0,1/0));else{if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Cf.setFromBufferAttribute(n),this.morphTargetsRelative?(Tf.addVectors(this.boundingBox.min,Cf.min),this.boundingBox.expandByPoint(Tf),Tf.addVectors(this.boundingBox.max,Cf.max),this.boundingBox.expandByPoint(Tf)):(this.boundingBox.expandByPoint(Cf.min),this.boundingBox.expandByPoint(Cf.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new _p);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingSphere.set(new Jd,1/0);else if(t){const n=this.boundingSphere.center;if(Cf.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const n=e[t];Af.setFromBufferAttribute(n),this.morphTargetsRelative?(Tf.addVectors(Cf.min,Af.min),Cf.expandByPoint(Tf),Tf.addVectors(Cf.max,Af.max),Cf.expandByPoint(Tf)):(Cf.expandByPoint(Af.min),Cf.expandByPoint(Af.max))}Cf.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Tf.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Tf));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Tf.fromBufferAttribute(s,e),o&&(Mf.fromBufferAttribute(t,e),Tf.add(Mf)),i=Math.max(i,n.distanceToSquared(Tf))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return;const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new vf(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let C=0;C<o;C++)l[C]=new Jd,c[C]=new Jd;const u=new Jd,h=new Jd,d=new Jd,p=new Cd,f=new Cd,m=new Cd,g=new Jd,v=new Jd;function y(t,e,n){u.fromArray(i,3*t),h.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(v),c[e].add(v),c[n].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let C=0,A=_.length;C<A;++C){const t=_[C],e=t.start;for(let i=e,r=e+t.count;i<r;i+=3)y(n[i+0],n[i+1],n[i+2])}const b=new Jd,x=new Jd,w=new Jd,S=new Jd;function M(t){w.fromArray(r,3*t),S.copy(w);const e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),x.crossVectors(S,e);const n=x.dot(c[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=n}for(let C=0,A=_.length;C<A;++C){const t=_[C],e=t.start;for(let i=e,r=e+t.count;i<r;i+=3)M(n[i+0]),M(n[i+1]),M(n[i+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new vf(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Jd,r=new Jd,s=new Jd,o=new Jd,a=new Jd,l=new Jd,c=new Jd,u=new Jd;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Tf.fromBufferAttribute(t,e),Tf.normalize(),t.setXYZ(e,Tf.x,Tf.y,Tf.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let o=0,a=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*i;for(let t=0;t<i;t++)s[a++]=n[o++]}return new vf(s,i,r)}if(null===this.index)return this;const e=new Ef,n=this.index.array,i=this.attributes;for(const o in i){const r=t(i[o],n);e.setAttribute(o,r)}const r=this.morphAttributes;for(const o in r){const i=[],s=r[o];for(let e=0,r=s.length;e<r;e++){const r=t(s[e],n);i.push(r)}e.morphAttributes[o]=i}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,a=s.length;o<a;o++){const t=s[o];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const a in n){const e=n[a];t.data.attributes[a]=e.toJSON(t.data)}const i={};let r=!1;for(const a in this.morphAttributes){const e=this.morphAttributes[a],n=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];n.push(r.toJSON(t.data))}n.length>0&&(i[a]=n,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const l in i){const t=i[l];this.setAttribute(l,t.clone(e))}const r=t.morphAttributes;for(const l in r){const t=[],n=r[l];for(let i=0,r=n.length;i<r;i++)t.push(n[i].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let l=0,c=s.length;l<c;l++){const t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const If=new Ep,Rf=new Tp,Nf=new _p,Df=new Jd,Lf=new Jd,Of=new Jd,kf=new Jd,Pf=new Jd,Ff=new Jd,Bf=new Jd,zf=new Jd,Uf=new Jd,Vf=new Cd,Wf=new Cd,Gf=new Cd,Hf=new Jd,jf=new Jd;class qf extends Qp{constructor(t=new Ef,e=new ff){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Nf.copy(n.boundingSphere),Nf.applyMatrix4(r),!1===t.ray.intersectsSphere(Nf))return;if(If.copy(r).invert(),Rf.copy(t.ray).applyMatrix4(If),null!==n.boundingBox&&!1===Rf.intersectsBox(n.boundingBox))return;let s;const o=n.index,a=n.attributes.position,l=n.morphAttributes.position,c=n.morphTargetsRelative,u=n.attributes.uv,h=n.attributes.uv2,d=n.groups,p=n.drawRange;if(null!==o)if(Array.isArray(i))for(let f=0,m=d.length;f<m;f++){const n=d[f],r=i[n.materialIndex];for(let i=Math.max(n.start,p.start),d=Math.min(o.count,Math.min(n.start+n.count,p.start+p.count));i<d;i+=3){const d=o.getX(i),p=o.getX(i+1),f=o.getX(i+2);s=Xf(this,r,t,Rf,a,l,c,u,h,d,p,f),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=n.materialIndex,e.push(s))}}else{for(let n=Math.max(0,p.start),r=Math.min(o.count,p.start+p.count);n<r;n+=3){const r=o.getX(n),d=o.getX(n+1),p=o.getX(n+2);s=Xf(this,i,t,Rf,a,l,c,u,h,r,d,p),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}else if(void 0!==a)if(Array.isArray(i))for(let f=0,m=d.length;f<m;f++){const n=d[f],r=i[n.materialIndex];for(let i=Math.max(n.start,p.start),o=Math.min(a.count,Math.min(n.start+n.count,p.start+p.count));i<o;i+=3){s=Xf(this,r,t,Rf,a,l,c,u,h,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=n.materialIndex,e.push(s))}}else{for(let n=Math.max(0,p.start),r=Math.min(a.count,p.start+p.count);n<r;n+=3){s=Xf(this,i,t,Rf,a,l,c,u,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}}}function Xf(t,e,n,i,r,s,o,a,l,c,u,h){Df.fromBufferAttribute(r,c),Lf.fromBufferAttribute(r,u),Of.fromBufferAttribute(r,h);const d=t.morphTargetInfluences;if(s&&d){Bf.set(0,0,0),zf.set(0,0,0),Uf.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],n=s[t];0!==e&&(kf.fromBufferAttribute(n,c),Pf.fromBufferAttribute(n,u),Ff.fromBufferAttribute(n,h),o?(Bf.addScaledVector(kf,e),zf.addScaledVector(Pf,e),Uf.addScaledVector(Ff,e)):(Bf.addScaledVector(kf.sub(Df),e),zf.addScaledVector(Pf.sub(Lf),e),Uf.addScaledVector(Ff.sub(Of),e)))}Df.add(Bf),Lf.add(zf),Of.add(Uf)}t.isSkinnedMesh&&(t.boneTransform(c,Df),t.boneTransform(u,Lf),t.boneTransform(h,Of));const p=function(t,e,n,i,r,s,o,a){let l;if(l=e.side===Zc?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side!==Kc,a),null===l)return null;jf.copy(a),jf.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(jf);return c<n.near||c>n.far?null:{distance:c,point:jf.clone(),object:t}}(t,e,n,i,Df,Lf,Of,Hf);if(p){a&&(Vf.fromBufferAttribute(a,c),Wf.fromBufferAttribute(a,u),Gf.fromBufferAttribute(a,h),p.uv=hf.getUV(Hf,Df,Lf,Of,Vf,Wf,Gf,new Cd)),l&&(Vf.fromBufferAttribute(l,c),Wf.fromBufferAttribute(l,u),Gf.fromBufferAttribute(l,h),p.uv2=hf.getUV(Hf,Df,Lf,Of,Vf,Wf,Gf,new Cd));const t={a:c,b:u,c:h,normal:new Jd,materialIndex:0};hf.getNormal(Df,Lf,Of,t.normal),p.face=t}return p}class Yf extends Ef{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,n,i,r,s,p,f,m,g,v){const y=s/m,_=p/g,b=s/2,x=p/2,w=f/2,S=m+1,M=g+1;let C=0,A=0;const T=new Jd;for(let o=0;o<M;o++){const s=o*_-x;for(let a=0;a<S;a++){const h=a*y-b;T[t]=h*i,T[e]=s*r,T[n]=w,l.push(T.x,T.y,T.z),T[t]=0,T[e]=0,T[n]=f>0?1:-1,c.push(T.x,T.y,T.z),u.push(a/m),u.push(1-o/g),C+=1}}for(let o=0;o<g;o++)for(let t=0;t<m;t++){const e=h+t+S*o,n=h+t+S*(o+1),i=h+(t+1)+S*(o+1),r=h+(t+1)+S*o;a.push(e,n,r),a.push(n,i,r),A+=6}o.addGroup(d,A,v),d+=A,h+=C}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new bf(l,3)),this.setAttribute("normal",new bf(c,3)),this.setAttribute("uv",new bf(u,2))}static fromJSON(t){return new Yf(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Zf(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Kf(t){const e={};for(let n=0;n<t.length;n++){const i=Zf(t[n]);for(const t in i)e[t]=i[t]}return e}function $f(t){return null===t.getRenderTarget()&&t.outputEncoding===td?rd:sd}const Jf={clone:Zf,merge:Kf};class Qf extends pf{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Zf(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class tm extends Qp{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ep,this.projectionMatrix=new Ep,this.projectionMatrixInverse=new Ep}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class em extends tm{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*fd*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*pd*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*fd*Math.atan(Math.tan(.5*pd*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*pd*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/o,i*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const nm=-90;class im extends Qp{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new em(nm,1,t,e);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(1,0,0),this.add(i);const r=new em(nm,1,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const s=new em(nm,1,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);const o=new em(nm,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const a=new em(nm,1,t,e);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);const l=new em(nm,1,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,o,a,l]=this.children,c=t.getRenderTarget(),u=t.toneMapping,h=t.xr.enabled;t.toneMapping=Ru,t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=u,t.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class rm extends qd{constructor(t,e,n,i,r,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:Pu,n,i,r,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class sm extends Yd{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new rm(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:Xu}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Yf(5,5,5),r=new Qf({name:"CubemapFromEquirect",uniforms:Zf(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Zc,blending:$c});r.uniforms.tEquirect.value=e;const s=new qf(i,r),o=e.minFilter;e.minFilter===Zu&&(e.minFilter=Xu);return new im(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,n,i);t.setRenderTarget(r)}}const om=new Jd,am=new Jd,lm=new Ad;class cm{constructor(t=new Jd(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=om.subVectors(n,e).cross(am.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(om),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||lm.getNormalMatrix(t),i=this.coplanarPoint(om).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const um=new _p,hm=new Jd;class dm{constructor(t=new cm,e=new cm,n=new cm,i=new cm,r=new cm,s=new cm){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-i,u-a,f-h,y-m).normalize(),e[1].setComponents(o+i,u+a,f+h,y+m).normalize(),e[2].setComponents(o+r,u+l,f+d,y+g).normalize(),e[3].setComponents(o-r,u-l,f-d,y-g).normalize(),e[4].setComponents(o-s,u-c,f-p,y-v).normalize(),e[5].setComponents(o+s,u+c,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),um.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(um)}intersectsSprite(t){return um.center.set(0,0,0),um.radius=.7071067811865476,um.applyMatrix4(t.matrixWorld),this.intersectsSphere(um)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(hm.x=i.normal.x>0?t.max.x:t.min.x,hm.y=i.normal.y>0?t.max.y:t.min.y,hm.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(hm)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function pm(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function fm(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,i,r){const s=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(s.buffer,e,r),s.version=e.version)}}}class mm extends Ef{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,u=t/o,h=e/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const t=g*h-s;for(let e=0;e<l;e++){const n=e*u-r;p.push(n,-t,0),f.push(0,0,1),m.push(e/o),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let t=0;t<o;t++){const e=t+l*g,n=t+l*(g+1),i=t+1+l*(g+1),r=t+1+l*g;d.push(e,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new bf(p,3)),this.setAttribute("normal",new bf(f,3)),this.setAttribute("uv",new bf(m,2))}static fromJSON(t){return new mm(t.width,t.height,t.widthSegments,t.heightSegments)}}const gm={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},vm={common:{diffuse:{value:new Ud(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ad},uv2Transform:{value:new Ad},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Cd(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ud(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ud(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ad}},sprite:{diffuse:{value:new Ud(16777215)},opacity:{value:1},center:{value:new Cd(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ad}}},ym={basic:{uniforms:Kf([vm.common,vm.specularmap,vm.envmap,vm.aomap,vm.lightmap,vm.fog]),vertexShader:gm.meshbasic_vert,fragmentShader:gm.meshbasic_frag},lambert:{uniforms:Kf([vm.common,vm.specularmap,vm.envmap,vm.aomap,vm.lightmap,vm.emissivemap,vm.bumpmap,vm.normalmap,vm.displacementmap,vm.fog,vm.lights,{emissive:{value:new Ud(0)}}]),vertexShader:gm.meshlambert_vert,fragmentShader:gm.meshlambert_frag},phong:{uniforms:Kf([vm.common,vm.specularmap,vm.envmap,vm.aomap,vm.lightmap,vm.emissivemap,vm.bumpmap,vm.normalmap,vm.displacementmap,vm.fog,vm.lights,{emissive:{value:new Ud(0)},specular:{value:new Ud(1118481)},shininess:{value:30}}]),vertexShader:gm.meshphong_vert,fragmentShader:gm.meshphong_frag},standard:{uniforms:Kf([vm.common,vm.envmap,vm.aomap,vm.lightmap,vm.emissivemap,vm.bumpmap,vm.normalmap,vm.displacementmap,vm.roughnessmap,vm.metalnessmap,vm.fog,vm.lights,{emissive:{value:new Ud(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:gm.meshphysical_vert,fragmentShader:gm.meshphysical_frag},toon:{uniforms:Kf([vm.common,vm.aomap,vm.lightmap,vm.emissivemap,vm.bumpmap,vm.normalmap,vm.displacementmap,vm.gradientmap,vm.fog,vm.lights,{emissive:{value:new Ud(0)}}]),vertexShader:gm.meshtoon_vert,fragmentShader:gm.meshtoon_frag},matcap:{uniforms:Kf([vm.common,vm.bumpmap,vm.normalmap,vm.displacementmap,vm.fog,{matcap:{value:null}}]),vertexShader:gm.meshmatcap_vert,fragmentShader:gm.meshmatcap_frag},points:{uniforms:Kf([vm.points,vm.fog]),vertexShader:gm.points_vert,fragmentShader:gm.points_frag},dashed:{uniforms:Kf([vm.common,vm.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:gm.linedashed_vert,fragmentShader:gm.linedashed_frag},depth:{uniforms:Kf([vm.common,vm.displacementmap]),vertexShader:gm.depth_vert,fragmentShader:gm.depth_frag},normal:{uniforms:Kf([vm.common,vm.bumpmap,vm.normalmap,vm.displacementmap,{opacity:{value:1}}]),vertexShader:gm.meshnormal_vert,fragmentShader:gm.meshnormal_frag},sprite:{uniforms:Kf([vm.sprite,vm.fog]),vertexShader:gm.sprite_vert,fragmentShader:gm.sprite_frag},background:{uniforms:{uvTransform:{value:new Ad},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:gm.background_vert,fragmentShader:gm.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:gm.backgroundCube_vert,fragmentShader:gm.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:gm.cube_vert,fragmentShader:gm.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:gm.equirect_vert,fragmentShader:gm.equirect_frag},distanceRGBA:{uniforms:Kf([vm.common,vm.displacementmap,{referencePosition:{value:new Jd},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:gm.distanceRGBA_vert,fragmentShader:gm.distanceRGBA_frag},shadow:{uniforms:Kf([vm.lights,vm.fog,{color:{value:new Ud(0)},opacity:{value:1}}]),vertexShader:gm.shadow_vert,fragmentShader:gm.shadow_frag}};ym.physical={uniforms:Kf([ym.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Cd(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ud(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Cd},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ud(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ud(1,1,1)},specularColorMap:{value:null}}]),vertexShader:gm.meshphysical_vert,fragmentShader:gm.meshphysical_frag};const _m={r:0,b:0,g:0};function bm(t,e,n,i,r,s,o){const a=new Ud(0);let l,c,u=!0===s?0:1,h=null,d=0,p=null;function f(e,n){e.getRGB(_m,$f(t)),i.buffers.color.setClear(_m.r,_m.g,_m.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),u=e,f(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,f(a,u)},render:function(i,s){let o=!1,m=!0===s.isScene?s.background:null;if(m&&m.isTexture){m=(s.backgroundBlurriness>0?n:e).get(m)}const g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(a,u):m&&m.isColor&&(f(m,1),o=!0),(t.autoClear||o)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===Uu)?(void 0===c&&(c=new qf(new Yf(1,1,1),new Qf({name:"BackgroundCubeMaterial",uniforms:Zf(ym.backgroundCube.uniforms),vertexShader:ym.backgroundCube.vertexShader,fragmentShader:ym.backgroundCube.fragmentShader,side:Zc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=m,c.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=s.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,h===m&&d===m.version&&p===t.toneMapping||(c.material.needsUpdate=!0,h=m,d=m.version,p=t.toneMapping),c.layers.enableAll(),i.unshift(c,c.geometry,c.material,0,0,null)):m&&m.isTexture&&(void 0===l&&(l=new qf(new mm(2,2),new Qf({name:"BackgroundMaterial",uniforms:Zf(ym.background.uniforms),vertexShader:ym.background.vertexShader,fragmentShader:ym.background.fragmentShader,side:Yc,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=m,l.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,!0===m.matrixAutoUpdate&&m.updateMatrix(),l.material.uniforms.uvTransform.value.copy(m.matrix),h===m&&d===m.version&&p===t.toneMapping||(l.material.needsUpdate=!0,h=m,d=m.version,p=t.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null))}}}function xm(t,e,n,i){const r=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=p(null);let c=l,u=!1;function h(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],i=[];for(let s=0;s<r;s++)e[s]=0,n[s]=0,i[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function f(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function m(t){g(t,0)}function g(n,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function v(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function y(e,n,r,s,o,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,s,o,a):t.vertexAttribIPointer(e,n,r,o,a)}function _(){b(),u=!0,c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,_,b){let x=!1;if(o){const e=function(e,n,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];void 0===u&&(u=p(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u);return u}(_,d,l);c!==e&&(c=e,h(c.object)),x=function(t,e,n,i){const r=c.attributes,s=e.attributes;let o=0;const a=n.getAttributes();for(const l in a){if(a[l].location>=0){const e=r[l];let n=s[l];if(void 0===n&&("instanceMatrix"===l&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===l&&t.instanceColor&&(n=t.instanceColor)),void 0===e)return!0;if(e.attribute!==n)return!0;if(n&&e.data!==n.data)return!0;o++}}return c.attributesNum!==o||c.index!==i}(r,_,d,b),x&&function(t,e,n,i){const r={},s=e.attributes;let o=0;const a=n.getAttributes();for(const l in a){if(a[l].location>=0){let e=s[l];void 0===e&&("instanceMatrix"===l&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===l&&t.instanceColor&&(e=t.instanceColor));const n={};n.attribute=e,e&&e.data&&(n.data=e.data),r[l]=n,o++}}c.attributes=r,c.attributesNum=o,c.index=i}(r,_,d,b)}else{const t=!0===l.wireframe;c.geometry===_.id&&c.program===d.id&&c.wireframe===t||(c.geometry=_.id,c.program=d.id,c.wireframe=t,x=!0)}null!==b&&n.update(b,34963),(x||u)&&(u=!1,function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const e in c){const i=c[e];if(i.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,d=s.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)g(i.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<i.locationSize;t++)m(i.location+t);t.bindBuffer(34962,c);for(let t=0;t<i.locationSize;t++)y(i.location+t,o/i.locationSize,u,e,l*h,(d+o/i.locationSize*t)*h)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)g(i.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)m(i.location+t);t.bindBuffer(34962,c);for(let t=0;t<i.locationSize;t++)y(i.location+t,o/i.locationSize,u,e,o*h,o/i.locationSize*t*h)}}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i.location,n);break;case 3:t.vertexAttrib3fv(i.location,n);break;case 4:t.vertexAttrib4fv(i.location,n);break;default:t.vertexAttrib1fv(i.location,n)}}}}v()}(r,l,d,_),null!==b&&t.bindBuffer(34963,n.get(b).buffer))},reset:_,resetDefaultState:b,dispose:function(){_();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const n in e){const t=e[n];for(const e in t)d(t[e].object),delete t[e];delete e[n]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)d(i[t].object),delete i[t];delete n[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function wm(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return;l[c](s,i,o,a),n.update(o,s,a)}}function Sm(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=t.getParameter(34930),h=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=h>0,_=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?t.getParameter(36183):0}}function Mm(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new cm,a=new Ad,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(t,n,i,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,l=i;n!==s;++n,l+=4)o.copy(t[n]).applyMatrix4(r,a),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==i||r;return r=e,n=u(t,s,0),i=t.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){const h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===h||0===h.length||s&&!p)s?u(null):c();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=u(h,o,e,a);for(let i=0;i!==e;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Cm(t){let e=new WeakMap;function n(t,e){return e===Bu?t.mapping=Pu:e===zu&&(t.mapping=Fu),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===Bu||s===zu){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new sm(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class Am extends tm{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Tm=[.125,.215,.35,.446,.526,.582],Em=20,Im=new Am,Rm=new Ud;let Nm=null;const Dm=(1+Math.sqrt(5))/2,Lm=1/Dm,Om=[new Jd(1,1,1),new Jd(-1,1,1),new Jd(1,1,-1),new Jd(-1,1,-1),new Jd(0,Dm,Lm),new Jd(0,Dm,-Lm),new Jd(Lm,0,Dm),new Jd(-Lm,0,Dm),new Jd(Dm,Lm,0),new Jd(-Dm,Lm,0)];class km{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Nm=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=zm(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Bm(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Nm),t.scissorTest=!1,Fm(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Pu||t.mapping===Fu?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Nm=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:Xu,minFilter:Xu,generateMipmaps:!1,type:ih,format:ch,encoding:Qh,depthBuffer:!1},i=Pm(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Pm(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+Tm.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>t-4?a=Tm[o-t+4-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(i,f*p*t),y.set(h,m*p*t);const r=[t,t,t,t,t,t];_.set(r,g*p*t)}const b=new Ef;b.setAttribute("position",new vf(v,f)),b.setAttribute("uv",new vf(y,m)),b.setAttribute("faceIndex",new vf(_,g)),e.push(b),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(Em),r=new Jd(0,1,0),s=new Qf({name:"SphericalGaussianBlur",defines:{n:Em,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Um(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:$c,depthTest:!1,depthWrite:!1});return s}(i,t,e)}return i}_compileMaterial(t){const e=new qf(this._lodPlanes[0],t);this._renderer.compile(e,Im)}_sceneToCubeUV(t,e,n,i){const r=new em(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Rm),a.toneMapping=Ru,a.autoClear=!1;const u=new ff({name:"PMREM.Background",side:Zc,depthWrite:!1,depthTest:!1}),h=new qf(new Yf,u);let d=!1;const p=t.background;p?p.isColor&&(u.color.copy(p),t.background=null,d=!0):(u.color.copy(Rm),d=!0);for(let f=0;f<6;f++){const e=f%3;0===e?(r.up.set(0,s[f],0),r.lookAt(o[f],0,0)):1===e?(r.up.set(0,0,s[f]),r.lookAt(0,o[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,o[f]));const n=this._cubeSize;Fm(i,e*n,f>2?n:0,n,n),a.setRenderTarget(i),d&&a.render(h,r),a.render(t,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===Pu||t.mapping===Fu;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=zm()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Bm());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new qf(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;Fm(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,Im)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const e=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=Om[(i-1)%Om.length];this._blur(t,i-1,i,e,n)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial,c=new qf(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Em,m=[];let g=0;for(let _=0;_<Em;++_){const t=_/p,e=Math.exp(-t*t/2);m.push(e),0===_?g+=e:_<f&&(g+=2*e)}for(let _=0;_<m.length;_++)m[_]=m[_]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];Fm(e,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(c,Im)}}function Pm(t,e,n){const i=new Yd(t,e,n);return i.texture.mapping=Uu,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Fm(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Bm(){return new Qf({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Um(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:$c,depthTest:!1,depthWrite:!1})}function zm(){return new Qf({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Um(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:$c,depthTest:!1,depthWrite:!1})}function Um(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Vm(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=s===Bu||s===zu,a=s===Pu||s===Fu;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=e.get(r);return null===n&&(n=new km(t)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),e.set(r,i),i.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(s)){null===n&&(n=new km(t));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Wm(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return e}}}function Gm(t,e,n,i){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const n in a.attributes)e.remove(a.attributes[n]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(Ed(n)?_f:yf)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const r in n)e.update(n[r],34962);const i=t.morphAttributes;for(const r in i){const t=i[r];for(let n=0,i=t.length;n<i;n++)e.update(t[n],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Hm(t,e,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,o,e*a),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,h;if(r)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return;u[h](s,l,o,i*a,c),n.update(l,s,c)}}function jm(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t}}}}function qm(t,e){return t[0]-e[0]}function Xm(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ym(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new Xd,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function(l,c,u,h){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const i=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==i?i.length:0;let a=s.get(c);if(void 0===a||a.count!==r){let t=function(){v.dispose(),s.delete(c),c.removeEventListener("dispose",t)};void 0!==a&&a.texture.dispose();const n=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,u=c.morphAttributes.position||[],h=c.morphAttributes.normal||[],d=c.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===i&&(p=2),!0===l&&(p=3);let f=c.attributes.position.count*p,m=1;f>e.maxTextureSize&&(m=Math.ceil(f/e.maxTextureSize),f=e.maxTextureSize);const g=new Float32Array(f*m*4*r),v=new Zd(g,f,m,r);v.type=nh,v.needsUpdate=!0;const y=4*p;for(let e=0;e<r;e++){const t=u[e],r=h[e],s=d[e],a=f*m*4*e;for(let e=0;e<t.count;e++){const c=e*y;!0===n&&(o.fromBufferAttribute(t,e),g[a+c+0]=o.x,g[a+c+1]=o.y,g[a+c+2]=o.z,g[a+c+3]=0),!0===i&&(o.fromBufferAttribute(r,e),g[a+c+4]=o.x,g[a+c+5]=o.y,g[a+c+6]=o.z,g[a+c+7]=0),!0===l&&(o.fromBufferAttribute(s,e),g[a+c+8]=o.x,g[a+c+9]=o.y,g[a+c+10]=o.z,g[a+c+11]=4===s.itemSize?o.w:1)}}a={count:r,texture:v,size:new Cd(f,m)},s.set(c,a),c.addEventListener("dispose",t)}let l=0;for(let t=0;t<d.length;t++)l+=d[t];const u=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(t,"morphTargetBaseInfluence",u),h.getUniforms().setValue(t,"morphTargetInfluences",d),h.getUniforms().setValue(t,"morphTargetsTexture",a.texture,n),h.getUniforms().setValue(t,"morphTargetsTextureSize",a.size)}else{const e=void 0===d?0:d.length;let n=i[c.id];if(void 0===n||n.length!==e){n=[];for(let t=0;t<e;t++)n[t]=[t,0];i[c.id]=n}for(let t=0;t<e;t++){const e=n[t];e[0]=t,e[1]=d[t]}n.sort(Xm);for(let t=0;t<8;t++)t<e&&n[t][1]?(a[t][0]=n[t][0],a[t][1]=n[t][1]):(a[t][0]=Number.MAX_SAFE_INTEGER,a[t][1]=0);a.sort(qm);const s=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=a[t],n=e[0],i=e[1];n!==Number.MAX_SAFE_INTEGER&&i?(s&&c.getAttribute("morphTarget"+t)!==s[n]&&c.setAttribute("morphTarget"+t,s[n]),o&&c.getAttribute("morphNormal"+t)!==o[n]&&c.setAttribute("morphNormal"+t,o[n]),r[t]=i,l+=i):(s&&!0===c.hasAttribute("morphTarget"+t)&&c.deleteAttribute("morphTarget"+t),o&&!0===c.hasAttribute("morphNormal"+t)&&c.deleteAttribute("morphNormal"+t),r[t]=0)}const u=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(t,"morphTargetBaseInfluence",u),h.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function Zm(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=i.render.frame,a=t.geometry,l=e.get(t,a);return r.get(l)!==o&&(e.update(l),r.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const Km=new qd,$m=new Zd,Jm=new Kd,Qm=new rm,tg=[],eg=[],ng=new Float32Array(16),ig=new Float32Array(9),rg=new Float32Array(4);function sg(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=tg[r];if(void 0===s&&(s=new Float32Array(r),tg[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function og(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function ag(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function lg(t,e){let n=eg[e];void 0===n&&(n=new Int32Array(e),eg[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function cg(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function ug(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(og(n,e))return;t.uniform2fv(this.addr,e),ag(n,e)}}function hg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(og(n,e))return;t.uniform3fv(this.addr,e),ag(n,e)}}function dg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(og(n,e))return;t.uniform4fv(this.addr,e),ag(n,e)}}function pg(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(og(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),ag(n,e)}else{if(og(n,i))return;rg.set(i),t.uniformMatrix2fv(this.addr,!1,rg),ag(n,i)}}function fg(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(og(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),ag(n,e)}else{if(og(n,i))return;ig.set(i),t.uniformMatrix3fv(this.addr,!1,ig),ag(n,i)}}function mg(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(og(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),ag(n,e)}else{if(og(n,i))return;ng.set(i),t.uniformMatrix4fv(this.addr,!1,ng),ag(n,i)}}function gg(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function vg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(og(n,e))return;t.uniform2iv(this.addr,e),ag(n,e)}}function yg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(og(n,e))return;t.uniform3iv(this.addr,e),ag(n,e)}}function _g(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(og(n,e))return;t.uniform4iv(this.addr,e),ag(n,e)}}function bg(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function xg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(og(n,e))return;t.uniform2uiv(this.addr,e),ag(n,e)}}function wg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(og(n,e))return;t.uniform3uiv(this.addr,e),ag(n,e)}}function Sg(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(og(n,e))return;t.uniform4uiv(this.addr,e),ag(n,e)}}function Mg(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(e||Km,r)}function Cg(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Jm,r)}function Ag(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Qm,r)}function Tg(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||$m,r)}function Eg(t,e){t.uniform1fv(this.addr,e)}function Ig(t,e){const n=sg(e,this.size,2);t.uniform2fv(this.addr,n)}function Rg(t,e){const n=sg(e,this.size,3);t.uniform3fv(this.addr,n)}function Ng(t,e){const n=sg(e,this.size,4);t.uniform4fv(this.addr,n)}function Dg(t,e){const n=sg(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Lg(t,e){const n=sg(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Og(t,e){const n=sg(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function kg(t,e){t.uniform1iv(this.addr,e)}function Pg(t,e){t.uniform2iv(this.addr,e)}function Fg(t,e){t.uniform3iv(this.addr,e)}function Bg(t,e){t.uniform4iv(this.addr,e)}function zg(t,e){t.uniform1uiv(this.addr,e)}function Ug(t,e){t.uniform2uiv(this.addr,e)}function Vg(t,e){t.uniform3uiv(this.addr,e)}function Wg(t,e){t.uniform4uiv(this.addr,e)}function Gg(t,e,n){const i=this.cache,r=e.length,s=lg(n,r);og(i,s)||(t.uniform1iv(this.addr,s),ag(i,s));for(let o=0;o!==r;++o)n.setTexture2D(e[o]||Km,s[o])}function Hg(t,e,n){const i=this.cache,r=e.length,s=lg(n,r);og(i,s)||(t.uniform1iv(this.addr,s),ag(i,s));for(let o=0;o!==r;++o)n.setTexture3D(e[o]||Jm,s[o])}function jg(t,e,n){const i=this.cache,r=e.length,s=lg(n,r);og(i,s)||(t.uniform1iv(this.addr,s),ag(i,s));for(let o=0;o!==r;++o)n.setTextureCube(e[o]||Qm,s[o])}function qg(t,e,n){const i=this.cache,r=e.length,s=lg(n,r);og(i,s)||(t.uniform1iv(this.addr,s),ag(i,s));for(let o=0;o!==r;++o)n.setTexture2DArray(e[o]||$m,s[o])}class Xg{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return cg;case 35664:return ug;case 35665:return hg;case 35666:return dg;case 35674:return pg;case 35675:return fg;case 35676:return mg;case 5124:case 35670:return gg;case 35667:case 35671:return vg;case 35668:case 35672:return yg;case 35669:case 35673:return _g;case 5125:return bg;case 36294:return xg;case 36295:return wg;case 36296:return Sg;case 35678:case 36198:case 36298:case 36306:case 35682:return Mg;case 35679:case 36299:case 36307:return Cg;case 35680:case 36300:case 36308:case 36293:return Ag;case 36289:case 36303:case 36311:case 36292:return Tg}}(e.type)}}class Yg{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Eg;case 35664:return Ig;case 35665:return Rg;case 35666:return Ng;case 35674:return Dg;case 35675:return Lg;case 35676:return Og;case 5124:case 35670:return kg;case 35667:case 35671:return Pg;case 35668:case 35672:return Fg;case 35669:case 35673:return Bg;case 5125:return zg;case 36294:return Ug;case 36295:return Vg;case 36296:return Wg;case 35678:case 36198:case 36298:case 36306:case 35682:return Gg;case 35679:case 36299:case 36307:return Hg;case 35680:case 36300:case 36308:case 36293:return jg;case 36289:case 36303:case 36311:case 36292:return qg}}(e.type)}}class Zg{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const Kg=/(\w+)(\])?(\[|\.)?/g;function $g(t,e){t.seq.push(e),t.map[e.id]=e}function Jg(t,e,n){const i=t.name,r=i.length;for(Kg.lastIndex=0;;){const s=Kg.exec(i),o=Kg.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){$g(n,void 0===c?new Xg(a,t,e):new Yg(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Zg(a),$g(n,t)),n=t}}}class Qg{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);Jg(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function tv(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let ev=0;function nv(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=r;o<s;o++){const t=o+1;i.push(`${t===e?">":" "} ${t}: ${n[o]}`)}return i.join("\n")}(t.getShaderSource(e),i)}return r}function iv(t,e){const n=function(t){switch(t){case Qh:return["Linear","( value )"];case td:return["sRGB","( value )"];default:return["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function rv(t,e){let n;switch(e){case Nu:n="Linear";break;case Du:n="Reinhard";break;case Lu:n="OptimizedCineon";break;case Ou:n="ACESFilmic";break;case ku:n="Custom";break;default:n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function sv(t){return""!==t}function ov(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function av(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const lv=/^[ \t]*#include +<([\w\d./]+)>/gm;function cv(t){return t.replace(lv,uv)}function uv(t,e){const n=gm[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return cv(n)}const hv=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function dv(t){return t.replace(hv,pv)}function pv(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function fv(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function mv(t,e,n,i){const r=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===jc?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===qc?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Xc&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Pu:case Fu:e="ENVMAP_TYPE_CUBE";break;case Uu:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===Fu&&(e="ENVMAP_MODE_REFRACTION");return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Tu:e="ENVMAP_BLENDING_MULTIPLY";break;case Eu:e="ENVMAP_BLENDING_MIX";break;case Iu:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(sv).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(sv).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(sv).join("\n"),v.length>0&&(v+="\n")):(g=[fv(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(sv).join("\n"),v=[p,fv(n),"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ru?"#define TONE_MAPPING":"",n.toneMapping!==Ru?gm.tonemapping_pars_fragment:"",n.toneMapping!==Ru?rv("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",gm.encodings_pars_fragment,iv("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(sv).join("\n")),o=cv(o),o=ov(o,n),o=av(o,n),a=cv(a),a=ov(a,n),a=av(a,n),o=dv(o),a=dv(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===ld?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===ld?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const _=y+v+a,b=tv(r,35633,y+g+o),x=tv(r,35632,_);if(r.attachShader(m,b),r.attachShader(m,x),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),e=r.getShaderInfoLog(b).trim(),n=r.getShaderInfoLog(x).trim();let i=!0,s=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;nv(r,b,"vertex"),nv(r,x,"fragment")}else""!==t||""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:n,prefix:v}})}let w,S;return r.deleteShader(b),r.deleteShader(x),this.getUniforms=function(){return void 0===w&&(w=new Qg(r,m)),w},this.getAttributes=function(){return void 0===S&&(S=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(r,m)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=ev++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=x,this}let gv=0;class vv{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new yv(t),e.set(t,n)),n}}class yv{constructor(t){this.id=gv++,this.code=t,this.usedTimes=0}}function _v(t,e,n,i,r,s,o){const a=new zp,l=new vv,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,c,m,g){const v=m.fog,y=g.geometry,_=s.isMeshStandardMaterial?m.environment:null,b=(s.isMeshStandardMaterial?n:e).get(s.envMap||_),x=b&&b.mapping===Uu?b.image.height:null,w=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),s.precision);const S=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,M=void 0!==S?S.length:0;let C,A,T,E,I=0;if(void 0!==y.morphAttributes.position&&(I=1),void 0!==y.morphAttributes.normal&&(I=2),void 0!==y.morphAttributes.color&&(I=3),w){const t=ym[w];C=t.vertexShader,A=t.fragmentShader}else C=s.vertexShader,A=s.fragmentShader,l.update(s),T=l.getVertexShaderID(s),E=l.getFragmentShaderID(s);const R=t.getRenderTarget(),N=s.alphaTest>0,D=s.clearcoat>0,L=s.iridescence>0;return{isWebGL2:u,shaderID:w,shaderName:s.type,vertexShader:C,fragmentShader:A,defines:s.defines,customVertexShaderID:T,customFragmentShaderID:E,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:d,outputEncoding:null===R?t.outputEncoding:!0===R.isXRRenderTarget?R.texture.encoding:Qh,map:!!s.map,matcap:!!s.matcap,envMap:!!b,envMapMode:b&&b.mapping,envMapCubeUVHeight:x,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===id,tangentSpaceNormalMap:s.normalMapType===nd,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===td,clearcoat:D,clearcoatMap:D&&!!s.clearcoatMap,clearcoatRoughnessMap:D&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:D&&!!s.clearcoatNormalMap,iridescence:L,iridescenceMap:L&&!!s.iridescenceMap,iridescenceThicknessMap:L&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&s.blending===Jc,alphaMap:!!s.alphaMap,alphaTest:N,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:M,morphTextureStride:I,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:Ru,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===Kc,flipSided:s.side===Zc,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0);e.supportsVertexTextures&&a.enable(1);e.instancing&&a.enable(2);e.instancingColor&&a.enable(3);e.map&&a.enable(4);e.matcap&&a.enable(5);e.envMap&&a.enable(6);e.lightMap&&a.enable(7);e.aoMap&&a.enable(8);e.emissiveMap&&a.enable(9);e.bumpMap&&a.enable(10);e.normalMap&&a.enable(11);e.objectSpaceNormalMap&&a.enable(12);e.tangentSpaceNormalMap&&a.enable(13);e.clearcoat&&a.enable(14);e.clearcoatMap&&a.enable(15);e.clearcoatRoughnessMap&&a.enable(16);e.clearcoatNormalMap&&a.enable(17);e.iridescence&&a.enable(18);e.iridescenceMap&&a.enable(19);e.iridescenceThicknessMap&&a.enable(20);e.displacementMap&&a.enable(21);e.specularMap&&a.enable(22);e.roughnessMap&&a.enable(23);e.metalnessMap&&a.enable(24);e.gradientMap&&a.enable(25);e.alphaMap&&a.enable(26);e.alphaTest&&a.enable(27);e.vertexColors&&a.enable(28);e.vertexAlphas&&a.enable(29);e.vertexUvs&&a.enable(30);e.vertexTangents&&a.enable(31);e.uvsVertexOnly&&a.enable(32);t.push(a.mask),a.disableAll(),e.fog&&a.enable(0);e.useFog&&a.enable(1);e.flatShading&&a.enable(2);e.logarithmicDepthBuffer&&a.enable(3);e.skinning&&a.enable(4);e.morphTargets&&a.enable(5);e.morphNormals&&a.enable(6);e.morphColors&&a.enable(7);e.premultipliedAlpha&&a.enable(8);e.shadowMapEnabled&&a.enable(9);e.physicallyCorrectLights&&a.enable(10);e.doubleSided&&a.enable(11);e.flipSided&&a.enable(12);e.useDepthPacking&&a.enable(13);e.dithering&&a.enable(14);e.specularIntensityMap&&a.enable(15);e.specularColorMap&&a.enable(16);e.transmission&&a.enable(17);e.transmissionMap&&a.enable(18);e.thicknessMap&&a.enable(19);e.sheen&&a.enable(20);e.sheenColorMap&&a.enable(21);e.sheenRoughnessMap&&a.enable(22);e.decodeVideoTexture&&a.enable(23);e.opaque&&a.enable(24);t.push(a.mask)}(n,e),n.push(t.outputEncoding)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=ym[e];n=Jf.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,r=c.length;t<r;t++){const e=c[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new mv(t,n,e,s),c.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function bv(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function xv(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function wv(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Sv(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,o,a,l,c){const u=s(t,e,o,a,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(t,e,o,a,l,c){const u=s(t,e,o,a,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||xv),i.length>1&&i.sort(e||wv),r.length>1&&r.sort(e||wv)}}}function Mv(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new Sv,t.set(e,[r])):n>=i.length?(r=new Sv,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function Cv(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Jd,color:new Ud};break;case"SpotLight":n={position:new Jd,direction:new Jd,color:new Ud,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Jd,color:new Ud,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Jd,skyColor:new Ud,groundColor:new Ud};break;case"RectAreaLight":n={color:new Ud,position:new Jd,halfWidth:new Jd,halfHeight:new Jd}}return t[e.id]=n,n}}}let Av=0;function Tv(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Ev(t,e){const n=new Cv,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cd};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cd,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)r.probe.push(new Jd);const s=new Jd,o=new Ep,a=new Ep;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,_=0;s.sort(Tv);const b=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,x=e.intensity,w=e.distance,S=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*x*b,l+=o.g*x*b,c+=o.b*x*b;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],x);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=S,r.directionalShadowMatrix[u]=e.shadow.matrix,m++}r.directional[u]=t,u++}else if(e.isSpotLight){const t=n.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(x*b),t.distance=w,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,r.spot[d]=t;const s=e.shadow;if(e.map&&(r.spotLightMap[y]=e.map,y++,s.updateMatrices(e),e.castShadow&&_++),r.spotLightMatrix[d]=s.matrix,e.castShadow){const t=i.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,r.spotShadow[d]=t,r.spotShadowMap[d]=S,v++}d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(x),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=S,r.pointShadowMatrix[h]=e.shadow.matrix,g++}r.point[h]=t,h++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(x*b),t.groundColor.copy(e.groundColor).multiplyScalar(x*b),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=vm.LTC_FLOAT_1,r.rectAreaLTC2=vm.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")&&(r.rectAreaLTC1=vm.LTC_HALF_1,r.rectAreaLTC2=vm.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const x=r.hash;x.directionalLength===u&&x.pointLength===h&&x.spotLength===d&&x.rectAreaLength===p&&x.hemiLength===f&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===v&&x.numSpotMaps===y||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-_,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=_,x.directionalLength=u,x.pointLength=h,x.spotLength=d,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,x.numSpotMaps=y,r.version=Av++)},setupView:function(t,e){let n=0,i=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){const e=t[d];if(e.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),n++}else if(e.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),l++}else if(e.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),a.identity(),o.copy(e.matrixWorld),o.premultiply(h),a.extractRotation(o),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(e.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),i++}else if(e.isHemisphereLight){const t=r.hemi[u];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(h),u++}}},state:r}}function Iv(t,e){const n=new Ev(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function Rv(t,e){let n=new WeakMap;return{get:function(i,r=0){const s=n.get(i);let o;return void 0===s?(o=new Iv(t,e),n.set(i,[o])):r>=s.length?(o=new Iv(t,e),s.push(o)):o=s[r],o},dispose:function(){n=new WeakMap}}}class Nv extends pf{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Dv extends pf{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Jd,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const Lv="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Ov="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function kv(t,e,n){let i=new dm;const r=new Cd,s=new Cd,o=new Xd,a=new Nv({depthPacking:ed}),l=new Dv,c={},u=n.maxTextureSize,h={0:Zc,1:Yc,2:Kc},d=new Qf({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Cd},radius:{value:4}},vertexShader:Lv,fragmentShader:Ov}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Ef;f.setAttribute("position",new vf(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new qf(f,d),g=this;function v(n,i){const s=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Yd(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,s,p,m,null)}function y(e,n,i,r,s,o){let u=null;const d=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(u=void 0!==d?d:!0===i.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=u.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=u.clone(),i[e]=r),u=r}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=o===Xc?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.map=n.map,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=r,u.farDistance=s),u}function _(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===Xc)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=r[c.materialIndex];if(u&&u.visible){const e=y(n,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,c)}}}else if(r.visible){const e=y(n,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)_(l[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=jc,this.render=function(e,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending($c),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=e.length;p<f;p++){const l=e[p],c=l.shadow;if(void 0===c)continue;if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),s.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/h.x),r.x=s.x*h.x,c.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/h.y),r.y=s.y*h.y,c.mapSize.y=s.y)),null===c.map){const t=this.type!==Xc?{minFilter:Hu,magFilter:Hu}:{};c.map=new Yd(r.x,r.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const f=c.getViewportCount();for(let t=0;t<f;t++){const e=c.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),c.updateMatrices(l,t),i=c.getFrustum(),_(n,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===Xc&&v(c,a),c.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}function Pv(t,e,n){const i=n.isWebGL2;const r=new function(){let e=!1;const n=new Xd;let i=null;const r=new Xd(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,o,a){!0===a&&(e*=o,i*=o,s*=o),n.set(e,i,s,o),!1===r.equals(n)&&(t.clearColor(e,i,s,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?U(2929):V(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){switch(e){case _u:t.depthFunc(512);break;case bu:t.depthFunc(519);break;case xu:t.depthFunc(513);break;case wu:t.depthFunc(515);break;case Su:t.depthFunc(514);break;case Mu:t.depthFunc(518);break;case Cu:t.depthFunc(516);break;case Au:t.depthFunc(517);break;default:t.depthFunc(515)}i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},o=new function(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?U(2960):V(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&s===o||(t.stencilFunc(e,n,o),i=e,r=n,s=o)},setOp:function(e,n,i){o===e&&a===n&&l===i||(t.stencilOp(e,n,i),o=e,a=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null}}},a=new WeakMap,l=new WeakMap;let c={},u={},h=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,_=null,b=null,x=null,w=!1,S=null,M=null,C=null,A=null,T=null;const E=t.getParameter(35661);let I=!1,R=0;const N=t.getParameter(7938);-1!==N.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(N)[1]),I=R>=1):-1!==N.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),I=R>=2);let D=null,L={};const O=t.getParameter(3088),k=t.getParameter(2978),P=(new Xd).fromArray(O),F=(new Xd).fromArray(k);function B(e,n,i){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let o=0;o<i;o++)t.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return s}const z={};function U(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function V(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}z[3553]=B(3553,3553,1),z[34067]=B(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),U(2929),s.setFunc(wu),j(!1),q(Gc),U(2884),H($c);const W={[iu]:32774,[ru]:32778,[su]:32779};if(i)W[ou]=32775,W[au]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(W[ou]=t.MIN_EXT,W[au]=t.MAX_EXT)}const G={[lu]:0,[cu]:1,[uu]:768,[du]:770,[yu]:776,[gu]:774,[fu]:772,[hu]:769,[pu]:771,[vu]:775,[mu]:773};function H(e,n,i,r,s,o,a,l){if(e!==$c){if(!1===f&&(U(3042),f=!0),e===nu)s=s||n,o=o||i,a=a||r,n===g&&s===_||(t.blendEquationSeparate(W[n],W[s]),g=n,_=s),i===v&&r===y&&o===b&&a===x||(t.blendFuncSeparate(G[i],G[r],G[o],G[a]),v=i,y=r,b=o,x=a),m=e,w=!1;else if(e!==m||l!==w){if(g===iu&&_===iu||(t.blendEquation(32774),g=iu,_=iu),l)switch(e){case Jc:t.blendFuncSeparate(1,771,1,771);break;case Qc:t.blendFunc(1,1);break;case tu:t.blendFuncSeparate(0,769,0,1);break;case eu:t.blendFuncSeparate(0,768,0,770)}else switch(e){case Jc:t.blendFuncSeparate(770,771,1,771);break;case Qc:t.blendFunc(770,1);break;case tu:t.blendFuncSeparate(0,769,0,1);break;case eu:t.blendFunc(0,768)}v=null,y=null,b=null,x=null,m=e,w=l}}else!0===f&&(V(3042),f=!1)}function j(e){S!==e&&(e?t.frontFace(2304):t.frontFace(2305),S=e)}function q(e){e!==Wc?(U(2884),e!==M&&(e===Gc?t.cullFace(1029):e===Hc?t.cullFace(1028):t.cullFace(1032))):V(2884),M=e}function X(e,n,i){e?(U(32823),A===n&&T===i||(t.polygonOffset(n,i),A=n,T=i)):V(32823)}return{buffers:{color:r,depth:s,stencil:o},enable:U,disable:V,bindFramebuffer:function(e,n){return u[e]!==n&&(t.bindFramebuffer(e,n),u[e]=n,i&&(36009===e&&(u[36160]=n),36160===e&&(u[36009]=n)),!0)},drawBuffers:function(i,r){let s=d,o=!1;if(i)if(s=h.get(r),void 0===s&&(s=[],h.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,n=t.length;e<n;e++)s[e]=36064+e;s.length=t.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:H,setMaterial:function(t,e){t.side===Kc?V(2884):U(2884);let n=t.side===Zc;e&&(n=!n),j(n),t.blending===Jc&&!1===t.transparent?H($c):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const i=t.stencilWrite;o.setTest(i),i&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?U(32926):V(32926)},setFlipSided:j,setCullFace:q,setLineWidth:function(e){e!==C&&(I&&t.lineWidth(e),C=e)},setPolygonOffset:X,setScissorTest:function(t){t?U(3089):V(3089)},activeTexture:function(e){void 0===e&&(e=33984+E-1),D!==e&&(t.activeTexture(e),D=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===D?33984+E-1:D);let r=L[i];void 0===r&&(r={type:void 0,texture:void 0},L[i]=r),r.type===e&&r.texture===n||(D!==i&&(t.activeTexture(i),D=i),t.bindTexture(e,n||z[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=L[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(e){}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){}},updateUBOMapping:function(e,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=l.get(n).get(e);a.get(e)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),a.set(e,i))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(e){}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(e){}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(e){}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(e){}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(e){}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(e){}},scissor:function(e){!1===P.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),P.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===i&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},D=null,L={},u={},h=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,_=null,b=null,x=null,w=!1,S=null,M=null,C=null,A=null,T=null,P.set(0,0,t.canvas.width,t.canvas.height),F.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),o.reset()}}}function Fv(t,e,n,i,r,s,o){const a=r.isWebGL2,l=(r.maxTextures,r.maxCubemapSize),c=r.maxTextureSize,u=r.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,d="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let f;const m=new WeakMap;let g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(V){}function v(t,e){return g?new OffscreenCanvas(t,e):Id("canvas")}function y(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?xd:Math.floor,s=i(r*t.width),o=i(r*t.height);void 0===f&&(f=v(s,o));const a=n?v(s,o):f;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),a}return t}return t}function _(t){return _d(t.width)&&_d(t.height)}function b(t,e){return t.generateMipmaps&&e&&t.minFilter!==Hu&&t.minFilter!==Xu}function x(e){t.generateMipmap(e)}function w(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n&&void 0!==t[n])return t[n];let l=i;return 6403===i&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===i&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===i&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===td&&!1===o?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function S(t,e,n){return!0===b(t,n)||t.isFramebufferTexture&&t.minFilter!==Hu&&t.minFilter!==Xu?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(t){return t===Hu||t===ju||t===qu?9728:9729}function C(t){const e=t.target;e.removeEventListener("dispose",C),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=m.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&T(t),0===Object.keys(r).length&&m.delete(n)}i.remove(t)}(e),e.isVideoTexture&&p.delete(e)}function A(e){const n=e.target;n.removeEventListener("dispose",A),function(e){const n=e.texture,r=i.get(e),s=i.get(n);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)t.deleteFramebuffer(r.__webglFramebuffer[i]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[i]);else{if(t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let a=0,l=n.length;a<l;a++){const e=i.get(n[a]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),o.memory.textures--),i.remove(n[a])}i.remove(n),i.remove(e)}(n)}function T(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete m.get(r)[n.__cacheKey],o.memory.textures--}let E=0;function I(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const n=t.image;if(null===n);else if(!1!==n.complete)return void O(r,t,e)}n.bindTexture(3553,r.__webglTexture,33984+e)}const R={[Vu]:10497,[Wu]:33071,[Gu]:33648},N={[Hu]:9728,[ju]:9984,[qu]:9986,[Xu]:9729,[Yu]:9985,[Zu]:9987};function D(n,s,o){if(o?(t.texParameteri(n,10242,R[s.wrapS]),t.texParameteri(n,10243,R[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,R[s.wrapR]),t.texParameteri(n,10240,N[s.magFilter]),t.texParameteri(n,10241,N[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS!==Wu||s.wrapT,t.texParameteri(n,10240,M(s.magFilter)),t.texParameteri(n,10241,M(s.minFilter)),s.minFilter!==Hu&&s.minFilter),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===nh&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===ih&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function L(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",C));const r=n.source;let s=m.get(r);void 0===s&&(s={},m.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&T(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return i}function O(e,r,o){let l=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=35866),r.isData3DTexture&&(l=32879);const u=L(e,r),h=r.source;n.bindTexture(l,e.__webglTexture,33984+o);const d=i.get(h);if(h.version!==d.__version||!0===u){n.activeTexture(33984+o),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const e=function(t){return!a&&(t.wrapS!==Wu||t.wrapT!==Wu||t.minFilter!==Hu&&t.minFilter!==Xu)}(r)&&!1===_(r.image);let i=y(r.image,e,!1,c);i=U(r,i);const p=_(i)||a,f=s.convert(r.format,r.encoding);let m,g=s.convert(r.type),v=w(r.internalFormat,f,g,r.encoding,r.isVideoTexture);D(l,r,p);const M=r.mipmaps,C=a&&!0!==r.isVideoTexture,A=void 0===d.__version||!0===u,T=S(r,i,p);if(r.isDepthTexture)v=6402,a?v=r.type===nh?36012:r.type===eh?33190:r.type===oh?35056:33189:r.type,r.format===dh&&6402===v&&r.type!==Qu&&r.type!==eh&&(r.type=eh,g=s.convert(r.type)),r.format===ph&&6402===v&&(v=34041,r.type!==oh&&(r.type=oh,g=s.convert(r.type))),A&&(C?n.texStorage2D(3553,1,v,i.width,i.height):n.texImage2D(3553,0,v,i.width,i.height,0,f,g,null));else if(r.isDataTexture)if(M.length>0&&p){C&&A&&n.texStorage2D(3553,T,v,M[0].width,M[0].height);for(let t=0,e=M.length;t<e;t++)m=M[t],C?n.texSubImage2D(3553,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(3553,t,v,m.width,m.height,0,f,g,m.data);r.generateMipmaps=!1}else C?(A&&n.texStorage2D(3553,T,v,i.width,i.height),n.texSubImage2D(3553,0,0,0,i.width,i.height,f,g,i.data)):n.texImage2D(3553,0,v,i.width,i.height,0,f,g,i.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){C&&A&&n.texStorage3D(35866,T,v,M[0].width,M[0].height,i.depth);for(let t=0,e=M.length;t<e;t++)m=M[t],r.format!==ch?null!==f&&(C?n.compressedTexSubImage3D(35866,t,0,0,0,m.width,m.height,i.depth,f,m.data,0,0):n.compressedTexImage3D(35866,t,v,m.width,m.height,i.depth,0,m.data,0,0)):C?n.texSubImage3D(35866,t,0,0,0,m.width,m.height,i.depth,f,g,m.data):n.texImage3D(35866,t,v,m.width,m.height,i.depth,0,f,g,m.data)}else{C&&A&&n.texStorage2D(3553,T,v,M[0].width,M[0].height);for(let t=0,e=M.length;t<e;t++)m=M[t],r.format!==ch?null!==f&&(C?n.compressedTexSubImage2D(3553,t,0,0,m.width,m.height,f,m.data):n.compressedTexImage2D(3553,t,v,m.width,m.height,0,m.data)):C?n.texSubImage2D(3553,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(3553,t,v,m.width,m.height,0,f,g,m.data)}else if(r.isDataArrayTexture)C?(A&&n.texStorage3D(35866,T,v,i.width,i.height,i.depth),n.texSubImage3D(35866,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(35866,0,v,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isData3DTexture)C?(A&&n.texStorage3D(32879,T,v,i.width,i.height,i.depth),n.texSubImage3D(32879,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(32879,0,v,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isFramebufferTexture){if(A)if(C)n.texStorage2D(3553,T,v,i.width,i.height);else{let t=i.width,e=i.height;for(let i=0;i<T;i++)n.texImage2D(3553,i,v,t,e,0,f,g,null),t>>=1,e>>=1}}else if(M.length>0&&p){C&&A&&n.texStorage2D(3553,T,v,M[0].width,M[0].height);for(let t=0,e=M.length;t<e;t++)m=M[t],C?n.texSubImage2D(3553,t,0,0,f,g,m):n.texImage2D(3553,t,v,f,g,m);r.generateMipmaps=!1}else C?(A&&n.texStorage2D(3553,T,v,i.width,i.height),n.texSubImage2D(3553,0,0,0,f,g,i)):n.texImage2D(3553,0,v,f,g,i);b(r,p)&&x(l),d.__version=h.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}function k(e,r,o,a,l){const c=s.convert(o.format,o.encoding),u=s.convert(o.type),d=w(o.internalFormat,c,u,o.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,d,r.width,r.height,r.depth,0,c,u,null):n.texImage2D(l,0,d,r.width,r.height,0,c,u,null)),n.bindFramebuffer(36160,e),z(r)?h.framebufferTexture2DMultisampleEXT(36160,a,l,i.get(o).__webglTexture,0,B(r)):(3553===l||l>=34069&&l<=34074)&&t.framebufferTexture2D(36160,a,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function P(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||z(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===nh?r=36012:e.type===eh&&(r=33190));const i=B(n);z(n)?h.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=B(n);i&&!1===z(n)?t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):z(n)?h.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<e.length;r++){const o=e[r],a=s.convert(o.format,o.encoding),l=s.convert(o.type),c=w(o.internalFormat,a,l,o.encoding),u=B(n);i&&!1===z(n)?t.renderbufferStorageMultisample(36161,u,c,n.width,n.height):z(n)?h.renderbufferStorageMultisampleEXT(36161,u,c,n.width,n.height):t.renderbufferStorage(36161,c,n.width,n.height)}}t.bindRenderbuffer(36161,null)}function F(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),I(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=B(r);if(r.depthTexture.format===dh)z(r)?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==ph)throw new Error("Unknown depthTexture format");z(r)?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),P(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),P(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function B(t){return Math.min(u,t.samples)}function z(t){const n=i.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function U(t,n){const i=t.encoding,r=t.format;t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===cd||i!==Qh&&i===td&&!1===a&&(!0===e.has("EXT_sRGB")&&r===ch?(t.format=cd,t.minFilter=Xu,t.generateMipmaps=!1):n=Wd.sRGBToLinear(n)),n}this.allocateTextureUnit=function(){const t=E;return E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=I,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):n.bindTexture(35866,r.__webglTexture,33984+e)},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):n.bindTexture(32879,r.__webglTexture,33984+e)},this.setTextureCube=function(e,r){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,r,o){if(6!==r.image.length)return;const c=L(e,r),u=r.source;n.bindTexture(34067,e.__webglTexture,33984+o);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(33984+o),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const e=r.isCompressedTexture||r.image[0].isCompressedTexture,i=r.image[0]&&r.image[0].isDataTexture,d=[];for(let t=0;t<6;t++)d[t]=e||i?i?r.image[t].image:r.image[t]:y(r.image[t],!1,!0,l),d[t]=U(r,d[t]);const p=d[0],f=_(p)||a,m=s.convert(r.format,r.encoding),g=s.convert(r.type),v=w(r.internalFormat,m,g,r.encoding),M=a&&!0!==r.isVideoTexture,C=void 0===h.__version||!0===c;let A,T=S(r,p,f);if(D(34067,r,f),e){M&&C&&n.texStorage2D(34067,T,v,p.width,p.height);for(let t=0;t<6;t++){A=d[t].mipmaps;for(let e=0;e<A.length;e++){const i=A[e];r.format!==ch?null!==m&&(M?n.compressedTexSubImage2D(34069+t,e,0,0,i.width,i.height,m,i.data):n.compressedTexImage2D(34069+t,e,v,i.width,i.height,0,i.data)):M?n.texSubImage2D(34069+t,e,0,0,i.width,i.height,m,g,i.data):n.texImage2D(34069+t,e,v,i.width,i.height,0,m,g,i.data)}}}else{A=r.mipmaps,M&&C&&(A.length>0&&T++,n.texStorage2D(34067,T,v,d[0].width,d[0].height));for(let t=0;t<6;t++)if(i){M?n.texSubImage2D(34069+t,0,0,0,d[t].width,d[t].height,m,g,d[t].data):n.texImage2D(34069+t,0,v,d[t].width,d[t].height,0,m,g,d[t].data);for(let e=0;e<A.length;e++){const i=A[e].image[t].image;M?n.texSubImage2D(34069+t,e+1,0,0,i.width,i.height,m,g,i.data):n.texImage2D(34069+t,e+1,v,i.width,i.height,0,m,g,i.data)}}else{M?n.texSubImage2D(34069+t,0,0,0,m,g,d[t]):n.texImage2D(34069+t,0,v,m,g,d[t]);for(let e=0;e<A.length;e++){const i=A[e];M?n.texSubImage2D(34069+t,e+1,0,0,m,g,i.image[t]):n.texImage2D(34069+t,e+1,v,m,g,i.image[t])}}}b(r,f)&&x(34067),h.__version=u.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}(o,e,r):n.bindTexture(34067,o.__webglTexture,33984+r)},this.rebindTextures=function(t,e,n){const r=i.get(t);void 0!==e&&k(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&F(t)},this.setupRenderTarget=function(e){const l=e.texture,c=i.get(e),u=i.get(l);e.addEventListener("dispose",A),!0!==e.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=t.createTexture()),u.__version=l.version,o.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=_(e)||a;if(h){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(c.__webglFramebuffer=t.createFramebuffer(),d&&r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}if(a&&e.samples>0&&!1===z(e)){const i=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer[n]);const o=s.convert(r.format,r.encoding),a=s.convert(r.type),l=w(r.internalFormat,o,a,r.encoding,!0===e.isXRRenderTarget),u=B(e);t.renderbufferStorageMultisample(36161,u,l,e.width,e.height),t.framebufferRenderbuffer(36160,36064+n,36161,c.__webglColorRenderbuffer[n])}t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),P(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,u.__webglTexture),D(34067,l,p);for(let t=0;t<6;t++)k(c.__webglFramebuffer[t],e,l,36064,34069+t);b(l,p)&&x(34067),n.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=i.get(s);n.bindTexture(3553,o.__webglTexture),D(3553,s,p),k(c.__webglFramebuffer,e,s,36064+r,3553),b(s,p)&&x(3553)}n.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&a&&(t=e.isWebGL3DRenderTarget?32879:35866),n.bindTexture(t,u.__webglTexture),D(t,l,p),k(c.__webglFramebuffer,e,l,36064,t),b(l,p)&&x(t),n.unbindTexture()}e.depthBuffer&&F(e)},this.updateRenderTargetMipmap=function(t){const e=_(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(b(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(e,r),x(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===z(e)){const r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,o=e.height;let a=16384;const l=[],c=e.stencilBuffer?33306:36096,u=i.get(e),h=!0===e.isWebGLMultipleRenderTargets;if(h)for(let e=0;e<r.length;e++)n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,null),n.bindFramebuffer(36160,u.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,null,0);n.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(36064+n),e.depthBuffer&&l.push(c);const p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024)),h&&t.framebufferRenderbuffer(36008,36064,36161,u.__webglColorRenderbuffer[n]),!0===p&&(t.invalidateFramebuffer(36008,[c]),t.invalidateFramebuffer(36009,[c])),h){const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,9728),d&&t.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),h)for(let e=0;e<r.length;e++){n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,u.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(36160,u.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,s,0)}n.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=k,this.useMultisampledRTT=z}function Bv(t,e,n){const i=n.isWebGL2;return{convert:function(n,r=null){let s;if(n===Ku)return 5121;if(n===rh)return 32819;if(n===sh)return 32820;if(n===$u)return 5120;if(n===Ju)return 5122;if(n===Qu)return 5123;if(n===th)return 5124;if(n===eh)return 5125;if(n===nh)return 5126;if(n===ih)return i?5131:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(n===ah)return 6406;if(n===ch)return 6408;if(n===uh)return 6409;if(n===hh)return 6410;if(n===dh)return 6402;if(n===ph)return 34041;if(n===lh)return 6408;if(n===cd)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(n===fh)return 6403;if(n===mh)return 36244;if(n===gh)return 33319;if(n===vh)return 33320;if(n===yh)return 36249;if(n===_h||n===bh||n===xh||n===wh)if(r===td){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===_h)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===bh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===xh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===wh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===_h)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===bh)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===xh)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===wh)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Sh||n===Mh||n===Ch||n===Ah){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===Sh)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Mh)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ch)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Ah)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Th)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Eh||n===Ih){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===Eh)return r===td?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===Ih)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===Rh||n===Nh||n===Dh||n===Lh||n===Oh||n===kh||n===Ph||n===Fh||n===Bh||n===zh||n===Uh||n===Vh||n===Wh||n===Gh){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===Rh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Nh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Dh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Lh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Oh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===kh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Ph)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Fh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Bh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===zh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Uh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Vh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Wh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Gh)return r===td?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Hh){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(n===Hh)return r===td?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===oh?i?34042:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[n]?t[n]:null}}}class zv extends em{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Uv extends Qp{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Vv={type:"move"};class Wv{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Uv,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Uv,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Jd,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Jd),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Uv,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Jd,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Jd),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const s of t.hand.values()){const t=e.getJointPose(s,n),i=this._getHandJoint(l,s);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=t.radius),i.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Vv)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new Uv;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class Gv extends qd{constructor(t,e,n,i,r,s,o,a,l,c){if((c=void 0!==c?c:dh)!==dh&&c!==ph)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===dh&&(n=eh),void 0===n&&c===ph&&(n=oh),super(null,i,r,s,o,a,c,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:Hu,this.minFilter=void 0!==a?a:Hu,this.flipY=!1,this.generateMipmaps=!1}}class Hv extends ud{constructor(t,e){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=null,l=null,c=null,u=null,h=null,d=null;const p=e.getContextAttributes();let f=null,m=null;const g=[],v=[],y=new Set,_=new Map,b=new em;b.layers.enable(1),b.viewport=new Xd;const x=new em;x.layers.enable(2),x.viewport=new Xd;const w=[b,x],S=new zv;S.layers.enable(1),S.layers.enable(2);let M=null,C=null;function A(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const n=g[e];void 0!==n&&n.dispatchEvent({type:t.type,data:t.inputSource})}function T(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",T),i.removeEventListener("inputsourceschange",E);for(let t=0;t<g.length;t++){const e=v[t];null!==e&&(v[t]=null,g[t].disconnect(e))}M=null,C=null,t.setRenderTarget(f),h=null,u=null,c=null,i=null,m=null,L.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function E(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=v.indexOf(n);i>=0&&(v[i]=null,g[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=v.indexOf(n);if(-1===i){for(let t=0;t<g.length;t++){if(t>=v.length){v.push(n),i=t;break}if(null===v[t]){v[t]=n,i=t;break}}if(-1===i)break}const r=g[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=g[t];return void 0===e&&(e=new Wv,g[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=g[t];return void 0===e&&(e=new Wv,g[t]=e),e.getGripSpace()},this.getHand=function(t){let e=g[t];return void 0===e&&(e=new Wv,g[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,n.isPresenting},this.setReferenceSpaceType=function(t){o=t,n.isPresenting},this.getReferenceSpace=function(){return a||s},this.setReferenceSpace=function(t){a=t},this.getBaseLayer=function(){return null!==u?u:h},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return i},this.setSession=async function(l){if(i=l,null!==i){if(f=t.getRenderTarget(),i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",T),i.addEventListener("inputsourceschange",E),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:h}),m=new Yd(h.framebufferWidth,h.framebufferHeight,{format:ch,type:Ku,encoding:t.outputEncoding,stencilBuffer:p.stencil})}else{let n=null,s=null,o=null;p.depth&&(o=p.stencil?35056:33190,n=p.stencil?ph:dh,s=p.stencil?oh:eh);const a={colorFormat:32856,depthFormat:o,scaleFactor:r};c=new XRWebGLBinding(i,e),u=c.createProjectionLayer(a),i.updateRenderState({layers:[u]}),m=new Yd(u.textureWidth,u.textureHeight,{format:ch,type:Ku,depthTexture:new Gv(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});t.properties.get(m).__ignoreDepthValues=u.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),a=null,s=await i.requestReferenceSpace(o),L.setContext(i),L.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const I=new Jd,R=new Jd;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;S.near=x.near=b.near=t.near,S.far=x.far=b.far=t.far,M===S.near&&C===S.far||(i.updateRenderState({depthNear:S.near,depthFar:S.far}),M=S.near,C=S.far);const e=t.parent,n=S.cameras;N(S,e);for(let i=0;i<n.length;i++)N(n[i],e);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),t.matrix.copy(S.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);const r=t.children;for(let i=0,s=r.length;i<s;i++)r[i].updateMatrixWorld(!0);2===n.length?function(t,e,n){I.setFromMatrixPosition(e.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const i=I.distanceTo(R),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,_=p+(i-m),b=l*a/v*g,x=c*a/v*g;t.projectionMatrix.makePerspective(y,_,b,x,g,v)}(S,b,x):S.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(t){null!==u&&(u.fixedFoveation=t),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=t)},this.getPlanes=function(){return y};let D=null;const L=new pm;L.setAnimationLoop((function(e,i){if(l=i.getViewerPose(a||s),d=i,null!==l){const e=l.views;null!==h&&(t.setRenderTargetFramebuffer(m,h.framebuffer),t.setRenderTarget(m));let n=!1;e.length!==S.cameras.length&&(S.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==h)s=h.getViewport(r);else{const e=c.getViewSubImage(u,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(m,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}let o=w[i];void 0===o&&(o=new em,o.layers.enable(i),o.viewport=new Xd,w[i]=o),o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&S.matrix.copy(o.matrix),!0===n&&S.cameras.push(o)}}for(let t=0;t<g.length;t++){const e=v[t],n=g[t];null!==e&&void 0!==n&&n.update(e,i,a||s)}if(D&&D(e,i),i.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:i.detectedPlanes});let t=null;for(const e of y)i.detectedPlanes.has(e)||(null===t&&(t=[]),t.push(e));if(null!==t)for(const e of t)y.delete(e),_.delete(e),n.dispatchEvent({type:"planeremoved",data:e});for(const e of i.detectedPlanes)if(y.has(e)){const t=_.get(e);e.lastChangedTime>t&&(_.set(e,e.lastChangedTime),n.dispatchEvent({type:"planechanged",data:e}))}else y.add(e),_.set(e,i.lastChangedTime),n.dispatchEvent({type:"planeadded",data:e})}d=null})),this.setAnimationLoop=function(t){D=t},this.dispose=function(){}}}function jv(t,e){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===Zc&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===Zc&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const r=e.get(i).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*e}let s,o;i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.iridescenceMap?s=i.iridescenceMap:i.iridescenceThicknessMap?s=i.iridescenceThicknessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularColorMap?s=i.specularColorMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap?s=i.thicknessMap:i.sheenColorMap?s=i.sheenColorMap:i.sheenRoughnessMap&&(s=i.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uvTransform.value.copy(s.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,$f(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,i,r,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(t,i):i.isMeshToonMaterial?(n(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,i)):i.isMeshPhongMaterial?(n(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,i)):i.isMeshStandardMaterial?(n(t,i),function(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap);const i=e.get(n).envMap;i&&(t.envMapIntensity.value=n.envMapIntensity)}(t,i),i.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===Zc&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,i,o)):i.isMeshMatcapMaterial?(n(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,i)):i.isMeshDepthMaterial?n(t,i):i.isMeshDistanceMaterial?(n(t,i),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?n(t,i):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,s):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function qv(t,e,n,i){let r={},s={},o=[];const a=n.isWebGL2?t.getParameter(35375):0;function l(t,e,n){const i=t.value;if(void 0===n[e])return n[e]="number"==typeof i?i:i.clone(),!0;if("number"==typeof i){if(n[e]!==i)return n[e]=i,!0}else{const t=n[e];if(!1===t.equals(i))return t.copy(i),!0}return!1}function c(t){const e=t.value,n={boundary:0,storage:0};return"number"==typeof e?(n.boundary=4,n.storage=4):e.isVector2?(n.boundary=8,n.storage=8):e.isVector3||e.isColor?(n.boundary=16,n.storage=12):e.isVector4?(n.boundary=16,n.storage=16):e.isMatrix3?(n.boundary=48,n.storage=48):e.isMatrix4?(n.boundary=64,n.storage=64):e.isTexture,n}function u(e){const n=e.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;let r=0;for(let s=0,o=e.length;s<o;s++){const t=e[s],o=c(t);if(t.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,s>0){r=n%i;0!==r&&i-r-o.boundary<0&&(n+=i-r,t.__offset=n)}n+=o.storage}r=n%i,r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return 0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(35345,i),t.bufferData(35345,r,s),t.bindBuffer(35345,null),t.bindBufferBase(35345,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(!function(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(35345,n);for(let r=0,o=i.length;r<o;r++){const e=i[r];if(!0===l(e,r,s)){const n=e.value,i=e.__offset;"number"==typeof n?(e.__data[0]=n,t.bufferSubData(35345,i,e.__data)):(e.value.isMatrix3?(e.__data[0]=e.value.elements[0],e.__data[1]=e.value.elements[1],e.__data[2]=e.value.elements[2],e.__data[3]=e.value.elements[0],e.__data[4]=e.value.elements[3],e.__data[5]=e.value.elements[4],e.__data[6]=e.value.elements[5],e.__data[7]=e.value.elements[0],e.__data[8]=e.value.elements[6],e.__data[9]=e.value.elements[7],e.__data[10]=e.value.elements[8],e.__data[11]=e.value.elements[0]):n.toArray(e.__data),t.bufferSubData(35345,i,e.__data))}}t.bindBuffer(35345,null)}(n),s[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);o=[],r={},s={}}}}function Xv(t={}){this.isWebGLRenderer=!0;const e=void 0!==t.canvas?t.canvas:function(){const t=Id("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,i=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,a=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u;u=null!==n?n.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let h=null,d=null;const p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Qh,this.physicallyCorrectLights=!1,this.toneMapping=Ru,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,_=null,b=-1,x=null;const w=new Xd,S=new Xd;let M=null,C=e.width,A=e.height,T=1,E=null,I=null;const R=new Xd(0,0,C,A),N=new Xd(0,0,C,A);let D=!1;const L=new dm;let O=!1,k=!1,P=null;const F=new Ep,B=new Cd,z=new Jd,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===_?T:1}let W,G,H,j,q,X,Y,Z,K,$,J,Q,tt,et,nt,it,rt,st,ot,at,lt,ct,ut,ht,dt=n;function pt(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const t={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Oc}`),e.addEventListener("webglcontextlost",gt,!1),e.addEventListener("webglcontextrestored",vt,!1),e.addEventListener("webglcontextcreationerror",yt,!1),null===dt){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),dt=pt(e,t),null===dt)throw pt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===dt.getShaderPrecisionFormat&&(dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Rt){throw Rt}function ft(){W=new Wm(dt),G=new Sm(dt,W,t),W.init(G),ct=new Bv(dt,W,G),H=new Pv(dt,W,G),j=new jm,q=new bv,X=new Fv(dt,W,H,q,G,ct,j),Y=new Cm(m),Z=new Vm(m),K=new fm(dt,G),ut=new xm(dt,W,K,G),$=new Gm(dt,K,j,ut),J=new Zm(dt,$,K,j),ot=new Ym(dt,G,X),it=new Mm(q),Q=new _v(m,Y,Z,W,G,ut,it),tt=new jv(m,q),et=new Mv,nt=new Rv(W,G),st=new bm(m,Y,Z,H,J,u,o),rt=new kv(m,J,G),ht=new qv(dt,j,G,H),at=new wm(dt,W,j,G),lt=new Hm(dt,W,j,G),j.programs=Q.programs,m.capabilities=G,m.extensions=W,m.properties=q,m.renderLists=et,m.shadowMap=rt,m.state=H,m.info=j}ft();const mt=new Hv(m,dt);function gt(t){t.preventDefault(),g=!0}function vt(){g=!1;const t=j.autoReset,e=rt.enabled,n=rt.autoUpdate,i=rt.needsUpdate,r=rt.type;ft(),j.autoReset=t,rt.enabled=e,rt.autoUpdate=n,rt.needsUpdate=i,rt.type=r}function yt(t){}function _t(t){const e=t.target;e.removeEventListener("dispose",_t),function(t){(function(t){const e=q.get(t).programs;void 0!==e&&(e.forEach((function(t){Q.releaseProgram(t)})),t.isShaderMaterial&&Q.releaseShaderCache(t))})(t),q.remove(t)}(e)}this.xr=mt,this.getContext=function(){return dt},this.getContextAttributes=function(){return dt.getContextAttributes()},this.forceContextLoss=function(){const t=W.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=W.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(t){void 0!==t&&(T=t,this.setSize(C,A,!1))},this.getSize=function(t){return t.set(C,A)},this.setSize=function(t,n,i){mt.isPresenting||(C=t,A=n,e.width=Math.floor(t*T),e.height=Math.floor(n*T),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(C*T,A*T).floor()},this.setDrawingBufferSize=function(t,n,i){C=t,A=n,T=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(w)},this.getViewport=function(t){return t.copy(R)},this.setViewport=function(t,e,n,i){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,n,i),H.viewport(w.copy(R).multiplyScalar(T).floor())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,n,i){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,i),H.scissor(S.copy(N).multiplyScalar(T).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(t){H.setScissorTest(D=t)},this.setOpaqueSort=function(t){E=t},this.setTransparentSort=function(t){I=t},this.getClearColor=function(t){return t.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;t&&(i|=16384),e&&(i|=256),n&&(i|=1024),dt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",gt,!1),e.removeEventListener("webglcontextrestored",vt,!1),e.removeEventListener("webglcontextcreationerror",yt,!1),et.dispose(),nt.dispose(),q.dispose(),Y.dispose(),Z.dispose(),J.dispose(),ut.dispose(),ht.dispose(),Q.dispose(),mt.dispose(),mt.removeEventListener("sessionstart",xt),mt.removeEventListener("sessionend",wt),P&&(P.dispose(),P=null),St.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=U);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,n,i,r){!0!==e.isScene&&(e=U);X.resetTextureUnits();const s=e.fog,o=i.isMeshStandardMaterial?e.environment:null,a=null===_?m.outputEncoding:!0===_.isXRRenderTarget?_.texture.encoding:Qh,l=(i.isMeshStandardMaterial?Z:Y).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=!!n.morphAttributes.color,g=i.toneMapped?m.toneMapping:Ru,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==v?v.length:0,w=q.get(i),S=d.state.lights;if(!0===O&&(!0===k||t!==x)){const e=t===x&&i.id===b;it.setState(i,t,e)}let M=!1;i.version===w.__version?w.needsLights&&w.lightsStateVersion!==S.state.version||w.outputEncoding!==a||r.isInstancedMesh&&!1===w.instancing?M=!0:r.isInstancedMesh||!0!==w.instancing?r.isSkinnedMesh&&!1===w.skinning?M=!0:r.isSkinnedMesh||!0!==w.skinning?w.envMap!==l||!0===i.fog&&w.fog!==s?M=!0:void 0===w.numClippingPlanes||w.numClippingPlanes===it.numPlanes&&w.numIntersection===it.numIntersection?(w.vertexAlphas!==c||w.vertexTangents!==u||w.morphTargets!==h||w.morphNormals!==p||w.morphColors!==f||w.toneMapping!==g||!0===G.isWebGL2&&w.morphTargetsCount!==y)&&(M=!0):M=!0:M=!0:M=!0:(M=!0,w.__version=i.version);let C=w.currentProgram;!0===M&&(C=Et(i,e,r));let E=!1,I=!1,R=!1;const N=C.getUniforms(),D=w.uniforms;H.useProgram(C.program)&&(E=!0,I=!0,R=!0);i.id!==b&&(b=i.id,I=!0);if(E||x!==t){if(N.setValue(dt,"projectionMatrix",t.projectionMatrix),G.logarithmicDepthBuffer&&N.setValue(dt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),x!==t&&(x=t,I=!0,R=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=N.map.cameraPosition;void 0!==e&&e.setValue(dt,z.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&N.setValue(dt,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&N.setValue(dt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){N.setOptional(dt,r,"bindMatrix"),N.setOptional(dt,r,"bindMatrixInverse");const t=r.skeleton;t&&G.floatVertexTextures&&(null===t.boneTexture&&t.computeBoneTexture(),N.setValue(dt,"boneTexture",t.boneTexture,X),N.setValue(dt,"boneTextureSize",t.boneTextureSize))}const L=n.morphAttributes;(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===G.isWebGL2)&&ot.update(r,n,i,C);(I||w.receiveShadow!==r.receiveShadow)&&(w.receiveShadow=r.receiveShadow,N.setValue(dt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(D.envMap.value=l,D.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);I&&(N.setValue(dt,"toneMappingExposure",m.toneMappingExposure),w.needsLights&&(B=R,(F=D).ambientLightColor.needsUpdate=B,F.lightProbe.needsUpdate=B,F.directionalLights.needsUpdate=B,F.directionalLightShadows.needsUpdate=B,F.pointLights.needsUpdate=B,F.pointLightShadows.needsUpdate=B,F.spotLights.needsUpdate=B,F.spotLightShadows.needsUpdate=B,F.rectAreaLights.needsUpdate=B,F.hemisphereLights.needsUpdate=B),s&&!0===i.fog&&tt.refreshFogUniforms(D,s),tt.refreshMaterialUniforms(D,i,T,A,P),Qg.upload(dt,w.uniformsList,D,X));var F,B;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Qg.upload(dt,w.uniformsList,D,X),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&N.setValue(dt,"center",r.center);if(N.setValue(dt,"modelViewMatrix",r.modelViewMatrix),N.setValue(dt,"normalMatrix",r.normalMatrix),N.setValue(dt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++)if(G.isWebGL2){const n=t[e];ht.update(n,C),ht.bind(n,C)}}return C}(t,e,n,i,r);H.setMaterial(i,o);let l=n.index,c=1;!0===i.wireframe&&(l=$.getWireframeAttribute(n),c=2);const u=n.drawRange,h=n.attributes.position;let p=u.start*c,f=(u.start+u.count)*c;null!==s&&(p=Math.max(p,s.start*c),f=Math.min(f,(s.start+s.count)*c)),null!==l?(p=Math.max(p,0),f=Math.min(f,l.count)):null!=h&&(p=Math.max(p,0),f=Math.min(f,h.count));const g=f-p;if(g<0||g===1/0)return;let v;ut.setup(r,i,a,n,l);let y=at;if(null!==l&&(v=K.get(l),y=lt,y.setIndex(v)),r.isMesh)!0===i.wireframe?(H.setLineWidth(i.wireframeLinewidth*V()),y.setMode(1)):y.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),H.setLineWidth(t*V()),r.isLineSegments?y.setMode(1):r.isLineLoop?y.setMode(2):y.setMode(3)}else r.isPoints?y.setMode(0):r.isSprite&&y.setMode(4);if(r.isInstancedMesh)y.renderInstances(p,g,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);y.renderInstances(p,g,e)}else y.render(p,g)},this.compile=function(t,e){function n(t,e,n){!0===t.transparent&&t.side===Kc?(t.side=Zc,t.needsUpdate=!0,Et(t,e,n),t.side=Yc,t.needsUpdate=!0,Et(t,e,n),t.side=Kc):Et(t,e,n)}d=nt.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){n(i[r],t,e)}else n(i,t,e)})),f.pop(),d=null};let bt=null;function xt(){St.stop()}function wt(){St.start()}const St=new pm;function Mt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||L.intersectsSprite(t)){i&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=J.update(t),r=t.material;r.visible&&h.push(t,e,r,n,z.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==j.render.frame&&(t.skeleton.update(),t.skeleton.frame=j.render.frame),!t.frustumCulled||L.intersectsObject(t))){i&&z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=J.update(t),r=t.material;if(Array.isArray(r)){const i=e.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&h.push(t,e,a,n,z.z,o)}}else r.visible&&h.push(t,e,r,n,z.z,null)}const r=t.children;for(let s=0,o=r.length;s<o;s++)Mt(r[s],e,n,i)}function Ct(t,e,n,i){const r=t.opaque,o=t.transmissive,a=t.transparent;d.setupLightsView(n),o.length>0&&function(t,e,n){const i=G.isWebGL2;null===P&&(P=new Yd(1,1,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?ih:Ku,minFilter:Zu,samples:i&&!0===s?4:0}));m.getDrawingBufferSize(B),i?P.setSize(B.x,B.y):P.setSize(xd(B.x),xd(B.y));const r=m.getRenderTarget();m.setRenderTarget(P),m.clear();const o=m.toneMapping;m.toneMapping=Ru,At(t,e,n),m.toneMapping=o,X.updateMultisampleRenderTarget(P),X.updateRenderTargetMipmap(P),m.setRenderTarget(r)}(r,e,n),i&&H.viewport(w.copy(i)),r.length>0&&At(r,e,n),o.length>0&&At(o,e,n),a.length>0&&At(a,e,n),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function At(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;o.layers.test(n.layers)&&Tt(o,e,n,a,l,c)}}function Tt(t,e,n,i,r,s){t.onBeforeRender(m,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,n,i,t,s),!0===r.transparent&&r.side===Kc?(r.side=Zc,r.needsUpdate=!0,m.renderBufferDirect(n,e,i,r,t,s),r.side=Yc,r.needsUpdate=!0,m.renderBufferDirect(n,e,i,r,t,s),r.side=Kc):m.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(m,e,n,i,r,s)}function Et(t,e,n){!0!==e.isScene&&(e=U);const i=q.get(t),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=Q.getParameters(t,r.state,s,e,n),l=Q.getProgramCacheKey(a);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?Z:Y).get(t.envMap||i.environment),void 0===c&&(t.addEventListener("dispose",_t),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return It(t,a),u}else a.uniforms=Q.getUniforms(t),t.onBuild(n,a,m),t.onBeforeCompile(a,m),u=Q.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const h=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=it.uniform),It(t,a),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=u.getUniforms(),f=Qg.seqWithValue(p.seq,h);return i.currentProgram=u,i.uniformsList=f,u}function It(t,e){const n=q.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}St.setAnimationLoop((function(t){bt&&bt(t)})),"undefined"!=typeof self&&St.setContext(self),this.setAnimationLoop=function(t){bt=t,mt.setAnimationLoop(t),null===t?St.stop():St.start()},mt.addEventListener("sessionstart",xt),mt.addEventListener("sessionend",wt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return;if(!0===g)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===mt.enabled&&!0===mt.isPresenting&&(!0===mt.cameraAutoUpdate&&mt.updateCamera(e),e=mt.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,_),d=nt.get(t,f.length),d.init(),f.push(d),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),L.setFromProjectionMatrix(F),k=this.localClippingEnabled,O=it.init(this.clippingPlanes,k,e),h=et.get(t,p.length),h.init(),p.push(h),Mt(t,e,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(E,I),!0===O&&it.beginShadows();const n=d.state.shadowsArray;if(rt.render(n,t,e),!0===O&&it.endShadows(),!0===this.info.autoReset&&this.info.reset(),st.render(h,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Ct(h,t,i,i.viewport)}}else Ct(h,t,e);null!==_&&(X.updateMultisampleRenderTarget(_),X.updateRenderTargetMipmap(_)),!0===t.isScene&&t.onAfterRender(m,t,e),ut.resetDefaultState(),b=-1,x=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(t,e,n){q.get(t.texture).__webglTexture=e,q.get(t.depthTexture).__webglTexture=n;const i=q.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=q.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){_=t,v=e,y=n;let i=!0,r=null,s=!1,o=!1;if(t){const n=q.get(t);void 0!==n.__useDefaultFramebuffer?(H.bindFramebuffer(36160,null),i=!1):void 0===n.__webglFramebuffer?X.setupRenderTarget(t):n.__hasExternalTextures&&X.rebindTextures(t,q.get(t.texture).__webglTexture,q.get(t.depthTexture).__webglTexture);const a=t.texture;(a.isData3DTexture||a.isDataArrayTexture||a.isCompressedArrayTexture)&&(o=!0);const l=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=l[e],s=!0):r=G.isWebGL2&&t.samples>0&&!1===X.useMultisampledRTT(t)?q.get(t).__webglMultisampledFramebuffer:l,w.copy(t.viewport),S.copy(t.scissor),M=t.scissorTest}else w.copy(R).multiplyScalar(T).floor(),S.copy(N).multiplyScalar(T).floor(),M=D;if(H.bindFramebuffer(36160,r)&&G.drawBuffers&&i&&H.drawBuffers(t,r),H.viewport(w),H.scissor(S),H.setScissorTest(M),s){const i=q.get(t.texture);dt.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(o){const i=q.get(t.texture),r=e||0;dt.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}b=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,o){if(!t||!t.isWebGLRenderTarget)return;let a=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){H.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==ch&&ct.convert(a)!==dt.getParameter(35739))return;const c=l===ih&&(W.has("EXT_color_buffer_half_float")||G.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===Ku||ct.convert(l)===dt.getParameter(35738)||l===nh&&(G.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return;e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&dt.readPixels(e,n,i,r,ct.convert(a),ct.convert(l),s)}finally{const t=null!==_?q.get(_).__webglFramebuffer:null;H.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);X.setTexture2D(e,0),dt.copyTexSubImage2D(3553,n,0,0,t.x,t.y,r,s),H.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,o=ct.convert(n.format),a=ct.convert(n.type);X.setTexture2D(n,0),dt.pixelStorei(37440,n.flipY),dt.pixelStorei(37441,n.premultiplyAlpha),dt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?dt.texSubImage2D(3553,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?dt.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):dt.texSubImage2D(3553,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&dt.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(m.isWebGL1Renderer)return;const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=ct.convert(i.format),c=ct.convert(i.type);let u;if(i.isData3DTexture)X.setTexture3D(i,0),u=32879;else{if(!i.isDataArrayTexture)return;X.setTexture2DArray(i,0),u=35866}dt.pixelStorei(37440,i.flipY),dt.pixelStorei(37441,i.premultiplyAlpha),dt.pixelStorei(3317,i.unpackAlignment);const h=dt.getParameter(3314),d=dt.getParameter(32878),p=dt.getParameter(3316),f=dt.getParameter(3315),g=dt.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;dt.pixelStorei(3314,v.width),dt.pixelStorei(32878,v.height),dt.pixelStorei(3316,t.min.x),dt.pixelStorei(3315,t.min.y),dt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isData3DTexture?dt.texSubImage3D(u,r,e.x,e.y,e.z,s,o,a,l,c,v.data):n.isCompressedArrayTexture?dt.compressedTexSubImage3D(u,r,e.x,e.y,e.z,s,o,a,l,v.data):dt.texSubImage3D(u,r,e.x,e.y,e.z,s,o,a,l,c,v),dt.pixelStorei(3314,h),dt.pixelStorei(32878,d),dt.pixelStorei(3316,p),dt.pixelStorei(3315,f),dt.pixelStorei(32877,g),0===r&&i.generateMipmaps&&dt.generateMipmap(u),H.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?X.setTextureCube(t,0):t.isData3DTexture?X.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?X.setTexture2DArray(t,0):X.setTexture2D(t,0),H.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,H.reset(),ut.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Yv extends Xv{}Yv.prototype.isWebGL1Renderer=!0;class Zv{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ud(t),this.near=e,this.far=n}clone(){return new Zv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Kv extends Qp{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return this.matrixWorldAutoUpdate}set autoUpdate(t){this.matrixWorldAutoUpdate=t}}class $v{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ad,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=md()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=md()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=md()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Jv=new Jd;class Qv{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Jv.fromBufferAttribute(this,e),Jv.applyMatrix4(t),this.setXYZ(e,Jv.x,Jv.y,Jv.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Jv.fromBufferAttribute(this,e),Jv.applyNormalMatrix(t),this.setXYZ(e,Jv.x,Jv.y,Jv.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Jv.fromBufferAttribute(this,e),Jv.transformDirection(t),this.setXYZ(e,Jv.x,Jv.y,Jv.z);return this}setX(t,e){return this.normalized&&(e=Sd(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Sd(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Sd(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Sd(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=wd(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=wd(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=wd(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=wd(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Sd(e,this.array),n=Sd(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Sd(e,this.array),n=Sd(n,this.array),i=Sd(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Sd(e,this.array),n=Sd(n,this.array),i=Sd(i,this.array),r=Sd(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new vf(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Qv(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ty extends pf{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ud(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let ey;const ny=new Jd,iy=new Jd,ry=new Jd,sy=new Cd,oy=new Cd,ay=new Ep,ly=new Jd,cy=new Jd,uy=new Jd,hy=new Cd,dy=new Cd,py=new Cd;class fy extends Qp{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",void 0===ey){ey=new Ef;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new $v(t,5);ey.setIndex([0,1,2,0,2,3]),ey.setAttribute("position",new Qv(e,3,0,!1)),ey.setAttribute("uv",new Qv(e,2,3,!1))}this.geometry=ey,this.material=void 0!==t?t:new ty,this.center=new Cd(.5,.5)}raycast(t,e){t.camera,iy.setFromMatrixScale(this.matrixWorld),ay.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),ry.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&iy.multiplyScalar(-ry.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;my(ly.set(-.5,-.5,0),ry,s,iy,i,r),my(cy.set(.5,-.5,0),ry,s,iy,i,r),my(uy.set(.5,.5,0),ry,s,iy,i,r),hy.set(0,0),dy.set(1,0),py.set(1,1);let o=t.ray.intersectTriangle(ly,cy,uy,!1,ny);if(null===o&&(my(cy.set(-.5,.5,0),ry,s,iy,i,r),dy.set(0,1),o=t.ray.intersectTriangle(ly,uy,cy,!1,ny),null===o))return;const a=t.ray.origin.distanceTo(ny);a<t.near||a>t.far||e.push({distance:a,point:ny.clone(),uv:hf.getUV(ny,ly,cy,uy,hy,dy,py,new Cd),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function my(t,e,n,i,r,s){sy.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(oy.x=s*sy.x-r*sy.y,oy.y=r*sy.x+s*sy.y):oy.copy(sy),t.copy(e),t.x+=oy.x,t.y+=oy.y,t.applyMatrix4(ay)}const gy=new Jd,vy=new Xd,yy=new Xd,_y=new Jd,by=new Ep;class xy extends qf{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ep,this.bindMatrixInverse=new Ep}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Xd,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}boneTransform(t,e){const n=this.skeleton,i=this.geometry;vy.fromBufferAttribute(i.attributes.skinIndex,t),yy.fromBufferAttribute(i.attributes.skinWeight,t),gy.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const t=yy.getComponent(r);if(0!==t){const i=vy.getComponent(r);by.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(_y.copy(gy).applyMatrix4(by),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}class wy extends Qp{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Sy extends qd{constructor(t=null,e=1,n=1,i,r,s,o,a,l=Hu,c=Hu,u,h){super(null,s,o,a,l,c,i,r,u,h),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const My=new Ep,Cy=new Ep;class Ay{constructor(t=[],e=[]){this.uuid=md(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Ep)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Ep;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=t.length;r<s;r++){const i=t[r]?t[r].matrixWorld:Cy;My.multiplyMatrices(i,e[r]),My.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ay(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=bd(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Sy(e,t,t,ch,nh);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){let i=e[t.bones[n]];void 0===i&&(i=new wy),this.bones.push(i),this.boneInverses.push((new Ep).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class Ty extends vf{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ey=new Ep,Iy=new Ep,Ry=[],Ny=new Ep,Dy=new qf;class Ly extends qf{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Ty(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1;for(let i=0;i<n;i++)this.setMatrixAt(i,Ny)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Dy.geometry=this.geometry,Dy.material=this.material,void 0!==Dy.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Ey),Iy.multiplyMatrices(n,Ey),Dy.matrixWorld=Iy,Dy.raycast(t,Ry);for(let t=0,n=Ry.length;t<n;t++){const n=Ry[t];n.instanceId=r,n.object=this,e.push(n)}Ry.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ty(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Oy extends pf{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ud(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ky=new Jd,Py=new Jd,Fy=new Ep,By=new Tp,zy=new _p;class Uy extends Qp{constructor(t=new Ef,e=new Oy){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)ky.fromBufferAttribute(e,t-1),Py.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=ky.distanceTo(Py);t.setAttribute("lineDistance",new bf(n,1))}return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),zy.copy(n.boundingSphere),zy.applyMatrix4(i),zy.radius+=r,!1===t.ray.intersectsSphere(zy))return;Fy.copy(i).invert(),By.copy(t.ray).applyMatrix4(Fy);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Jd,c=new Jd,u=new Jd,h=new Jd,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,r);if(By.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(h);s<t.near||s>t.far||e.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1);if(By.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(h);i<t.near||i>t.far||e.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const Vy=new Jd,Wy=new Jd;class Gy extends Uy{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Vy.fromBufferAttribute(e,t),Wy.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Vy.distanceTo(Wy);t.setAttribute("lineDistance",new bf(n,1))}return this}}class Hy extends Uy{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class jy extends pf{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ud(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const qy=new Ep,Xy=new Tp,Yy=new _p,Zy=new Jd;class Ky extends Qp{constructor(t=new Ef,e=new jy){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Yy.copy(n.boundingSphere),Yy.applyMatrix4(i),Yy.radius+=r,!1===t.ray.intersectsSphere(Yy))return;qy.copy(i).invert(),Xy.copy(t.ray).applyMatrix4(qy);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);Zy.fromBufferAttribute(c,r),$y(Zy,r,a,i,t,e,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)Zy.fromBufferAttribute(c,n),$y(Zy,n,a,i,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function $y(t,e,n,i,r,s,o){const a=Xy.distanceSqToPoint(t);if(a<n){const n=new Jd;Xy.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}class Jy extends qd{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:Xu,this.magFilter=void 0!==r?r:Xu,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Qy{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let o,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),o=this.getPoint(r),a=e||(s.isVector2?new Cd:new Jd);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Jd,i=[],r=[],s=[],o=new Jd,a=new Ep;for(let d=0;d<=t;d++){const e=d/t;i[d]=this.getTangentAt(e,new Jd)}r[0]=new Jd,s[0]=new Jd;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(gd(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(o,t))}s[d].crossVectors(i[d],r[d])}if(!0===e){let e=Math.acos(gd(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class t_ extends Qy{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new Cd,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}function e_(){let t=0,e=0,n=0,i=0;function r(r,s,o,a){t=r,e=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(i-e)/(o+a)+(i-n)/a;l*=o,c*=o,r(e,n,l,c)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}const n_=new Jd,i_=new e_,r_=new e_,s_=new e_;class o_ extends Qy{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new Jd){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=i[(l-1)%r]:(n_.subVectors(i[0],i[1]).add(i[0]),o=n_);const u=i[l%r],h=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(n_.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=n_),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),i_.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,e,n,i),r_.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,e,n,i),s_.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,e,n,i)}else"catmullrom"===this.curveType&&(i_.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),r_.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),s_.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return n.set(i_.calc(c),r_.calc(c),s_.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Jd).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function a_(t,e,n,i,r){const s=.5*(i-e),o=.5*(r-n),a=t*t;return(2*n-2*i+s+o)*(t*a)+(-3*n+3*i-2*s-o)*a+s*t+n}function l_(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function c_(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class u_ extends Qy{constructor(t=new Cd,e=new Cd,n=new Cd,i=new Cd){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Cd){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(c_(t,i.x,r.x,s.x,o.x),c_(t,i.y,r.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class h_ extends Qy{constructor(t=new Cd,e=new Cd){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Cd){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Cd;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class d_ extends Qy{constructor(t=new Cd,e=new Cd,n=new Cd){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Cd){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(l_(t,i.x,r.x,s.x),l_(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class p_ extends Qy{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Cd){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return n.set(a_(o,a.x,l.x,c.x,u.x),a_(o,a.y,l.y,c.y,u.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Cd).fromArray(n))}return this}}var f_=Object.freeze({__proto__:null,ArcCurve:class extends t_{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:o_,CubicBezierCurve:u_,CubicBezierCurve3:class extends Qy{constructor(t=new Jd,e=new Jd,n=new Jd,i=new Jd){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Jd){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(c_(t,i.x,r.x,s.x,o.x),c_(t,i.y,r.y,s.y,o.y),c_(t,i.z,r.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},EllipseCurve:t_,LineCurve:h_,LineCurve3:class extends Qy{constructor(t=new Jd,e=new Jd){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new Jd){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:d_,QuadraticBezierCurve3:class extends Qy{constructor(t=new Jd,e=new Jd,n=new Jd){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Jd){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(l_(t,i.x,r.x,s.x),l_(t,i.y,r.y,s.y),l_(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},SplineCurve:p_});class m_ extends Qy{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new h_(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new f_[n.type]).fromJSON(n))}return this}}class g_ extends m_{constructor(t){super(),this.type="Path",this.currentPoint=new Cd,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new h_(this.currentPoint.clone(),new Cd(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new d_(this.currentPoint.clone(),new Cd(t,e),new Cd(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const o=new u_(this.currentPoint.clone(),new Cd(t,e),new Cd(n,i),new Cd(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new p_(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,s,o,a),this}absellipse(t,e,n,i,r,s,o,a){const l=new t_(t,e,n,i,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class v_ extends Ef{constructor(t=1,e=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],o=[],a=[],l=new Jd,c=new Cd;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let u=0,h=3;u<=e;u++,h+=3){const r=n+u/e*i;l.x=t*Math.cos(r),l.y=t*Math.sin(r),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,a.push(c.x,c.y)}for(let u=1;u<=e;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new bf(s,3)),this.setAttribute("normal",new bf(o,3)),this.setAttribute("uv",new bf(a,2))}static fromJSON(t){return new v_(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class y_ extends Ef{constructor(t=1,e=1,n=1,i=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,s=new Cd,f=new Jd;let v=0;const y=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=i;t++)u.push(0,m*_,0),h.push(0,_,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i*a+o,n=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*_,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,_,0),s.x=.5*n+.5,s.y=.5*r*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new Jd,v=new Jd;let y=0;const _=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+o,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),s.set(l,_,f).normalize(),h.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(n,i,s),c.push(i,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new bf(u,3)),this.setAttribute("normal",new bf(h,3)),this.setAttribute("uv",new bf(d,2))}static fromJSON(t){return new y_(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class __ extends y_{constructor(t=1,e=1,n=8,i=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new __(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class b_ extends Ef{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function o(t,e,n,i){const r=i+1,s=[];for(let o=0;o<=r;o++){s[o]=[];const i=t.clone().lerp(n,o/r),a=e.clone().lerp(n,o/r),l=r-o;for(let t=0;t<=l;t++)s[o][t]=0===t&&o===r?i:i.clone().lerp(a,t/l)}for(let o=0;o<r;o++)for(let t=0;t<2*(r-o)-1;t++){const e=Math.floor(t/2);t%2==0?(a(s[o][e+1]),a(s[o+1][e]),a(s[o][e])):(a(s[o][e+1]),a(s[o+1][e+1]),a(s[o+1][e]))}}function a(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Jd,i=new Jd,r=new Jd;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),o(n,i,r,t)}(i),function(t){const e=new Jd;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Jd;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-o)}var e;(function(){const t=new Jd,e=new Jd,n=new Jd,i=new Jd,o=new Cd,a=new Cd,l=new Cd;for(let h=0,d=0;h<r.length;h+=9,d+=6){t.set(r[h+0],r[h+1],r[h+2]),e.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=u(i);c(o,d+0,t,p),c(a,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new bf(r,3)),this.setAttribute("normal",new bf(r.slice(),3)),this.setAttribute("uv",new bf(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new b_(t.vertices,t.indices,t.radius,t.details)}}class x_ extends b_{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new x_(t.radius,t.detail)}}const w_=new Jd,S_=new Jd,M_=new Jd,C_=new hf;class A_ extends Ef{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(pd*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let t=0;t<a;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:a}=C_;if(e.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),C_.getNormal(M_),u[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,u[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=u[t],i=u[e],s=C_[c[t]],o=C_[c[e]],a=`${n}_${i}`,p=`${i}_${n}`;p in h&&h[p]?(M_.dot(h[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),h[p]=null):a in h||(h[a]={index0:l[t],index1:l[e],normal:M_.clone()})}}for(const t in h)if(h[t]){const{index0:e,index1:n}=h[t];w_.fromBufferAttribute(o,e),S_.fromBufferAttribute(o,n),d.push(w_.x,w_.y,w_.z),d.push(S_.x,S_.y,S_.z)}this.setAttribute("position",new bf(d,3))}}}class T_ extends g_{constructor(t){super(t),this.uuid=md(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new g_).fromJSON(n))}return this}}const E_=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=I_(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=I_(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(U_(c));for(r.sort(P_),s=0;s<r.length;s++)n=F_(r[s],n);return n}(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(let e=n;e<r;e+=n)h=t[e],d=t[e+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return N_(s,o,n,a,l,p,0),o};function I_(t,e,n,i,r){let s,o;if(r===function(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)o=K_(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=K_(s,t[s],t[s+1],o);return o&&H_(o,o.next)&&($_(o),o=o.next),o}function R_(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!H_(i,i.next)&&0!==G_(i.prev,i,i.next))i=i.next;else{if($_(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function N_(t,e,n,i,r,s,o){if(!t)return;!o&&s&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=z_(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,i);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(t,i,r,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?L_(t,i,r,s):D_(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),$_(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?N_(t=O_(R_(t),e,n),e,n,i,r,s,2):2===o&&k_(t,e,n,i,r,s):N_(R_(t),e,n,i,r,s,1);break}}function D_(t){const e=t.prev,n=t,i=t.next;if(G_(e,n,i)>=0)return!1;const r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&V_(r,a,s,l,o,c,f.x,f.y)&&G_(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function L_(t,e,n,i){const r=t.prev,s=t,o=t.next;if(G_(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=z_(p,f,e,n,i),y=z_(m,g,e,n,i);let _=t.prevZ,b=t.nextZ;for(;_&&_.z>=v&&b&&b.z<=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&V_(a,u,l,h,c,d,_.x,_.y)&&G_(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&V_(a,u,l,h,c,d,b.x,b.y)&&G_(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&V_(a,u,l,h,c,d,_.x,_.y)&&G_(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&V_(a,u,l,h,c,d,b.x,b.y)&&G_(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function O_(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!H_(r,s)&&j_(r,i,i.next,s)&&Y_(r,s)&&Y_(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),$_(i),$_(i.next),i=t=s),i=i.next}while(i!==t);return R_(i)}function k_(t,e,n,i,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&W_(o,t)){let a=Z_(o,t);return o=R_(o,o.next),a=R_(a,a.next),N_(o,e,n,i,r,s,0),void N_(a,e,n,i,r,s,0)}t=t.next}o=o.next}while(o!==t)}function P_(t,e){return t.x-e.x}function F_(t,e){const n=function(t,e){let n,i=e,r=-1/0;const s=t.x,o=t.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){const t=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>r&&(r=t,n=i.x<i.next.x?i:i.next,t===s))return n}i=i.next}while(i!==e);if(!n)return null;const a=n,l=n.x,c=n.y;let u,h=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&V_(o<c?s:r,o,l,c,o<c?r:s,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(s-i.x),Y_(i,t)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&B_(n,i)))&&(n=i,h=u)),i=i.next}while(i!==a);return n}(t,e);if(!n)return e;const i=Z_(n,t);return R_(i,i.next),R_(n,n.next)}function B_(t,e){return G_(t.prev,t,e.prev)<0&&G_(e.next,t,t.next)<0}function z_(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function U_(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function V_(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function W_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&j_(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Y_(t,e)&&Y_(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(G_(t.prev,t,e.prev)||G_(t,e.prev,e))||H_(t,e)&&G_(t.prev,t,t.next)>0&&G_(e.prev,e,e.next)>0)}function G_(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function H_(t,e){return t.x===e.x&&t.y===e.y}function j_(t,e,n,i){const r=X_(G_(t,e,n)),s=X_(G_(t,e,i)),o=X_(G_(n,i,t)),a=X_(G_(n,i,e));return r!==s&&o!==a||(!(0!==r||!q_(t,n,e))||(!(0!==s||!q_(t,i,e))||(!(0!==o||!q_(n,t,i))||!(0!==a||!q_(n,e,i)))))}function q_(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function X_(t){return t>0?1:t<0?-1:0}function Y_(t,e){return G_(t.prev,t,t.next)<0?G_(t,e,t.next)>=0&&G_(t,t.prev,e)>=0:G_(t,e,t.prev)<0||G_(t,t.next,e)<0}function Z_(t,e){const n=new J_(t.i,t.x,t.y),i=new J_(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function K_(t,e,n,i){const r=new J_(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function $_(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function J_(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Q_{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return Q_.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];tb(t),eb(n,t);let s=t.length;e.forEach(tb);for(let a=0;a<e.length;a++)i.push(s),s+=e[a].length,eb(n,e[a]);const o=E_(n,i);for(let a=0;a<o.length;a+=3)r.push(o.slice(a,a+3));return r}}function tb(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function eb(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class nb extends Ef{constructor(t=new T_([new Cd(.5,.5),new Cd(-.5,.5),new Cd(-.5,-.5),new Cd(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let o=0,a=t.length;o<a;o++){s(t[o])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:u-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:ib;let g,v,y,_,b,x=!1;f&&(g=f.getSpacedPoints(a),x=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new Jd,_=new Jd,b=new Jd),c||(p=0,u=0,h=0,d=0);const w=t.extractPoints(o);let S=w.shape;const M=w.holes;if(!Q_.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];Q_.isClockWise(e)&&(M[t]=e.reverse())}}const C=Q_.triangulateShape(S,M),A=S;for(let e=0,n=M.length;e<n;e++){const t=M[e];S=S.concat(t)}function T(t,e,n){return e.clone().multiplyScalar(n).add(t)}const E=S.length,I=C.length;function R(t,e,n){let i,r,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+o/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-a*l);i=p+o*m-t.x,r=f+a*m-t.y;const g=i*i+r*r;if(g<=2)return new Cd(i,r);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(i=-a,r=o,s=Math.sqrt(u)):(i=o,r=a,s=Math.sqrt(u/2))}return new Cd(i/s,r/s)}const N=[];for(let e=0,n=A.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),N[e]=R(A[e],A[i],A[r]);const D=[];let L,O=N.concat();for(let e=0,n=M.length;e<n;e++){const t=M[e];L=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[e]=R(t[e],t[i],t[r]);D.push(L),O=O.concat(L)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,r=A.length;e<r;e++){const t=T(A[e],N[e],i);F(t.x,t.y,-n)}for(let e=0,r=M.length;e<r;e++){const t=M[e];L=D[e];for(let e=0,r=t.length;e<r;e++){const r=T(t[e],L[e],i);F(r.x,r.y,-n)}}}const k=h+d;for(let e=0;e<E;e++){const t=c?T(S[e],O[e],k):S[e];x?(_.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(_).add(y),F(b.x,b.y,b.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<E;t++){const n=c?T(S[t],O[t],k):S[t];x?(_.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(_).add(y),F(b.x,b.y,b.z)):F(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,r=A.length;e<r;e++){const t=T(A[e],N[e],i);F(t.x,t.y,l+n)}for(let e=0,r=M.length;e<r;e++){const t=M[e];L=D[e];for(let e=0,r=t.length;e<r;e++){const r=T(t[e],L[e],i);x?F(r.x,r.y+g[a-1].y,g[a-1].x+n):F(r.x,r.y,l+n)}}}function P(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=E*t,s=E*(t+1);z(e+i+n,e+r+n,e+r+s,e+i+s)}}}function F(t,e,n){s.push(t),s.push(e),s.push(n)}function B(t,e,r){U(t),U(e),U(r);const s=i.length/3,o=m.generateTopUV(n,i,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[2])}function z(t,e,r,s){U(t),U(e),U(s),U(e),U(r),U(s);const o=i.length/3,a=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function U(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function V(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=E*t;for(let n=0;n<I;n++){const t=C[n];B(t[2]+e,t[1]+e,t[0]+e)}t=a+2*p,e=E*t;for(let n=0;n<I;n++){const t=C[n];B(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<I;t++){const e=C[t];B(e[2],e[1],e[0])}for(let t=0;t<I;t++){const e=C[t];B(e[0]+E*a,e[1]+E*a,e[2]+E*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;P(A,e),e+=A.length;for(let n=0,i=M.length;n<i;n++){const t=M[n];P(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new bf(i,3)),this.setAttribute("uv",new bf(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,s=t.shapes.length;r<s;r++){const i=e[t.shapes[r]];n.push(i)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new f_[i.type]).fromJSON(i)),new nb(n,t.options)}}const ib={generateTopUV:function(t,e,n,i,r){const s=e[3*n],o=e[3*n+1],a=e[3*i],l=e[3*i+1],c=e[3*r],u=e[3*r+1];return[new Cd(s,o),new Cd(a,l),new Cd(c,u)]},generateSideWallUV:function(t,e,n,i,r,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*i],u=e[3*i+1],h=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new Cd(o,1-l),new Cd(c,1-h),new Cd(d,1-f),new Cd(m,1-v)]:[new Cd(a,1-l),new Cd(u,1-h),new Cd(p,1-f),new Cd(g,1-v)]}};class rb extends Ef{constructor(t=new T_([new Cd(0,.5),new Cd(-.5,-.5),new Cd(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(o,a,c),o+=a,a=0;function l(t){const o=i.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===Q_.isClockWise(c)&&(c=c.reverse());for(let e=0,n=u.length;e<n;e++){const t=u[e];!0===Q_.isClockWise(t)&&(u[e]=t.reverse())}const h=Q_.triangulateShape(c,u);for(let e=0,n=u.length;e<n;e++){const t=u[e];c=c.concat(t)}for(let e=0,n=c.length;e<n;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,i=h.length;e<i;e++){const t=h[e],i=t[0]+o,r=t[1]+o,s=t[2]+o;n.push(i,r,s),a+=3}}this.setIndex(n),this.setAttribute("position",new bf(i,3)),this.setAttribute("normal",new bf(r,3)),this.setAttribute("uv",new bf(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new rb(n,t.curveSegments)}}class sb extends Ef{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new Jd,h=new Jd,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0==g&&0==s?y=.5/e:g==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(i+a*r)*Math.sin(s+v*o),u.y=t*Math.cos(s+v*o),u.z=t*Math.sin(i+a*r)*Math.sin(s+v*o),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let t=0;t<e;t++){const e=c[g][t+1],i=c[g][t],r=c[g+1][t],o=c[g+1][t+1];(0!==g||s>0)&&d.push(e,i,o),(g!==n-1||a<Math.PI)&&d.push(i,r,o)}this.setIndex(d),this.setAttribute("position",new bf(p,3)),this.setAttribute("normal",new bf(f,3)),this.setAttribute("uv",new bf(m,2))}static fromJSON(t){return new sb(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class ob extends Ef{constructor(t=1,e=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],l=[],c=new Jd,u=new Jd,h=new Jd;for(let d=0;d<=n;d++)for(let s=0;s<=i;s++){const p=s/i*r,f=d/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(s/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let t=1;t<=i;t++){const e=(i+1)*d+t-1,n=(i+1)*(d-1)+t-1,r=(i+1)*(d-1)+t,o=(i+1)*d+t;s.push(e,n,o),s.push(n,r,o)}this.setIndex(s),this.setAttribute("position",new bf(o,3)),this.setAttribute("normal",new bf(a,3)),this.setAttribute("uv",new bf(l,2))}static fromJSON(t){return new ob(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class ab extends Ef{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],c=[],u=new Jd,h=new Jd,d=new Jd,p=new Jd,f=new Jd,m=new Jd,g=new Jd;for(let y=0;y<=n;++y){const o=y/n*r*Math.PI*2;v(o,r,s,t,d),v(o+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),o=e*Math.sin(r);u.x=d.x+(s*g.x+o*f.x),u.y=d.y+(s*g.y+o*f.y),u.z=d.z+(s*g.z+o*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/n),c.push(t/i)}}for(let y=1;y<=n;y++)for(let t=1;t<=i;t++){const e=(i+1)*(y-1)+(t-1),n=(i+1)*y+(t-1),r=(i+1)*y+t,s=(i+1)*(y-1)+t;o.push(e,n,s),o.push(n,r,s)}function v(t,e,n,i,r){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,l=Math.cos(a);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new bf(a,3)),this.setAttribute("normal",new bf(l,3)),this.setAttribute("uv",new bf(c,2))}static fromJSON(t){return new ab(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class lb extends pf{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ud(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ud(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nd,this.normalScale=new Cd(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class cb extends lb{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Cd(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return gd(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ud(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ud(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ud(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class ub extends pf{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ud(16777215),this.specular=new Ud(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ud(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nd,this.normalScale=new Cd(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Tu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class hb extends pf{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ud(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ud(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nd,this.normalScale=new Cd(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class db extends pf{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ud(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ud(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nd,this.normalScale=new Cd(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Tu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}function pb(t,e,n){return mb(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)}function fb(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function mb(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function gb(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort((function(e,n){return t[e]-t[n]})),n}function vb(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r}function yb(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),n.push(o)),s=t[r++]}while(void 0!==s)}var _b=Object.freeze({__proto__:null,arraySlice:pb,convertArray:fb,isTypedArray:mb,getKeyframeOrder:gb,sortedArray:vb,flattenJSON:yb,subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const t=s.tracks[l],e=t.getValueSize(),a=[],c=[];for(let s=0;s<t.times.length;++s){const o=t.times[s]*r;if(!(o<n||o>=i)){a.push(t.times[s]);for(let n=0;n<e;++n)c.push(t.values[s*e+n])}}0!==a.length&&(t.times=fb(a,t.times.constructor),t.values=fb(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let o=0;o<r;++o){const e=n.tracks[o],i=e.ValueTypeName;if("bool"===i||"string"===i)continue;const r=t.tracks.find((function(t){return t.name===e.name&&t.ValueTypeName===i}));if(void 0===r)continue;let a=0;const l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=e.times.length-1;let d;if(s<=e.times[0]){const t=a,n=l-a;d=pb(e.values,t,n)}else if(s>=e.times[h]){const t=h*l+a,n=t+l-a;d=pb(e.values,t,n)}else{const t=e.createInterpolant(),n=a,i=l-a;t.evaluate(s),d=pb(t.resultBuffer,n,i)}if("quaternion"===i){(new $d).fromArray(d).normalize().conjugate().toArray(d)}const p=r.times.length;for(let t=0;t<p;++t){const e=t*u+c;if("quaternion"===i)$d.multiplyQuaternionsFlat(r.values,e,d,0,r.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)r.values[e+n]-=d[n]}}}return t.blendMode=2501,t}});class bb{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const o=e[1];t<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let s=0;s!==i;++s)e[s]=n[r+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class xb extends bb{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zh,endingEnd:Zh}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case Kh:r=t,o=2*e-n;break;case $h:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Kh:s=t,a=2*n-e;break;case $h:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==o;++b)r[b]=g*s[c+b]+v*s[l+b]+y*s[a+b]+_*s[u+b];return r}}class wb extends bb{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(i-e),u=1-c;for(let h=0;h!==o;++h)r[h]=s[l+h]*u+s[a+h]*c;return r}}class Sb extends bb{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Mb{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=fb(e,this.TimeBufferType),this.values=fb(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:fb(t.times,Array),values:fb(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Sb(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new wb(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new xb(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case qh:e=this.InterpolantFactoryMethodDiscrete;break;case Xh:e=this.InterpolantFactoryMethodLinear;break;case Yh:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return qh;case this.InterpolantFactoryMethodLinear:return Xh;case this.InterpolantFactoryMethodSmooth:return Yh}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=pb(n,r,s),this.values=pb(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(t=!1);let s=null;for(let o=0;o!==r;o++){const e=n[o];if("number"==typeof e&&isNaN(e)){t=!1;break}if(null!==s&&s>e){t=!1;break}s=e}if(void 0!==i&&mb(i))for(let o=0,a=i.length;o!==a;++o){const e=i[o];if(isNaN(e)){t=!1;break}}return t}optimize(){const t=pb(this.times),e=pb(this.values),n=this.getValueSize(),i=this.getInterpolation()===Yh,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const i=o*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,o=0;o!==n;++o)e[i+o]=e[t+o];++s}return s!==t.length?(this.times=pb(t,0,s),this.values=pb(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=pb(this.times,0),e=pb(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Mb.prototype.TimeBufferType=Float32Array,Mb.prototype.ValueBufferType=Float32Array,Mb.prototype.DefaultInterpolation=Xh;class Cb extends Mb{}Cb.prototype.ValueTypeName="bool",Cb.prototype.ValueBufferType=Array,Cb.prototype.DefaultInterpolation=qh,Cb.prototype.InterpolantFactoryMethodLinear=void 0,Cb.prototype.InterpolantFactoryMethodSmooth=void 0;class Ab extends Mb{}Ab.prototype.ValueTypeName="color";class Tb extends Mb{}Tb.prototype.ValueTypeName="number";class Eb extends bb{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let l=t*o;for(let c=l+o;l!==c;l+=4)$d.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Ib extends Mb{InterpolantFactoryMethodLinear(t){return new Eb(this.times,this.values,this.getValueSize(),t)}}Ib.prototype.ValueTypeName="quaternion",Ib.prototype.DefaultInterpolation=Xh,Ib.prototype.InterpolantFactoryMethodSmooth=void 0;class Rb extends Mb{}Rb.prototype.ValueTypeName="string",Rb.prototype.ValueBufferType=Array,Rb.prototype.DefaultInterpolation=qh,Rb.prototype.InterpolantFactoryMethodLinear=void 0,Rb.prototype.InterpolantFactoryMethodSmooth=void 0;class Nb extends Mb{}Nb.prototype.ValueTypeName="vector";class Db{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=md(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let s=0,o=n.length;s!==o;++s)e.push(Lb(n[s]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,s=n.length;r!==s;++r)e.push(Mb.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let o=0;o<r;o++){let t=[],a=[];t.push((o+r-1)%r,o,(o+1)%r),a.push(0,1,0);const l=gb(t);t=vb(t,1,l),a=vb(a,1,l),i||0!==t[0]||(t.push(r),a.push(a[0])),s.push(new Tb(".morphTargetInfluences["+e[o].name+"]",t,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,a=t.length;o<a;o++){const e=t[o],n=e.name.match(r);if(n&&n.length>1){const t=n[1];let r=i[t];r||(i[t]=r=[]),r.push(e)}}const s=[];for(const o in i)s.push(this.CreateFromMorphTargetSequence(o,i[o],e,n));return s}static parseAnimation(t,e){if(!t)return null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],o=[];yb(n,s,o,i),0!==s.length&&r.push(new t(e,s,o))}},i=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let c=0;c<l.length;c++){const t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const r in e){const e=[],s=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new Tb(".morphTargetInfluence["+r+"]",e,s))}a=e.length*s}else{const r=".bones["+e[c].name+"]";n(Nb,r+".position",t,"pos",i),n(Ib,r+".quaternion",t,"rot",i),n(Nb,r+".scale",t,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Lb(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Tb;case"vector":case"vector2":case"vector3":case"vector4":return Nb;case"color":return Ab;case"quaternion":return Ib;case"bool":case"boolean":return Cb;case"string":return Rb}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];yb(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ob={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class kb{constructor(t,e,n){const i=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const Pb=new kb;class Fb{constructor(t){this.manager=void 0!==t?t:Pb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Bb={};class zb extends Error{constructor(t,e){super(t),this.response=e}}class Ub extends Fb{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Ob.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==Bb[t])return void Bb[t].push({onLoad:e,onProgress:n,onError:i});Bb[t]=[],Bb[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(e.status,"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=Bb[t],i=e.body.getReader(),r=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw new zb(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{Ob.add(t,e);const n=Bb[t];delete Bb[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=Bb[t];if(void 0===n)throw this.manager.itemError(t),e;delete Bb[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Vb extends Fb{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ob.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=Id("img");function a(){c(),Ob.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class Wb extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=new rm,s=new Vb(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){r.images[n]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(let l=0;l<t.length;++l)a(l);return r}}class Gb extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Sy,o=new Ub(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,(function(t){const n=r.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:Wu,s.wrapT=void 0!==n.wrapT?n.wrapT:Wu,s.magFilter=void 0!==n.magFilter?n.magFilter:Xu,s.minFilter=void 0!==n.minFilter?n.minFilter:Xu,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=Zu),1===n.mipmapCount&&(s.minFilter=Xu),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n))}),n,i),s}}class Hb extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=new qd,s=new Vb(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class jb extends Qp{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ud(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class qb extends jb{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qp.DefaultUp),this.updateMatrix(),this.groundColor=new Ud(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const Xb=new Ep,Yb=new Jd,Zb=new Jd;class Kb{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Cd(512,512),this.map=null,this.mapPass=null,this.matrix=new Ep,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new dm,this._frameExtents=new Cd(1,1),this._viewportCount=1,this._viewports=[new Xd(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Yb.setFromMatrixPosition(t.matrixWorld),e.position.copy(Yb),Zb.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Zb),e.updateMatrixWorld(),Xb.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Xb),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Xb)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class $b extends Kb{constructor(){super(new em(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*fd*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Jb extends jb{constructor(t,e,n=0,i=Math.PI/3,r=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qp.DefaultUp),this.updateMatrix(),this.target=new Qp,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new $b}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const Qb=new Ep,tx=new Jd,ex=new Jd;class nx extends Kb{constructor(){super(new em(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Cd(4,2),this._viewportCount=6,this._viewports=[new Xd(2,1,1,1),new Xd(0,1,1,1),new Xd(3,1,1,1),new Xd(1,1,1,1),new Xd(3,0,1,1),new Xd(1,0,1,1)],this._cubeDirections=[new Jd(1,0,0),new Jd(-1,0,0),new Jd(0,0,1),new Jd(0,0,-1),new Jd(0,1,0),new Jd(0,-1,0)],this._cubeUps=[new Jd(0,1,0),new Jd(0,1,0),new Jd(0,1,0),new Jd(0,1,0),new Jd(0,0,1),new Jd(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),tx.setFromMatrixPosition(t.matrixWorld),n.position.copy(tx),ex.copy(n.position),ex.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(ex),n.updateMatrixWorld(),i.makeTranslation(-tx.x,-tx.y,-tx.z),Qb.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qb)}}class ix extends jb{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new nx}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class rx extends Kb{constructor(){super(new Am(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class sx extends jb{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qp.DefaultUp),this.updateMatrix(),this.target=new Qp,this.shadow=new rx}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class ox extends jb{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class ax{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(xW){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class lx extends Fb{constructor(t){super(t),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ob.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Ob.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}let cx;class ux{static getContext(){return void 0===cx&&(cx=new(window.AudioContext||window.webkitAudioContext)),cx}static setContext(t){cx=t}}class hx extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Ub(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);ux.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(xW){i&&i(xW),r.manager.itemError(t)}}),n,i)}}class dx{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=px(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=px();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function px(){return("undefined"==typeof performance?Date:performance).now()}const fx=new Jd,mx=new $d,gx=new Jd,vx=new Jd;class yx extends Qp{constructor(){super(),this.type="AudioListener",this.context=ux.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new dx}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(fx,mx,gx),vx.set(0,0,-1).applyQuaternion(mx),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(fx.x,t),e.positionY.linearRampToValueAtTime(fx.y,t),e.positionZ.linearRampToValueAtTime(fx.z,t),e.forwardX.linearRampToValueAtTime(vx.x,t),e.forwardY.linearRampToValueAtTime(vx.y,t),e.forwardZ.linearRampToValueAtTime(vx.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(fx.x,fx.y,fx.z),e.setOrientation(vx.x,vx.y,vx.z,n.x,n.y,n.z)}}class _x extends Qp{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const bx=new Jd,xx=new $d,wx=new Jd,Sx=new Jd;class Mx extends _x{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(bx,xx,wx),Sx.set(0,0,1).applyQuaternion(xx);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(bx.x,t),e.positionY.linearRampToValueAtTime(bx.y,t),e.positionZ.linearRampToValueAtTime(bx.z,t),e.orientationX.linearRampToValueAtTime(Sx.x,t),e.orientationY.linearRampToValueAtTime(Sx.y,t),e.orientationZ.linearRampToValueAtTime(Sx.z,t)}else e.setPosition(bx.x,bx.y,bx.z),e.setOrientation(Sx.x,Sx.y,Sx.z)}}class Cx{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class Ax{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let a=e,l=e+e;a!==l;++a)if(n[a]!==n[a+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,s=i;r!==s;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)t[e+s]=t[n+s]}_slerp(t,e,n,i){$d.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;$d.multiplyQuaternionsFlat(t,s,t,e,t,n),$d.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const Tx="\\[\\]\\.:\\/",Ex=new RegExp("["+Tx+"]","g"),Ix="[^"+Tx+"]",Rx="[^"+Tx.replace("\\.","")+"]",Nx=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Ix)+/(WCOD+)?/.source.replace("WCOD",Rx)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ix)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ix)+"$"),Dx=["material","materials","bones","map"];class Lx{constructor(t,e,n){this.path=e,this.parsedPath=n||Lx.parseTrackName(e),this.node=Lx.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Lx.Composite(t,e,n):new Lx(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Ex,"")}static parseTrackName(t){const e=Nx.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==Dx.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=Lx.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return;if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return;if(!t.material.materials)return;t=t.material.materials;break;case"bones":if(!t.skeleton)return;t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return;if(!t.material.map)return;t=t.material.map;break;default:if(void 0===t[n])return;t=t[n]}if(void 0!==i){if(void 0===t[i])return;t=t[i]}}const s=t[i];if(void 0===s){e.nodeName;return}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return;if(!t.geometry.morphAttributes)return;void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Lx.Composite=class{constructor(t,e,n){const i=n||Lx.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Lx.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Lx.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Lx.prototype.GetterByBindingType=[Lx.prototype._getValue_direct,Lx.prototype._getValue_array,Lx.prototype._getValue_arrayElement,Lx.prototype._getValue_toArray],Lx.prototype.SetterByBindingTypeAndVersioning=[[Lx.prototype._setValue_direct,Lx.prototype._setValue_direct_setNeedsUpdate,Lx.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Lx.prototype._setValue_array,Lx.prototype._setValue_array_setNeedsUpdate,Lx.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Lx.prototype._setValue_arrayElement,Lx.prototype._setValue_arrayElement_setNeedsUpdate,Lx.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Lx.prototype._setValue_fromArray,Lx.prototype._setValue_fromArray_setNeedsUpdate,Lx.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ox{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:Zh,endingEnd:Zh};for(let l=0;l!==s;++l){const t=r[l].createInterpolant(null);o[l]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r||!s||1&~r?i:e-i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&!(1&~r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=Kh,i.endingEnd=Kh):(i.endingStart=t?this.zeroSlopeAtStart?Kh:Zh:$h,i.endingEnd=e?this.zeroSlopeAtEnd?Kh:Zh:$h)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=n,this}}const kx=new Float32Array(1);class Px extends ud{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==r;++u){const t=i[u],r=t.name;let l=c[r];if(void 0!==l)++l.referenceCount,s[u]=l;else{if(l=s[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=e&&e._propertyBindings[u].binding.parsedPath;l=new Ax(Lx.create(n,r,i),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),s[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0==--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new wb(new Float32Array(2),new Float32Array(2),1,kx),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?Db.findByName(i,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Jh),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Ox(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?Db.findByName(n,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==n;++l){e[l]._update(i,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const r in n){const t=n[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const r in i){const t=i[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Fx{constructor(t,e,n=0,i=1/0){this.ray=new Tp(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new zp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e)}intersectObject(t,e=!0,n=[]){return zx(t,this,n,e),n.sort(Bx),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)zx(t[i],this,n,e);return n.sort(Bx),n}}function Bx(t,e){return t.distance-e.distance}function zx(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)zx(i[t],e,n,!0)}}class Ux{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(gd(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Vx extends Gy{constructor(t=10,e=10,n=4473924,i=8947848){n=new Ud(n),i=new Ud(i);const r=e/2,s=t/e,o=t/2,a=[],l=[];for(let u=0,h=0,d=-o;u<=e;u++,d+=s){a.push(-o,0,d,o,0,d),a.push(d,0,-o,d,0,o);const t=u===r?n:i;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}const c=new Ef;c.setAttribute("position",new bf(a,3)),c.setAttribute("color",new bf(l,3));super(c,new Oy({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Wx=new Jd;let Gx,Hx;class jx extends Qp{constructor(t=new Jd(0,0,1),e=new Jd(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===Gx&&(Gx=new Ef,Gx.setAttribute("position",new bf([0,0,0,0,1,0],3)),Hx=new y_(0,.5,1,5,1),Hx.translate(0,-.5,0)),this.position.copy(e),this.line=new Uy(Gx,new Oy({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qf(Hx,new ff({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Wx.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Wx,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class qx extends Gy{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Ef;n.setAttribute("position",new bf(e,3)),n.setAttribute("color",new bf([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Oy({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new Ud,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Xx{constructor(){this.type="ShapePath",this.color=new Ud,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new g_,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],o=e[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],a=-a,o=e[r],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return i}const n=Q_.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,o;const a=[];if(1===i.length)return s=i[0],o=new T_,o.curves=s.curves,a.push(o),a;let l=!n(i[0].getPoints());l=t?!l:l;const c=[],u=[];let h,d,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)s=i[m],h=s.getPoints(),r=n(h),r=t?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new T_,p:h},u[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:h[0]});if(!u[0])return function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new T_;r.curves=i.curves,e.push(r)}return e}(i);if(u.length>1){let t=!1,n=0;for(let e=0,i=u.length;e<i;e++)c[e]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<u.length;r++)e(o.p,u[r].p)&&(i!==r&&n++,a?(a=!1,c[r].push(o)):t=!0);a&&c[i].push(o)}}n>0&&!1===t&&(p=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,a.push(o),d=p[m];for(let t=0,e=d.length;t<e;t++)o.holes.push(d[t].h)}return a}}const Yx=Zx();function Zx(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const t=l-127;t<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):t<-14?(i[l]=1024>>-t-14,i[256|l]=1024>>-t-14|32768,r[l]=-t-1,r[256|l]=-t-1):t<=15?(i[l]=t+15<<10,i[256|l]=t+15<<10|32768,r[l]=13,r[256|l]=13):t<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let t=l<<13,e=0;for(;!(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,s[l]=t|e}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}var Kx=Object.freeze({__proto__:null,toHalfFloat:function(t){Math.abs(t),t=gd(t,-65504,65504),Yx.floatView[0]=t;const e=Yx.uint32View[0],n=e>>23&511;return Yx.baseTable[n]+((8388607&e)>>Yx.shiftTable[n])},fromHalfFloat:function(t){const e=t>>10;return Yx.uint32View[0]=Yx.mantissaTable[Yx.offsetTable[e]+(1023&t)]+Yx.exponentTable[e],Yx.floatView[0]}});class $x extends Yf{constructor(t,e,n,i,r,s){super(t,e,n,i,r,s)}}class Jx extends v_{constructor(t,e,n,i){super(t,e,n,i)}}class Qx extends mm{constructor(t,e,n,i){super(t,e,n,i)}}class tw extends sb{constructor(t,e,n,i,r,s,o){super(t,e,n,i,r,s,o)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Oc}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=Oc));class ew{constructor(t){void 0===t&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t){void 0===t&&(t=new iw);const e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t}vmult(t,e){void 0===e&&(e=new iw);const n=this.elements,i=t.x,r=t.y,s=t.z;return e.x=n[0]*i+n[1]*r+n[2]*s,e.y=n[3]*i+n[4]*r+n[5]*s,e.z=n[6]*i+n[7]*r+n[8]*s,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e){void 0===e&&(e=new ew);const n=this.elements,i=t.elements,r=e.elements,s=n[0],o=n[1],a=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],p=n[8],f=i[0],m=i[1],g=i[2],v=i[3],y=i[4],_=i[5],b=i[6],x=i[7],w=i[8];return r[0]=s*f+o*v+a*b,r[1]=s*m+o*y+a*x,r[2]=s*g+o*_+a*w,r[3]=l*f+c*v+u*b,r[4]=l*m+c*y+u*x,r[5]=l*g+c*_+u*w,r[6]=h*f+d*v+p*b,r[7]=h*m+d*y+p*x,r[8]=h*g+d*_+p*w,e}scale(t,e){void 0===e&&(e=new ew);const n=this.elements,i=e.elements;for(let r=0;3!==r;r++)i[3*r+0]=t.x*n[3*r+0],i[3*r+1]=t.y*n[3*r+1],i[3*r+2]=t.z*n[3*r+2];return e}solve(t,e){void 0===e&&(e=new iw);const n=[];let i,r;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)n[i+4*r]=this.elements[i+3*r];n[3]=t.x,n[7]=t.y,n[11]=t.z;let s=3;const o=s;let a;let l;do{if(i=o-s,0===n[i+4*i])for(r=i+1;r<o;r++)if(0!==n[i+4*r]){a=4;do{l=4-a,n[l+4*i]+=n[l+4*r]}while(--a);break}if(0!==n[i+4*i])for(r=i+1;r<o;r++){const t=n[i+4*r]/n[i+4*i];a=4;do{l=4-a,n[l+4*r]=l<=i?0:n[l+4*r]-n[l+4*i]*t}while(--a)}}while(--s);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw`Could not solve equation! Got x=[${e.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return e}e(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(t){void 0===t&&(t=new ew);const e=nw;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)e[n+6*i]=this.elements[n+3*i];e[3]=1,e[9]=0,e[15]=0,e[4]=0,e[10]=1,e[16]=0,e[5]=0,e[11]=0,e[17]=1;let r=3;const s=r;let o;let a;do{if(n=s-r,0===e[n+6*n])for(i=n+1;i<s;i++)if(0!==e[n+6*i]){o=6;do{a=6-o,e[a+6*n]+=e[a+6*i]}while(--o);break}if(0!==e[n+6*n])for(i=n+1;i<s;i++){const t=e[n+6*i]/e[n+6*n];o=6;do{a=6-o,e[a+6*i]=a<=n?0:e[a+6*i]-e[a+6*n]*t}while(--o)}}while(--r);n=2;do{i=n-1;do{const t=e[n+6*i]/e[n+6*n];o=6;do{a=6-o,e[a+6*i]=e[a+6*i]-e[a+6*n]*t}while(--o)}while(i--)}while(--n);n=2;do{const t=1/e[n+6*n];o=6;do{a=6-o,e[a+6*n]=e[a+6*n]*t}while(--o)}while(n--);n=2;do{i=2;do{if(a=e[3+i+6*n],isNaN(a)||a===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(n,i,a)}while(i--)}while(n--);return t}setRotationFromQuaternion(t){const e=t.x,n=t.y,i=t.z,r=t.w,s=e+e,o=n+n,a=i+i,l=e*s,c=e*o,u=e*a,h=n*o,d=n*a,p=i*a,f=r*s,m=r*o,g=r*a,v=this.elements;return v[0]=1-(h+p),v[1]=c-g,v[2]=u+m,v[3]=c+g,v[4]=1-(l+p),v[5]=d-f,v[6]=u-m,v[7]=d+f,v[8]=1-(l+h),this}transpose(t){void 0===t&&(t=new ew);const e=this.elements,n=t.elements;let i;return n[0]=e[0],n[4]=e[4],n[8]=e[8],i=e[1],n[1]=e[3],n[3]=i,i=e[2],n[2]=e[6],n[6]=i,i=e[5],n[5]=e[7],n[7]=i,t}}const nw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class iw{constructor(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}cross(t,e){void 0===e&&(e=new iw);const n=t.x,i=t.y,r=t.z,s=this.x,o=this.y,a=this.z;return e.x=o*r-a*i,e.y=a*n-s*r,e.z=s*i-o*n,e}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(!e)return new iw(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z}vsub(t,e){if(!e)return new iw(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}crossmat(){return new ew([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,e=this.y,n=this.z,i=Math.sqrt(t*t+e*e+n*n);if(i>0){const t=1/i;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return i}unit(t){void 0===t&&(t=new iw);const e=this.x,n=this.y,i=this.z;let r=Math.sqrt(e*e+n*n+i*i);return r>0?(r=1/r,t.x=e*r,t.y=n*r,t.z=i*r):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)}lengthSquared(){return this.dot(this)}distanceTo(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z;return Math.sqrt((r-e)*(r-e)+(s-n)*(s-n)+(o-i)*(o-i))}distanceSquared(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z;return(r-e)*(r-e)+(s-n)*(s-n)+(o-i)*(o-i)}scale(t,e){void 0===e&&(e=new iw);const n=this.x,i=this.y,r=this.z;return e.x=t*n,e.y=t*i,e.z=t*r,e}vmul(t,e){return void 0===e&&(e=new iw),e.x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,n){return void 0===n&&(n=new iw),n.x=this.x+t*e.x,n.y=this.y+t*e.y,n.z=this.z+t*e.z,n}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(t){return void 0===t&&(t=new iw),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){const n=this.length();if(n>0){const i=rw,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const s=sw;Math.abs(i.x)<.9?(s.set(1,0,0),i.cross(s,t)):(s.set(0,1,0),i.cross(s,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,n){const i=this.x,r=this.y,s=this.z;n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n.z=s+(t.z-s)*e}almostEquals(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(ow),ow.almostEquals(t,e)}clone(){return new iw(this.x,this.y,this.z)}}iw.ZERO=new iw(0,0,0),iw.UNIT_X=new iw(1,0,0),iw.UNIT_Y=new iw(0,1,0),iw.UNIT_Z=new iw(0,0,1);const rw=new iw,sw=new iw,ow=new iw;class aw{constructor(t){void 0===t&&(t={}),this.lowerBound=new iw,this.upperBound=new iw,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,n,i){const r=this.lowerBound,s=this.upperBound,o=n;r.copy(t[0]),o&&o.vmult(r,r),s.copy(r);for(let a=1;a<t.length;a++){let e=t[a];o&&(o.vmult(e,lw),e=lw),e.x>s.x&&(s.x=e.x),e.x<r.x&&(r.x=e.x),e.y>s.y&&(s.y=e.y),e.y<r.y&&(r.y=e.y),e.z>s.z&&(s.z=e.z),e.z<r.z&&(r.z=e.z)}return e&&(e.vadd(r,r),e.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return(new aw).copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound,s=i.x<=n.x&&n.x<=r.x||e.x<=r.x&&r.x<=n.x,o=i.y<=n.y&&n.y<=r.y||e.y<=r.y&&r.y<=n.y,a=i.z<=n.z&&n.z<=r.z||e.z<=r.z&&r.z<=n.z;return s&&o&&a}volume(){const t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){const e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound;return e.x<=i.x&&n.x>=r.x&&e.y<=i.y&&n.y>=r.y&&e.z<=i.z&&n.z>=r.z}getCorners(t,e,n,i,r,s,o,a){const l=this.lowerBound,c=this.upperBound;t.copy(l),e.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),i.set(l.x,c.y,c.z),r.set(c.x,l.y,c.z),s.set(l.x,c.y,l.z),o.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(t,e){const n=cw,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(i,r,s,o,a,l,c,u);for(let h=0;8!==h;h++){const e=n[h];t.pointToLocal(e,e)}return e.setFromPoints(n)}toWorldFrame(t,e){const n=cw,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(i,r,s,o,a,l,c,u);for(let h=0;8!==h;h++){const e=n[h];t.pointToWorld(e,e)}return e.setFromPoints(n)}overlapsRay(t){const{direction:e,from:n}=t,i=1/e.x,r=1/e.y,s=1/e.z,o=(this.lowerBound.x-n.x)*i,a=(this.upperBound.x-n.x)*i,l=(this.lowerBound.y-n.y)*r,c=(this.upperBound.y-n.y)*r,u=(this.lowerBound.z-n.z)*s,h=(this.upperBound.z-n.z)*s,d=Math.max(Math.max(Math.min(o,a),Math.min(l,c)),Math.min(u,h)),p=Math.min(Math.min(Math.max(o,a),Math.max(l,c)),Math.max(u,h));return!(p<0)&&!(d>p)}}const lw=new iw,cw=[new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw];class uw{constructor(){this.matrix=[]}get(t,e){let{index:n}=t,{index:i}=e;if(i>n){const t=i;i=n,n=t}return this.matrix[(n*(n+1)>>1)+i-1]}set(t,e,n){let{index:i}=t,{index:r}=e;if(r>i){const t=r;r=i,i=t}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class hw{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[t]&&(n[t]=[]),n[t].includes(e)||n[t].push(e),this}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[t]||!n[t].includes(e))}hasAnyEventListener(t){if(void 0===this._listeners)return!1;return void 0!==this._listeners[t]}removeEventListener(t,e){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[t])return this;const i=n[t].indexOf(e);return-1!==i&&n[t].splice(i,1),this}dispatchEvent(t){if(void 0===this._listeners)return this;const e=this._listeners[t.type];if(void 0!==e){t.target=this;for(let n=0,i=e.length;n<i;n++)e[n].call(this,t)}return this}}class dw{constructor(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=t,this.y=e,this.z=n,this.w=i}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){const n=Math.sin(.5*e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e),this}toAxisAngle(t){void 0===t&&(t=new iw),this.normalize();const e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]}setFromVectors(t,e){if(t.isAntiparallelTo(e)){const e=pw,n=fw;t.tangents(e,n),this.setFromAxisAngle(e,Math.PI)}else{const n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()}return this}mult(t,e){void 0===e&&(e=new dw);const n=this.x,i=this.y,r=this.z,s=this.w,o=t.x,a=t.y,l=t.z,c=t.w;return e.x=n*c+s*o+i*l-r*a,e.y=i*c+s*a+r*o-n*l,e.z=r*c+s*l+n*a-i*o,e.w=s*c-n*o-i*a-r*l,e}inverse(t){void 0===t&&(t=new dw);const e=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(t);const s=1/(e*e+n*n+i*i+r*r);return t.x*=s,t.y*=s,t.z*=s,t.w*=s,t}conjugate(t){return void 0===t&&(t=new dw),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e){void 0===e&&(e=new iw);const n=t.x,i=t.y,r=t.z,s=this.x,o=this.y,a=this.z,l=this.w,c=l*n+o*r-a*i,u=l*i+a*n-s*r,h=l*r+s*i-o*n,d=-s*n-o*i-a*r;return e.x=c*l+d*-s+u*-a-h*-o,e.y=u*l+d*-o+h*-s-c*-a,e.z=h*l+d*-a+c*-o-u*-s,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e){let n,i,r;void 0===e&&(e="YZX");const s=this.x,o=this.y,a=this.z,l=this.w;if("YZX"!==e)throw new Error(`Euler order ${e} not supported yet.`);{const t=s*o+a*l;if(t>.499&&(n=2*Math.atan2(s,l),i=Math.PI/2,r=0),t<-.499&&(n=-2*Math.atan2(s,l),i=-Math.PI/2,r=0),void 0===n){const e=s*s,c=o*o,u=a*a;n=Math.atan2(2*o*l-2*s*a,1-2*c-2*u),i=Math.asin(2*t),r=Math.atan2(2*s*l-2*o*a,1-2*e-2*u)}}t.y=n,t.z=i,t.x=r}setFromEuler(t,e,n,i){void 0===i&&(i="XYZ");const r=Math.cos(t/2),s=Math.cos(e/2),o=Math.cos(n/2),a=Math.sin(t/2),l=Math.sin(e/2),c=Math.sin(n/2);return"XYZ"===i?(this.x=a*s*o+r*l*c,this.y=r*l*o-a*s*c,this.z=r*s*c+a*l*o,this.w=r*s*o-a*l*c):"YXZ"===i?(this.x=a*s*o+r*l*c,this.y=r*l*o-a*s*c,this.z=r*s*c-a*l*o,this.w=r*s*o+a*l*c):"ZXY"===i?(this.x=a*s*o-r*l*c,this.y=r*l*o+a*s*c,this.z=r*s*c+a*l*o,this.w=r*s*o-a*l*c):"ZYX"===i?(this.x=a*s*o-r*l*c,this.y=r*l*o+a*s*c,this.z=r*s*c-a*l*o,this.w=r*s*o+a*l*c):"YZX"===i?(this.x=a*s*o+r*l*c,this.y=r*l*o+a*s*c,this.z=r*s*c-a*l*o,this.w=r*s*o-a*l*c):"XZY"===i&&(this.x=a*s*o-r*l*c,this.y=r*l*o-a*s*c,this.z=r*s*c+a*l*o,this.w=r*s*o+a*l*c),this}clone(){return new dw(this.x,this.y,this.z,this.w)}slerp(t,e,n){void 0===n&&(n=new dw);const i=this.x,r=this.y,s=this.z,o=this.w;let a,l,c,u,h,d=t.x,p=t.y,f=t.z,m=t.w;return l=i*d+r*p+s*f+o*m,l<0&&(l=-l,d=-d,p=-p,f=-f,m=-m),1-l>1e-6?(a=Math.acos(l),c=Math.sin(a),u=Math.sin((1-e)*a)/c,h=Math.sin(e*a)/c):(u=1-e,h=e),n.x=u*i+h*d,n.y=u*r+h*p,n.z=u*s+h*f,n.w=u*o+h*m,n}integrate(t,e,n,i){void 0===i&&(i=new dw);const r=t.x*n.x,s=t.y*n.y,o=t.z*n.z,a=this.x,l=this.y,c=this.z,u=this.w,h=.5*e;return i.x+=h*(r*u+s*c-o*l),i.y+=h*(s*u+o*a-r*c),i.z+=h*(o*u+r*l-s*a),i.w+=h*(-r*a-s*l-o*c),i}}const pw=new iw,fw=new iw;class mw{constructor(t){void 0===t&&(t={}),this.id=mw.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,e){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,e,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}mw.idCounter=0,mw.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class gw{constructor(t){void 0===t&&(t={}),this.position=new iw,this.quaternion=new dw,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return gw.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return gw.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e){return void 0===e&&(e=new iw),this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,n,i){return void 0===i&&(i=new iw),n.vsub(t,i),e.conjugate(vw),vw.vmult(i,i),i}static pointToWorldFrame(t,e,n,i){return void 0===i&&(i=new iw),e.vmult(n,i),i.vadd(t,i),i}static vectorToWorldFrame(t,e,n){return void 0===n&&(n=new iw),t.vmult(e,n),n}static vectorToLocalFrame(t,e,n,i){return void 0===i&&(i=new iw),e.w*=-1,e.vmult(n,i),e.w*=-1,i}}const vw=new dw;class yw extends mw{constructor(t){void 0===t&&(t={});const{vertices:e=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:s}=t;super({type:mw.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const t=this.faces,e=this.vertices,n=this.uniqueEdges;n.length=0;const i=new iw;for(let r=0;r!==t.length;r++){const s=t[r],o=s.length;for(let t=0;t!==o;t++){const r=(t+1)%o;e[s[t]].vsub(e[s[r]],i),i.normalize();let a=!1;for(let t=0;t!==n.length;t++)if(n[t].almostEquals(i)||n[t].almostEquals(i)){a=!0;break}a||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let i=0;i<this.faces[t].length;i++)if(!this.vertices[this.faces[t][i]])throw new Error(`Vertex ${this.faces[t][i]} not found!`);const e=this.faceNormals[t]||new iw;this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e;const n=this.vertices[this.faces[t][0]];if(e.dot(n)<0)for(let i=0;i<this.faces[t].length;i++);}}getFaceNormal(t,e){const n=this.faces[t],i=this.vertices[n[0]],r=this.vertices[n[1]],s=this.vertices[n[2]];yw.computeNormal(i,r,s,e)}static computeNormal(t,e,n,i){const r=new iw,s=new iw;e.vsub(t,s),n.vsub(e,r),r.cross(s,i),i.isZero()||i.normalize()}clipAgainstHull(t,e,n,i,r,s,o,a,l){const c=new iw;let u=-1,h=-Number.MAX_VALUE;for(let p=0;p<n.faces.length;p++){c.copy(n.faceNormals[p]),r.vmult(c,c);const t=c.dot(s);t>h&&(h=t,u=p)}const d=[];for(let p=0;p<n.faces[u].length;p++){const t=n.vertices[n.faces[u][p]],e=new iw;e.copy(t),r.vmult(e,e),i.vadd(e,e),d.push(e)}u>=0&&this.clipFaceAgainstHull(s,t,e,d,o,a,l)}findSeparatingAxis(t,e,n,i,r,s,o,a){const l=new iw,c=new iw,u=new iw,h=new iw,d=new iw,p=new iw;let f=Number.MAX_VALUE;const m=this;if(m.uniqueAxes)for(let g=0;g!==m.uniqueAxes.length;g++){n.vmult(m.uniqueAxes[g],l);const o=m.testSepAxis(l,t,e,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(l))}else{const a=o?o.length:m.faces.length;for(let c=0;c<a;c++){const a=o?o[c]:c;l.copy(m.faceNormals[a]),n.vmult(l,l);const u=m.testSepAxis(l,t,e,n,i,r);if(!1===u)return!1;u<f&&(f=u,s.copy(l))}}if(t.uniqueAxes)for(let g=0;g!==t.uniqueAxes.length;g++){r.vmult(t.uniqueAxes[g],c);const o=m.testSepAxis(c,t,e,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(c))}else{const o=a?a.length:t.faces.length;for(let l=0;l<o;l++){const o=a?a[l]:l;c.copy(t.faceNormals[o]),r.vmult(c,c);const u=m.testSepAxis(c,t,e,n,i,r);if(!1===u)return!1;u<f&&(f=u,s.copy(c))}}for(let g=0;g!==m.uniqueEdges.length;g++){n.vmult(m.uniqueEdges[g],h);for(let o=0;o!==t.uniqueEdges.length;o++)if(r.vmult(t.uniqueEdges[o],d),h.cross(d,p),!p.almostZero()){p.normalize();const o=m.testSepAxis(p,t,e,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(p))}}return i.vsub(e,u),u.dot(s)>0&&s.negate(s),!0}testSepAxis(t,e,n,i,r,s){yw.project(this,t,n,i,_w),yw.project(e,t,r,s,bw);const o=_w[0],a=_w[1],l=bw[0],c=bw[1];if(o<c||l<a)return!1;const u=o-c,h=l-a;return u<h?u:h}calculateLocalInertia(t,e){const n=new iw,i=new iw;this.computeLocalAABB(i,n);const r=n.x-i.x,s=n.y-i.y,o=n.z-i.z;e.x=1/12*t*(2*s*2*s+2*o*2*o),e.y=1/12*t*(2*r*2*r+2*o*2*o),e.z=1/12*t*(2*s*2*s+2*r*2*r)}getPlaneConstantOfFace(t){const e=this.faces[t],n=this.faceNormals[t],i=this.vertices[e[0]];return-n.dot(i)}clipFaceAgainstHull(t,e,n,i,r,s,o){const a=new iw,l=new iw,c=new iw,u=new iw,h=new iw,d=new iw,p=new iw,f=new iw,m=this,g=i,v=[];let y=-1,_=Number.MAX_VALUE;for(let M=0;M<m.faces.length;M++){a.copy(m.faceNormals[M]),n.vmult(a,a);const e=a.dot(t);e<_&&(_=e,y=M)}if(y<0)return;const b=m.faces[y];b.connectedFaces=[];for(let M=0;M<m.faces.length;M++)for(let t=0;t<m.faces[M].length;t++)-1!==b.indexOf(m.faces[M][t])&&M!==y&&-1===b.connectedFaces.indexOf(M)&&b.connectedFaces.push(M);const x=b.length;for(let M=0;M<x;M++){const t=m.vertices[b[M]],i=m.vertices[b[(M+1)%x]];t.vsub(i,l),c.copy(l),n.vmult(c,c),e.vadd(c,c),u.copy(this.faceNormals[y]),n.vmult(u,u),e.vadd(u,u),c.cross(u,h),h.negate(h),d.copy(t),n.vmult(d,d),e.vadd(d,d);const r=b.connectedFaces[M];p.copy(this.faceNormals[r]);const s=this.getPlaneConstantOfFace(r);f.copy(p),n.vmult(f,f);const o=s-f.dot(e);for(this.clipFaceAgainstPlane(g,v,f,o);g.length;)g.shift();for(;v.length;)g.push(v.shift())}p.copy(this.faceNormals[y]);const w=this.getPlaneConstantOfFace(y);f.copy(p),n.vmult(f,f);const S=w-f.dot(e);for(let M=0;M<g.length;M++){let t=f.dot(g[M])+S;if(t<=r&&(t=r),t<=s){const e=g[M];if(t<=1e-6){const n={point:e,normal:f,depth:t};o.push(n)}}}}clipFaceAgainstPlane(t,e,n,i){let r,s;const o=t.length;if(o<2)return e;let a=t[t.length-1],l=t[0];r=n.dot(a)+i;for(let c=0;c<o;c++){if(l=t[c],s=n.dot(l)+i,r<0)if(s<0){const t=new iw;t.copy(l),e.push(t)}else{const t=new iw;a.lerp(l,r/(r-s),t),e.push(t)}else if(s<0){const t=new iw;a.lerp(l,r/(r-s),t),e.push(t),e.push(l)}a=l,r=s}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new iw);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)e.vmult(n[r],i[r]),t.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){const n=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<t.x?t.x=r.x:r.x>e.x&&(e.x=r.x),r.y<t.y?t.y=r.y:r.y>e.y&&(e.y=r.y),r.z<t.z?t.z=r.z:r.z>e.z&&(e.z=r.z)}}computeWorldFaceNormals(t){const e=this.faceNormals.length;for(;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new iw);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==e;r++)t.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;const e=this.vertices;for(let n=0;n!==e.length;n++){const i=e[n].lengthSquared();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,i){const r=this.vertices;let s,o,a,l,c,u,h=new iw;for(let d=0;d<r.length;d++){h.copy(r[d]),e.vmult(h,h),t.vadd(h,h);const n=h;(void 0===s||n.x<s)&&(s=n.x),(void 0===l||n.x>l)&&(l=n.x),(void 0===o||n.y<o)&&(o=n.y),(void 0===c||n.y>c)&&(c=n.y),(void 0===a||n.z<a)&&(a=n.z),(void 0===u||n.z>u)&&(u=n.z)}n.set(s,o,a),i.set(l,c,u)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){void 0===t&&(t=new iw);const e=this.vertices;for(let n=0;n<e.length;n++)t.vadd(e[n],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){const n=this.vertices.length,i=this.vertices;if(e){for(let t=0;t<n;t++){const n=i[t];e.vmult(n,n)}for(let t=0;t<this.faceNormals.length;t++){const n=this.faceNormals[t];e.vmult(n,n)}}if(t)for(let r=0;r<n;r++){const e=i[r];e.vadd(t,e)}}pointIsInside(t){const e=this.vertices,n=this.faces,i=this.faceNormals,r=new iw;this.getAveragePointLocal(r);for(let s=0;s<this.faces.length;s++){let o=i[s];const a=e[n[s][0]],l=new iw;t.vsub(a,l);const c=o.dot(l),u=new iw;r.vsub(a,u);const h=o.dot(u);if(c<0&&h>0||c>0&&h<0)return!1}return-1}static project(t,e,n,i,r){const s=t.vertices.length,o=xw;let a=0,l=0;const c=ww,u=t.vertices;c.setZero(),gw.vectorToLocalFrame(n,i,e,o),gw.pointToLocalFrame(n,i,c,c);const h=c.dot(o);l=a=u[0].dot(o);for(let d=1;d<s;d++){const t=u[d].dot(o);t>a&&(a=t),t<l&&(l=t)}if(l-=h,a-=h,l>a){const t=l;l=a,a=t}r[0]=a,r[1]=l}}const _w=[],bw=[];new iw;const xw=new iw,ww=new iw;class Sw extends mw{constructor(t){super({type:mw.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=iw,r=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],s=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],o=new yw({vertices:r,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:s});this.convexPolyhedronRepresentation=o,o.material=this.material}calculateLocalInertia(t,e){return void 0===e&&(e=new iw),Sw.calculateInertia(this.halfExtents,t,e),e}static calculateInertia(t,e,n){const i=t;n.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(t,e){const n=t,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==e)for(let r=0;r!==n.length;r++)e.vmult(n[r],n[r]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let s=0;s<r.length;s++)Mw.set(r[s][0],r[s][1],r[s][2]),e.vmult(Mw,Mw),t.vadd(Mw,Mw),n(Mw.x,Mw.y,Mw.z)}calculateWorldAABB(t,e,n,i){const r=this.halfExtents;Cw[0].set(r.x,r.y,r.z),Cw[1].set(-r.x,r.y,r.z),Cw[2].set(-r.x,-r.y,r.z),Cw[3].set(-r.x,-r.y,-r.z),Cw[4].set(r.x,-r.y,-r.z),Cw[5].set(r.x,r.y,-r.z),Cw[6].set(-r.x,r.y,-r.z),Cw[7].set(r.x,-r.y,r.z);const s=Cw[0];e.vmult(s,s),t.vadd(s,s),i.copy(s),n.copy(s);for(let o=1;o<8;o++){const r=Cw[o];e.vmult(r,r),t.vadd(r,r);const s=r.x,a=r.y,l=r.z;s>i.x&&(i.x=s),a>i.y&&(i.y=a),l>i.z&&(i.z=l),s<n.x&&(n.x=s),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}const Mw=new iw,Cw=[new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw],Aw=1,Tw=2,Ew=4,Iw=0,Rw=1,Nw=2;class Dw extends hw{constructor(t){void 0===t&&(t={}),super(),this.id=Dw.idCounter++,this.index=-1,this.world=null,this.vlambda=new iw,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof t.collisionResponse||t.collisionResponse,this.position=new iw,this.previousPosition=new iw,this.interpolatedPosition=new iw,this.initPosition=new iw,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new iw,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new iw,this.force=new iw;const e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?Dw.STATIC:Dw.DYNAMIC,typeof t.type==typeof Dw.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=Dw.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new iw,this.quaternion=new dw,this.initQuaternion=new dw,this.previousQuaternion=new dw,this.interpolatedQuaternion=new dw,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new iw,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new iw,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new iw,this.invInertia=new iw,this.invInertiaWorld=new ew,this.invMassSolve=0,this.invInertiaSolve=new iw,this.invInertiaWorldSolve=new ew,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new iw(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new iw(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new aw,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new iw,this.isTrigger=Boolean(t.isTrigger),t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){const t=this.sleepState;this.sleepState=Dw.AWAKE,this.wakeUpAfterNarrowphase=!1,t===Dw.SLEEPING&&this.dispatchEvent(Dw.wakeupEvent)}sleep(){this.sleepState=Dw.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){if(this.allowSleep){const e=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;e===Dw.AWAKE&&n<i?(this.sleepState=Dw.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(Dw.sleepyEvent)):e===Dw.SLEEPY&&n>i?this.wakeUp():e===Dw.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Dw.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Dw.SLEEPING||this.type===Dw.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e){return void 0===e&&(e=new iw),t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e){return void 0===e&&(e=new iw),this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e){return void 0===e&&(e=new iw),this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e){return void 0===e&&(e=new iw),this.quaternion.vmult(t,e),e}addShape(t,e,n){const i=new iw,r=new dw;return e&&i.copy(e),n&&r.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this}removeShape(t){const e=this.shapes.indexOf(t);return-1===e||(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=null),this}updateBoundingRadius(){const t=this.shapes,e=this.shapeOffsets,n=t.length;let i=0;for(let r=0;r!==n;r++){const n=t[r];n.updateBoundingSphereRadius();const s=e[r].length(),o=n.boundingSphereRadius;s+o>i&&(i=s+o)}this.boundingRadius=i}updateAABB(){const t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,r=Lw,s=Ow,o=this.quaternion,a=this.aabb,l=kw;for(let c=0;c!==i;c++){const i=t[c];o.vmult(e[c],r),r.vadd(this.position,r),o.mult(n[c],s),i.calculateWorldAABB(r,s,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){const e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){const t=Pw,n=Fw;t.setRotationFromQuaternion(this.quaternion),t.transpose(n),t.scale(e,t),t.mmult(n,this.invInertiaWorld)}else;}applyForce(t,e){if(void 0===e&&(e=new iw),this.type!==Dw.DYNAMIC)return;this.sleepState===Dw.SLEEPING&&this.wakeUp();const n=Bw;e.cross(t,n),this.force.vadd(t,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(t,e){if(void 0===e&&(e=new iw),this.type!==Dw.DYNAMIC)return;const n=zw,i=Uw;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,i),this.applyForce(n,i)}applyTorque(t){this.type===Dw.DYNAMIC&&(this.sleepState===Dw.SLEEPING&&this.wakeUp(),this.torque.vadd(t,this.torque))}applyImpulse(t,e){if(void 0===e&&(e=new iw),this.type!==Dw.DYNAMIC)return;this.sleepState===Dw.SLEEPING&&this.wakeUp();const n=e,i=Vw;i.copy(t),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=Ww;n.cross(t,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(t,e){if(void 0===e&&(e=new iw),this.type!==Dw.DYNAMIC)return;const n=Gw,i=Hw;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,i),this.applyImpulse(n,i)}updateMassProperties(){const t=jw;this.invMass=this.mass>0?1/this.mass:0;const e=this.inertia,n=this.fixedRotation;this.updateAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Sw.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){const n=new iw;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}integrate(t,e,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Dw.DYNAMIC&&this.type!==Dw.KINEMATIC||this.sleepState===Dw.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,s=this.position,o=this.force,a=this.torque,l=this.quaternion,c=this.invMass,u=this.invInertiaWorld,h=this.linearFactor,d=c*t;i.x+=o.x*d*h.x,i.y+=o.y*d*h.y,i.z+=o.z*d*h.z;const p=u.elements,f=this.angularFactor,m=a.x*f.x,g=a.y*f.y,v=a.z*f.z;r.x+=t*(p[0]*m+p[1]*g+p[2]*v),r.y+=t*(p[3]*m+p[4]*g+p[5]*v),r.z+=t*(p[6]*m+p[7]*g+p[8]*v),s.x+=i.x*t,s.y+=i.y*t,s.z+=i.z*t,l.integrate(this.angularVelocity,t,this.angularFactor,l),e&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Dw.idCounter=0,Dw.COLLIDE_EVENT_NAME="collide",Dw.DYNAMIC=Aw,Dw.STATIC=Tw,Dw.KINEMATIC=Ew,Dw.AWAKE=Iw,Dw.SLEEPY=Rw,Dw.SLEEPING=Nw,Dw.wakeupEvent={type:"wakeup"},Dw.sleepyEvent={type:"sleepy"},Dw.sleepEvent={type:"sleep"};const Lw=new iw,Ow=new dw,kw=new aw,Pw=new ew,Fw=new ew,Bw=(new ew,new iw),zw=new iw,Uw=new iw,Vw=new iw,Ww=new iw,Gw=new iw,Hw=new iw,jw=new iw;class qw{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return!!(t.collisionFilterGroup&e.collisionFilterMask&&e.collisionFilterGroup&t.collisionFilterMask)&&(!(t.type&Dw.STATIC||t.sleepState===Dw.SLEEPING)||!(e.type&Dw.STATIC||e.sleepState===Dw.SLEEPING))}intersectionTest(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)}doBoundingSphereBroadphase(t,e,n,i){const r=Xw;e.position.vsub(t.position,r);const s=(t.boundingRadius+e.boundingRadius)**2;r.lengthSquared()<s&&(n.push(t),i.push(e))}doBoundingBoxBroadphase(t,e,n,i){t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))}makePairsUnique(t,e){const n=Yw,i=Zw,r=Kw,s=t.length;for(let o=0;o!==s;o++)i[o]=t[o],r[o]=e[o];t.length=0,e.length=0;for(let o=0;o!==s;o++){const t=i[o].id,e=r[o].id,s=t<e?`${t},${e}`:`${e},${t}`;n[s]=o,n.keys.push(s)}for(let o=0;o!==n.keys.length;o++){const s=n.keys.pop(),o=n[s];t.push(i[o]),e.push(r[o]),delete n[s]}}setWorld(t){}static boundingSphereCheck(t,e){const n=new iw;t.position.vsub(e.position,n);const i=t.shapes[0],r=e.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(t,e,n){return[]}}const Xw=new iw;new iw,new dw,new iw;const Yw={keys:[]},Zw=[],Kw=[];new iw,new iw,new iw;class $w extends qw{constructor(){super()}collisionPairs(t,e,n){const i=t.bodies,r=i.length;let s,o;for(let a=0;a!==r;a++)for(let t=0;t!==a;t++)s=i[a],o=i[t],this.needBroadphaseCollision(s,o)&&this.intersectionTest(s,o,e,n)}aabbQuery(t,e,n){void 0===n&&(n=[]);for(let i=0;i<t.bodies.length;i++){const r=t.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}}class Jw{constructor(){this.rayFromWorld=new iw,this.rayToWorld=new iw,this.hitNormalWorld=new iw,this.hitPointWorld=new iw,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,n,i,r,s,o){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=s,this.distance=o}}let Qw,tS,eS,nS,iS,rS,sS;const oS=1,aS=2,lS=4;Qw=mw.types.SPHERE,tS=mw.types.PLANE,eS=mw.types.BOX,nS=mw.types.CYLINDER,iS=mw.types.CONVEXPOLYHEDRON,rS=mw.types.HEIGHTFIELD,sS=mw.types.TRIMESH;class cS{get[Qw](){return this._intersectSphere}get[tS](){return this._intersectPlane}get[eS](){return this._intersectBox}get[nS](){return this._intersectConvex}get[iS](){return this._intersectConvex}get[rS](){return this._intersectHeightfield}get[sS](){return this._intersectTrimesh}constructor(t,e){void 0===t&&(t=new iw),void 0===e&&(e=new iw),this.from=t.clone(),this.to=e.clone(),this.direction=new iw,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=cS.ANY,this.result=new Jw,this.hasHit=!1,this.callback=t=>{}}intersectWorld(t,e){return this.mode=e.mode||cS.ANY,this.result=e.result||new Jw,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(uS),hS.length=0,t.broadphase.aabbQuery(t,uS,hS),this.intersectBodies(hS),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!t.collisionResponse)return;if(!(this.collisionFilterGroup&t.collisionFilterMask&&t.collisionFilterGroup&this.collisionFilterMask))return;const i=fS,r=mS;for(let s=0,o=t.shapes.length;s<o;s++){const e=t.shapes[s];if((!n||e.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[s],r),t.quaternion.vmult(t.shapeOffsets[s],i),i.vadd(t.position,i),this.intersectShape(e,r,i,t),this.result.shouldStop))break}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let n=0,i=t.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(t[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,n,i){const r=function(t,e,n){n.vsub(t,PS);const i=PS.dot(e);e.scale(i,FS),FS.vadd(t,FS);const r=n.distanceTo(FS);return r}(this.from,this.direction,n);if(r>t.boundingSphereRadius)return;const s=this[t.type];s&&s.call(this,t,e,n,i,t)}_intersectBox(t,e,n,i,r){return this._intersectConvex(t.convexPolyhedronRepresentation,e,n,i,r)}_intersectPlane(t,e,n,i,r){const s=this.from,o=this.to,a=this.direction,l=new iw(0,0,1);e.vmult(l,l);const c=new iw;s.vsub(n,c);const u=c.dot(l);o.vsub(n,c);if(u*c.dot(l)>0)return;if(s.distanceTo(o)<u)return;const h=l.dot(a);if(Math.abs(h)<this.precision)return;const d=new iw,p=new iw,f=new iw;s.vsub(n,d);const m=-l.dot(d)/h;a.scale(m,p),s.vadd(p,f),this.reportIntersection(l,f,r,i,-1)}getAABB(t){const{lowerBound:e,upperBound:n}=t,i=this.to,r=this.from;e.x=Math.min(i.x,r.x),e.y=Math.min(i.y,r.y),e.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(t,e,n,i,r){t.data,t.elementSize;const s=wS;s.from.copy(this.from),s.to.copy(this.to),gw.pointToLocalFrame(n,e,s.from,s.from),gw.pointToLocalFrame(n,e,s.to,s.to),s.updateDirection();const o=SS;let a,l,c,u;a=l=0,c=u=t.data.length-1;const h=new aw;s.getAABB(h),t.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,o,!0),a=Math.max(a,o[0]),l=Math.max(l,o[1]),t.getIndexOfPosition(h.upperBound.x,h.upperBound.y,o,!0),c=Math.min(c,o[0]+1),u=Math.min(u,o[1]+1);for(let d=a;d<c;d++)for(let o=l;o<u;o++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(d,o,h),h.overlapsRay(s)){if(t.getConvexTrianglePillar(d,o,!1),gw.pointToWorldFrame(n,e,t.pillarOffset,xS),this._intersectConvex(t.pillarConvex,e,xS,i,r,bS),this.result.shouldStop)return;t.getConvexTrianglePillar(d,o,!0),gw.pointToWorldFrame(n,e,t.pillarOffset,xS),this._intersectConvex(t.pillarConvex,e,xS,i,r,bS)}}}_intersectSphere(t,e,n,i,r){const s=this.from,o=this.to,a=t.radius,l=(o.x-s.x)**2+(o.y-s.y)**2+(o.z-s.z)**2,c=2*((o.x-s.x)*(s.x-n.x)+(o.y-s.y)*(s.y-n.y)+(o.z-s.z)*(s.z-n.z)),u=c**2-4*l*((s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-a**2),h=MS,d=CS;if(!(u<0))if(0===u)s.lerp(o,u,h),h.vsub(n,d),d.normalize(),this.reportIntersection(d,h,r,i,-1);else{const t=(-c-Math.sqrt(u))/(2*l),e=(-c+Math.sqrt(u))/(2*l);if(t>=0&&t<=1&&(s.lerp(o,t,h),h.vsub(n,d),d.normalize(),this.reportIntersection(d,h,r,i,-1)),this.result.shouldStop)return;e>=0&&e<=1&&(s.lerp(o,e,h),h.vsub(n,d),d.normalize(),this.reportIntersection(d,h,r,i,-1))}}_intersectConvex(t,e,n,i,r,s){const o=AS,a=TS,l=s&&s.faceList||null,c=t.faces,u=t.vertices,h=t.faceNormals,d=this.direction,p=this.from,f=this.to,m=p.distanceTo(f),g=l?l.length:c.length,v=this.result;for(let y=0;!v.shouldStop&&y<g;y++){const t=l?l[y]:y,s=c[t],f=h[t],g=e,_=n;a.copy(u[s[0]]),g.vmult(a,a),a.vadd(_,a),a.vsub(p,a),g.vmult(f,o);const b=d.dot(o);if(Math.abs(b)<this.precision)continue;const x=o.dot(a)/b;if(!(x<0)){d.scale(x,gS),gS.vadd(p,gS),vS.copy(u[s[0]]),g.vmult(vS,vS),_.vadd(vS,vS);for(let e=1;!v.shouldStop&&e<s.length-1;e++){yS.copy(u[s[e]]),_S.copy(u[s[e+1]]),g.vmult(yS,yS),g.vmult(_S,_S),_.vadd(yS,yS),_.vadd(_S,_S);const n=gS.distanceTo(p);!cS.pointInTriangle(gS,vS,yS,_S)&&!cS.pointInTriangle(gS,yS,vS,_S)||n>m||this.reportIntersection(o,gS,r,i,t)}}}}_intersectTrimesh(t,e,n,i,r,s){const o=ES,a=OS,l=kS,c=TS,u=IS,h=RS,d=NS,p=LS,f=DS,m=t.indices;t.vertices;const g=this.from,v=this.to,y=this.direction;l.position.copy(n),l.quaternion.copy(e),gw.vectorToLocalFrame(n,e,y,u),gw.pointToLocalFrame(n,e,g,h),gw.pointToLocalFrame(n,e,v,d),d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,h.x*=t.scale.x,h.y*=t.scale.y,h.z*=t.scale.z,d.vsub(h,u),u.normalize();const _=h.distanceSquared(d);t.tree.rayQuery(this,l,a);for(let b=0,x=a.length;!this.result.shouldStop&&b!==x;b++){const s=a[b];t.getNormal(s,o),t.getVertex(m[3*s],vS),vS.vsub(h,c);const l=u.dot(o),d=o.dot(c)/l;if(d<0)continue;u.scale(d,gS),gS.vadd(h,gS),t.getVertex(m[3*s+1],yS),t.getVertex(m[3*s+2],_S);const g=gS.distanceSquared(h);!cS.pointInTriangle(gS,yS,vS,_S)&&!cS.pointInTriangle(gS,vS,yS,_S)||g>_||(gw.vectorToWorldFrame(e,o,f),gw.pointToWorldFrame(n,e,gS,p),this.reportIntersection(f,p,r,i,s))}a.length=0}reportIntersection(t,e,n,i,r){const s=this.from,o=this.to,a=s.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case cS.ALL:this.hasHit=!0,l.set(s,o,t,e,n,i,a),l.hasHit=!0,this.callback(l);break;case cS.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,i,a));break;case cS.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,i,a),l.shouldStop=!0}}static pointInTriangle(t,e,n,i){i.vsub(e,PS),n.vsub(e,dS),t.vsub(e,pS);const r=PS.dot(PS),s=PS.dot(dS),o=PS.dot(pS),a=dS.dot(dS),l=dS.dot(pS);let c,u;return(c=a*o-s*l)>=0&&(u=r*l-s*o)>=0&&c+u<r*a-s*s}}cS.CLOSEST=oS,cS.ANY=aS,cS.ALL=lS;const uS=new aw,hS=[],dS=new iw,pS=new iw,fS=new iw,mS=new dw,gS=new iw,vS=new iw,yS=new iw,_S=new iw;new iw,new Jw;const bS={faceList:[0]},xS=new iw,wS=new cS,SS=[],MS=new iw,CS=new iw,AS=new iw;new iw,new iw;const TS=new iw,ES=new iw,IS=new iw,RS=new iw,NS=new iw,DS=new iw,LS=new iw;new aw;const OS=[],kS=new gw,PS=new iw,FS=new iw;class BS extends qw{static checkBounds(t,e,n){let i,r;0===n?(i=t.position.x,r=e.position.x):1===n?(i=t.position.y,r=e.position.y):2===n&&(i=t.position.z,r=e.position.z);const s=t.boundingRadius;return r-e.boundingRadius<i+s}static insertionSortX(t){for(let e=1,n=t.length;e<n;e++){const n=t[e];let i;for(i=e-1;i>=0&&!(t[i].aabb.lowerBound.x<=n.aabb.lowerBound.x);i--)t[i+1]=t[i];t[i+1]=n}return t}static insertionSortY(t){for(let e=1,n=t.length;e<n;e++){const n=t[e];let i;for(i=e-1;i>=0&&!(t[i].aabb.lowerBound.y<=n.aabb.lowerBound.y);i--)t[i+1]=t[i];t[i+1]=n}return t}static insertionSortZ(t){for(let e=1,n=t.length;e<n;e++){const n=t[e];let i;for(i=e-1;i>=0&&!(t[i].aabb.lowerBound.z<=n.aabb.lowerBound.z);i--)t[i+1]=t[i];t[i+1]=n}return t}constructor(t){super(),this.axisList=[],this.world=null,this.axisIndex=0;const e=this.axisList;this._addBodyHandler=t=>{e.push(t.body)},this._removeBodyHandler=t=>{const n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}setWorld(t){this.axisList.length=0;for(let e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0}collisionPairs(t,e,n){const i=this.axisList,r=i.length,s=this.axisIndex;let o,a;for(this.dirty&&(this.sortList(),this.dirty=!1),o=0;o!==r;o++){const t=i[o];for(a=o+1;a<r;a++){const r=i[a];if(this.needBroadphaseCollision(t,r)){if(!BS.checkBounds(t,r,s))break;this.intersectionTest(t,r,e,n)}}}}sortList(){const t=this.axisList,e=this.axisIndex,n=t.length;for(let i=0;i!==n;i++){const e=t[i];e.aabbNeedsUpdate&&e.updateAABB()}0===e?BS.insertionSortX(t):1===e?BS.insertionSortY(t):2===e&&BS.insertionSortZ(t)}autoDetectAxis(){let t=0,e=0,n=0,i=0,r=0,s=0;const o=this.axisList,a=o.length,l=1/a;for(let d=0;d!==a;d++){const a=o[d],l=a.position.x;t+=l,e+=l*l;const c=a.position.y;n+=c,i+=c*c;const u=a.position.z;r+=u,s+=u*u}const c=e-t*t*l,u=i-n*n*l,h=s-r*r*l;this.axisIndex=c>u?c>h?0:2:u>h?1:2}aabbQuery(t,e,n){void 0===n&&(n=[]),this.dirty&&(this.sortList(),this.dirty=!1);const i=this.axisIndex;let r="x";1===i&&(r="y"),2===i&&(r="z");const s=this.axisList;e.lowerBound[r],e.upperBound[r];for(let o=0;o<s.length;o++){const t=s[o];t.aabbNeedsUpdate&&t.updateAABB(),t.aabb.overlaps(e)&&n.push(t)}return n}}class zS{static defaults(t,e){void 0===t&&(t={});for(let n in e)n in t||(t[n]=e[n]);return t}}class US{constructor(t,e,n){void 0===n&&(n={}),n=zS.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=US.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}US.idCounter=0;class VS{constructor(){this.spatial=new iw,this.rotational=new iw}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class WS{constructor(t,e,n,i){void 0===n&&(n=-1e6),void 0===i&&(i=1e6),this.id=WS.idCounter++,this.minForce=n,this.maxForce=i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new VS,this.jacobianElementB=new VS,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,n){const i=e,r=t,s=n;this.a=4/(s*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(s*s*r*(1+4*i))}computeB(t,e,n){const i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*n}computeGq(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,s=i.position;return t.spatial.dot(r)+e.spatial.dot(s)}computeGW(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,s=i.velocity,o=n.angularVelocity,a=i.angularVelocity;return t.multiplyVectors(r,o)+e.multiplyVectors(s,a)}computeGWlambda(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,s=i.vlambda,o=n.wlambda,a=i.wlambda;return t.multiplyVectors(r,o)+e.multiplyVectors(s,a)}computeGiMf(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,s=n.torque,o=i.force,a=i.torque,l=n.invMassSolve,c=i.invMassSolve;return r.scale(l,GS),o.scale(c,HS),n.invInertiaWorldSolve.vmult(s,jS),i.invInertiaWorldSolve.vmult(a,qS),t.multiplyVectors(GS,jS)+e.multiplyVectors(HS,qS)}computeGiMGt(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,s=i.invMassSolve,o=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve;let l=r+s;return o.vmult(t.rotational,XS),l+=XS.dot(t.rotational),a.vmult(e.rotational,XS),l+=XS.dot(e.rotational),l}addToWlambda(t){const e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,s=YS;i.vlambda.addScaledVector(i.invMassSolve*t,e.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*t,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(e.rotational,s),i.wlambda.addScaledVector(t,s,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,s),r.wlambda.addScaledVector(t,s,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}WS.idCounter=0;const GS=new iw,HS=new iw,jS=new iw,qS=new iw,XS=new iw,YS=new iw;class ZS extends WS{constructor(t,e,n){void 0===n&&(n=1e6),super(t,e,0,n),this.restitution=0,this.ri=new iw,this.rj=new iw,this.ni=new iw}computeB(t){const e=this.a,n=this.b,i=this.bi,r=this.bj,s=this.ri,o=this.rj,a=KS,l=$S,c=i.velocity,u=i.angularVelocity;i.force,i.torque;const h=r.velocity,d=r.angularVelocity;r.force,r.torque;const p=JS,f=this.jacobianElementA,m=this.jacobianElementB,g=this.ni;s.cross(g,a),o.cross(g,l),g.negate(f.spatial),a.negate(f.rotational),m.spatial.copy(g),m.rotational.copy(l),p.copy(r.position),p.vadd(o,p),p.vsub(i.position,p),p.vsub(s,p);const v=g.dot(p),y=this.restitution+1;return-v*e-(y*h.dot(g)-y*c.dot(g)+d.dot(l)-u.dot(a))*n-t*this.computeGiMf()}getImpactVelocityAlongNormal(){const t=QS,e=tM,n=eM,i=nM,r=iM;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,r),this.ni.dot(r)}}const KS=new iw,$S=new iw,JS=new iw,QS=new iw,tM=new iw,eM=new iw,nM=new iw,iM=new iw;class rM extends US{constructor(t,e,n,i,r){void 0===e&&(e=new iw),void 0===i&&(i=new iw),void 0===r&&(r=1e6),super(t,n),this.pivotA=e.clone(),this.pivotB=i.clone();const s=this.equationX=new ZS(t,n),o=this.equationY=new ZS(t,n),a=this.equationZ=new ZS(t,n);this.equations.push(s,o,a),s.minForce=o.minForce=a.minForce=-r,s.maxForce=o.maxForce=a.maxForce=r,s.ni.set(1,0,0),o.ni.set(0,1,0),a.ni.set(0,0,1)}update(){const t=this.bodyA,e=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}}new iw,new iw;class sM extends WS{constructor(t,e,n){void 0===n&&(n={});const i=void 0!==n.maxForce?n.maxForce:1e6;super(t,e,-i,i),this.axisA=n.axisA?n.axisA.clone():new iw(1,0,0),this.axisB=n.axisB?n.axisB.clone():new iw(0,1,0),this.maxAngle=Math.PI/2}computeB(t){const e=this.a,n=this.b,i=this.axisA,r=this.axisB,s=oM,o=aM,a=this.jacobianElementA,l=this.jacobianElementB;i.cross(r,s),r.cross(i,o),a.rotational.copy(o),l.rotational.copy(s);return-(Math.cos(this.maxAngle)-i.dot(r))*e-this.computeGW()*n-t*this.computeGiMf()}}const oM=new iw,aM=new iw;new iw,new iw,new iw,new iw;class lM extends WS{constructor(t,e,n){void 0===n&&(n=1e6),super(t,e,-n,n),this.axisA=new iw,this.axisB=new iw,this.targetVelocity=0}computeB(t){this.a;const e=this.b;this.bi,this.bj;const n=this.axisA,i=this.axisB,r=this.jacobianElementA,s=this.jacobianElementB;r.rotational.copy(n),i.negate(s.rotational);return-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}}class cM extends rM{constructor(t,e,n){void 0===n&&(n={});const i=void 0!==n.maxForce?n.maxForce:1e6;super(t,n.pivotA?n.pivotA.clone():new iw,e,n.pivotB?n.pivotB.clone():new iw,i);(this.axisA=n.axisA?n.axisA.clone():new iw(1,0,0)).normalize();(this.axisB=n.axisB?n.axisB.clone():new iw(1,0,0)).normalize(),this.collideConnected=!!n.collideConnected;const r=this.rotationalEquation1=new sM(t,e,n),s=this.rotationalEquation2=new sM(t,e,n),o=this.motorEquation=new lM(t,e,i);o.enabled=!1,this.equations.push(r,s,o)}enableMotor(){this.motorEquation.enabled=!0}disableMotor(){this.motorEquation.enabled=!1}setMotorSpeed(t){this.motorEquation.targetVelocity=t}setMotorMaxForce(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t}update(){const t=this.bodyA,e=this.bodyB,n=this.motorEquation,i=this.rotationalEquation1,r=this.rotationalEquation2,s=uM,o=hM,a=this.axisA,l=this.axisB;super.update(),t.quaternion.vmult(a,s),e.quaternion.vmult(l,o),s.tangents(i.axisA,r.axisA),i.axisB.copy(o),r.axisB.copy(o),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}}const uM=new iw,hM=new iw;class dM extends WS{constructor(t,e,n){super(t,e,-n,n),this.ri=new iw,this.rj=new iw,this.t=new iw}computeB(t){this.a;const e=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=pM,s=fM,o=this.t;n.cross(o,r),i.cross(o,s);const a=this.jacobianElementA,l=this.jacobianElementB;o.negate(a.spatial),r.negate(a.rotational),l.spatial.copy(o),l.rotational.copy(s);return-this.computeGW()*e-t*this.computeGiMf()}}const pM=new iw,fM=new iw;class mM{constructor(t,e,n){n=zS.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=mM.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}mM.idCounter=0;class gM{constructor(t){void 0===t&&(t={});let e="";"string"==typeof t&&(e=t,t={}),this.name=e,this.id=gM.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}}gM.idCounter=0,new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw;class vM{constructor(t){void 0===t&&(t={}),t=zS.defaults(t,{chassisConnectionPointLocal:new iw,chassisConnectionPointWorld:new iw,directionLocal:new iw,directionWorld:new iw,axleLocal:new iw,axleWorld:new iw,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:10.5,forwardAcceleration:1,sideAcceleration:1,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.forwardAcceleration=t.forwardAcceleration,this.sideAcceleration=t.sideAcceleration,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.slipInfo=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new Jw,this.worldTransform=new gw,this.isInContact=!1}updateWheel(t){const e=this.raycastResult;if(this.isInContact){const n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,_M),t.getVelocityAtWorldPoint(_M,yM);const i=e.hitNormalWorld.dot(yM);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{const t=-1/n;this.suspensionRelativeVelocity=i*t,this.clippedInvContactDotSuspension=t}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}}const yM=new iw,_M=new iw;class bM{constructor(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:2,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:1,this.constraints=[],this.preStepCallback=()=>{},this.currentVehicleSpeedKmHour=0,this.numWheelsOnGround=0}addWheel(t){void 0===t&&(t={});const e=new vM(t),n=this.wheelInfos.length;return this.wheelInfos.push(e),n}setSteeringValue(t,e){this.wheelInfos[e].steering=t}applyEngineForce(t,e){this.wheelInfos[e].engineForce=t}setBrake(t,e){this.wheelInfos[e].brake=t}addToWorld(t){t.addBody(this.chassisBody);const e=this;this.preStepCallback=()=>{e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t}getVehicleAxisWorld(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)}updateVehicle(t){const e=this.wheelInfos,n=e.length,i=this.chassisBody;for(let u=0;u<n;u++)this.updateWheelTransform(u);this.currentVehicleSpeedKmHour=3.6*i.velocity.length();const r=new iw;this.getVehicleAxisWorld(this.indexForwardAxis,r),r.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(let u=0;u<n;u++)this.castRay(e[u]);this.updateSuspension(t);const s=new iw,o=new iw;for(let u=0;u<n;u++){const n=e[u];let r=n.suspensionForce;r>n.maxSuspensionForce&&(r=n.maxSuspensionForce),n.raycastResult.hitNormalWorld.scale(r*t,s),n.raycastResult.hitPointWorld.vsub(i.position,o),i.applyImpulse(s,o)}this.updateFriction(t);const a=new iw,l=new iw,c=new iw;for(let u=0;u<n;u++){const n=e[u];i.getVelocityAtWorldPoint(n.chassisConnectionPointWorld,c);let r=1;if(1===this.indexUpAxis)r=-1;if(n.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,l);const e=l.dot(n.raycastResult.hitNormalWorld);n.raycastResult.hitNormalWorld.scale(e,a),l.vsub(a,l);const i=l.dot(c);n.deltaRotation=r*i*t/n.radius}!n.sliding&&n.isInContact||0===n.engineForce||!n.useCustomSlidingRotationalSpeed||(n.deltaRotation=(n.engineForce>0?1:-1)*n.customSlidingRotationalSpeed*t),Math.abs(n.brake)>Math.abs(n.engineForce)&&(n.deltaRotation=0),n.rotation+=n.deltaRotation,n.deltaRotation*=.99}}updateSuspension(t){const e=this.chassisBody.mass,n=this.wheelInfos,i=n.length;for(let r=0;r<i;r++){const t=n[r];if(t.isInContact){let n;const i=t.suspensionRestLength-t.suspensionLength;n=t.suspensionStiffness*i*t.clippedInvContactDotSuspension;const r=t.suspensionRelativeVelocity;let s;s=r<0?t.dampingCompression:t.dampingRelaxation,n-=s*r,t.suspensionForce=n*e,t.suspensionForce<0&&(t.suspensionForce=0)}else t.suspensionForce=0}}removeFromWorld(t){this.constraints,t.removeBody(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null}castRay(t){const e=MM,n=CM;this.updateWheelTransformWorld(t);const i=this.chassisBody;let r=-1;const s=t.suspensionRestLength+t.radius;t.directionWorld.scale(s,e);const o=t.chassisConnectionPointWorld;o.vadd(e,n);const a=t.raycastResult;a.reset();const l=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(o,n,a),i.collisionResponse=l;const c=a.body;if(t.raycastResult.groundObject=0,c){r=a.distance,t.raycastResult.hitNormalWorld=a.hitNormalWorld,t.isInContact=!0;const e=a.distance;t.suspensionLength=e-t.radius;const n=t.suspensionRestLength-t.maxSuspensionTravel,s=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<n&&(t.suspensionLength=n),t.suspensionLength>s&&(t.suspensionLength=s,t.raycastResult.reset());const o=t.raycastResult.hitNormalWorld.dot(t.directionWorld),l=new iw;i.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,l);const c=t.raycastResult.hitNormalWorld.dot(l);if(o>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{const e=-1/o;t.suspensionRelativeVelocity=c*e,t.clippedInvContactDotSuspension=e}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return r}updateWheelTransformWorld(t){t.isInContact=!1;const e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)}updateWheelTransform(t){const e=xM,n=wM,i=SM,r=this.wheelInfos[t];this.updateWheelTransformWorld(r),r.directionLocal.scale(-1,e),n.copy(r.axleLocal),e.cross(n,i),i.normalize(),n.normalize();const s=r.steering,o=new dw;o.setFromAxisAngle(e,s);const a=new dw;a.setFromAxisAngle(n,r.rotation);const l=r.worldTransform.quaternion;this.chassisBody.quaternion.mult(o,l),l.mult(a,l),l.normalize();const c=r.worldTransform.position;c.copy(r.directionWorld),c.scale(r.suspensionLength,c),c.vadd(r.chassisConnectionPointWorld,c)}getWheelTransformWorld(t){return this.wheelInfos[t].worldTransform}updateFriction(t){const e=TM,n=this.wheelInfos,i=n.length,r=this.chassisBody,s=IM,o=EM;this.numWheelsOnGround=0;for(let a=0;a<i;a++){const t=n[a];t.raycastResult.body&&this.numWheelsOnGround++,t.sideImpulse=0,t.forwardImpulse=0,s[a]||(s[a]=new iw),o[a]||(o[a]=new iw)}for(let a=0;a<i;a++){const t=n[a],i=t.raycastResult.body;if(i){const n=o[a];this.getWheelTransformWorld(a).vectorToWorldFrame(AM[this.indexRightAxis],n);const l=t.raycastResult.hitNormalWorld,c=n.dot(l);l.scale(c,e),n.vsub(e,n),n.normalize(),l.cross(n,s[a]),s[a].normalize(),t.sideImpulse=GM(r,t.raycastResult.hitPointWorld,i,t.raycastResult.hitPointWorld,n),t.sideImpulse*=RM}}this.sliding=!1;for(let a=0;a<i;a++){const e=n[a],i=e.raycastResult.body;let o=0;if(e.slipInfo=1,i){const n=0,l=e.brake?e.brake:n;o=OM(r,i,e.raycastResult.hitPointWorld,s[a],l),o+=e.engineForce*t;const c=l/o;e.slipInfo*=c}if(e.forwardImpulse=0,e.skidInfo=1,i){e.skidInfo=1;const n=e.suspensionForce*t*e.frictionSlip,i=n*n;e.forwardImpulse=o;const r=.5*e.forwardImpulse/e.forwardAcceleration,s=1*e.sideImpulse/e.sideAcceleration,a=r*r+s*s;if(e.sliding=!1,a>i){this.sliding=!0,e.sliding=!0;const t=n/Math.sqrt(a);e.skidInfo*=t}}}if(this.sliding)for(let a=0;a<i;a++){const t=n[a];0!==t.sideImpulse&&t.skidInfo<1&&(t.forwardImpulse*=t.skidInfo,t.sideImpulse*=t.skidInfo)}for(let a=0;a<i;a++){const t=n[a],e=new iw;if(t.raycastResult.hitPointWorld.vsub(r.position,e),0!==t.forwardImpulse){const n=new iw;s[a].scale(t.forwardImpulse,n),r.applyImpulse(n,e)}if(0!==t.sideImpulse){const n=t.raycastResult.body,i=new iw;t.raycastResult.hitPointWorld.vsub(n.position,i);const s=new iw;o[a].scale(t.sideImpulse,s),r.vectorToLocalFrame(e,e),e["xyz"[this.indexUpAxis]]*=t.rollInfluence,r.vectorToWorldFrame(e,e),r.applyImpulse(s,e),s.scale(-1,s),n.applyImpulse(s,i)}}}}new iw,new iw,new iw;const xM=new iw,wM=new iw,SM=new iw;new cS,new iw;const MM=new iw,CM=new iw,AM=[new iw(1,0,0),new iw(0,1,0),new iw(0,0,1)],TM=new iw,EM=[],IM=[],RM=1,NM=new iw,DM=new iw,LM=new iw;function OM(t,e,n,i,r){let s=0;const o=n,a=NM,l=DM,c=LM;t.getVelocityAtWorldPoint(o,a),e.getVelocityAtWorldPoint(o,l),a.vsub(l,c);return s=-i.dot(c)*(1/(zM(t,n,i)+zM(e,n,i))),r<s&&(s=r),s<-r&&(s=-r),s}const kM=new iw,PM=new iw,FM=new iw,BM=new iw;function zM(t,e,n){const i=kM,r=PM,s=FM,o=BM;return e.vsub(t.position,i),i.cross(n,r),t.invInertiaWorld.vmult(r,o),o.cross(i,s),t.invMass+n.dot(s)}const UM=new iw,VM=new iw,WM=new iw;function GM(t,e,n,i,r){if(r.lengthSquared()>1.1)return 0;const s=UM,o=VM,a=WM;t.getVelocityAtWorldPoint(e,s),n.getVelocityAtWorldPoint(i,o),s.vsub(o,a);return-.2*r.dot(a)*(1/(t.invMass+n.invMass))}class HM extends mw{constructor(t){if(super({type:mw.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(t,e){void 0===e&&(e=new iw);const n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,n,i){const r=this.radius,s=["x","y","z"];for(let o=0;o<s.length;o++){const e=s[o];n[e]=t[e]-r,i[e]=t[e]+r}}}new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw;class jM extends yw{constructor(t,e,n,i){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=8),t<0)throw new Error("The cylinder radiusTop cannot be negative.");if(e<0)throw new Error("The cylinder radiusBottom cannot be negative.");const r=i,s=[],o=[],a=[],l=[],c=[],u=Math.cos,h=Math.sin;s.push(new iw(-e*h(0),.5*-n,e*u(0))),l.push(0),s.push(new iw(-t*h(0),.5*n,t*u(0))),c.push(1);for(let p=0;p<r;p++){const i=2*Math.PI/r*(p+1),d=2*Math.PI/r*(p+.5);p<r-1?(s.push(new iw(-e*h(i),.5*-n,e*u(i))),l.push(2*p+2),s.push(new iw(-t*h(i),.5*n,t*u(i))),c.push(2*p+3),a.push([2*p,2*p+1,2*p+3,2*p+2])):a.push([2*p,2*p+1,1,0]),(r%2==1||p<r/2)&&o.push(new iw(-h(d),0,u(d)))}a.push(l),o.push(new iw(0,1,0));const d=[];for(let p=0;p<c.length;p++)d.push(c[c.length-p-1]);a.push(d),super({vertices:s,faces:a,axes:o}),this.type=mw.types.CYLINDER,this.radiusTop=t,this.radiusBottom=e,this.height=n,this.numSegments=i}}class qM extends mw{constructor(){super({type:mw.types.PLANE}),this.worldNormal=new iw,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(t){const e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(t,e){return void 0===e&&(e=new iw),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,i){XM.set(0,0,1),e.vmult(XM,XM);const r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===XM.x?i.x=t.x:-1===XM.x&&(n.x=t.x),1===XM.y?i.y=t.y:-1===XM.y&&(n.y=t.y),1===XM.z?i.z=t.z:-1===XM.z&&(n.z=t.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const XM=new iw;new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw,new iw;class YM{constructor(t){void 0===t&&(t={}),this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new aw,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(t,e,n){void 0===n&&(n=0);const i=this.data;if(!this.aabb.contains(t))return!1;const r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let i=!1;r.length||(this.subdivide(),i=!0);for(let s=0;8!==s;s++)if(r[s].insert(t,e,n+1))return!0;i&&(r.length=0)}return i.push(e),!0}subdivide(){const t=this.aabb,e=t.lowerBound,n=t.upperBound,i=this.children;i.push(new YM({aabb:new aw({lowerBound:new iw(0,0,0)})}),new YM({aabb:new aw({lowerBound:new iw(1,0,0)})}),new YM({aabb:new aw({lowerBound:new iw(1,1,0)})}),new YM({aabb:new aw({lowerBound:new iw(1,1,1)})}),new YM({aabb:new aw({lowerBound:new iw(0,1,1)})}),new YM({aabb:new aw({lowerBound:new iw(0,0,1)})}),new YM({aabb:new aw({lowerBound:new iw(1,0,1)})}),new YM({aabb:new aw({lowerBound:new iw(0,1,0)})})),n.vsub(e,KM),KM.scale(.5,KM);const r=this.root||this;for(let s=0;8!==s;s++){const t=i[s];t.root=r;const n=t.aabb.lowerBound;n.x*=KM.x,n.y*=KM.y,n.z*=KM.z,n.vadd(e,n),n.vadd(KM,t.aabb.upperBound)}}aabbQuery(t,e){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e}rayQuery(t,e,n){return t.getAABB($M),$M.toLocalFrame(e,$M),this.aabbQuery($M,n),n}removeEmptyNodes(){for(let t=this.children.length-1;t>=0;t--)this.children[t].removeEmptyNodes(),this.children[t].children.length||this.children[t].data.length||this.children.splice(t,1)}}class ZM extends YM{constructor(t,e){void 0===e&&(e={}),super({root:null,aabb:t}),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}}const KM=new iw,$M=new aw;class JM extends mw{constructor(t,e){super({type:mw.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new aw,this.edges=null,this.scale=new iw(1,1,1),this.tree=new ZM,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const t=this.tree;t.reset(),t.aabb.copy(this.aabb);const e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;const n=new aw,i=new iw,r=new iw,s=new iw,o=[i,r,s];for(let a=0;a<this.indices.length/3;a++){const e=3*a;this._getUnscaledVertex(this.indices[e],i),this._getUnscaledVertex(this.indices[e+1],r),this._getUnscaledVertex(this.indices[e+2],s),n.setFromPoints(o),t.insert(n,a)}t.removeEmptyNodes()}getTrianglesInAABB(t,e){tC.copy(t);const n=this.scale,i=n.x,r=n.y,s=n.z,o=tC.lowerBound,a=tC.upperBound;return o.x/=i,o.y/=r,o.z/=s,a.x/=i,a.y/=r,a.z/=s,this.tree.aabbQuery(tC,e)}setScale(t){const e=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=t.x===t.y&&t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const t=QM,e=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,r=this.indices[i],s=this.indices[i+1],o=this.indices[i+2];this.getVertex(r,sC),this.getVertex(s,oC),this.getVertex(o,aC),JM.computeNormal(oC,sC,aC,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}}updateEdges(){const t={},e=(e,n)=>{t[e<n?`${e}_${n}`:`${n}_${e}`]=!0};for(let i=0;i<this.indices.length/3;i++){const t=3*i,n=this.indices[t],r=this.indices[t+1],s=this.indices[t+2];e(n,r),e(r,s),e(s,n)}const n=Object.keys(t);this.edges=new Int16Array(2*n.length);for(let i=0;i<n.length;i++){const t=n[i].split("_");this.edges[2*i]=parseInt(t[0],10),this.edges[2*i+1]=parseInt(t[1],10)}}getEdgeVertex(t,e,n){const i=this.edges[2*t+(e?1:0)];this.getVertex(i,n)}getEdgeVector(t,e){const n=eC,i=nC;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)}static computeNormal(t,e,n,i){e.vsub(t,rC),n.vsub(e,iC),iC.cross(rC,i),i.isZero()||i.normalize()}getVertex(t,e){const n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e}_getUnscaledVertex(t,e){const n=3*t,i=this.vertices;return e.set(i[n],i[n+1],i[n+2])}getWorldVertex(t,e,n,i){return this.getVertex(t,i),gw.pointToWorldFrame(e,n,i,i),i}getTriangleVertices(t,e,n,i){const r=3*t;this.getVertex(this.indices[r],e),this.getVertex(this.indices[r+1],n),this.getVertex(this.indices[r+2],i)}getNormal(t,e){const n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(t,e){this.computeLocalAABB(lC);const n=lC.upperBound.x-lC.lowerBound.x,i=lC.upperBound.y-lC.lowerBound.y,r=lC.upperBound.z-lC.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*r*2*r),1/12*t*(2*n*2*n+2*r*2*r),1/12*t*(2*i*2*i+2*n*2*n))}computeLocalAABB(t){const e=t.lowerBound,n=t.upperBound,i=this.vertices.length;this.vertices;const r=cC;this.getVertex(0,r),e.copy(r),n.copy(r);for(let s=0;s!==i;s++)this.getVertex(s,r),r.x<e.x?e.x=r.x:r.x>n.x&&(n.x=r.x),r.y<e.y?e.y=r.y:r.y>n.y&&(n.y=r.y),r.z<e.z?e.z=r.z:r.z>n.z&&(n.z=r.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let t=0;const e=this.vertices,n=new iw;for(let i=0,r=e.length/3;i!==r;i++){this.getVertex(i,n);const e=n.lengthSquared();e>t&&(t=e)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,i){const r=uC,s=hC;r.position=t,r.quaternion=e,this.aabb.toWorldFrame(r,s),n.copy(s.lowerBound),i.copy(s.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(t,e,n,i,r){void 0===t&&(t=1),void 0===e&&(e=.5),void 0===n&&(n=8),void 0===i&&(i=6),void 0===r&&(r=2*Math.PI);const s=[],o=[];for(let a=0;a<=n;a++)for(let o=0;o<=i;o++){const l=o/i*r,c=a/n*Math.PI*2,u=(t+e*Math.cos(c))*Math.cos(l),h=(t+e*Math.cos(c))*Math.sin(l),d=e*Math.sin(c);s.push(u,h,d)}for(let a=1;a<=n;a++)for(let t=1;t<=i;t++){const e=(i+1)*a+t-1,n=(i+1)*(a-1)+t-1,r=(i+1)*(a-1)+t,s=(i+1)*a+t;o.push(e,n,s),o.push(n,r,s)}return new JM(s,o)}}const QM=new iw,tC=new aw,eC=new iw,nC=new iw,iC=new iw,rC=new iw,sC=new iw,oC=new iw,aC=new iw,lC=new aw,cC=new iw,uC=new gw,hC=new aw;class dC{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){!t.enabled||t.bi.isTrigger||t.bj.isTrigger||this.equations.push(t)}removeEquation(t){const e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)}removeAllEquations(){this.equations.length=0}}class pC extends dC{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,s=this.equations,o=s.length,a=e.bodies,l=a.length,c=t;let u,h,d,p,f,m;if(0!==o)for(let _=0;_!==l;_++)a[_].updateSolveMassProperties();const g=mC,v=gC,y=fC;g.length=o,v.length=o,y.length=o;for(let _=0;_!==o;_++){const t=s[_];y[_]=0,v[_]=t.computeB(c),g[_]=1/t.computeC()}if(0!==o){for(let n=0;n!==l;n++){const t=a[n],e=t.vlambda,i=t.wlambda;e.set(0,0,0),i.set(0,0,0)}for(n=0;n!==i;n++){p=0;for(let t=0;t!==o;t++){const e=s[t];u=v[t],h=g[t],m=y[t],f=e.computeGWlambda(),d=h*(u-f-e.eps*m),m+d<e.minForce?d=e.minForce-m:m+d>e.maxForce&&(d=e.maxForce-m),y[t]+=d,p+=d>0?d:-d,e.addToWlambda(d)}if(p*p<r)break}for(let n=0;n!==l;n++){const t=a[n],e=t.velocity,i=t.angularVelocity;t.vlambda.vmul(t.linearFactor,t.vlambda),e.vadd(t.vlambda,e),t.wlambda.vmul(t.angularFactor,t.wlambda),i.vadd(t.wlambda,i)}let t=s.length;const e=1/c;for(;t--;)s[t].multiplier=y[t]*e}return n}}const fC=[],mC=[],gC=[];Dw.STATIC;class vC{constructor(){this.objects=[],this.type=Object}release(){const t=arguments.length;for(let e=0;e!==t;e++)this.objects.push(e<0||arguments.length<=e?void 0:arguments[e]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){const e=this.objects;for(;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}class yC extends vC{constructor(){super(...arguments),this.type=iw}constructObject(){return new iw}}const _C=mw.types.SPHERE,bC=mw.types.SPHERE|mw.types.PLANE,xC=mw.types.BOX|mw.types.BOX,wC=mw.types.SPHERE|mw.types.BOX,SC=mw.types.PLANE|mw.types.BOX,MC=mw.types.CONVEXPOLYHEDRON,CC=mw.types.SPHERE|mw.types.CONVEXPOLYHEDRON,AC=mw.types.PLANE|mw.types.CONVEXPOLYHEDRON,TC=mw.types.BOX|mw.types.CONVEXPOLYHEDRON,EC=mw.types.SPHERE|mw.types.HEIGHTFIELD,IC=mw.types.BOX|mw.types.HEIGHTFIELD,RC=mw.types.CONVEXPOLYHEDRON|mw.types.HEIGHTFIELD,NC=mw.types.PARTICLE|mw.types.SPHERE,DC=mw.types.PLANE|mw.types.PARTICLE,LC=mw.types.BOX|mw.types.PARTICLE,OC=mw.types.PARTICLE|mw.types.CONVEXPOLYHEDRON,kC=mw.types.CYLINDER,PC=mw.types.SPHERE|mw.types.CYLINDER,FC=mw.types.PLANE|mw.types.CYLINDER,BC=mw.types.BOX|mw.types.CYLINDER,zC=mw.types.CONVEXPOLYHEDRON|mw.types.CYLINDER,UC=mw.types.HEIGHTFIELD|mw.types.CYLINDER,VC=mw.types.PARTICLE|mw.types.CYLINDER,WC=mw.types.SPHERE|mw.types.TRIMESH,GC=mw.types.PLANE|mw.types.TRIMESH;class HC{get[_C](){return this.sphereSphere}get[bC](){return this.spherePlane}get[xC](){return this.boxBox}get[wC](){return this.sphereBox}get[SC](){return this.planeBox}get[MC](){return this.convexConvex}get[CC](){return this.sphereConvex}get[AC](){return this.planeConvex}get[TC](){return this.boxConvex}get[EC](){return this.sphereHeightfield}get[IC](){return this.boxHeightfield}get[RC](){return this.convexHeightfield}get[NC](){return this.sphereParticle}get[DC](){return this.planeParticle}get[LC](){return this.boxParticle}get[OC](){return this.convexParticle}get[kC](){return this.convexConvex}get[PC](){return this.sphereConvex}get[FC](){return this.planeConvex}get[BC](){return this.boxConvex}get[zC](){return this.convexConvex}get[UC](){return this.heightfieldCylinder}get[VC](){return this.particleCylinder}get[WC](){return this.sphereTrimesh}get[GC](){return this.planeTrimesh}constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new yC,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,n,i,r,s){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=t,o.bj=e):o=new ZS(t,e),o.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;const a=this.currentContactMaterial;o.restitution=a.restitution,o.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||t.material,c=i.material||e.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(o.restitution=l.restitution*c.restitution),o.si=r||n,o.sj=s||i,o}createFrictionEquationsFromContact(t,e){const n=t.bi,i=t.bj,r=t.si,s=t.sj,o=this.world,a=this.currentContactMaterial;let l=a.friction;const c=r.material||n.material,u=s.material||i.material;if(c&&u&&c.friction>=0&&u.friction>=0&&(l=c.friction*u.friction),l>0){const r=l*(o.frictionGravity||o.gravity).length();let s=n.invMass+i.invMass;s>0&&(s=1/s);const c=this.frictionEquationPool,u=c.length?c.pop():new dM(n,i,r*s),h=c.length?c.pop():new dM(n,i,r*s);return u.bi=h.bi=n,u.bj=h.bj=i,u.minForce=h.minForce=-r*s,u.maxForce=h.maxForce=r*s,u.ri.copy(t.ri),u.rj.copy(t.rj),h.ri.copy(t.ri),h.rj.copy(t.rj),t.ni.tangents(u.t,h.t),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),h.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),u.enabled=h.enabled=t.enabled,e.push(u,h),!0}return!1}createFrictionFromAverage(t){let e=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(e,this.frictionResult)||1===t)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];jC.setZero(),qC.setZero(),XC.setZero();const r=e.bi;e.bj;for(let o=0;o!==t;o++)e=this.result[this.result.length-1-o],e.bi!==r?(jC.vadd(e.ni,jC),qC.vadd(e.ri,qC),XC.vadd(e.rj,XC)):(jC.vsub(e.ni,jC),qC.vadd(e.rj,qC),XC.vadd(e.ri,XC));const s=1/t;qC.scale(s,n.ri),XC.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),jC.normalize(),jC.tangents(n.t,i.t)}getContacts(t,e,n,i,r,s,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=i,this.frictionResult=s;const a=KC,l=$C,c=YC,u=ZC;for(let h=0,d=t.length;h!==d;h++){const i=t[h],r=e[h];let s=null;i.material&&r.material&&(s=n.getContactMaterial(i.material,r.material)||null);const o=i.type&Dw.KINEMATIC&&r.type&Dw.STATIC||i.type&Dw.STATIC&&r.type&Dw.KINEMATIC||i.type&Dw.KINEMATIC&&r.type&Dw.KINEMATIC;for(let t=0;t<i.shapes.length;t++){i.quaternion.mult(i.shapeOrientations[t],a),i.quaternion.vmult(i.shapeOffsets[t],c),c.vadd(i.position,c);const e=i.shapes[t];for(let t=0;t<r.shapes.length;t++){r.quaternion.mult(r.shapeOrientations[t],l),r.quaternion.vmult(r.shapeOffsets[t],u),u.vadd(r.position,u);const h=r.shapes[t];if(!(e.collisionFilterMask&h.collisionFilterGroup&&h.collisionFilterMask&e.collisionFilterGroup))continue;if(c.distanceTo(u)>e.boundingSphereRadius+h.boundingSphereRadius)continue;let d=null;e.material&&h.material&&(d=n.getContactMaterial(e.material,h.material)||null),this.currentContactMaterial=d||s||n.defaultContactMaterial;const p=this[e.type|h.type];if(p){let t=!1;t=e.type<h.type?p.call(this,e,h,c,u,a,l,i,r,e,h,o):p.call(this,h,e,u,c,l,a,r,i,e,h,o),t&&o&&(n.shapeOverlapKeeper.set(e.id,h.id),n.bodyOverlapKeeper.set(i.id,r.id))}}}}}sphereSphere(t,e,n,i,r,s,o,a,l,c,u){if(u)return n.distanceSquared(i)<(t.radius+e.radius)**2;const h=this.createContactEquation(o,a,t,e,l,c);i.vsub(n,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.scale(t.radius,h.ri),h.rj.scale(-e.radius,h.rj),h.ri.vadd(n,h.ri),h.ri.vsub(o.position,h.ri),h.rj.vadd(i,h.rj),h.rj.vsub(a.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}spherePlane(t,e,n,i,r,s,o,a,l,c,u){const h=this.createContactEquation(o,a,t,e,l,c);if(h.ni.set(0,0,1),s.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.scale(t.radius,h.ri),n.vsub(i,gA),h.ni.scale(h.ni.dot(gA),vA),gA.vsub(vA,h.rj),-gA.dot(h.ni)<=t.radius){if(u)return!0;const t=h.ri,e=h.rj;t.vadd(n,t),t.vsub(o.position,t),e.vadd(i,e),e.vsub(a.position,e),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}}boxBox(t,e,n,i,r,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,r,s,o,a,t,e,u)}sphereBox(t,e,n,i,r,s,o,a,l,c,u){const h=this.v3pool,d=AA;n.vsub(i,wA),e.getSideNormals(d,s);const p=t.radius;let f=!1;const m=EA,g=IA,v=RA;let y=null,_=0,b=0,x=0,w=null;for(let N=0,D=d.length;N!==D&&!1===f;N++){const t=SA;t.copy(d[N]);const e=t.length();t.normalize();const n=wA.dot(t);if(n<e+p&&n>0){const i=MA,r=CA;i.copy(d[(N+1)%3]),r.copy(d[(N+2)%3]);const s=i.length(),o=r.length();i.normalize(),r.normalize();const a=wA.dot(i),l=wA.dot(r);if(a<s&&a>-s&&l<o&&l>-o){const s=Math.abs(n-e-p);if((null===w||s<w)&&(w=s,b=a,x=l,y=e,m.copy(t),g.copy(i),v.copy(r),_++,u))return!0}}}if(_){f=!0;const r=this.createContactEquation(o,a,t,e,l,c);m.scale(-p,r.ri),r.ni.copy(m),r.ni.negate(r.ni),m.scale(y,m),g.scale(b,g),m.vadd(g,m),v.scale(x,v),m.vadd(v,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}let S=h.get();const M=TA;for(let N=0;2!==N&&!f;N++)for(let r=0;2!==r&&!f;r++)for(let s=0;2!==s&&!f;s++)if(S.set(0,0,0),N?S.vadd(d[0],S):S.vsub(d[0],S),r?S.vadd(d[1],S):S.vsub(d[1],S),s?S.vadd(d[2],S):S.vsub(d[2],S),i.vadd(S,M),M.vsub(n,M),M.lengthSquared()<p*p){if(u)return!0;f=!0;const r=this.createContactEquation(o,a,t,e,l,c);r.ri.copy(M),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(p,r.ri),r.rj.copy(S),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}h.release(S),S=null;const C=h.get(),A=h.get(),T=h.get(),E=h.get(),I=h.get(),R=d.length;for(let N=0;N!==R&&!f;N++)for(let r=0;r!==R&&!f;r++)if(N%3!=r%3){d[r].cross(d[N],C),C.normalize(),d[N].vadd(d[r],A),T.copy(n),T.vsub(A,T),T.vsub(i,T);const s=T.dot(C);C.scale(s,E);let h=0;for(;h===N%3||h===r%3;)h++;I.copy(n),I.vsub(E,I),I.vsub(A,I),I.vsub(i,I);const m=Math.abs(s),g=I.length();if(m<d[h].length()&&g<p){if(u)return!0;f=!0;const r=this.createContactEquation(o,a,t,e,l,c);A.vadd(E,r.rj),r.rj.copy(r.rj),I.negate(r.ni),r.ni.normalize(),r.ri.copy(r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(n,r.ri),r.ri.normalize(),r.ri.scale(p,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}h.release(C,A,T,E,I)}planeBox(t,e,n,i,r,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,r,s,o,a,t,e,u)}convexConvex(t,e,n,i,r,s,o,a,l,c,u,h,d){const p=jA;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,r,i,s,p,h,d)){const h=[],d=qA;t.clipAgainstHull(n,r,e,i,s,p,-100,100,h);let f=0;for(let r=0;r!==h.length;r++){if(u)return!0;const s=this.createContactEquation(o,a,t,e,l,c),m=s.ri,g=s.rj;p.negate(s.ni),h[r].normal.negate(d),d.scale(h[r].depth,d),h[r].point.vadd(d,m),g.copy(h[r].point),m.vsub(n,m),g.vsub(i,g),m.vadd(n,m),m.vsub(o.position,m),g.vadd(i,g),g.vsub(a.position,g),this.result.push(s),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(t,e,n,i,r,s,o,a,l,c,u){const h=this.v3pool;n.vsub(i,NA);const d=e.faceNormals,p=e.faces,f=e.vertices,m=t.radius;let g=!1;for(let v=0;v!==f.length;v++){const r=f[v],h=kA;s.vmult(r,h),i.vadd(h,h);const d=OA;if(h.vsub(n,d),d.lengthSquared()<m*m){if(u)return!0;g=!0;const r=this.createContactEquation(o,a,t,e,l,c);return r.ri.copy(d),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(m,r.ri),h.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),void this.createFrictionEquationsFromContact(r,this.frictionResult)}}for(let v=0,y=p.length;v!==y&&!1===g;v++){const r=d[v],y=p[v],_=PA;s.vmult(r,_);const b=FA;s.vmult(f[y[0]],b),b.vadd(i,b);const x=BA;_.scale(-m,x),n.vadd(x,x);const w=zA;x.vsub(b,w);const S=w.dot(_),M=UA;if(n.vsub(b,M),S<0&&M.dot(_)>0){const r=[];for(let t=0,e=y.length;t!==e;t++){const e=h.get();s.vmult(f[y[t]],e),i.vadd(e,e),r.push(e)}if(xA(r,_,n)){if(u)return!0;g=!0;const s=this.createContactEquation(o,a,t,e,l,c);_.scale(-m,s.ri),_.negate(s.ni);const d=h.get();_.scale(-S,d);const p=h.get();_.scale(-m,p),n.vsub(i,s.rj),s.rj.vadd(p,s.rj),s.rj.vadd(d,s.rj),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),h.release(d),h.release(p),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let t=0,e=r.length;t!==e;t++)h.release(r[t]);return}for(let d=0;d!==y.length;d++){const p=h.get(),g=h.get();s.vmult(f[y[(d+1)%y.length]],p),s.vmult(f[y[(d+2)%y.length]],g),i.vadd(p,p),i.vadd(g,g);const v=DA;g.vsub(p,v);const _=LA;v.unit(_);const b=h.get(),x=h.get();n.vsub(p,x);const w=x.dot(_);_.scale(w,b),b.vadd(p,b);const S=h.get();if(b.vsub(n,S),w>0&&w*w<v.lengthSquared()&&S.lengthSquared()<m*m){if(u)return!0;const s=this.createContactEquation(o,a,t,e,l,c);b.vsub(i,s.rj),b.vsub(n,s.ni),s.ni.normalize(),s.ni.scale(m,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let t=0,e=r.length;t!==e;t++)h.release(r[t]);return h.release(p),h.release(g),h.release(b),h.release(S),void h.release(x)}h.release(p),h.release(g),h.release(b),h.release(S),h.release(x)}for(let t=0,e=r.length;t!==e;t++)h.release(r[t])}}}planeConvex(t,e,n,i,r,s,o,a,l,c,u){const h=VA,d=WA;d.set(0,0,1),r.vmult(d,d);let p=0;const f=GA;for(let m=0;m!==e.vertices.length;m++){h.copy(e.vertices[m]),s.vmult(h,h),i.vadd(h,h),h.vsub(n,f);if(d.dot(f)<=0){if(u)return!0;const r=this.createContactEquation(o,a,t,e,l,c),s=HA;d.scale(d.dot(f),s),h.vsub(s,s),s.vsub(n,r.ri),r.ni.copy(d),h.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(t,e,n,i,r,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e,u)}sphereHeightfield(t,e,n,i,r,s,o,a,l,c,u){const h=e.data,d=t.radius,p=e.elementSize,f=oT,m=sT;gw.pointToLocalFrame(i,s,n,m);let g=Math.floor((m.x-d)/p)-1,v=Math.ceil((m.x+d)/p)+1,y=Math.floor((m.y-d)/p)-1,_=Math.ceil((m.y+d)/p)+1;if(v<0||_<0||g>h.length||y>h[0].length)return;g<0&&(g=0),v<0&&(v=0),y<0&&(y=0),_<0&&(_=0),g>=h.length&&(g=h.length-1),v>=h.length&&(v=h.length-1),_>=h[0].length&&(_=h[0].length-1),y>=h[0].length&&(y=h[0].length-1);const b=[];e.getRectMinMax(g,y,v,_,b);const x=b[0],w=b[1];if(m.z-d>w||m.z+d<x)return;const S=this.result;for(let M=g;M<v;M++)for(let l=y;l<_;l++){const c=S.length;let h=!1;if(e.getConvexTrianglePillar(M,l,!1),gw.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.sphereConvex(t,e.pillarConvex,n,f,r,s,o,a,t,e,u)),u&&h)return!0;if(e.getConvexTrianglePillar(M,l,!0),gw.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(h=this.sphereConvex(t,e.pillarConvex,n,f,r,s,o,a,t,e,u)),u&&h)return!0;if(S.length-c>2)return}}boxHeightfield(t,e,n,i,r,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e,u)}convexHeightfield(t,e,n,i,r,s,o,a,l,c,u){const h=e.data,d=e.elementSize,p=t.boundingSphereRadius,f=iT,m=rT,g=nT;gw.pointToLocalFrame(i,s,n,g);let v=Math.floor((g.x-p)/d)-1,y=Math.ceil((g.x+p)/d)+1,_=Math.floor((g.y-p)/d)-1,b=Math.ceil((g.y+p)/d)+1;if(y<0||b<0||v>h.length||_>h[0].length)return;v<0&&(v=0),y<0&&(y=0),_<0&&(_=0),b<0&&(b=0),v>=h.length&&(v=h.length-1),y>=h.length&&(y=h.length-1),b>=h[0].length&&(b=h[0].length-1),_>=h[0].length&&(_=h[0].length-1);const x=[];e.getRectMinMax(v,_,y,b,x);const w=x[0],S=x[1];if(!(g.z-p>S||g.z+p<w))for(let M=v;M<y;M++)for(let l=_;l<b;l++){let c=!1;if(e.getConvexTrianglePillar(M,l,!1),gw.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(c=this.convexConvex(t,e.pillarConvex,n,f,r,s,o,a,null,null,u,m,null)),u&&c)return!0;if(e.getConvexTrianglePillar(M,l,!0),gw.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(c=this.convexConvex(t,e.pillarConvex,n,f,r,s,o,a,null,null,u,m,null)),u&&c)return!0}}sphereParticle(t,e,n,i,r,s,o,a,l,c,u){const h=KA;h.set(0,0,1),i.vsub(n,h);if(h.lengthSquared()<=t.radius*t.radius){if(u)return!0;const n=this.createContactEquation(a,o,e,t,l,c);h.normalize(),n.rj.copy(h),n.rj.scale(t.radius,n.rj),n.ni.copy(h),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(t,e,n,i,r,s,o,a,l,c,u){const h=XA;h.set(0,0,1),o.quaternion.vmult(h,h);const d=YA;i.vsub(o.position,d);if(h.dot(d)<=0){if(u)return!0;const n=this.createContactEquation(a,o,e,t,l,c);n.ni.copy(h),n.ni.negate(n.ni),n.ri.set(0,0,0);const r=ZA;h.scale(h.dot(i),r),i.vsub(r,r),n.rj.copy(r),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(t,e,n,i,r,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e,u)}convexParticle(t,e,n,i,r,s,o,a,l,c,u){let h=-1;const d=QA,p=eT;let f=null;const m=JA;if(m.copy(i),m.vsub(n,m),r.conjugate($A),$A.vmult(m,m),t.pointIsInside(m)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,r),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(r);for(let e=0,n=t.faces.length;e!==n;e++){const n=[t.worldVertices[t.faces[e][0]]],r=t.worldFaceNormals[e];i.vsub(n[0],tT);const s=-r.dot(tT);if(null===f||Math.abs(s)<Math.abs(f)){if(u)return!0;f=s,h=e,d.copy(r)}}if(-1!==h){const r=this.createContactEquation(a,o,e,t,l,c);d.scale(f,p),p.vadd(i,p),p.vsub(n,p),r.rj.copy(p),d.negate(r.ni),r.ri.set(0,0,0);const s=r.ri,u=r.rj;s.vadd(i,s),s.vsub(a.position,s),u.vadd(n,u),u.vsub(o.position,u),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}}heightfieldCylinder(t,e,n,i,r,s,o,a,l,c,u){return this.convexHeightfield(e,t,i,n,s,r,a,o,l,c,u)}particleCylinder(t,e,n,i,r,s,o,a,l,c,u){return this.convexParticle(e,t,i,n,s,r,a,o,l,c,u)}sphereTrimesh(t,e,n,i,r,s,o,a,l,c,u){const h=sA,d=oA,p=aA,f=lA,m=cA,g=uA,v=fA,y=rA,_=nA,b=mA;gw.pointToLocalFrame(i,s,n,m);const x=t.radius;v.lowerBound.set(m.x-x,m.y-x,m.z-x),v.upperBound.set(m.x+x,m.y+x,m.z+x),e.getTrianglesInAABB(v,b);const w=iA,S=t.radius*t.radius;for(let E=0;E<b.length;E++)for(let r=0;r<3;r++)if(e.getVertex(e.indices[3*b[E]+r],w),w.vsub(m,_),_.lengthSquared()<=S){if(y.copy(w),gw.pointToWorldFrame(i,s,y,w),w.vsub(n,_),u)return!0;let r=this.createContactEquation(o,a,t,e,l,c);r.ni.copy(_),r.ni.normalize(),r.ri.copy(r.ni),r.ri.scale(t.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.copy(w),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}for(let E=0;E<b.length;E++)for(let r=0;r<3;r++){e.getVertex(e.indices[3*b[E]+r],h),e.getVertex(e.indices[3*b[E]+(r+1)%3],d),d.vsub(h,p),m.vsub(d,g);const v=g.dot(p);m.vsub(h,g);let y=g.dot(p);if(y>0&&v<0){m.vsub(h,g),f.copy(p),f.normalize(),y=g.dot(f),f.scale(y,g),g.vadd(h,g);if(g.distanceTo(m)<t.radius){if(u)return!0;const r=this.createContactEquation(o,a,t,e,l,c);g.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(t.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),gw.pointToWorldFrame(i,s,g,g),g.vsub(a.position,r.rj),gw.vectorToWorldFrame(s,r.ni,r.ni),gw.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}}const M=hA,C=dA,A=pA,T=eA;for(let E=0,I=b.length;E!==I;E++){e.getTriangleVertices(b[E],M,C,A),e.getNormal(b[E],T),m.vsub(M,g);let r=g.dot(T);if(T.scale(r,g),m.vsub(g,g),r=g.distanceTo(m),cS.pointInTriangle(g,M,C,A)&&r<t.radius){if(u)return!0;let r=this.createContactEquation(o,a,t,e,l,c);g.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(t.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),gw.pointToWorldFrame(i,s,g,g),g.vsub(a.position,r.rj),gw.vectorToWorldFrame(s,r.ni,r.ni),gw.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}b.length=0}planeTrimesh(t,e,n,i,r,s,o,a,l,c,u){const h=new iw,d=JC;d.set(0,0,1),r.vmult(d,d);for(let p=0;p<e.vertices.length/3;p++){e.getVertex(p,h);const r=new iw;r.copy(h),gw.pointToWorldFrame(i,s,r,h);const f=QC;h.vsub(n,f);if(d.dot(f)<=0){if(u)return!0;const n=this.createContactEquation(o,a,t,e,l,c);n.ni.copy(d);const i=tA;d.scale(f.dot(d),i),h.vsub(i,i),n.ri.copy(i),n.ri.vsub(o.position,n.ri),n.rj.copy(h),n.rj.vsub(a.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const jC=new iw,qC=new iw,XC=new iw,YC=new iw,ZC=new iw,KC=new dw,$C=new dw,JC=new iw,QC=new iw,tA=new iw,eA=new iw,nA=new iw;new iw;const iA=new iw,rA=new iw,sA=new iw,oA=new iw,aA=new iw,lA=new iw,cA=new iw,uA=new iw,hA=new iw,dA=new iw,pA=new iw,fA=new aw,mA=[],gA=new iw,vA=new iw,yA=new iw,_A=new iw,bA=new iw;function xA(t,e,n){let i=null;const r=t.length;for(let s=0;s!==r;s++){const o=t[s],a=yA;t[(s+1)%r].vsub(o,a);const l=_A;a.cross(e,l);const c=bA;n.vsub(o,c);const u=l.dot(c);if(!(null===i||u>0&&!0===i||u<=0&&!1===i))return!1;null===i&&(i=u>0)}return!0}const wA=new iw,SA=new iw,MA=new iw,CA=new iw,AA=[new iw,new iw,new iw,new iw,new iw,new iw],TA=new iw,EA=new iw,IA=new iw,RA=new iw,NA=new iw,DA=new iw,LA=new iw,OA=new iw,kA=new iw,PA=new iw,FA=new iw,BA=new iw,zA=new iw,UA=new iw;new iw,new iw;const VA=new iw,WA=new iw,GA=new iw,HA=new iw,jA=new iw,qA=new iw,XA=new iw,YA=new iw,ZA=new iw,KA=new iw,$A=new dw,JA=new iw;new iw;const QA=new iw,tT=new iw,eT=new iw,nT=new iw,iT=new iw,rT=[0],sT=new iw,oT=new iw;class aT{constructor(){this.current=[],this.previous=[]}getKey(t,e){if(e<t){const n=e;e=t,t=n}return t<<16|e}set(t,e){const n=this.getKey(t,e),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let t=i.length-1;t>=r;t--)i[t+1]=i[t];i[r]=n}}tick(){const t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){const n=this.current,i=this.previous,r=n.length,s=i.length;let o=0;for(let a=0;a<r;a++){let e=!1;const r=n[a];for(;r>i[o];)o++;e=r===i[o],e||lT(t,r)}o=0;for(let a=0;a<s;a++){let t=!1;const r=i[a];for(;r>n[o];)o++;t=n[o]===r,t||lT(e,r)}}}function lT(t,e){t.push((4294901760&e)>>16,65535&e)}const cT=(t,e)=>t<e?`${t}-${e}`:`${e}-${t}`;class uT{constructor(){this.data={keys:[]}}get(t,e){const n=cT(t,e);return this.data[n]}set(t,e,n){const i=cT(t,e);this.get(t,e)||this.data.keys.push(i),this.data[i]=n}delete(t,e){const n=cT(t,e),i=this.data.keys.indexOf(n);-1!==i&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const t=this.data,e=t.keys;for(;e.length>0;){delete t[e.pop()]}}}class hT extends hw{constructor(t){void 0===t&&(t={}),super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new iw,t.gravity&&this.gravity.copy(t.gravity),t.frictionGravity&&(this.frictionGravity=new iw,this.frictionGravity.copy(t.frictionGravity)),this.broadphase=void 0!==t.broadphase?t.broadphase:new $w,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==t.solver?t.solver:new pC,this.constraints=[],this.narrowphase=new HC(this),this.collisionMatrix=new uw,this.collisionMatrixPrevious=new uw,this.bodyOverlapKeeper=new aT,this.shapeOverlapKeeper=new aT,this.contactmaterials=[],this.contactMaterialTable=new uT,this.defaultMaterial=new gM("default"),this.defaultContactMaterial=new mM(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}collisionMatrixTick(){const t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){const e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)}rayTest(t,e,n){n instanceof Jw?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)}raycastAll(t,e,n,i){return void 0===n&&(n={}),n.mode=cS.ALL,n.from=t,n.to=e,n.callback=i,dT.intersectWorld(this,n)}raycastAny(t,e,n,i){return void 0===n&&(n={}),n.mode=cS.ANY,n.from=t,n.to=e,n.result=i,dT.intersectWorld(this,n)}raycastClosest(t,e,n,i){return void 0===n&&(n={}),n.mode=cS.CLOSEST,n.from=t,n.to=e,n.result=i,dT.intersectWorld(this,n)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof Dw&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;const e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(let t=0;t!==n.length;t++)n[t].index=t;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){const e=this.bodies;for(let n=0;n<e.length;n++){const i=e[n].shapes;for(let e=0;e<i.length;e++){const n=i[e];if(n.id===t)return n}}return null}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}removeContactMaterial(t){const e=this.contactmaterials.indexOf(t);-1!==e&&(this.contactmaterials.splice(e,1),this.contactMaterialTable.delete(t.materials[0].id,t.materials[1].id))}fixedStep(t,e){void 0===t&&(t=1/60),void 0===e&&(e=10);const n=pT.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(t,i,e)}else this.step(t,void 0,e);this.lastCallTime=n}step(t,e,n){if(void 0===n&&(n=10),void 0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;const i=pT.now();let r=0;for(;this.accumulator>=t&&r<n&&(this.internalStep(t),this.accumulator-=t,r++,!(pT.now()-i>1e3*t)););this.accumulator=this.accumulator%t;const s=this.accumulator/t;for(let t=0;t!==this.bodies.length;t++){const e=this.bodies[t];e.previousPosition.lerp(e.position,s,e.interpolatedPosition),e.previousQuaternion.slerp(e.quaternion,s,e.interpolatedQuaternion),e.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;const e=this.contacts,n=_T,i=bT,r=this.bodies.length,s=this.bodies,o=this.solver,a=this.gravity,l=this.doProfiling,c=this.profile,u=Dw.DYNAMIC;let h=-1/0;const d=this.constraints,p=yT;a.length();const f=a.x,m=a.y,g=a.z;let v=0;for(l&&(h=pT.now()),v=0;v!==r;v++){const t=s[v];if(t.type===u){const e=t.force,n=t.mass;e.x+=n*f,e.y+=n*m,e.z+=n*g}}for(let T=0,E=this.subsystems.length;T!==E;T++)this.subsystems[T].update();l&&(h=pT.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),l&&(c.broadphase=pT.now()-h);let y=d.length;for(v=0;v!==y;v++){const t=d[v];if(!t.collideConnected)for(let e=n.length-1;e>=0;e-=1)(t.bodyA===n[e]&&t.bodyB===i[e]||t.bodyB===n[e]&&t.bodyA===i[e])&&(n.splice(e,1),i.splice(e,1))}this.collisionMatrixTick(),l&&(h=pT.now());const _=vT,b=e.length;for(v=0;v!==b;v++)_.push(e[v]);e.length=0;const x=this.frictionEquations.length;for(v=0;v!==x;v++)p.push(this.frictionEquations[v]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,e,_,this.frictionEquations,p),l&&(c.narrowphase=pT.now()-h),l&&(h=pT.now()),v=0;v<this.frictionEquations.length;v++)o.addEquation(this.frictionEquations[v]);const w=e.length;for(let T=0;T!==w;T++){const t=e[T],n=t.bi,i=t.bj,r=t.si,s=t.sj;let a;if(a=n.material&&i.material&&this.getContactMaterial(n.material,i.material)||this.defaultContactMaterial,a.friction,n.material&&i.material&&(n.material.friction>=0&&i.material.friction>=0&&(n.material.friction,i.material.friction),n.material.restitution>=0&&i.material.restitution>=0&&(t.restitution=n.material.restitution*i.material.restitution)),o.addEquation(t),n.allowSleep&&n.type===Dw.DYNAMIC&&n.sleepState===Dw.SLEEPING&&i.sleepState===Dw.AWAKE&&i.type!==Dw.STATIC){i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(n.wakeUpAfterNarrowphase=!0)}if(i.allowSleep&&i.type===Dw.DYNAMIC&&i.sleepState===Dw.SLEEPING&&n.sleepState===Dw.AWAKE&&n.type!==Dw.STATIC){n.velocity.lengthSquared()+n.angularVelocity.lengthSquared()>=2*n.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(n,i,!0),this.collisionMatrixPrevious.get(n,i)||(gT.body=i,gT.contact=t,n.dispatchEvent(gT),gT.body=n,i.dispatchEvent(gT)),this.bodyOverlapKeeper.set(n.id,i.id),this.shapeOverlapKeeper.set(r.id,s.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=pT.now()-h,h=pT.now()),v=0;v!==r;v++){const t=s[v];t.wakeUpAfterNarrowphase&&(t.wakeUp(),t.wakeUpAfterNarrowphase=!1)}for(y=d.length,v=0;v!==y;v++){const t=d[v];t.update();for(let e=0,n=t.equations.length;e!==n;e++){const n=t.equations[e];o.addEquation(n)}}o.solve(t,this),l&&(c.solve=pT.now()-h),o.removeAllEquations();const S=Math.pow;for(v=0;v!==r;v++){const e=s[v];if(e.type&u){const n=S(1-e.linearDamping,t),i=e.velocity;i.scale(n,i);const r=e.angularVelocity;if(r){const n=S(1-e.angularDamping,t);r.scale(n,r)}}}this.dispatchEvent(mT),l&&(h=pT.now());const M=this.stepnumber%(this.quatNormalizeSkip+1)==0,C=this.quatNormalizeFast;for(v=0;v!==r;v++)s[v].integrate(t,M,C);this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=pT.now()-h),this.stepnumber+=1,this.dispatchEvent(fT);let A=!0;if(this.allowSleep)for(A=!1,v=0;v!==r;v++){const t=s[v];t.sleepTick(this.time),t.sleepState!==Dw.SLEEPING&&(A=!0)}this.hasActiveBodies=A}emitContactEvents(){const t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(xT,wT),t){for(let t=0,e=xT.length;t<e;t+=2)ST.bodyA=this.getBodyById(xT[t]),ST.bodyB=this.getBodyById(xT[t+1]),this.dispatchEvent(ST);ST.bodyA=ST.bodyB=null}if(e){for(let t=0,e=wT.length;t<e;t+=2)MT.bodyA=this.getBodyById(wT[t]),MT.bodyB=this.getBodyById(wT[t+1]),this.dispatchEvent(MT);MT.bodyA=MT.bodyB=null}xT.length=wT.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(xT,wT),n){for(let t=0,e=xT.length;t<e;t+=2){const e=this.getShapeById(xT[t]),n=this.getShapeById(xT[t+1]);CT.shapeA=e,CT.shapeB=n,e&&(CT.bodyA=e.body),n&&(CT.bodyB=n.body),this.dispatchEvent(CT)}CT.bodyA=CT.bodyB=CT.shapeA=CT.shapeB=null}if(i){for(let t=0,e=wT.length;t<e;t+=2){const e=this.getShapeById(wT[t]),n=this.getShapeById(wT[t+1]);AT.shapeA=e,AT.shapeB=n,e&&(AT.bodyA=e.body),n&&(AT.bodyB=n.body),this.dispatchEvent(AT)}AT.bodyA=AT.bodyB=AT.shapeA=AT.shapeB=null}}clearForces(){const t=this.bodies,e=t.length;for(let n=0;n!==e;n++){const e=t[n];e.force,e.torque,e.force.set(0,0,0),e.torque.set(0,0,0)}}}new aw;const dT=new cS,pT=globalThis.performance||{};if(!pT.now){let t=Date.now();pT.timing&&pT.timing.navigationStart&&(t=pT.timing.navigationStart),pT.now=()=>Date.now()-t}new iw;const fT={type:"postStep"},mT={type:"preStep"},gT={type:Dw.COLLIDE_EVENT_NAME,body:null,contact:null},vT=[],yT=[],_T=[],bT=[],xT=[],wT=[],ST={type:"beginContact",bodyA:null,bodyB:null},MT={type:"endContact",bodyA:null,bodyB:null},CT={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},AT={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var TT=function(){var t=0,e=document.createElement("div");function n(t){return e.appendChild(t.dom),t}function i(n){for(var i=0;i<e.children.length;i++)e.children[i].style.display=i===n?"block":"none";t=n}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(n){n.preventDefault(),i(++t%e.children.length)}),!1);var r=(performance||Date).now(),s=r,o=0,a=n(new TT.Panel("FPS","#0ff","#002")),l=n(new TT.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new TT.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:n,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(l.update(t-r,200),t>=s+1e3&&(a.update(1e3*o/(t-s),100),s=t,o=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:e,setMode:i}};TT.Panel=function(t,e,n){var i=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,u=2*o,h=3*o,d=15*o,p=74*o,f=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(t,c,u),g.fillRect(h,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,p,f),{dom:m,update:function(l,v){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(i)+"-"+s(r)+")",c,u),g.drawImage(m,h+o,d,p-o,f,h,d,p-o,f),g.fillRect(h+p-o,d,o,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+p-o,d,o,s((1-l/v)*f))}}};const ET=TT,IT={type:"change"},RT={type:"start"},NT={type:"end"};class DT extends ud{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Jd,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:kc,MIDDLE:Pc,RIGHT:Fc},this.touches={ONE:Bc,TWO:Uc},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",G),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(IT),n.update(),r=i.NONE},this.update=function(){const e=new Jd,h=(new $d).setFromUnitVectors(t.up,new Jd(0,1,0)),d=h.clone().invert(),p=new Jd,f=new $d,m=2*Math.PI;return function(){const t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(h),o.setFromVector3(e),n.autoRotate&&r===i.NONE&&S(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(o.theta+=a.theta*n.dampingFactor,o.phi+=a.phi*n.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let g=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(g)&&isFinite(v)&&(g<-Math.PI?g+=m:g>Math.PI&&(g-=m),v<-Math.PI?v+=m:v>Math.PI&&(v-=m),o.theta=g<=v?Math.max(g,Math.min(v,o.theta)):o.theta>(g+v)/2?Math.max(g,o.theta):Math.min(v,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=l,o.radius=Math.max(n.minDistance,Math.min(n.maxDistance,o.radius)),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),e.setFromSpherical(o),e.applyQuaternion(d),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(a.theta*=1-n.dampingFactor,a.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(a.set(0,0,0),c.set(0,0,0)),l=1,!!(u||p.distanceToSquared(n.object.position)>s||8*(1-f.dot(n.object.quaternion))>s)&&(n.dispatchEvent(IT),p.copy(n.object.position),f.copy(n.object.quaternion),u=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",H),n.domElement.removeEventListener("pointerdown",B),n.domElement.removeEventListener("pointercancel",V),n.domElement.removeEventListener("wheel",W),n.domElement.removeEventListener("pointermove",z),n.domElement.removeEventListener("pointerup",U),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",G)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const s=1e-6,o=new Ux,a=new Ux;let l=1;const c=new Jd;let u=!1;const h=new Cd,d=new Cd,p=new Cd,f=new Cd,m=new Cd,g=new Cd,v=new Cd,y=new Cd,_=new Cd,b=[],x={};function w(){return Math.pow(.95,n.zoomSpeed)}function S(t){a.theta-=t}function M(t){a.phi-=t}const C=function(){const t=new Jd;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),c.add(t)}}(),A=function(){const t=new Jd;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),c.add(t)}}(),T=function(){const t=new Jd;return function(e,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),C(2*e*o/r.clientHeight,n.object.matrix),A(2*i*o/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(C(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),A(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):n.enablePan=!1}}();function E(t){n.object.isPerspectiveCamera?l/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),u=!0):n.enableZoom=!1}function I(t){n.object.isPerspectiveCamera?l*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),u=!0):n.enableZoom=!1}function R(t){h.set(t.clientX,t.clientY)}function N(t){f.set(t.clientX,t.clientY)}function D(){if(1===b.length)h.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);h.set(t,e)}}function L(){if(1===b.length)f.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);f.set(t,e)}}function O(){const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY,n=Math.sqrt(t*t+e*e);v.set(0,n)}function k(t){if(1==b.length)d.set(t.pageX,t.pageY);else{const e=X(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);d.set(n,i)}p.subVectors(d,h).multiplyScalar(n.rotateSpeed);const e=n.domElement;S(2*Math.PI*p.x/e.clientHeight),M(2*Math.PI*p.y/e.clientHeight),h.copy(d)}function P(t){if(1===b.length)m.set(t.pageX,t.pageY);else{const e=X(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);m.set(n,i)}g.subVectors(m,f).multiplyScalar(n.panSpeed),T(g.x,g.y),f.copy(m)}function F(t){const e=X(t),i=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(i*i+r*r);y.set(0,s),_.set(0,Math.pow(y.y/v.y,n.zoomSpeed)),E(_.y),v.copy(y)}function B(t){!1!==n.enabled&&(0===b.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",z),n.domElement.addEventListener("pointerup",U)),function(t){b.push(t)}(t),"touch"===t.pointerType?function(t){switch(q(t),b.length){case 1:switch(n.touches.ONE){case Bc:if(!1===n.enableRotate)return;D(),r=i.TOUCH_ROTATE;break;case zc:if(!1===n.enablePan)return;L(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case Uc:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&O(),n.enablePan&&L(),r=i.TOUCH_DOLLY_PAN;break;case Vc:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&O(),n.enableRotate&&D(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(RT)}(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Pc:if(!1===n.enableZoom)return;!function(t){v.set(t.clientX,t.clientY)}(t),r=i.DOLLY;break;case kc:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;N(t),r=i.PAN}else{if(!1===n.enableRotate)return;R(t),r=i.ROTATE}break;case Fc:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;R(t),r=i.ROTATE}else{if(!1===n.enablePan)return;N(t),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(RT)}(t))}function z(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(q(t),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;k(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;P(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&F(t),n.enablePan&&P(t)}(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&F(t),n.enableRotate&&k(t)}(t),n.update();break;default:r=i.NONE}}(t):function(t){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function(t){d.set(t.clientX,t.clientY),p.subVectors(d,h).multiplyScalar(n.rotateSpeed);const e=n.domElement;S(2*Math.PI*p.x/e.clientHeight),M(2*Math.PI*p.y/e.clientHeight),h.copy(d),n.update()}(t);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(t){y.set(t.clientX,t.clientY),_.subVectors(y,v),_.y>0?E(w()):_.y<0&&I(w()),v.copy(y),n.update()}(t);break;case i.PAN:if(!1===n.enablePan)return;!function(t){m.set(t.clientX,t.clientY),g.subVectors(m,f).multiplyScalar(n.panSpeed),T(g.x,g.y),f.copy(m),n.update()}(t)}}(t))}function U(t){j(t),0===b.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",z),n.domElement.removeEventListener("pointerup",U)),n.dispatchEvent(NT),r=i.NONE}function V(t){j(t)}function W(t){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(t.preventDefault(),n.dispatchEvent(RT),function(t){t.deltaY<0?I(w()):t.deltaY>0&&E(w()),n.update()}(t),n.dispatchEvent(NT))}function G(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?M(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):T(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?M(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):T(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?S(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):T(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?S(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):T(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function H(t){!1!==n.enabled&&t.preventDefault()}function j(t){delete x[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function q(t){let e=x[t.pointerId];void 0===e&&(e=new Cd,x[t.pointerId]=e),e.set(t.pageX,t.pageY)}function X(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return x[e.pointerId]}n.domElement.addEventListener("contextmenu",H),n.domElement.addEventListener("pointerdown",B),n.domElement.addEventListener("pointercancel",V),n.domElement.addEventListener("wheel",W,{passive:!1}),this.update()}}function LT(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function OT(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}
/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var kT,PT,FT,BT,zT,UT,VT,WT,GT,HT,jT,qT,XT,YT,ZT,KT,$T,JT,QT,tE,eE,nE,iE,rE,sE,oE,aE,lE,cE,uE,hE,dE,pE={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},fE={duration:.5,overwrite:!1,delay:0},mE=1e8,gE=1e-8,vE=2*Math.PI,yE=vE/4,_E=0,bE=Math.sqrt,xE=Math.cos,wE=Math.sin,SE=function(t){return"string"==typeof t},ME=function(t){return"function"==typeof t},CE=function(t){return"number"==typeof t},AE=function(t){return void 0===t},TE=function(t){return"object"==typeof t},EE=function(t){return!1!==t},IE=function(){return"undefined"!=typeof window},RE=function(t){return ME(t)||SE(t)},NE="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},DE=Array.isArray,LE=/(?:-?\.?\d|\.)+/gi,OE=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,kE=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,PE=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,FE=/[+-]=-?[.\d]+/,BE=/[^,'"\[\]\s]+/gi,zE=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,UE={},VE={},WE=function(t){return(VE=gI(t,UE))&&gN},GE=function(t,e){return!e&&void 0},HE=function(t,e){return t&&(UE[t]=e)&&VE&&(VE[t]=e)||UE},jE=function(){return 0},qE={suppressEvents:!0,isStart:!0,kill:!1},XE={suppressEvents:!0,kill:!1},YE={suppressEvents:!0},ZE={},KE=[],$E={},JE={},QE={},tI=30,eI=[],nI="",iI=function(t){var e,n,i=t[0];if(TE(i)||ME(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=eI.length;n--&&!eI[n].targetTest(i););e=eI[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new RR(t[n],e)))||t.splice(n,1);return t},rI=function(t){return t._gsap||iI(XI(t))[0]._gsap},sI=function(t,e,n){return(n=t[e])&&ME(n)?t[e]():AE(n)&&t.getAttribute&&t.getAttribute(e)||n},oI=function(t,e){return(t=t.split(",")).forEach(e)||t},aI=function(t){return Math.round(1e5*t)/1e5||0},lI=function(t){return Math.round(1e7*t)/1e7||0},cI=function(t,e){var n=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),"+"===n?t+i:"-"===n?t-i:"*"===n?t*i:t/i},uI=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},hI=function(){var t,e,n=KE.length,i=KE.slice(0);for($E={},KE.length=0,t=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},dI=function(t,e,n,i){KE.length&&!PT&&hI(),t.render(e,n,i||PT&&e<0&&(t._initted||t._startAt)),KE.length&&!PT&&hI()},pI=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(BE).length<2?e:SE(t)?t.trim():t},fI=function(t){return t},mI=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},gI=function(t,e){for(var n in e)t[n]=e[n];return t},vI=function t(e,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(e[i]=TE(n[i])?t(e[i]||(e[i]={}),n[i]):n[i]);return e},yI=function(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i},_I=function(t){var e,n=t.parent||BT,i=t.keyframes?(e=DE(t.keyframes),function(t,n){for(var i in n)i in t||"duration"===i&&e||"ease"===i||(t[i]=n[i])}):mI;if(EE(t.inherit))for(;n;)i(t,n.vars.defaults),n=n.parent||n._dp;return t},bI=function(t,e,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var s,o=t[i];if(r)for(s=e[r];o&&o[r]>s;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=o,e.parent=e._dp=t,e},xI=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,s=e._next;r?r._next=s:t[n]===e&&(t[n]=s),s?s._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},wI=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},SI=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},MI=function(t,e,n,i){return t._startAt&&(PT?t._startAt.revert(XE):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,i))},CI=function t(e){return!e||e._ts&&t(e.parent)},AI=function(t){return t._repeat?TI(t._tTime,t=t.duration()+t._rDelay)*t:0},TI=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},EI=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},II=function(t){return t._end=lI(t._start+(t._tDur/Math.abs(t._ts||t._rts||gE)||0))},RI=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=lI(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),II(t),n._dirty||SI(n,t)),t},NI=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=EI(t.rawTime(),e),(!e._dur||GI(0,e.totalDuration(),n)-e._tTime>gE)&&e.render(n,!0)),SI(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},DI=function(t,e,n,i){return e.parent&&wI(e),e._start=lI((CE(n)?n:n||t!==BT?UI(t,n,e):t._time)+e._delay),e._end=lI(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),bI(t,e,"_first","_last",t._sort?"_start":0),PI(e)||(t._recent=e),i||NI(t,e),t._ts<0&&RI(t,t._tTime),t},LI=function(t,e){return UE.ScrollTrigger?UE.ScrollTrigger.create(e,t):void 0},OI=function(t,e,n,i,r){return BR(t,e,r),t._initted?!n&&t._pt&&!PT&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&GT!==vR.frame?(KE.push(t),t._lazy=[r,i],1):void 0:1},kI=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},PI=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},FI=function(t,e,n,i){var r=t._repeat,s=lI(e)||0,o=t._tTime/t._tDur;return o&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=r?r<0?1e10:lI(s*(r+1)+t._rDelay*r):s,o>0&&!i&&RI(t,t._tTime=t._tDur*o),t.parent&&II(t),n||SI(t.parent,t),t},BI=function(t){return t instanceof DR?SI(t):FI(t,t._dur)},zI={_start:0,endTime:jE,totalDuration:jE},UI=function t(e,n,i){var r,s,o,a=e.labels,l=e._recent||zI,c=e.duration()>=mE?l.endTime(!1):e._dur;return SE(n)&&(isNaN(n)||n in a)?(s=n.charAt(0),o="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(o?(r<0?l:i).totalDuration()/100:1)):r<0?(n in a||(a[n]=c),a[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),o&&i&&(s=s/100*(DE(i)?i[0]:i).totalDuration()),r>1?t(e,n.substr(0,r-1),i)+s:c+s)):null==n?c:+n},VI=function(t,e,n){var i,r,s=CE(e[1]),o=(s?2:1)+(t<2?0:1),a=e[o];if(s&&(a.duration=e[1]),a.parent=n,t){for(i=a,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=EE(r.vars.inherit)&&r.parent;a.immediateRender=EE(i.immediateRender),t<2?a.runBackwards=1:a.startAt=e[o-1]}return new GR(e[0],a,e[o+1])},WI=function(t,e){return t||0===t?e(t):e},GI=function(t,e,n){return n<t?t:n>e?e:n},HI=function(t,e){return SE(t)&&(e=zE.exec(t))?e[1]:""},jI=[].slice,qI=function(t,e){return t&&TE(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&TE(t[0]))&&!t.nodeType&&t!==zT},XI=function(t,e,n){return FT&&!e&&FT.selector?FT.selector(t):!SE(t)||n||!UT&&yR()?DE(t)?function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var i;return SE(t)&&!e||qI(t,1)?(i=n).push.apply(i,XI(t)):n.push(t)}))||n}(t,n):qI(t)?jI.call(t,0):t?[t]:[]:jI.call((e||VT).querySelectorAll(t),0)},YI=function(t){return t=XI(t)[0]||GE()||{},function(e){var n=t.current||t.nativeElement||t;return XI(e,n.querySelectorAll?n:n===t?GE()||VT.createElement("div"):t)}},ZI=function(t){return t.sort((function(){return.5-Math.random()}))},KI=function(t){if(ME(t))return t;var e=TE(t)?t:{each:t},n=CR(e.ease),i=e.from||0,r=parseFloat(e.base)||0,s={},o=i>0&&i<1,a=isNaN(i)||o,l=e.axis,c=i,u=i;return SE(i)?c=u={center:.5,edges:.5,end:1}[i]||0:!o&&a&&(c=i[0],u=i[1]),function(t,o,h){var d,p,f,m,g,v,y,_,b,x=(h||e).length,w=s[x];if(!w){if(!(b="auto"===e.grid?0:(e.grid||[1,mE])[1])){for(y=-1e8;y<(y=h[b++].getBoundingClientRect().left)&&b<x;);b<x&&b--}for(w=s[x]=[],d=a?Math.min(b,x)*c-.5:i%b,p=b===mE?0:a?x*u/b-.5:i/b|0,y=0,_=mE,v=0;v<x;v++)f=v%b-d,m=p-(v/b|0),w[v]=g=l?Math.abs("y"===l?m:f):bE(f*f+m*m),g>y&&(y=g),g<_&&(_=g);"random"===i&&ZI(w),w.max=y-_,w.min=_,w.v=x=(parseFloat(e.amount)||parseFloat(e.each)*(b>x?x-1:l?"y"===l?x/b:b:Math.max(b,x/b))||0)*("edges"===i?-1:1),w.b=x<0?r-x:r,w.u=HI(e.amount||e.each)||0,n=n&&x<0?SR(n):n}return x=(w[t]-w.min)/w.max||0,lI(w.b+(n?n(x):x)*w.v)+w.u}},$I=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var i=lI(Math.round(parseFloat(n)/t)*t*e);return(i-i%1)/e+(CE(n)?0:HI(n))}},JI=function(t,e){var n,i,r=DE(t);return!r&&TE(t)&&(n=r=t.radius||mE,t.values?(t=XI(t.values),(i=!CE(t[0]))&&(n*=n)):t=$I(t.increment)),WI(e,r?ME(t)?function(e){return i=t(e),Math.abs(i-e)<=n?i:e}:function(e){for(var r,s,o=parseFloat(i?e.x:e),a=parseFloat(i?e.y:0),l=mE,c=0,u=t.length;u--;)(r=i?(r=t[u].x-o)*r+(s=t[u].y-a)*s:Math.abs(t[u]-o))<l&&(l=r,c=u);return c=!n||l<=n?t[c]:e,i||c===e||CE(e)?c:c+HI(e)}:$I(t))},QI=function(t,e,n,i){return WI(DE(t)?!e:!0===n?!!(n=0):!i,(function(){return DE(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*i)/i}))},tR=function(t,e,n){return WI(n,(function(n){return t[~~e(n)]}))},eR=function(t){for(var e,n,i,r,s=0,o="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?BE:LE),o+=t.substr(s,e-s)+QI(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return o+t.substr(s,t.length-s)},nR=function(t,e,n,i,r){var s=e-t,o=i-n;return WI(r,(function(e){return n+((e-t)/s*o||0)}))},iR=function(t,e,n){var i,r,s,o=t.labels,a=mE;for(i in o)(r=o[i]-e)<0==!!n&&r&&a>(r=Math.abs(r))&&(s=i,a=r);return s},rR=function(t,e,n){var i,r,s,o=t.vars,a=o[e],l=FT,c=t._ctx;if(a)return i=o[e+"Params"],r=o.callbackScope||t,n&&KE.length&&hI(),c&&(FT=c),s=i?a.apply(r,i):a.call(r),FT=l,s},sR=function(t){return wI(t),t.scrollTrigger&&t.scrollTrigger.kill(!!PT),t.progress()<1&&rR(t,"onInterrupt"),t},oR=[],aR=function(t){if(t)if(t=!t.name&&t.default||t,IE()||t.headless){var e=t.name,n=ME(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:jE,render:JR,add:PR,kill:tN,modifier:QR,rawVars:0},s={targetTest:0,get:0,getSetter:YR,aliases:{},register:0};if(yR(),t!==i){if(JE[e])return;mI(i,mI(yI(t,r),s)),gI(i.prototype,gI(r,yI(t,s))),JE[i.prop=e]=i,t.targetTest&&(eI.push(i),ZE[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}HE(e,i),t.register&&t.register(gN,i,iN)}else oR.push(t)},lR=255,cR={aqua:[0,lR,lR],lime:[0,lR,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,lR],navy:[0,0,128],white:[lR,lR,lR],olive:[128,128,0],yellow:[lR,lR,0],orange:[lR,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[lR,0,0],pink:[lR,192,203],cyan:[0,lR,lR],transparent:[lR,lR,lR,0]},uR=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*lR+.5|0},hR=function(t,e,n){var i,r,s,o,a,l,c,u,h,d,p=t?CE(t)?[t>>16,t>>8&lR,t&lR]:0:cR.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),cR[t])p=cR[t];else if("#"===t.charAt(0)){if(t.length<6&&(i=t.charAt(1),r=t.charAt(2),s=t.charAt(3),t="#"+i+i+r+r+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&lR,p&lR,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&lR,t&lR]}else if("hsl"===t.substr(0,3))if(p=d=t.match(LE),e){if(~t.indexOf("="))return p=t.match(OE),n&&p.length<4&&(p[3]=1),p}else o=+p[0]%360/360,a=+p[1]/100,i=2*(l=+p[2]/100)-(r=l<=.5?l*(a+1):l+a-l*a),p.length>3&&(p[3]*=1),p[0]=uR(o+1/3,i,r),p[1]=uR(o,i,r),p[2]=uR(o-1/3,i,r);else p=t.match(LE)||cR.transparent;p=p.map(Number)}return e&&!d&&(i=p[0]/lR,r=p[1]/lR,s=p[2]/lR,l=((c=Math.max(i,r,s))+(u=Math.min(i,r,s)))/2,c===u?o=a=0:(h=c-u,a=l>.5?h/(2-c-u):h/(c+u),o=c===i?(r-s)/h+(r<s?6:0):c===r?(s-i)/h+2:(i-r)/h+4,o*=60),p[0]=~~(o+.5),p[1]=~~(100*a+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},dR=function(t){var e=[],n=[],i=-1;return t.split(fR).forEach((function(t){var r=t.match(kE)||[];e.push.apply(e,r),n.push(i+=r.length+1)})),e.c=n,e},pR=function(t,e,n){var i,r,s,o,a="",l=(t+a).match(fR),c=e?"hsla(":"rgba(",u=0;if(!l)return t;if(l=l.map((function(t){return(t=hR(t,e,1))&&c+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(s=dR(t),(i=n.c).join(a)!==s.c.join(a)))for(o=(r=t.replace(fR,"1").split(kE)).length-1;u<o;u++)a+=r[u]+(~i.indexOf(u)?l.shift()||c+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(o=(r=t.split(fR)).length-1;u<o;u++)a+=r[u]+l[u];return a+r[o]},fR=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in cR)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),mR=/hsl[a]?\(/,gR=function(t){var e,n=t.join(" ");if(fR.lastIndex=0,fR.test(n))return e=mR.test(n),t[1]=pR(t[1],e),t[0]=pR(t[0],e,dR(t[1])),!0},vR=(JT=Date.now,QT=500,tE=33,eE=JT(),nE=eE,rE=iE=1e3/240,oE=function t(e){var n,i,r,s,o=JT()-nE,a=!0===e;if((o>QT||o<0)&&(eE+=o-tE),((n=(r=(nE+=o)-eE)-rE)>0||a)&&(s=++ZT.frame,KT=r-1e3*ZT.time,ZT.time=r/=1e3,rE+=n+(n>=iE?4:iE-n),i=1),a||(qT=XT(t)),i)for($T=0;$T<sE.length;$T++)sE[$T](r,KT,s,e)},ZT={time:0,frame:0,tick:function(){oE(!0)},deltaRatio:function(t){return KT/(1e3/(t||60))},wake:function(){WT&&(!UT&&IE()&&(zT=UT=window,VT=zT.document||{},UE.gsap=gN,(zT.gsapVersions||(zT.gsapVersions=[])).push(gN.version),WE(VE||zT.GreenSockGlobals||!zT.gsap&&zT||{}),oR.forEach(aR)),YT="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,qT&&ZT.sleep(),XT=YT||function(t){return setTimeout(t,rE-1e3*ZT.time+1|0)},jT=1,oE(2))},sleep:function(){(YT?cancelAnimationFrame:clearTimeout)(qT),jT=0,XT=jE},lagSmoothing:function(t,e){QT=t||1/0,tE=Math.min(e||33,QT)},fps:function(t){iE=1e3/(t||240),rE=1e3*ZT.time+iE},add:function(t,e,n){var i=e?function(e,n,r,s){t(e,n,r,s),ZT.remove(i)}:t;return ZT.remove(t),sE[n?"unshift":"push"](i),yR(),i},remove:function(t,e){~(e=sE.indexOf(t))&&sE.splice(e,1)&&$T>=e&&$T--},_listeners:sE=[]}),yR=function(){return!jT&&vR.wake()},_R={},bR=/^[\d.\-M][\d.\-,\s]/,xR=/["']/g,wR=function(t){for(var e,n,i,r={},s=t.substr(1,t.length-3).split(":"),o=s[0],a=1,l=s.length;a<l;a++)n=s[a],e=a!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[o]=isNaN(i)?i.replace(xR,"").trim():+i,o=n.substr(e+1).trim();return r},SR=function(t){return function(e){return 1-t(1-e)}},MR=function t(e,n){for(var i,r=e._first;r;)r instanceof DR?t(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?t(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},CR=function(t,e){return t&&(ME(t)?t:_R[t]||function(t){var e,n,i,r,s=(t+"").split("("),o=_R[s[0]];return o&&s.length>1&&o.config?o.config.apply(null,~t.indexOf("{")?[wR(s[1])]:(e=t,n=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",n),e.substring(n,~r&&r<i?e.indexOf(")",i+1):i)).split(",").map(pI)):_R._CE&&bR.test(t)?_R._CE("",t):o}(t))||e},AR=function(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,s={easeIn:e,easeOut:n,easeInOut:i};return oI(t,(function(t){for(var e in _R[t]=UE[t]=s,_R[r=t.toLowerCase()]=n,s)_R[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=_R[t+"."+e]=s[e]})),s},TR=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},ER=function t(e,n,i){var r=n>=1?n:1,s=(i||(e?.3:.45))/(n<1?n:1),o=s/vE*(Math.asin(1/r)||0),a=function(t){return 1===t?1:r*Math.pow(2,-10*t)*wE((t-o)*s)+1},l="out"===e?a:"in"===e?function(t){return 1-a(1-t)}:TR(a);return s=vE/s,l.config=function(n,i){return t(e,n,i)},l},IR=function t(e,n){void 0===n&&(n=1.70158);var i=function(t){return t?--t*t*((n+1)*t+n)+1:0},r="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:TR(i);return r.config=function(n){return t(e,n)},r};oI("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;AR(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),_R.Linear.easeNone=_R.none=_R.Linear.easeIn,AR("Elastic",ER("in"),ER("out"),ER()),aE=7.5625,uE=2*(cE=1/(lE=2.75)),hE=2.5*cE,AR("Bounce",(function(t){return 1-dE(1-t)}),dE=function(t){return t<cE?aE*t*t:t<uE?aE*Math.pow(t-1.5/lE,2)+.75:t<hE?aE*(t-=2.25/lE)*t+.9375:aE*Math.pow(t-2.625/lE,2)+.984375}),AR("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),AR("Circ",(function(t){return-(bE(1-t*t)-1)})),AR("Sine",(function(t){return 1===t?1:1-xE(t*yE)})),AR("Back",IR("in"),IR("out"),IR()),_R.SteppedEase=_R.steps=UE.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,i=t+(e?0:1),r=e?1:0;return function(t){return((i*GI(0,.99999999,t)|0)+r)*n}}},fE.ease=_R["quad.out"],oI("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return nI+=t+","+t+"Params,"}));var RR=function(t,e){this.id=_E++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:sI,this.set=e?e.getSetter:YR},NR=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,FI(this,+t.duration,1,1),this.data=t.data,FT&&(this._ctx=FT,FT.data.push(this)),jT||vR.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,FI(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(yR(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(RI(this,t),!n._dp||n.parent||NI(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&DI(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===gE||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),dI(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+AI(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+AI(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?TI(this._tTime,n)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var n=this.parent&&this._ts?EI(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime(GI(-Math.abs(this._delay),this._tDur,n),!1!==e),II(this),function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(yR(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==gE&&(this._tTime-=gE)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&DI(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(EE(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?EI(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=YE);var e=PT;return PT=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),PT=e,this},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,BI(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,BI(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(UI(this,t),EE(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,EE(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-gE))},e.eventCallback=function(t,e,n){var i=this.vars;return arguments.length>1?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise((function(n){var i=ME(t)?t:fI,r=function(){var t=e.then;e.then=null,ME(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),n(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?r():e._prom=r}))},e.kill=function(){sR(this)},t}();mI(NR.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var DR=function(t){function e(e,n){var i;return void 0===e&&(e={}),(i=t.call(this,e)||this).labels={},i.smoothChildTiming=!!e.smoothChildTiming,i.autoRemoveChildren=!!e.autoRemoveChildren,i._sort=EE(e.sortChildren),BT&&DI(e.parent||BT,LT(i),n),e.reversed&&i.reverse(),e.paused&&i.paused(!0),e.scrollTrigger&&LI(LT(i),e.scrollTrigger),i}OT(e,t);var n=e.prototype;return n.to=function(t,e,n){return VI(0,arguments,this),this},n.from=function(t,e,n){return VI(1,arguments,this),this},n.fromTo=function(t,e,n,i){return VI(2,arguments,this),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,_I(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new GR(t,e,UI(this,n),1),this},n.call=function(t,e,n){return DI(this,GR.delayedCall(0,t,e),n)},n.staggerTo=function(t,e,n,i,r,s,o){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=o,n.parent=this,new GR(t,n,UI(this,r)),this},n.staggerFrom=function(t,e,n,i,r,s,o){return n.runBackwards=1,_I(n).immediateRender=EE(n.immediateRender),this.staggerTo(t,e,n,i,r,s,o)},n.staggerFromTo=function(t,e,n,i,r,s,o,a){return i.startAt=n,_I(i).immediateRender=EE(i.immediateRender),this.staggerTo(t,e,i,r,s,o,a)},n.render=function(t,e,n){var i,r,s,o,a,l,c,u,h,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,y=t<=0?0:lI(t),_=this._zTime<0!=t<0&&(this._initted||!v);if(this!==BT&&y>g&&t>=0&&(y=g),y!==this._tTime||n||_){if(m!==this._time&&v&&(y+=this._time-m,t+=this._time-m),i=y,h=this._start,l=!(u=this._ts),_&&(v||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,a=v+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*a+t,e,n);if(i=lI(y%a),y===g?(o=this._repeat,i=v):((o=~~(y/a))&&o===y/a&&(i=v,o--),i>v&&(i=v)),d=TI(this._tTime,a),!m&&this._tTime&&d!==o&&this._tTime-d*a-this._dur<=0&&(d=o),p&&1&o&&(i=v-i,f=1),o!==d&&!this._lock){var b=p&&1&d,x=b===(p&&1&o);if(o<d&&(b=!b),m=b?0:y%v?v:y,this._lock=1,this.render(m||(f?0:lI(o*a)),e,!v)._lock=0,this._tTime=y,!e&&this.parent&&rR(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,x&&(this._lock=2,m=b?v:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;MR(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,lI(m),lI(i)),c&&(y-=i-(i=c._start))),this._tTime=y,this._time=i,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&i&&!e&&!o&&(rR(this,"onStart"),this._tTime!==y))return this;if(i>=m&&t>=0)for(r=this._first;r;){if(s=r._next,(r._act||i>=r._start)&&r._ts&&c!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,e,n),i!==this._time||!this._ts&&!l){c=0,s&&(y+=this._zTime=-1e-8);break}}r=s}else{r=this._last;for(var w=t<0?t:i;r;){if(s=r._prev,(r._act||w<=r._end)&&r._ts&&c!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(w-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(w-r._start)*r._ts,e,n||PT&&(r._initted||r._startAt)),i!==this._time||!this._ts&&!l){c=0,s&&(y+=this._zTime=w?-1e-8:gE);break}}r=s}}if(c&&!e&&(this.pause(),c.render(i>=m?0:-1e-8)._zTime=i>=m?1:-1,this._ts))return this._start=h,II(this),this.render(t,e,n);this._onUpdate&&!e&&rR(this,"onUpdate",!0),(y===g&&this._tTime>=this.totalDuration()||!y&&m)&&(h!==this._start&&Math.abs(u)===Math.abs(this._ts)||this._lock||((t||!v)&&(y===g&&this._ts>0||!y&&this._ts<0)&&wI(this,1),e||t<0&&!m||!y&&!m&&g||(rR(this,y===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(CE(e)||(e=UI(this,e,t)),!(t instanceof NR)){if(DE(t))return t.forEach((function(t){return n.add(t,e)})),this;if(SE(t))return this.addLabel(t,e);if(!ME(t))return this;t=GR.delayedCall(0,t)}return this!==t?DI(this,t,e):this},n.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-1e8);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof GR?e&&r.push(s):(n&&r.push(s),t&&r.push.apply(r,s.getChildren(!0,e,n)))),s=s._next;return r},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return SE(t)?this.removeLabel(t):ME(t)?this.killTweensOf(t):(xI(this,t),t===this._recent&&(this._recent=this._last),SI(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=lI(vR.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=UI(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var i=GR.delayedCall(0,e||jE,n);return i.data="isPause",this._hasPause=1,DI(this,i,UI(this,t))},n.removePause=function(t){var e=this._first;for(t=UI(this,t);e;)e._start===t&&"isPause"===e.data&&wI(e),e=e._next},n.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)LR!==i[r]&&i[r].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,i=[],r=XI(t),s=this._first,o=CE(e);s;)s instanceof GR?uI(s._targets,r)&&(o?(!LR||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(n=s.getTweensOf(r,e)).length&&i.push.apply(i,n),s=s._next;return i},n.tweenTo=function(t,e){e=e||{};var n,i=this,r=UI(i,t),s=e,o=s.startAt,a=s.onStart,l=s.onStartParams,c=s.immediateRender,u=GR.to(i,mI({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale())||gE,onStart:function(){if(i.pause(),!n){var t=e.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale());u._dur!==t&&FI(u,t,0,1).render(u._time,!0,!0),n=1}a&&a.apply(u,l||[])}},e));return c?u.render(0):u},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,mI({startAt:{time:UI(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),iR(this,UI(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),iR(this,UI(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+gE)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=t,r._end+=t),r=r._next;if(e)for(i in s)s[i]>=n&&(s[i]+=t);return SI(this)},n.invalidate=function(e){var n=this._first;for(this._lock=0;n;)n.invalidate(e),n=n._next;return t.prototype.invalidate.call(this,e)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),SI(this)},n.totalDuration=function(t){var e,n,i,r=0,s=this,o=s._last,a=mE;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(i=s.parent;o;)e=o._prev,o._dirty&&o.totalDuration(),(n=o._start)>a&&s._sort&&o._ts&&!s._lock?(s._lock=1,DI(s,o,n-o._delay,1)._lock=0):a=n,n<0&&o._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-1/0),a=0),o._end>r&&o._ts&&(r=o._end),o=e;FI(s,s===BT&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(t){if(BT._ts&&(dI(BT,EI(t,BT)),GT=vR.frame),vR.frame>=tI){tI+=pE.autoSleep||120;var e=BT._first;if((!e||!e._ts)&&pE.autoSleep&&vR._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||vR.sleep()}}},e}(NR);mI(DR.prototype,{_lock:0,_hasPause:0,_forcing:0});var LR,OR,kR=function(t,e,n,i,r,s,o){var a,l,c,u,h,d,p,f,m=new iN(this._pt,t,e,0,1,$R,null,r),g=0,v=0;for(m.b=n,m.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=eR(i)),s&&(s(f=[n,i],t,e),n=f[0],i=f[1]),l=n.match(PE)||[];a=PE.exec(i);)u=a[0],h=i.substring(g,a.index),c?c=(c+1)%5:"rgba("===h.substr(-5)&&(c=1),u!==l[v++]&&(d=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:h||1===v?h:",",s:d,c:"="===u.charAt(1)?cI(d,u)-d:parseFloat(u)-d,m:c&&c<4?Math.round:0},g=PE.lastIndex);return m.c=g<i.length?i.substring(g,i.length):"",m.fp=o,(FE.test(i)||p)&&(m.e=0),this._pt=m,m},PR=function(t,e,n,i,r,s,o,a,l,c){ME(i)&&(i=i(r||0,t,s));var u,h=t[e],d="get"!==n?n:ME(h)?l?t[e.indexOf("set")||!ME(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():h,p=ME(h)?l?qR:jR:HR;if(SE(i)&&(~i.indexOf("random(")&&(i=eR(i)),"="===i.charAt(1)&&((u=cI(d,i)+(HI(d)||0))||0===u)&&(i=u)),!c||d!==i||OR)return isNaN(d*i)||""===i?kR.call(this,t,e,d,i,p,a||pE.stringFilter,l):(u=new iN(this._pt,t,e,+d||0,i-(d||0),"boolean"==typeof h?KR:ZR,0,p),l&&(u.fp=l),o&&u.modifier(o,this,t),this._pt=u)},FR=function(t,e,n,i,r,s){var o,a,l,c;if(JE[t]&&!1!==(o=new JE[t]).init(r,o.rawVars?e[t]:function(t,e,n,i,r){if(ME(t)&&(t=UR(t,r,e,n,i)),!TE(t)||t.style&&t.nodeType||DE(t)||NE(t))return SE(t)?UR(t,r,e,n,i):t;var s,o={};for(s in t)o[s]=UR(t[s],r,e,n,i);return o}(e[t],i,r,s,n),n,i,s)&&(n._pt=a=new iN(n._pt,r,t,0,1,o.render,o,0,o.priority),n!==HT))for(l=n._ptLookup[n._targets.indexOf(r)],c=o._props.length;c--;)l[o._props[c]]=a;return o},BR=function t(e,n,i){var r,s,o,a,l,c,u,h,d,p,f,m,g,v=e.vars,y=v.ease,_=v.startAt,b=v.immediateRender,x=v.lazy,w=v.onUpdate,S=v.runBackwards,M=v.yoyoEase,C=v.keyframes,A=v.autoRevert,T=e._dur,E=e._startAt,I=e._targets,R=e.parent,N=R&&"nested"===R.data?R.vars.targets:I,D="auto"===e._overwrite&&!kT,L=e.timeline;if(L&&(!C||!y)&&(y="none"),e._ease=CR(y,fE.ease),e._yEase=M?SR(CR(!0===M?y:M,fE.ease)):0,M&&e._yoyo&&!e._repeat&&(M=e._yEase,e._yEase=e._ease,e._ease=M),e._from=!L&&!!v.runBackwards,!L||C&&!v.stagger){if(m=(h=I[0]?rI(I[0]).harness:0)&&v[h.prop],r=yI(v,ZE),E&&(E._zTime<0&&E.progress(1),n<0&&S&&b&&!A?E.render(-1,!0):E.revert(S&&T?XE:qE),E._lazy=0),_){if(wI(e._startAt=GR.set(I,mI({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:!E&&EE(x),startAt:null,delay:0,onUpdate:w&&function(){return rR(e,"onUpdate")},stagger:0},_))),e._startAt._dp=0,e._startAt._sat=e,n<0&&(PT||!b&&!A)&&e._startAt.revert(XE),b&&T&&n<=0&&i<=0)return void(n&&(e._zTime=n))}else if(S&&T&&!E)if(n&&(b=!1),o=mI({overwrite:!1,data:"isFromStart",lazy:b&&!E&&EE(x),immediateRender:b,stagger:0,parent:R},r),m&&(o[h.prop]=m),wI(e._startAt=GR.set(I,o)),e._startAt._dp=0,e._startAt._sat=e,n<0&&(PT?e._startAt.revert(XE):e._startAt.render(-1,!0)),e._zTime=n,b){if(!n)return}else t(e._startAt,gE,gE);for(e._pt=e._ptCache=0,x=T&&EE(x)||x&&!T,s=0;s<I.length;s++){if(u=(l=I[s])._gsap||iI(I)[s]._gsap,e._ptLookup[s]=p={},$E[u.id]&&KE.length&&hI(),f=N===I?s:N.indexOf(l),h&&!1!==(d=new h).init(l,m||r,e,f,N)&&(e._pt=a=new iN(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(t){p[t]=a})),d.priority&&(c=1)),!h||m)for(o in r)JE[o]&&(d=FR(o,r,e,f,l,N))?d.priority&&(c=1):p[o]=a=PR.call(e,l,o,"get",r[o],f,N,0,v.stringFilter);e._op&&e._op[s]&&e.kill(l,e._op[s]),D&&e._pt&&(LR=e,BT.killTweensOf(l,p,e.globalTime(n)),g=!e.parent,LR=0),e._pt&&x&&($E[u.id]=1)}c&&nN(e),e._onInit&&e._onInit(e)}e._onUpdate=w,e._initted=(!e._op||e._pt)&&!g,C&&n<=0&&L.render(mE,!0,!0)},zR=function(t,e,n,i){var r,s,o=e.ease||i||"power1.inOut";if(DE(e))s=n[t]||(n[t]=[]),e.forEach((function(t,n){return s.push({t:n/(e.length-1)*100,v:t,e:o})}));else for(r in e)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(t),v:e[r],e:o})},UR=function(t,e,n,i,r){return ME(t)?t.call(e,n,i,r):SE(t)&&~t.indexOf("random(")?eR(t):t},VR=nI+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",WR={};oI(VR+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return WR[t]=1}));var GR=function(t){function e(e,n,i,r){var s;"number"==typeof n&&(i.duration=n,n=i,i=null);var o,a,l,c,u,h,d,p,f=(s=t.call(this,r?n:_I(n))||this).vars,m=f.duration,g=f.delay,v=f.immediateRender,y=f.stagger,_=f.overwrite,b=f.keyframes,x=f.defaults,w=f.scrollTrigger,S=f.yoyoEase,M=n.parent||BT,C=(DE(e)||NE(e)?CE(e[0]):"length"in n)?[e]:XI(e);if(s._targets=C.length?iI(C):GE(0,!pE.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=_,b||y||RE(m)||RE(g)){if(n=s.vars,(o=s.timeline=new DR({data:"nested",defaults:x||{},targets:M&&"nested"===M.data?M.vars.targets:C})).kill(),o.parent=o._dp=LT(s),o._start=0,y||RE(m)||RE(g)){if(c=C.length,d=y&&KI(y),TE(y))for(u in y)~VR.indexOf(u)&&(p||(p={}),p[u]=y[u]);for(a=0;a<c;a++)(l=yI(n,WR)).stagger=0,S&&(l.yoyoEase=S),p&&gI(l,p),h=C[a],l.duration=+UR(m,LT(s),a,h,C),l.delay=(+UR(g,LT(s),a,h,C)||0)-s._delay,!y&&1===c&&l.delay&&(s._delay=g=l.delay,s._start+=g,l.delay=0),o.to(h,l,d?d(a,h,C):0),o._ease=_R.none;o.duration()?m=g=0:s.timeline=0}else if(b){_I(mI(o.vars.defaults,{ease:"none"})),o._ease=CR(b.ease||n.ease||"none");var A,T,E,I=0;if(DE(b))b.forEach((function(t){return o.to(C,t,">")})),o.duration();else{for(u in l={},b)"ease"===u||"easeEach"===u||zR(u,b[u],l,b.easeEach);for(u in l)for(A=l[u].sort((function(t,e){return t.t-e.t})),I=0,a=0;a<A.length;a++)(E={ease:(T=A[a]).e,duration:(T.t-(a?A[a-1].t:0))/100*m})[u]=T.v,o.to(C,E,I),I+=E.duration;o.duration()<m&&o.to({},{duration:m-o.duration()})}}m||s.duration(m=o.duration())}else s.timeline=0;return!0!==_||kT||(LR=LT(s),BT.killTweensOf(C),LR=0),DI(M,LT(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(v||!m&&!b&&s._start===lI(M._time)&&EE(v)&&CI(LT(s))&&"nested"!==M.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-g)||0)),w&&LI(LT(s),w),s}OT(e,t);var n=e.prototype;return n.render=function(t,e,n){var i,r,s,o,a,l,c,u,h,d=this._time,p=this._tDur,f=this._dur,m=t<0,g=t>p-gE&&!m?p:t<gE?0:t;if(f){if(g!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(i=g,u=this.timeline,this._repeat){if(o=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*o+t,e,n);if(i=lI(g%o),g===p?(s=this._repeat,i=f):((s=~~(g/o))&&s===lI(g/o)&&(i=f,s--),i>f&&(i=f)),(l=this._yoyo&&1&s)&&(h=this._yEase,i=f-i),a=TI(this._tTime,o),i===d&&!n&&this._initted&&s===a)return this._tTime=g,this;s!==a&&(u&&this._yEase&&MR(u,l),this.vars.repeatRefresh&&!l&&!this._lock&&this._time!==o&&this._initted&&(this._lock=n=1,this.render(lI(o*s),!0).invalidate()._lock=0))}if(!this._initted){if(OI(this,m?t:i,n,e,g))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==a))return this;if(f!==this._dur)return this.render(t,e,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(h||this._ease)(i/f),this._from&&(this.ratio=c=1-c),i&&!d&&!e&&!s&&(rR(this,"onStart"),this._tTime!==g))return this;for(r=this._pt;r;)r.r(c,r.d),r=r._next;u&&u.render(t<0?t:u._dur*u._ease(i/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&MI(this,t,0,n),rR(this,"onUpdate")),this._repeat&&s!==a&&this.vars.onRepeat&&!e&&this.parent&&rR(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&MI(this,t,0,!0),(t||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&wI(this,1),e||m&&!d||!(g||d||l)||(rR(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,i){var r,s,o,a=t.ratio,l=e<0||!e&&(!t._start&&kI(t)&&(t._initted||!PI(t))||(t._ts<0||t._dp._ts<0)&&!PI(t))?0:1,c=t._rDelay,u=0;if(c&&t._repeat&&(u=GI(0,t._tDur,e),s=TI(u,c),t._yoyo&&1&s&&(l=1-l),s!==TI(t._tTime,c)&&(a=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==a||PT||i||t._zTime===gE||!e&&t._zTime){if(!t._initted&&OI(t,e,i,n,u))return;for(o=t._zTime,t._zTime=e||(n?gE:0),n||(n=e&&!o),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=u,r=t._pt;r;)r.r(l,r.d),r=r._next;e<0&&MI(t,e,0,!0),t._onUpdate&&!n&&rR(t,"onUpdate"),u&&t._repeat&&!n&&t.parent&&rR(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&wI(t,1),n||PT||(rR(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},n.resetTo=function(t,e,n,i,r){jT||vR.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||BR(this,s),function(t,e,n,i,r,s,o,a){var l,c,u,h,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],u=t._ptLookup,h=t._targets.length;h--;){if((l=u[h][e])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==e&&l.fp!==e;)l=l._next;if(!l)return OR=1,t.vars[e]="+=0",BR(t,o),OR=0,a?GE():1;d.push(l)}for(h=d.length;h--;)(l=(c=d[h])._pt||c).s=!i&&0!==i||r?l.s+(i||0)+s*l.c:i,l.c=n-l.s,c.e&&(c.e=aI(n)+HI(c.e)),c.b&&(c.b=l.s+HI(c.b))}(this,t,e,n,i,this._ease(s/this._dur),s,r)?this.resetTo(t,e,n,i,1):(RI(this,0),this.parent||bI(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?sR(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,LR&&!0!==LR.vars.overwrite)._first||sR(this),this.parent&&n!==this.timeline.totalDuration()&&FI(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,o,a,l,c,u=this._targets,h=t?XI(t):u,d=this._ptLookup,p=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(u,h))return"all"===e&&(this._pt=0),sR(this);for(i=this._op=this._op||[],"all"!==e&&(SE(e)&&(a={},oI(e,(function(t){return a[t]=1})),e=a),e=function(t,e){var n,i,r,s,o=t[0]?rI(t[0]).harness:0,a=o&&o.aliases;if(!a)return e;for(i in n=gI({},e),a)if(i in n)for(r=(s=a[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(u,e)),c=u.length;c--;)if(~h.indexOf(u[c]))for(a in r=d[c],"all"===e?(i[c]=e,o=r,s={}):(s=i[c]=i[c]||{},o=e),o)(l=r&&r[a])&&("kill"in l.d&&!0!==l.d.kill(a)||xI(this,l,"_pt"),delete r[a]),"all"!==s&&(s[a]=1);return this._initted&&!this._pt&&p&&sR(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,e){return VI(1,arguments)},e.delayedCall=function(t,n,i,r){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},e.fromTo=function(t,e,n){return VI(2,arguments)},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return BT.killTweensOf(t,e,n)},e}(NR);mI(GR.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),oI("staggerTo,staggerFrom,staggerFromTo",(function(t){GR[t]=function(){var e=new DR,n=jI.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var HR=function(t,e,n){return t[e]=n},jR=function(t,e,n){return t[e](n)},qR=function(t,e,n,i){return t[e](i.fp,n)},XR=function(t,e,n){return t.setAttribute(e,n)},YR=function(t,e){return ME(t[e])?jR:AE(t[e])&&t.setAttribute?XR:HR},ZR=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},KR=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},$R=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},JR=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},QR=function(t,e,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(t,e,n),s=r},tN=function(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?xI(this,i,"_pt"):i.dep||(e=1),i=n;return!e},eN=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},nN=function(t){for(var e,n,i,r,s=t._pt;s;){for(e=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=e}t._pt=i},iN=function(){function t(t,e,n,i,r,s,o,a,l){this.t=e,this.s=i,this.c=r,this.p=n,this.r=s||ZR,this.d=o||this,this.set=a||HR,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=eN,this.m=t,this.mt=n,this.tween=e},t}();oI(nI+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return ZE[t]=1})),UE.TweenMax=UE.TweenLite=GR,UE.TimelineLite=UE.TimelineMax=DR,BT=new DR({sortChildren:!1,defaults:fE,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),pE.stringFilter=gR;var rN=[],sN={},oN=[],aN=0,lN=0,cN=function(t){return(sN[t]||oN).map((function(t){return t()}))},uN=function(){var t=Date.now(),e=[];t-aN>2&&(cN("matchMediaInit"),rN.forEach((function(t){var n,i,r,s,o=t.queries,a=t.conditions;for(i in o)(n=zT.matchMedia(o[i]).matches)&&(r=1),n!==a[i]&&(a[i]=n,s=1);s&&(t.revert(),r&&e.push(t))})),cN("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t,(function(e){return t.add(null,e)}))})),aN=t,cN("matchMedia"))},hN=function(){function t(t,e){this.selector=e&&YI(e),this.data=[],this._r=[],this.isReverted=!1,this.id=lN++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,n){ME(t)&&(n=e,e=t,t=ME);var i=this,r=function(){var t,r=FT,s=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=YI(n)),FT=i,t=e.apply(i,arguments),ME(t)&&i._r.push(t),FT=r,i.selector=s,i.isReverted=!1,t};return i.last=r,t===ME?r(i,(function(t){return i.add(null,t)})):t?i[t]=r:r},e.ignore=function(t){var e=FT;FT=null,t(this),FT=e},e.getTweens=function(){var e=[];return this.data.forEach((function(n){return n instanceof t?e.push.apply(e,n.getTweens()):n instanceof GR&&!(n.parent&&"nested"===n.parent.data)&&e.push(n)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var n=this;if(t?function(){for(var e,i=n.getTweens(),r=n.data.length;r--;)"isFlip"===(e=n.data[r]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(t){return i.splice(i.indexOf(t),1)})));for(i.map((function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t:t}})).sort((function(t,e){return e.g-t.g||-1/0})).forEach((function(e){return e.t.revert(t)})),r=n.data.length;r--;)(e=n.data[r])instanceof DR?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof GR)&&e.revert&&e.revert(t);n._r.forEach((function(e){return e(t,n)})),n.isReverted=!0}():this.data.forEach((function(t){return t.kill&&t.kill()})),this.clear(),e)for(var i=rN.length;i--;)rN[i].id===this.id&&rN.splice(i,1)},e.revert=function(t){this.kill(t||{})},t}(),dN=function(){function t(t){this.contexts=[],this.scope=t,FT&&FT.data.push(this)}var e=t.prototype;return e.add=function(t,e,n){TE(t)||(t={matches:t});var i,r,s,o=new hN(0,n||this.scope),a=o.conditions={};for(r in FT&&!o.selector&&(o.selector=FT.selector),this.contexts.push(o),e=o.add("onMatch",e),o.queries=t,t)"all"===r?s=1:(i=zT.matchMedia(t[r]))&&(rN.indexOf(o)<0&&rN.push(o),(a[r]=i.matches)&&(s=1),i.addListener?i.addListener(uN):i.addEventListener("change",uN));return s&&e(o,(function(t){return o.add(null,t)})),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),pN={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return aR(t)}))},timeline:function(t){return new DR(t)},getTweensOf:function(t,e){return BT.getTweensOf(t,e)},getProperty:function(t,e,n,i){SE(t)&&(t=XI(t)[0]);var r=rI(t||{}).get,s=n?fI:pI;return"native"===n&&(n=""),t?e?s((JE[e]&&JE[e].get||r)(t,e,n,i)):function(e,n,i){return s((JE[e]&&JE[e].get||r)(t,e,n,i))}:t},quickSetter:function(t,e,n){if((t=XI(t)).length>1){var i=t.map((function(t){return gN.quickSetter(t,e,n)})),r=i.length;return function(t){for(var e=r;e--;)i[e](t)}}t=t[0]||{};var s=JE[e],o=rI(t),a=o.harness&&(o.harness.aliases||{})[e]||e,l=s?function(e){var i=new s;HT._pt=0,i.init(t,n?e+n:e,HT,0,[t]),i.render(1,i),HT._pt&&JR(1,HT)}:o.set(t,a);return s?l:function(e){return l(t,a,n?e+n:e,o,1)}},quickTo:function(t,e,n){var i,r=gN.to(t,gI(((i={})[e]="+=0.1",i.paused=!0,i),n||{})),s=function(t,n,i){return r.resetTo(e,t,n,i)};return s.tween=r,s},isTweening:function(t){return BT.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=CR(t.ease,fE.ease)),vI(fE,t||{})},config:function(t){return vI(pE,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,r=t.defaults,s=t.extendTimeline;(i||"").split(",").forEach((function(t){return t&&!JE[t]&&!UE[t]&&GE()})),QE[e]=function(t,e,i){return n(XI(t),mI(e||{},r),i)},s&&(DR.prototype[e]=function(t,n,i){return this.add(QE[e](t,TE(n)?n:(i=n)&&{},this),i)})},registerEase:function(t,e){_R[t]=CR(e)},parseEase:function(t,e){return arguments.length?CR(t,e):_R},getById:function(t){return BT.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,i,r=new DR(t);for(r.smoothChildTiming=EE(t.smoothChildTiming),BT.remove(r),r._dp=0,r._time=r._tTime=BT._time,n=BT._first;n;)i=n._next,!e&&!n._dur&&n instanceof GR&&n.vars.onComplete===n._targets[0]||DI(r,n,n._start-n._delay),n=i;return DI(BT,r,0),r},context:function(t,e){return t?new hN(t,e):FT},matchMedia:function(t){return new dN(t)},matchMediaRefresh:function(){return rN.forEach((function(t){var e,n,i=t.conditions;for(n in i)i[n]&&(i[n]=!1,e=1);e&&t.revert()}))||uN()},addEventListener:function(t,e){var n=sN[t]||(sN[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=sN[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},utils:{wrap:function t(e,n,i){var r=n-e;return DE(e)?tR(e,t(0,e.length),n):WI(i,(function(t){return(r+(t-e)%r)%r+e}))},wrapYoyo:function t(e,n,i){var r=n-e,s=2*r;return DE(e)?tR(e,t(0,e.length-1),n):WI(i,(function(t){return e+((t=(s+(t-e)%s)%s||0)>r?s-t:t)}))},distribute:KI,random:QI,snap:JI,normalize:function(t,e,n){return nR(t,e,0,1,n)},getUnit:HI,clamp:function(t,e,n){return WI(n,(function(n){return GI(t,e,n)}))},splitColor:hR,toArray:XI,selector:YI,mapRange:nR,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||HI(n))}},interpolate:function t(e,n,i,r){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var o,a,l,c,u,h=SE(e),d={};if(!0===i&&(r=1)&&(i=null),h)e={p:e},n={p:n};else if(DE(e)&&!DE(n)){for(l=[],c=e.length,u=c-2,a=1;a<c;a++)l.push(t(e[a-1],e[a]));c--,s=function(t){t*=c;var e=Math.min(u,~~t);return l[e](t-e)},i=n}else r||(e=gI(DE(e)?[]:{},e));if(!l){for(o in n)PR.call(d,e,o,"get",n[o]);s=function(t){return JR(t,d)||(h?e.p:e)}}}return WI(i,s)},shuffle:ZI},install:WE,effects:QE,ticker:vR,updateRoot:DR.updateRoot,plugins:JE,globalTimeline:BT,core:{PropTween:iN,globals:HE,Tween:GR,Timeline:DR,Animation:NR,getCache:rI,_removeLinkedListItem:xI,reverting:function(){return PT},context:function(t){return t&&FT&&(FT.data.push(t),t._ctx=FT),FT},suppressOverwrites:function(t){return kT=t}}};oI("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return pN[t]=GR[t]})),vR.add(DR.updateRoot),HT=pN.to({},{duration:0});var fN=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},mN=function(t,e){return{name:t,rawVars:1,init:function(t,n,i){i._onInit=function(t){var i,r;if(SE(n)&&(i={},oI(n,(function(t){return i[t]=1})),n=i),e){for(r in i={},n)i[r]=e(n[r]);n=i}!function(t,e){var n,i,r,s=t._targets;for(n in e)for(i=s.length;i--;)(r=t._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=fN(r,n)),r&&r.modifier&&r.modifier(e[n],t,s[i],n))}(t,n)}}}},gN=pN.registerPlugin({name:"attr",init:function(t,e,n,i,r){var s,o,a;for(s in this.tween=n,e)a=t.getAttribute(s)||"",(o=this.add(t,"setAttribute",(a||0)+"",e[s],i,r,0,0,s)).op=s,o.b=a,this._props.push(s)},render:function(t,e){for(var n=e._pt;n;)PT?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},mN("roundProps",$I),mN("modifiers"),mN("snap",JI))||pN;GR.version=DR.version=gN.version="3.12.5",WT=1,IE()&&yR(),_R.Power0,_R.Power1,_R.Power2,_R.Power3,_R.Power4,_R.Linear,_R.Quad,_R.Cubic,_R.Quart,_R.Quint,_R.Strong,_R.Elastic,_R.Back,_R.SteppedEase,_R.Bounce,_R.Sine,_R.Expo,_R.Circ;
/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
var vN,yN,_N,bN,xN,wN,SN,MN,CN={},AN=180/Math.PI,TN=Math.PI/180,EN=Math.atan2,IN=/([A-Z])/g,RN=/(left|right|width|margin|padding|x)/i,NN=/[\s,\(]\S/,DN={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},LN=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},ON=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},kN=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},PN=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},FN=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},BN=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},zN=function(t,e,n){return t.style[e]=n},UN=function(t,e,n){return t.style.setProperty(e,n)},VN=function(t,e,n){return t._gsap[e]=n},WN=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},GN=function(t,e,n,i,r){var s=t._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},HN=function(t,e,n,i,r){var s=t._gsap;s[e]=n,s.renderTransform(r,s)},jN="transform",qN=jN+"Origin",XN=function t(e,n){var i=this,r=this.target,s=r.style,o=r._gsap;if(e in CN&&s){if(this.tfm=this.tfm||{},"transform"===e)return DN.transform.split(",").forEach((function(e){return t.call(i,e,n)}));if(~(e=DN[e]||e).indexOf(",")?e.split(",").forEach((function(t){return i.tfm[t]=hD(r,t)})):this.tfm[e]=o.x?o[e]:hD(r,e),e===qN&&(this.tfm.zOrigin=o.zOrigin),this.props.indexOf(jN)>=0)return;o.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(qN,n,"")),e=jN}(s||n)&&this.props.push(e,n,s[e])},YN=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},ZN=function(){var t,e,n=this.props,i=this.target,r=i.style,s=i._gsap;for(t=0;t<n.length;t+=3)n[t+1]?i[n[t]]=n[t+2]:n[t+2]?r[n[t]]=n[t+2]:r.removeProperty("--"===n[t].substr(0,2)?n[t]:n[t].replace(IN,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)s[e]=this.tfm[e];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(t=SN())&&t.isStart||r[jN]||(YN(r),s.zOrigin&&r[qN]&&(r[qN]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},KN=function(t,e){var n={target:t,props:[],revert:ZN,save:XN};return t._gsap||gN.core.getCache(t),e&&e.split(",").forEach((function(t){return n.save(t)})),n},$N=function(t,e){var n=yN.createElementNS?yN.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):yN.createElement(t);return n&&n.style?n:yN.createElement(t)},JN=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(IN,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,tD(n)||n,1)||""},QN="O,Moz,ms,Ms,Webkit".split(","),tD=function(t,e,n){var i=(e||xN).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(QN[r]+t in i););return r<0?null:(3===r?"ms":r>=0?QN[r]:"")+t},eD=function(){"undefined"!=typeof window&&window.document&&(vN=window,yN=vN.document,_N=yN.documentElement,xN=$N("div")||{style:{}},$N("div"),jN=tD(jN),qN=jN+"Origin",xN.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",MN=!!tD("perspective"),SN=gN.core.reverting,bN=1)},nD=function t(e){var n,i=$N("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,s=this.nextSibling,o=this.style.cssText;if(_N.appendChild(i),i.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(xW){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(s?r.insertBefore(this,s):r.appendChild(this)),_N.removeChild(i),this.style.cssText=o,n},iD=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},rD=function(t){var e;try{e=t.getBBox()}catch(n){e=nD.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===nD||(e=nD.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+iD(t,["x","cx","x1"])||0,y:+iD(t,["y","cy","y1"])||0,width:0,height:0}},sD=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!rD(t))},oD=function(t,e){if(e){var n,i=t.style;e in CN&&e!==qN&&(e=jN),i.removeProperty?("ms"!==(n=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),i.removeProperty("--"===n?e:e.replace(IN,"-$1").toLowerCase())):i.removeAttribute(e)}},aD=function(t,e,n,i,r,s){var o=new iN(t._pt,e,n,0,1,s?BN:FN);return t._pt=o,o.b=i,o.e=r,t._props.push(n),o},lD={deg:1,rad:1,turn:1},cD={grid:1,flex:1},uD=function t(e,n,i,r){var s,o,a,l,c=parseFloat(i)||0,u=(i+"").trim().substr((c+"").length)||"px",h=xN.style,d=RN.test(n),p="svg"===e.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===r,v="%"===r;if(r===u||!c||lD[r]||lD[u])return c;if("px"!==u&&!g&&(c=t(e,n,i,"px")),l=e.getCTM&&sD(e),(v||"%"===u)&&(CN[n]||~n.indexOf("adius")))return s=l?e.getBBox()[d?"width":"height"]:e[f],aI(v?c/s*m:c/100*s);if(h[d?"width":"height"]=m+(g?u:r),o=~n.indexOf("adius")||"em"===r&&e.appendChild&&!p?e:e.parentNode,l&&(o=(e.ownerSVGElement||{}).parentNode),o&&o!==yN&&o.appendChild||(o=yN.body),(a=o._gsap)&&v&&a.width&&d&&a.time===vR.time&&!a.uncache)return aI(c/a.width*m);if(!v||"height"!==n&&"width"!==n)(v||"%"===u)&&!cD[JN(o,"display")]&&(h.position=JN(e,"position")),o===e&&(h.position="static"),o.appendChild(xN),s=xN[f],o.removeChild(xN),h.position="absolute";else{var y=e.style[n];e.style[n]=m+r,s=e[f],y?e.style[n]=y:oD(e,n)}return d&&v&&((a=rI(o)).time=vR.time,a.width=o[f]),aI(g?s*c/m:s&&c?m/s*c:0)},hD=function(t,e,n,i){var r;return bN||eD(),e in DN&&"transform"!==e&&~(e=DN[e]).indexOf(",")&&(e=e.split(",")[0]),CN[e]&&"transform"!==e?(r=wD(t,i),r="transformOrigin"!==e?r[e]:r.svg?r.origin:SD(JN(t,qN))+" "+r.zOrigin+"px"):(!(r=t.style[e])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=mD[e]&&mD[e](t,e,n)||JN(t,e)||sI(t,e)||("opacity"===e?1:0)),n&&!~(r+"").trim().indexOf(" ")?uD(t,e,r,n)+n:r},dD=function(t,e,n,i){if(!n||"none"===n){var r=tD(e,t,1),s=r&&JN(t,r,1);s&&s!==n?(e=r,n=s):"borderColor"===e&&(n=JN(t,"borderTopColor"))}var o,a,l,c,u,h,d,p,f,m,g,v=new iN(this._pt,t.style,e,0,1,$R),y=0,_=0;if(v.b=n,v.e=i,n+="","auto"===(i+="")&&(h=t.style[e],t.style[e]=i,i=JN(t,e)||i,h?t.style[e]=h:oD(t,e)),gR(o=[n,i]),i=o[1],l=(n=o[0]).match(kE)||[],(i.match(kE)||[]).length){for(;a=kE.exec(i);)d=a[0],f=i.substring(y,a.index),u?u=(u+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(u=1),d!==(h=l[_++]||"")&&(c=parseFloat(h)||0,g=h.substr((c+"").length),"="===d.charAt(1)&&(d=cI(c,d)+g),p=parseFloat(d),m=d.substr((p+"").length),y=kE.lastIndex-m.length,m||(m=m||pE.units[e]||g,y===i.length&&(i+=m,v.e+=m)),g!==m&&(c=uD(t,e,h,m)||0),v._pt={_next:v._pt,p:f||1===_?f:",",s:c,c:p-c,m:u&&u<4||"zIndex"===e?Math.round:0});v.c=y<i.length?i.substring(y,i.length):""}else v.r="display"===e&&"none"===i?BN:FN;return FE.test(i)&&(v.e=0),this._pt=v,v},pD={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},fD=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,s=e.t,o=s.style,a=e.u,l=s._gsap;if("all"===a||!0===a)o.cssText="",i=1;else for(r=(a=a.split(",")).length;--r>-1;)n=a[r],CN[n]&&(i=1,n="transformOrigin"===n?qN:jN),oD(s,n);i&&(oD(s,jN),l&&(l.svg&&s.removeAttribute("transform"),wD(s,1),l.uncache=1,YN(o)))}},mD={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){var s=t._pt=new iN(t._pt,e,n,0,0,fD);return s.u=i,s.pr=-10,s.tween=r,t._props.push(n),1}}},gD=[1,0,0,1,0,0],vD={},yD=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},_D=function(t){var e=JN(t,jN);return yD(e)?gD:e.substr(7).match(OE).map(aI)},bD=function(t,e){var n,i,r,s,o=t._gsap||rI(t),a=t.style,l=_D(t);return o.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=t.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?gD:l:(l!==gD||t.offsetParent||t===_N||o.svg||(r=a.display,a.display="block",(n=t.parentNode)&&t.offsetParent||(s=1,i=t.nextElementSibling,_N.appendChild(t)),l=_D(t),r?a.display=r:oD(t,"display"),s&&(i?n.insertBefore(t,i):n?n.appendChild(t):_N.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},xD=function(t,e,n,i,r,s){var o,a,l,c=t._gsap,u=r||bD(t,!0),h=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,m=u[0],g=u[1],v=u[2],y=u[3],_=u[4],b=u[5],x=e.split(" "),w=parseFloat(x[0])||0,S=parseFloat(x[1])||0;n?u!==gD&&(a=m*y-g*v)&&(l=w*(-g/a)+S*(m/a)-(m*b-g*_)/a,w=w*(y/a)+S*(-v/a)+(v*b-y*_)/a,S=l):(w=(o=rD(t)).x+(~x[0].indexOf("%")?w/100*o.width:w),S=o.y+(~(x[1]||x[0]).indexOf("%")?S/100*o.height:S)),i||!1!==i&&c.smooth?(_=w-h,b=S-d,c.xOffset=p+(_*m+b*v)-_,c.yOffset=f+(_*g+b*y)-b):c.xOffset=c.yOffset=0,c.xOrigin=w,c.yOrigin=S,c.smooth=!!i,c.origin=e,c.originIsAbsolute=!!n,t.style[qN]="0px 0px",s&&(aD(s,c,"xOrigin",h,w),aD(s,c,"yOrigin",d,S),aD(s,c,"xOffset",p,c.xOffset),aD(s,c,"yOffset",f,c.yOffset)),t.setAttribute("data-svg-origin",w+" "+S)},wD=function(t,e){var n=t._gsap||new RR(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,s,o,a,l,c,u,h,d,p,f,m,g,v,y,_,b,x,w,S,M,C,A,T,E,I,R,N,D,L,O,k=t.style,P=n.scaleX<0,F="px",B="deg",z=getComputedStyle(t),U=JN(t,qN)||"0";return i=r=s=l=c=u=h=d=p=0,o=a=1,n.svg=!(!t.getCTM||!sD(t)),z.translate&&("none"===z.translate&&"none"===z.scale&&"none"===z.rotate||(k[jN]=("none"!==z.translate?"translate3d("+(z.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==z.rotate?"rotate("+z.rotate+") ":"")+("none"!==z.scale?"scale("+z.scale.split(" ").join(",")+") ":"")+("none"!==z[jN]?z[jN]:"")),k.scale=k.rotate=k.translate="none"),g=bD(t,n.svg),n.svg&&(n.uncache?(T=t.getBBox(),U=n.xOrigin-T.x+"px "+(n.yOrigin-T.y)+"px",A=""):A=!e&&t.getAttribute("data-svg-origin"),xD(t,A||U,!!A||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==gD&&(b=g[0],x=g[1],w=g[2],S=g[3],i=M=g[4],r=C=g[5],6===g.length?(o=Math.sqrt(b*b+x*x),a=Math.sqrt(S*S+w*w),l=b||x?EN(x,b)*AN:0,(h=w||S?EN(w,S)*AN+l:0)&&(a*=Math.abs(Math.cos(h*TN))),n.svg&&(i-=f-(f*b+m*w),r-=m-(f*x+m*S))):(O=g[6],D=g[7],I=g[8],R=g[9],N=g[10],L=g[11],i=g[12],r=g[13],s=g[14],c=(v=EN(O,N))*AN,v&&(A=M*(y=Math.cos(-v))+I*(_=Math.sin(-v)),T=C*y+R*_,E=O*y+N*_,I=M*-_+I*y,R=C*-_+R*y,N=O*-_+N*y,L=D*-_+L*y,M=A,C=T,O=E),u=(v=EN(-w,N))*AN,v&&(y=Math.cos(-v),L=S*(_=Math.sin(-v))+L*y,b=A=b*y-I*_,x=T=x*y-R*_,w=E=w*y-N*_),l=(v=EN(x,b))*AN,v&&(A=b*(y=Math.cos(v))+x*(_=Math.sin(v)),T=M*y+C*_,x=x*y-b*_,C=C*y-M*_,b=A,M=T),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,u=180-u),o=aI(Math.sqrt(b*b+x*x+w*w)),a=aI(Math.sqrt(C*C+O*O)),v=EN(M,C),h=Math.abs(v)>2e-4?v*AN:0,p=L?1/(L<0?-L:L):0),n.svg&&(A=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!yD(JN(t,jN)),A&&t.setAttribute("transform",A))),Math.abs(h)>90&&Math.abs(h)<270&&(P?(o*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,h+=h<=0?180:-180)),e=e||n.uncache,n.x=i-((n.xPercent=i&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+F,n.y=r-((n.yPercent=r&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-r)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+F,n.z=s+F,n.scaleX=aI(o),n.scaleY=aI(a),n.rotation=aI(l)+B,n.rotationX=aI(c)+B,n.rotationY=aI(u)+B,n.skewX=h+B,n.skewY=d+B,n.transformPerspective=p+F,(n.zOrigin=parseFloat(U.split(" ")[2])||!e&&n.zOrigin||0)&&(k[qN]=SD(U)),n.xOffset=n.yOffset=0,n.force3D=pE.force3D,n.renderTransform=n.svg?RD:MN?ID:CD,n.uncache=0,n},SD=function(t){return(t=t.split(" "))[0]+" "+t[1]},MD=function(t,e,n){var i=HI(e);return aI(parseFloat(e)+parseFloat(uD(t,"x",n+"px",i)))+i},CD=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,ID(t,e)},AD="0deg",TD="0px",ED=") ",ID=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,s=n.x,o=n.y,a=n.z,l=n.rotation,c=n.rotationY,u=n.rotationX,h=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,y=n.zOrigin,_="",b="auto"===g&&t&&1!==t||!0===g;if(y&&(u!==AD||c!==AD)){var x,w=parseFloat(c)*TN,S=Math.sin(w),M=Math.cos(w);w=parseFloat(u)*TN,x=Math.cos(w),s=MD(v,s,S*x*-y),o=MD(v,o,-Math.sin(w)*-y),a=MD(v,a,M*x*-y+y)}m!==TD&&(_+="perspective("+m+ED),(i||r)&&(_+="translate("+i+"%, "+r+"%) "),(b||s!==TD||o!==TD||a!==TD)&&(_+=a!==TD||b?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+ED),l!==AD&&(_+="rotate("+l+ED),c!==AD&&(_+="rotateY("+c+ED),u!==AD&&(_+="rotateX("+u+ED),h===AD&&d===AD||(_+="skew("+h+", "+d+ED),1===p&&1===f||(_+="scale("+p+", "+f+ED),v.style[jN]=_||"translate(0, 0)"},RD=function(t,e){var n,i,r,s,o,a=e||this,l=a.xPercent,c=a.yPercent,u=a.x,h=a.y,d=a.rotation,p=a.skewX,f=a.skewY,m=a.scaleX,g=a.scaleY,v=a.target,y=a.xOrigin,_=a.yOrigin,b=a.xOffset,x=a.yOffset,w=a.forceCSS,S=parseFloat(u),M=parseFloat(h);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=TN,p*=TN,n=Math.cos(d)*m,i=Math.sin(d)*m,r=Math.sin(d-p)*-g,s=Math.cos(d-p)*g,p&&(f*=TN,o=Math.tan(p-f),r*=o=Math.sqrt(1+o*o),s*=o,f&&(o=Math.tan(f),n*=o=Math.sqrt(1+o*o),i*=o)),n=aI(n),i=aI(i),r=aI(r),s=aI(s)):(n=m,s=g,i=r=0),(S&&!~(u+"").indexOf("px")||M&&!~(h+"").indexOf("px"))&&(S=uD(v,"x",u,"px"),M=uD(v,"y",h,"px")),(y||_||b||x)&&(S=aI(S+y-(y*n+_*r)+b),M=aI(M+_-(y*i+_*s)+x)),(l||c)&&(o=v.getBBox(),S=aI(S+l/100*o.width),M=aI(M+c/100*o.height)),o="matrix("+n+","+i+","+r+","+s+","+S+","+M+")",v.setAttribute("transform",o),w&&(v.style[jN]=o)},ND=function(t,e,n,i,r){var s,o,a=360,l=SE(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?AN:1)-i,u=i+c+"deg";return l&&("short"===(s=r.split("_")[1])&&(c%=a)!==c%180&&(c+=c<0?a:-360),"cw"===s&&c<0?c=(c+36e9)%a-~~(c/a)*a:"ccw"===s&&c>0&&(c=(c-36e9)%a-~~(c/a)*a)),t._pt=o=new iN(t._pt,e,n,i,c,ON),o.e=u,o.u="deg",t._props.push(n),o},DD=function(t,e){for(var n in e)t[n]=e[n];return t},LD=function(t,e,n){var i,r,s,o,a,l,c,u=DD({},n._gsap),h=n.style;for(r in u.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),h[jN]=e,i=wD(n,1),oD(n,jN),n.setAttribute("transform",s)):(s=getComputedStyle(n)[jN],h[jN]=e,i=wD(n,1),h[jN]=s),CN)(s=u[r])!==(o=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(a=HI(s)!==(c=HI(o))?uD(n,r,s,c):parseFloat(s),l=parseFloat(o),t._pt=new iN(t._pt,i,r,a,l-a,LN),t._pt.u=c||0,t._props.push(r));DD(i,u)};oI("padding,margin,Width,Radius",(function(t,e){var n="Top",i="Right",r="Bottom",s="Left",o=(e<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map((function(n){return e<2?t+n:"border"+n+t}));mD[e>1?"border"+t:t]=function(t,e,n,i,r){var s,a;if(arguments.length<4)return s=o.map((function(e){return hD(t,e,n)})),5===(a=s.join(" ")).split(s[0]).length?s[0]:a;s=(i+"").split(" "),a={},o.forEach((function(t,e){return a[t]=s[e]=s[e]||s[(e-1)/2|0]})),t.init(e,a,r)}}));var OD,kD,PD,FD={name:"css",register:eD,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var s,o,a,l,c,u,h,d,p,f,m,g,v,y,_,b,x,w,S,M,C=this._props,A=t.style,T=n.vars.startAt;for(h in bN||eD(),this.styles=this.styles||KN(t),b=this.styles.props,this.tween=n,e)if("autoRound"!==h&&(o=e[h],!JE[h]||!FR(h,e,n,i,t,r)))if(c=typeof o,u=mD[h],"function"===c&&(c=typeof(o=o.call(n,i,t,r))),"string"===c&&~o.indexOf("random(")&&(o=eR(o)),u)u(this,t,h,o,n)&&(_=1);else if("--"===h.substr(0,2))s=(getComputedStyle(t).getPropertyValue(h)+"").trim(),o+="",fR.lastIndex=0,fR.test(s)||(d=HI(s),p=HI(o)),p?d!==p&&(s=uD(t,h,s,p)+p):d&&(o+=d),this.add(A,"setProperty",s,o,i,r,0,0,h),C.push(h),b.push(h,0,A[h]);else if("undefined"!==c){if(T&&h in T?(s="function"==typeof T[h]?T[h].call(n,i,t,r):T[h],SE(s)&&~s.indexOf("random(")&&(s=eR(s)),HI(s+"")||"auto"===s||(s+=pE.units[h]||HI(hD(t,h))||""),"="===(s+"").charAt(1)&&(s=hD(t,h))):s=hD(t,h),l=parseFloat(s),(f="string"===c&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),h in DN&&("autoAlpha"===h&&(1===l&&"hidden"===hD(t,"visibility")&&a&&(l=0),b.push("visibility",0,A.visibility),aD(this,A,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==h&&"transform"!==h&&~(h=DN[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in CN)if(this.styles.save(h),g||((v=t._gsap).renderTransform&&!e.parseTransform||wD(t,e.parseTransform),y=!1!==e.smoothOrigin&&v.smooth,(g=this._pt=new iN(this._pt,A,jN,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===h)this._pt=new iN(this._pt,v,"scaleY",v.scaleY,(f?cI(v.scaleY,f+a):a)-v.scaleY||0,LN),this._pt.u=0,C.push("scaleY",h),h+="X";else{if("transformOrigin"===h){b.push(qN,0,A[qN]),w=void 0,S=void 0,M=void 0,w=(x=o).split(" "),S=w[0],M=w[1]||"50%","top"!==S&&"bottom"!==S&&"left"!==M&&"right"!==M||(x=S,S=M,M=x),w[0]=pD[S]||S,w[1]=pD[M]||M,o=w.join(" "),v.svg?xD(t,o,0,y,0,this):((p=parseFloat(o.split(" ")[2])||0)!==v.zOrigin&&aD(this,v,"zOrigin",v.zOrigin,p),aD(this,A,h,SD(s),SD(o)));continue}if("svgOrigin"===h){xD(t,o,1,y,0,this);continue}if(h in vD){ND(this,v,h,l,f?cI(l,f+o):o);continue}if("smoothOrigin"===h){aD(this,v,"smooth",v.smooth,o);continue}if("force3D"===h){v[h]=o;continue}if("transform"===h){LD(this,o,t);continue}}else h in A||(h=tD(h)||h);if(m||(a||0===a)&&(l||0===l)&&!NN.test(o)&&h in A)a||(a=0),(d=(s+"").substr((l+"").length))!==(p=HI(o)||(h in pE.units?pE.units[h]:d))&&(l=uD(t,h,s,p)),this._pt=new iN(this._pt,m?v:A,h,l,(f?cI(l,f+a):a)-l,m||"px"!==p&&"zIndex"!==h||!1===e.autoRound?LN:PN),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=kN);else if(h in A)dD.call(this,t,h,s,f?f+o:o);else if(h in t)this.add(t,h,s||t[h],f?f+o:o,i,r);else if("parseTransform"!==h)continue;m||(h in A?b.push(h,0,A[h]):b.push(h,1,s||t[h])),C.push(h)}_&&nN(this)},render:function(t,e){if(e.tween._time||!SN())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:hD,aliases:DN,getSetter:function(t,e,n){var i=DN[e];return i&&i.indexOf(",")<0&&(e=i),e in CN&&e!==qN&&(t._gsap.x||hD(t,"x"))?n&&wN===n?"scale"===e?WN:VN:(wN=n||{})&&("scale"===e?GN:HN):t.style&&!AE(t.style[e])?zN:~e.indexOf("-")?UN:YR(t,e)},core:{_removeProperty:oD,_getMatrix:bD}};gN.utils.checkPrefix=tD,gN.core.getStyleSaver=KN,PD=oI((OD="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(kD="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){CN[t]=1})),oI(kD,(function(t){pE.units[t]="deg",vD[t]=1})),DN[PD[13]]=OD+","+kD,oI("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");DN[e[1]]=PD[e[0]]})),oI("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){pE.units[t]="px"})),gN.registerPlugin(FD);var BD=gN.registerPlugin(FD)||gN;BD.core.Tween;class zD extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Ub(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){const n=r.parse(JSON.parse(t));e&&e(n)}),n,i)}parse(t){return new UD(t)}}class UD{constructor(t){this.isFont=!0,this.type="Font",this.data=t}generateShapes(t,e=100){const n=[],i=function(t,e,n){const i=Array.from(t),r=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=[];let a=0,l=0;for(let c=0;c<i.length;c++){const t=i[c];if("\n"===t)a=0,l-=s;else{const e=VD(t,r,a,l,n);a+=e.offsetX,o.push(e.path)}}return o}(t,e,this.data);for(let r=0,s=i.length;r<s;r++)n.push(...i[r].toShapes());return n}}function VD(t,e,n,i,r){const s=r.glyphs[t]||r.glyphs["?"];if(!s)return;const o=new Xx;let a,l,c,u,h,d,p,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=t.length;r<s;){switch(t[r++]){case"m":a=t[r++]*e+n,l=t[r++]*e+i,o.moveTo(a,l);break;case"l":a=t[r++]*e+n,l=t[r++]*e+i,o.lineTo(a,l);break;case"q":c=t[r++]*e+n,u=t[r++]*e+i,h=t[r++]*e+n,d=t[r++]*e+i,o.quadraticCurveTo(h,d,c,u);break;case"b":c=t[r++]*e+n,u=t[r++]*e+i,h=t[r++]*e+n,d=t[r++]*e+i,p=t[r++]*e+n,f=t[r++]*e+i,o.bezierCurveTo(h,d,p,f,c,u)}}}return{offsetX:s.ha*e,path:o}}class WD extends nb{constructor(t,e={}){const n=e.font;if(void 0===n)super();else{const i=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(i,e)}this.type="TextGeometry"}}function GD(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),r=Math.round(t.g),s=Math.round(t.b),o=t.a,a=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=t.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+i+","+r+","+s+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+s+","+o+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+s+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+s+","+o+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+s+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+s+",a:"+o+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+c+",a:"+o+"}":"unknown format"}var HD=Array.prototype.forEach,jD=Array.prototype.slice,qD={BREAK:{},extend:function(t){return this.each(jD.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(jD.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=jD.call(arguments);return function(){for(var e=jD.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(HD&&t.forEach&&t.forEach===HD)t.forEach(e,n);else if(t.length===t.length+0){var i,r=void 0;for(r=0,i=t.length;r<i;r++)if(r in t&&e.call(n,t[r],r)===this.BREAK)return}else for(var s in t)if(e.call(n,t[s],s)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var r=this,s=arguments;var o=n||!i;clearTimeout(i),i=setTimeout((function(){i=null,n||t.apply(r,s)}),e),o&&t.apply(r,s)}},toArray:function(t){return t.toArray?t.toArray():jD.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},XD=[{litmus:qD.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:GD},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:GD},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:GD},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:GD}}},{litmus:qD.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:qD.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:qD.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(qD.isNumber(t.r)&&qD.isNumber(t.g)&&qD.isNumber(t.b)&&qD.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(qD.isNumber(t.r)&&qD.isNumber(t.g)&&qD.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(qD.isNumber(t.h)&&qD.isNumber(t.s)&&qD.isNumber(t.v)&&qD.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(qD.isNumber(t.h)&&qD.isNumber(t.s)&&qD.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],YD=void 0,ZD=void 0,KD=function(){ZD=!1;var t=arguments.length>1?qD.toArray(arguments):arguments[0];return qD.each(XD,(function(e){if(e.litmus(t))return qD.each(e.conversions,(function(e,n){if(YD=e.read(t),!1===ZD&&!1!==YD)return ZD=YD,YD.conversionName=n,YD.conversion=e,qD.BREAK})),qD.BREAK})),ZD},$D=void 0,JD={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),s=n*(1-e),o=n*(1-r*e),a=n*(1-(1-r)*e),l=[[n,a,s],[o,n,s],[s,n,a],[s,o,n],[a,s,n],[n,s,o]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),r=Math.max(t,e,n),s=r-i,o=void 0;return 0===r?{h:NaN,s:0,v:0}:(o=t===r?(e-n)/s:e===r?2+(n-t)/s:4+(t-e)/s,(o/=6)<0&&(o+=1),{h:360*o,s:s/r,v:r/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),i=this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<($D=8*e)|t&~(255<<$D)}},QD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tL=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},eL=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),nL=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,n,i)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(i):void 0},iL=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},rL=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},sL=function(){function t(){if(tL(this,t),this.__state=KD.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return eL(t,[{key:"toString",value:function(){return GD(this)}},{key:"toHexString",value:function(){return GD(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function oL(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||sL.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(sL.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function aL(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||sL.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(sL.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}sL.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=JD.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");qD.extend(t.__state,JD.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},sL.recalculateHSV=function(t){var e=JD.rgb_to_hsv(t.r,t.g,t.b);qD.extend(t.__state,{s:e.s,v:e.v}),qD.isNaN(e.h)?qD.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},sL.COMPONENTS=["r","g","b","h","s","v","hex","a"],oL(sL.prototype,"r",2),oL(sL.prototype,"g",1),oL(sL.prototype,"b",0),aL(sL.prototype,"h"),aL(sL.prototype,"s"),aL(sL.prototype,"v"),Object.defineProperty(sL.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(sL.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=JD.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var lL=function(){function t(e,n){tL(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return eL(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),cL={};qD.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){qD.each(t,(function(t){cL[t]=e}))}));var uL=/(\d+(\.\d+)?)px/;function hL(t){if("0"===t||qD.isUndefined(t))return 0;var e=t.match(uL);return qD.isNull(e)?0:parseFloat(e[1])}var dL={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,r=e;qD.isUndefined(r)&&(r=!0),qD.isUndefined(i)&&(i=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var r=n||{},s=cL[e];if(!s)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(s);switch(s){case"MouseEvents":var a=r.x||r.clientX||0,l=r.y||r.clientY||0;o.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=o.initKeyboardEvent||o.initKeyEvent;qD.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:o.initEvent(e,r.bubbles||!1,r.cancelable||!0)}qD.defaults(o,i),t.dispatchEvent(o)},bind:function(t,e,n,i){var r=i||!1;return t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on"+e,n),dL},unbind:function(t,e,n,i){var r=i||!1;return t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on"+e,n),dL},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return dL},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return dL},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return hL(e["border-left-width"])+hL(e["border-right-width"])+hL(e["padding-left"])+hL(e["padding-right"])+hL(e.width)},getHeight:function(t){var e=getComputedStyle(t);return hL(e["border-top-width"])+hL(e["border-bottom-width"])+hL(e["padding-top"])+hL(e["padding-bottom"])+hL(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},pL=function(t){function e(t,n){tL(this,e);var i=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),dL.bind(i.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return iL(e,lL),eL(e,[{key:"setValue",value:function(t){var n=nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),fL=function(t){function e(t,n,i){tL(this,e);var r=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=i,o=r;if(r.__select=document.createElement("select"),qD.isArray(s)){var a={};qD.each(s,(function(t){a[t]=t})),s=a}return qD.each(s,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),o.__select.appendChild(n)})),r.updateDisplay(),dL.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;o.setValue(t)})),r.domElement.appendChild(r.__select),r}return iL(e,lL),eL(e,[{key:"setValue",value:function(t){var n=nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return dL.isActive(this.__select)?this:(this.__select.value=this.getValue(),nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),mL=function(t){function e(t,n){tL(this,e);var i=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i;function s(){r.setValue(r.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),dL.bind(i.__input,"keyup",s),dL.bind(i.__input,"change",s),dL.bind(i.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),dL.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return iL(e,lL),eL(e,[{key:"updateDisplay",value:function(){return dL.isActive(this.__input)||(this.__input.value=this.getValue()),nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function gL(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var vL=function(t){function e(t,n,i){tL(this,e);var r=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=i||{};return r.__min=s.min,r.__max=s.max,r.__step=s.step,qD.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=gL(r.__impliedStep),r}return iL(e,lL),eL(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=gL(t),this}}]),e}();var yL=function(t){function e(t,n,i){tL(this,e);var r=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));r.__truncationSuspended=!1;var s=r,o=void 0;function a(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function l(t){var e=o-t.clientY;s.setValue(s.getValue()+e*s.__impliedStep),o=t.clientY}function c(){dL.unbind(window,"mousemove",l),dL.unbind(window,"mouseup",c),a()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),dL.bind(r.__input,"change",(function(){var t=parseFloat(s.__input.value);qD.isNaN(t)||s.setValue(t)})),dL.bind(r.__input,"blur",(function(){a()})),dL.bind(r.__input,"mousedown",(function(t){dL.bind(window,"mousemove",l),dL.bind(window,"mouseup",c),o=t.clientY})),dL.bind(r.__input,"keydown",(function(t){13===t.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,a())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return iL(e,vL),eL(e,[{key:"updateDisplay",value:function(){var t,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(t*i)/i),nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function _L(t,e,n,i,r){return i+(t-e)/(n-e)*(r-i)}var bL=function(t){function e(t,n,i,r,s){tL(this,e);var o=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:r,step:s})),a=o;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(_L(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function c(){dL.unbind(window,"mousemove",l),dL.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function u(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(_L(e,n.left,n.right,a.__min,a.__max))}function h(){dL.unbind(window,"touchmove",u),dL.unbind(window,"touchend",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),dL.bind(o.__background,"mousedown",(function(t){document.activeElement.blur(),dL.bind(window,"mousemove",l),dL.bind(window,"mouseup",c),l(t)})),dL.bind(o.__background,"touchstart",(function(t){if(1!==t.touches.length)return;dL.bind(window,"touchmove",u),dL.bind(window,"touchend",h),u(t)})),dL.addClass(o.__background,"slider"),dL.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return iL(e,vL),eL(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",nL(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),xL=function(t){function e(t,n,i){tL(this,e);var r=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===i?"Fire":i,dL.bind(r.__button,"click",(function(t){return t.preventDefault(),s.fire(),!1})),dL.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return iL(e,lL),eL(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),wL=function(t){function e(t,n){tL(this,e);var i=rL(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new sL(i.getValue()),i.__temp=new sL(0);var r=i;i.domElement=document.createElement("div"),dL.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",dL.bind(i.__input,"keydown",(function(t){13===t.keyCode&&h.call(this)})),dL.bind(i.__input,"blur",h),dL.bind(i.__selector,"mousedown",(function(){dL.addClass(this,"drag").bind(window,"mouseup",(function(){dL.removeClass(r.__selector,"drag")}))})),dL.bind(i.__selector,"touchstart",(function(){dL.addClass(this,"drag").bind(window,"touchend",(function(){dL.removeClass(r.__selector,"drag")}))}));var s,o=document.createElement("div");function a(t){p(t),dL.bind(window,"mousemove",p),dL.bind(window,"touchmove",p),dL.bind(window,"mouseup",c),dL.bind(window,"touchend",c)}function l(t){f(t),dL.bind(window,"mousemove",f),dL.bind(window,"touchmove",f),dL.bind(window,"mouseup",u),dL.bind(window,"touchend",u)}function c(){dL.unbind(window,"mousemove",p),dL.unbind(window,"touchmove",p),dL.unbind(window,"mouseup",c),dL.unbind(window,"touchend",c),d()}function u(){dL.unbind(window,"mousemove",f),dL.unbind(window,"touchmove",f),dL.unbind(window,"mouseup",u),dL.unbind(window,"touchend",u),d()}function h(){var t=KD(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function d(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function p(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,s=n.clientY,o=(i-e.left)/(e.right-e.left),a=1-(s-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),o>1?o=1:o<0&&(o=0),r.__color.v=a,r.__color.s=o,r.setValue(r.__color.toOriginal()),!1}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),r.__color.h=360*n,r.setValue(r.__color.toOriginal()),!1}return qD.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),qD.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),qD.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),qD.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),qD.extend(o.style,{width:"100%",height:"100%",background:"none"}),ML(o,"top","rgba(0,0,0,0)","#000"),qD.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(s=i.__hue_field).style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",qD.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),dL.bind(i.__saturation_field,"mousedown",a),dL.bind(i.__saturation_field,"touchstart",a),dL.bind(i.__field_knob,"mousedown",a),dL.bind(i.__field_knob,"touchstart",a),dL.bind(i.__hue_field,"mousedown",l),dL.bind(i.__hue_field,"touchstart",l),i.__saturation_field.appendChild(o),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return iL(e,lL),eL(e,[{key:"updateDisplay",value:function(){var t=KD(this.getValue());if(!1!==t){var e=!1;qD.each(sL.COMPONENTS,(function(n){if(!qD.isUndefined(t[n])&&!qD.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&qD.extend(this.__color.__state,t)}qD.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;qD.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,ML(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),qD.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(),SL=["-moz-","-o-","-webkit-","-ms-",""];function ML(t,e,n,i){t.style.background="",qD.each(SL,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}var CL=function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var r=n.getElementsByTagName("head")[0];try{r.appendChild(i)}catch(xW){}},AL=function(t,e){var n=t[e];return qD.isArray(arguments[2])||qD.isObject(arguments[2])?new fL(t,e,arguments[2]):qD.isNumber(n)?qD.isNumber(arguments[2])&&qD.isNumber(arguments[3])?qD.isNumber(arguments[4])?new bL(t,e,arguments[2],arguments[3],arguments[4]):new bL(t,e,arguments[2],arguments[3]):qD.isNumber(arguments[4])?new yL(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new yL(t,e,{min:arguments[2],max:arguments[3]}):qD.isString(n)?new mL(t,e):qD.isFunction(n)?new xL(t,e,""):qD.isBoolean(n)?new pL(t,e):null};var TL=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},EL=function(){function t(){tL(this,t),this.backgroundElement=document.createElement("div"),qD.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),dL.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),qD.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;dL.bind(this.backgroundElement,"click",(function(){e.hide()}))}return eL(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),qD.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",dL.unbind(t.domElement,"webkitTransitionEnd",e),dL.unbind(t.domElement,"transitionend",e),dL.unbind(t.domElement,"oTransitionEnd",e)};dL.bind(this.domElement,"webkitTransitionEnd",e),dL.bind(this.domElement,"transitionend",e),dL.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-dL.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-dL.getHeight(this.domElement)/2+"px"}}]),t}();CL(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var IL="Default",RL=function(){try{return!!window.localStorage}catch(xW){return!1}}(),NL=void 0,DL=!0,LL=void 0,OL=!1,kL=[],PL=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),dL.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=qD.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=qD.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),qD.isUndefined(i.load)?i.load={preset:IL}:i.preset&&(i.load.preset=i.preset),qD.isUndefined(i.parent)&&i.hideable&&kL.push(this),i.resizable=qD.isUndefined(i.parent)&&i.resizable,i.autoPlace&&qD.isUndefined(i.scrollable)&&(i.scrollable=!0);var r,s=RL&&"true"===localStorage.getItem(WL(this,"isLocal")),o=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,jL(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?dL.addClass(n.__ul,t.CLASS_CLOSED):dL.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return s},set:function(t){RL&&(s=t,t?dL.bind(window,"unload",o):dL.unbind(window,"unload",o),localStorage.setItem(WL(n,"isLocal"),t))}}}),qD.isUndefined(i.parent)){if(this.closed=i.closed||!1,dL.addClass(this.domElement,t.CLASS_MAIN),dL.makeSelectable(this.domElement,!1),RL&&s){n.useLocalStorage=!0;var l=localStorage.getItem(WL(this,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,dL.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(dL.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(dL.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),dL.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var c=document.createTextNode(i.name);dL.addClass(c,"controller-name"),a=FL(n,c);dL.addClass(this.__ul,t.CLASS_CLOSED),dL.addClass(a,"title"),dL.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(qD.isUndefined(i.parent)&&(DL&&(LL=document.createElement("div"),dL.addClass(LL,"dg"),dL.addClass(LL,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(LL),DL=!1),LL.appendChild(this.domElement),dL.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||jL(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},dL.bind(window,"resize",this.__resizeHandler),dL.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),dL.bind(this.__ul,"transitionend",this.__resizeHandler),dL.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&function(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function i(){dL.removeClass(t.__closeButton,PL.CLASS_DRAG),dL.unbind(window,"mousemove",n),dL.unbind(window,"mouseup",i)}function r(r){return r.preventDefault(),e=r.clientX,dL.addClass(t.__closeButton,PL.CLASS_DRAG),dL.bind(window,"mousemove",n),dL.bind(window,"mouseup",i),!1}t.__resize_handle=document.createElement("div"),qD.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),dL.bind(t.__resize_handle,"mousedown",r),dL.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this),o=function(){RL&&"true"===localStorage.getItem(WL(n,"isLocal"))&&localStorage.setItem(WL(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,i.parent||((r=n.getRoot()).width+=1,qD.defer((function(){r.width-=1})))};function FL(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function BL(t){dL.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&dL.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function zL(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function UL(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var r=n.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r),r[e.property]=e,n.load&&n.load.remembered){var s=n.load.remembered,o=void 0;if(s[t.preset])o=s[t.preset];else{if(!s[IL])return;o=s[IL]}if(o[i]&&void 0!==o[i][e.property]){var a=o[i][e.property];e.initialValue=a,e.setValue(a)}}}}function VL(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var r=void 0;if(i.color)r=new wL(e,n);else{var s=[e,n].concat(i.factoryArgs);r=AL.apply(t,s)}i.before instanceof lL&&(i.before=i.before.__li),UL(t,r),dL.addClass(r.domElement,"c");var o=document.createElement("span");dL.addClass(o,"property-name"),o.innerHTML=r.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(r.domElement);var l=FL(t,a,i.before);return dL.addClass(l,PL.CLASS_CONTROLLER_ROW),r instanceof wL?dL.addClass(l,"color"):dL.addClass(l,QD(r.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,qD.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),VL(t,n.object,n.property,{before:i,factoryArgs:[qD.toArray(arguments)]})}if(qD.isArray(e)||qD.isObject(e)){var r=n.__li.nextElementSibling;return n.remove(),VL(t,n.object,n.property,{before:r,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof bL){var i=new yL(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});qD.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],r=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(i,t),e.apply(n,t)}})),dL.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof yL){var r=function(e){if(qD.isNumber(n.__min)&&qD.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,r=n.__gui.__listening.indexOf(n)>-1;n.remove();var s=VL(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return s.name(i),r&&s.listen(),s}return e};n.min=qD.compose(r,n.min),n.max=qD.compose(r,n.max)}else n instanceof pL?(dL.bind(e,"click",(function(){dL.fakeEvent(n.__checkbox,"click")})),dL.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof xL?(dL.bind(e,"click",(function(){dL.fakeEvent(n.__button,"click")})),dL.bind(e,"mouseover",(function(){dL.addClass(n.__button,"hover")})),dL.bind(e,"mouseout",(function(){dL.removeClass(n.__button,"hover")}))):n instanceof wL&&(dL.addClass(e,"color"),n.updateDisplay=qD.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=qD.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&zL(t.getRoot(),!0),e}),n.setValue)}(t,l,r),t.__controllers.push(r),r}function WL(t,e){return document.location.href+"."+e}function GL(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function HL(t,e){e.style.display=t.useLocalStorage?"block":"none"}function jL(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function qL(t,e){var n={};return qD.each(t.__rememberedObjects,(function(i,r){var s={},o=t.__rememberedObjectIndecesToControllers[r];qD.each(o,(function(t,n){s[n]=e?t.initialValue:t.getValue()})),n[r]=s})),n}function XL(t){0!==t.length&&TL.call(window,(function(){XL(t)})),qD.each(t,(function(t){t.updateDisplay()}))}PL.toggleHide=function(){OL=!OL,qD.each(kL,(function(t){t.domElement.style.display=OL?"none":""}))},PL.CLASS_AUTO_PLACE="a",PL.CLASS_AUTO_PLACE_CONTAINER="ac",PL.CLASS_MAIN="main",PL.CLASS_CONTROLLER_ROW="cr",PL.CLASS_TOO_TALL="taller-than-window",PL.CLASS_CLOSED="closed",PL.CLASS_CLOSE_BUTTON="close-button",PL.CLASS_CLOSE_TOP="close-top",PL.CLASS_CLOSE_BOTTOM="close-bottom",PL.CLASS_DRAG="drag",PL.DEFAULT_WIDTH=245,PL.TEXT_CLOSED="Close Controls",PL.TEXT_OPEN="Open Controls",PL._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||PL.toggleHide()},dL.bind(window,"keydown",PL._keydownHandler,!1),qD.extend(PL.prototype,{add:function(t,e){return VL(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return VL(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;qD.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&LL.removeChild(this.domElement);var t=this;qD.each(this.__folders,(function(e){t.removeFolder(e)})),dL.unbind(window,"keydown",PL._keydownHandler,!1),BL(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new PL(e);this.__folders[t]=n;var i=FL(this,n.domElement);return dL.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],BL(t);var e=this;qD.each(t.__folders,(function(e){t.removeFolder(e)})),qD.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=dL.getOffset(t.__ul).top,n=0;qD.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=dL.getHeight(e))})),window.innerHeight-e-20<n?(dL.addClass(t.domElement,PL.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(dL.removeClass(t.domElement,PL.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&qD.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:qD.debounce((function(){this.onResize()}),50),remember:function(){if(qD.isUndefined(NL)&&((NL=new EL).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;qD.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");dL.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),dL.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",dL.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",dL.addClass(i,"button"),dL.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",dL.addClass(r,"button"),dL.addClass(r,"save-as");var s=document.createElement("span");s.innerHTML="Revert",dL.addClass(s,"button"),dL.addClass(s,"revert");var o=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?qD.each(t.load.remembered,(function(e,n){GL(t,n,n===t.preset)})):GL(t,IL,!1);if(dL.bind(o,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(o),e.appendChild(n),e.appendChild(i),e.appendChild(r),e.appendChild(s),RL){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(WL(t,"isLocal"))&&l.setAttribute("checked","checked"),HL(t,a),dL.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,HL(t,a)}))}var c=document.getElementById("dg-new-constructor");dL.bind(c,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||NL.hide()})),dL.bind(n,"click",(function(){c.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),NL.show(),c.focus(),c.select()})),dL.bind(i,"click",(function(){t.save()})),dL.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),dL.bind(s,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&jL(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=qL(this)),t.folders={},qD.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=qL(this),zL(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[IL]=qL(this,!0)),this.load.remembered[t]=qL(this),this.preset=t,GL(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){qD.each(this.__controllers,(function(e){this.getRoot().load.remembered?UL(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),qD.each(this.__folders,(function(t){t.revert(t)})),t||zL(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&XL(this.__listening)},updateDisplay:function(){qD.each(this.__controllers,(function(t){t.updateDisplay()})),qD.each(this.__folders,(function(t){t.updateDisplay()}))}});var YL=PL;class ZL extends Gb{constructor(t){super(t),this.type=ih}parse(t){const e=function(t,e,n){e=e||1024;let i=t.pos,r=-1,s=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));for(;0>(r=a.indexOf("\n"))&&s<e&&i<t.byteLength;)o+=a,s+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));return-1<r&&(!1!==n&&(t.pos+=s+r+1),o+a.slice(0,r))},n=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=t[e+0]*s,n[i+1]=t[e+1]*s,n[i+2]=t[e+2]*s,n[i+3]=1},i=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=Kx.toHalfFloat(Math.min(t[e+0]*s,65504)),n[i+1]=Kx.toHalfFloat(Math.min(t[e+1]*s,65504)),n[i+2]=Kx.toHalfFloat(Math.min(t[e+2]*s,65504)),n[i+3]=Kx.toHalfFloat(1)},r=new Uint8Array(t);r.pos=0;const s=function(t){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let a,l;if(t.pos>=t.byteLength||!(a=e(t)))return-1;if(!(l=a.match(/^#\?(\S+)/)))return-1;for(o.valid|=1,o.programtype=l[1],o.string+=a+"\n";a=e(t),!1!==a;)if(o.string+=a+"\n","#"!==a.charAt(0)){if((l=a.match(n))&&(o.gamma=parseFloat(l[1])),(l=a.match(i))&&(o.exposure=parseFloat(l[1])),(l=a.match(r))&&(o.valid|=2,o.format=l[1]),(l=a.match(s))&&(o.valid|=4,o.height=parseInt(l[1],10),o.width=parseInt(l[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=a+"\n";return 2&o.valid&&4&o.valid?o:-1}(r);if(-1!==s){const t=s.width,e=s.height,o=function(t,e,n){const i=e;if(i<8||i>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(i!==(t[2]<<8|t[3]))return-1;const r=new Uint8Array(4*e*n);if(!r.length)return-1;let s=0,o=0;const a=4*i,l=new Uint8Array(4),c=new Uint8Array(a);let u=n;for(;u>0&&o<t.byteLength;){if(o+4>t.byteLength)return-1;if(l[0]=t[o++],l[1]=t[o++],l[2]=t[o++],l[3]=t[o++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=i)return-1;let e,n=0;for(;n<a&&o<t.byteLength;){e=t[o++];const i=e>128;if(i&&(e-=128),0===e||n+e>a)return-1;if(i){const i=t[o++];for(let t=0;t<e;t++)c[n++]=i}else c.set(t.subarray(o,o+e),n),n+=e,o+=e}const h=i;for(let t=0;t<h;t++){let e=0;r[s]=c[t+e],e+=i,r[s+1]=c[t+e],e+=i,r[s+2]=c[t+e],e+=i,r[s+3]=c[t+e],s+=4}u--}return r}(r.subarray(r.pos),t,e);if(-1!==o){let r,a,l;switch(this.type){case nh:l=o.length/4;const t=new Float32Array(4*l);for(let i=0;i<l;i++)n(o,4*i,t,4*i);r=t,a=nh;break;case ih:l=o.length/4;const e=new Uint16Array(4*l);for(let n=0;n<l;n++)i(o,4*n,e,4*n);r=e,a=ih}return{width:t,height:e,data:r,header:s.string,gamma:s.gamma,exposure:s.exposure,type:a}}}return null}setDataType(t){return this.type=t,this}load(t,e,n,i){return super.load(t,(function(t,n){switch(t.type){case nh:case ih:t.encoding=Qh,t.minFilter=Xu,t.magFilter=Xu,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,n)}),n,i)}}class KL extends Fb{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new nO(t)})),this.register((function(t){return new cO(t)})),this.register((function(t){return new uO(t)})),this.register((function(t){return new rO(t)})),this.register((function(t){return new sO(t)})),this.register((function(t){return new oO(t)})),this.register((function(t){return new aO(t)})),this.register((function(t){return new eO(t)})),this.register((function(t){return new lO(t)})),this.register((function(t){return new iO(t)})),this.register((function(t){return new QL(t)})),this.register((function(t){return new hO(t)})),this.register((function(t){return new dO(t)}))}load(t,e,n,i){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ax.extractUrlBase(t),this.manager.itemStart(t);const o=function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)},a=new Ub(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{r.parse(n,s,(function(n){e(n),r.manager.itemEnd(t)}),o)}catch(xW){o(xW)}}),n,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let r;const s={},o={};if("string"==typeof t)r=JSON.parse(t);else if(t instanceof ArrayBuffer){if(ax.decodeText(new Uint8Array(t,0,4))===pO){try{s[JL.KHR_BINARY_GLTF]=new gO(t)}catch(l){return void(i&&i(l))}r=JSON.parse(s[JL.KHR_BINARY_GLTF].content)}else r=JSON.parse(ax.decodeText(new Uint8Array(t)))}else r=t;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const a=new UO(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const t=this.pluginCallbacks[c](a);o[t.name]=t,s[t.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const t=r.extensionsUsed[c],e=r.extensionsRequired||[];switch(t){case JL.KHR_MATERIALS_UNLIT:s[t]=new tO;break;case JL.KHR_DRACO_MESH_COMPRESSION:s[t]=new vO(r,this.dracoLoader);break;case JL.KHR_TEXTURE_TRANSFORM:s[t]=new yO;break;case JL.KHR_MESH_QUANTIZATION:s[t]=new _O;break;default:e.indexOf(t)>=0&&o[t]}}a.setExtensions(s),a.setPlugins(o),a.parse(n,i)}parseAsync(t,e){const n=this;return new Promise((function(i,r){n.parse(t,e,i,r)}))}}function $L(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const JL={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class QL{constructor(t){this.parser=t,this.name=JL.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const r=e.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let o;const a=new Ud(16777215);void 0!==s.color&&a.fromArray(s.color);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new sx(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ix(a),o.distance=l;break;case"spot":o=new Jb(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,kO(o,s),void 0!==s.intensity&&(o.intensity=s.intensity),o.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(o),e.cache.add(n,i),i}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(t){return n._getNodeRef(e.cache,r,t)}))}}class tO{constructor(){this.name=JL.KHR_MATERIALS_UNLIT}getMaterialType(){return ff}extendParams(t,e,n){const i=[];t.color=new Ud(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture,td))}return Promise.all(i)}}class eO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(e.emissiveIntensity=i),Promise.resolve()}}class nO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Cd(t,t)}return Promise.all(r)}}class iO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class rO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new Ud(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];return void 0!==s.sheenColorFactor&&e.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,td)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class sO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class oO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return e.attenuationColor=new Ud(o[0],o[1],o[2]),Promise.all(r)}}class aO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class lO{constructor(t){this.parser=t,this.name=JL.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?cb:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return e.specularColor=new Ud(o[0],o[1],o[2]),void 0!==s.specularColorTexture&&r.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,td)),Promise.all(r)}}class cO{constructor(t){this.parser=t,this.name=JL.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class uO{constructor(t){this.parser=t,this.name=JL.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(t,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class hO{constructor(t){this.name=JL.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,o=t.byteStride,a=new Uint8Array(e,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,a,t.mode,t.filter).then((function(t){return t.buffer})):r.ready.then((function(){const e=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(e),s,o,a,t.mode,t.filter),e}))}))}return null}}class dO{constructor(t){this.name=JL.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=e.meshes[n.mesh];for(const a of i.primitives)if(a.mode!==SO.TRIANGLES&&a.mode!==SO.TRIANGLE_STRIP&&a.mode!==SO.TRIANGLE_FAN&&void 0!==a.mode)return null;const r=n.extensions[this.name].attributes,s=[],o={};for(const a in r)s.push(this.parser.getDependency("accessor",r[a]).then((t=>(o[a]=t,o[a]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(t)),Promise.all(s).then((t=>{const e=t.pop(),n=e.isGroup?e.children:[e],i=t[0].count,r=[];for(const s of n){const t=new Ep,e=new Jd,n=new $d,a=new Jd(1,1,1),l=new Ly(s.geometry,s.material,i);for(let r=0;r<i;r++)o.TRANSLATION&&e.fromBufferAttribute(o.TRANSLATION,r),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,r),o.SCALE&&a.fromBufferAttribute(o.SCALE,r),l.setMatrixAt(r,t.compose(e,n,a));for(const i in o)"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&s.geometry.setAttribute(i,o[i]);Qp.prototype.copy.call(l,s),l.frustumCulled=!1,this.parser.assignFinalMaterial(l),r.push(l)}return e.isGroup?(e.clear(),e.add(...r),e):r[0]})))}}const pO="glTF",fO=1313821514,mO=5130562;class gO{constructor(t){this.name=JL.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:ax.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==pO)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(t,12);let r=0;for(;r<n;){const e=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,n===fO){const n=new Uint8Array(t,12+r,e);this.content=ax.decodeText(n)}else if(n===mO){const n=12+r;this.body=t.slice(n,n+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class vO{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=JL.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const t=EO[c]||c.toLowerCase();o[t]=s[c]}for(const c in t.attributes){const e=EO[c]||c.toLowerCase();if(void 0!==s[c]){const i=n.accessors[t.attributes[c]],r=MO[i.componentType];l[e]=r.name,a[e]=!0===i.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(const e in t.attributes){const n=t.attributes[e],i=a[e];void 0!==i&&(n.normalized=i)}e(t)}),o,l)}))}))}}class yO{constructor(){this.name=JL.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord,void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class _O{constructor(){this.name=JL.KHR_MESH_QUANTIZATION}}class bO extends bb{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let s=0;s!==i;s++)e[s]=n[r+s];return e}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-e,u=(n-e)/c,h=u*u,d=h*u,p=t*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let _=0;_!==o;_++){const t=s[f+_+o],e=s[f+_+a]*c,n=s[p+_+o],i=s[p+_]*c;r[_]=v*t+y*e+m*n+g*i}return r}}const xO=new $d;class wO extends bO{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return xO.fromArray(r).normalize().toArray(r),r}}const SO={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},MO={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},CO={9728:Hu,9729:Xu,9984:ju,9985:Yu,9986:qu,9987:Zu},AO={33071:Wu,33648:Gu,10497:Vu},TO={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},EO={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},IO={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},RO={CUBICSPLINE:void 0,LINEAR:Xh,STEP:qh},NO="OPAQUE",DO="MASK",LO="BLEND";function OO(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function kO(t,e){void 0!==e.extras&&"object"==typeof e.extras&&Object.assign(t.userData,e.extras)}function PO(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}}}function FO(t){const e=t.extensions&&t.extensions[JL.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+BO(e.attributes):t.indices+":"+BO(t.attributes)+":"+t.mode,n}function BO(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function zO(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class UO{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new $L,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,r=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new Hb(this.options.manager):this.textureLoader=new lx(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ub(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};OO(r,s,i),kO(s,i),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=e.length;i<r;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let i=0,r=t.length;i<r;i++){const e=t[i];void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(n[e.mesh].isSkinnedMesh=!0)),void 0!==e.camera&&this._addNodeRef(this.cameraCache,e.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[i,s]of t.children.entries())r(s,e.children[i])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":i=this.loadCamera(e);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)})),!i)throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[JL.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,r){n.load(ax.resolveURL(e.uri,i.path),t,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse){const t=TO[i.type],e=MO[i.componentType],n=!0===i.normalized,r=new e(i.count*t);return Promise.resolve(new vf(r,t,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(t){const r=t[0],s=TO[i.type],o=MO[i.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,c=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,p;if(u&&u!==l){const t=Math.floor(c/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(d=new o(r,t*u,i.count*u/a),l=new $v(d,u/a),e.cache.add(n,l)),p=new Qv(l,s,c%u/a,h)}else d=null===r?new o(i.count*s):new o(r,c,i.count*s),p=new vf(d,s,h);if(void 0!==i.sparse){const e=TO.SCALAR,n=MO[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(t[1],a,i.sparse.count*e),u=new o(t[2],l,i.sparse.count*s);null!==r&&(p=new vf(p.array.slice(),p.itemSize,p.normalized));for(let t=0,i=c.length;t<i;t++){const e=c[t];if(p.setX(e,u[t*s]),s>=2&&p.setY(e,u[t*s+1]),s>=3&&p.setZ(e,u[t*s+2]),s>=4&&p.setW(e,u[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t].source,r=e.images[i];let s=this.textureLoader;if(r.uri){const t=n.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,n){const i=this,r=this.json,s=r.textures[t],o=r.images[e],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(e,n).then((function(e){e.flipY=!1,e.name=s.name||o.name||"";const n=(r.samplers||{})[s.sampler]||{};return e.magFilter=CO[n.magFilter]||Xu,e.minFilter=CO[n.minFilter]||Zu,e.wrapS=AO[n.wrapS]||Vu,e.wrapT=AO[n.wrapT]||Vu,i.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(t,e){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const s=i.images[t],o=self.URL||self.webkitURL;let a=s.uri||"",l=!1;if(void 0!==s.bufferView)a=n.getDependency("bufferView",s.bufferView).then((function(t){l=!0;const e=new Blob([t],{type:s.mimeType});return a=o.createObjectURL(e),a}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(a).then((function(t){return new Promise((function(n,i){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){const e=new qd(t);e.needsUpdate=!0,n(e)}),e.load(ax.resolveURL(t,r.path),s,void 0,i)}))})).then((function(t){var e;return!0===l&&o.revokeObjectURL(a),t.userData.mimeType=s.mimeType||((e=s.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw t}));return this.sourceCache[t]=c,c}assignTexture(t,e,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&0!=n.texCoord&&("aoMap"!==e||n.texCoord),r.extensions[JL.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[JL.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=r.associations.get(s);s=r.extensions[JL.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),r.associations.set(s,e)}}return void 0!==i&&(s.encoding=i),t[e]=s,s}))}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new jy,pf.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Oy,pf.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";i&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return lb}loadMaterial(t){const e=this,n=this.json,i=this.extensions,r=n.materials[t];let s;const o={},a=[];if((r.extensions||{})[JL.KHR_MATERIALS_UNLIT]){const t=i[JL.KHR_MATERIALS_UNLIT];s=t.getMaterialType(),a.push(t.extendParams(o,r,e))}else{const n=r.pbrMetallicRoughness||{};if(o.color=new Ud(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==n.baseColorTexture&&a.push(e.assignTexture(o,"map",n.baseColorTexture,td)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(e.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),a.push(e.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),a.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===r.doubleSided&&(o.side=Kc);const l=r.alphaMode||NO;if(l===LO?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===DO&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==ff&&(a.push(e.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Cd(1,1),void 0!==r.normalTexture.scale)){const t=r.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==r.occlusionTexture&&s!==ff&&(a.push(e.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==ff&&(o.emissive=(new Ud).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&s!==ff&&a.push(e.assignTexture(o,"emissiveMap",r.emissiveTexture,td)),Promise.all(a).then((function(){const n=new s(o);return r.name&&(n.name=r.name),kO(n,r),e.associations.set(n,{materials:t}),r.extensions&&OO(i,n,r),n}))}createUniqueName(t){const e=Lx.sanitizeNodeName(t||"");let n=e;for(let i=1;this.nodeNamesUsed[n];++i)n=e+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function r(t){return n[JL.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return WO(n,t,e)}))}const s=[];for(let o=0,a=t.length;o<a;o++){const n=t[o],a=FO(n),l=i[a];if(l)s.push(l.promise);else{let t;t=n.extensions&&n.extensions[JL.KHR_DRACO_MESH_COMPRESSION]?r(n):WO(new Ef,n,e),i[a]={primitive:n,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){const e=this,n=this.json,i=this.extensions,r=n.meshes[t],s=r.primitives,o=[];for(let l=0,c=s.length;l<c;l++){const t=void 0===s[l].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new lb({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Yc})),a.DefaultMaterial):this.getDependency("material",s[l].material);o.push(t)}var a;return o.push(e.loadGeometries(s)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){const n=a[u],c=s[u];let h;const d=o[u];if(c.mode===SO.TRIANGLES||c.mode===SO.TRIANGLE_STRIP||c.mode===SO.TRIANGLE_FAN||void 0===c.mode)h=!0===r.isSkinnedMesh?new xy(n,d):new qf(n,d),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),c.mode===SO.TRIANGLE_STRIP?h.geometry=GO(h.geometry,1):c.mode===SO.TRIANGLE_FAN&&(h.geometry=GO(h.geometry,2));else if(c.mode===SO.LINES)h=new Gy(n,d);else if(c.mode===SO.LINE_STRIP)h=new Uy(n,d);else if(c.mode===SO.LINE_LOOP)h=new Hy(n,d);else{if(c.mode!==SO.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new Ky(n,d)}Object.keys(h.geometry.morphAttributes).length>0&&PO(h,r),h.name=e.createUniqueName(r.name||"mesh_"+t),kO(h,r),c.extensions&&OO(i,h,c),e.assignFinalMaterial(h),l.push(h)}for(let i=0,r=l.length;i<r;i++)e.associations.set(l[i],{meshes:t,primitives:i});if(1===l.length)return l[0];const c=new Uv;e.associations.set(c,{meshes:t});for(let t=0,e=l.length;t<e;t++)c.add(l[t]);return c}))}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new em(Md.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new Am(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),kO(e,n),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],n=[];for(let i=0,r=e.joints.length;i<r;i++)n.push(this.getDependency("node",e.joints[i]));return void 0!==e.inverseBindMatrices?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(t){const e=t.pop(),n=t,i=[],r=[];for(let s=0,o=n.length;s<o;s++){const t=n[s];if(t){i.push(t);const n=new Ep;null!==e&&n.fromArray(e.array,16*s),r.push(n)}}return new Ay(i,r)}))}loadAnimation(t){const e=this.json.animations[t],n=[],i=[],r=[],s=[],o=[];for(let a=0,l=e.channels.length;a<l;a++){const t=e.channels[a],l=e.samplers[t.sampler],c=t.target,u=c.node,h=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",h)),r.push(this.getDependency("accessor",d)),s.push(l),o.push(c)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o)]).then((function(n){const i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],n=r[t],c=s[t],u=o[t],h=a[t];if(void 0===e)continue;let d;switch(e.updateMatrix(),IO[h.path]){case IO.weights:d=Tb;break;case IO.rotation:d=Ib;break;default:d=Nb}const p=e.name?e.name:e.uuid,f=void 0!==u.interpolation?RO[u.interpolation]:Xh,m=[];IO[h.path]===IO.weights?e.traverse((function(t){t.morphTargetInfluences&&m.push(t.name?t.name:t.uuid)})):m.push(p);let g=c.array;if(c.normalized){const t=zO(g.constructor),e=new Float32Array(g.length);for(let n=0,i=g.length;n<i;n++)e[n]=g[n]*t;g=e}for(let t=0,i=m.length;t<i;t++){const e=new d(m[t]+"."+IO[h.path],n.array,g,f);"CUBICSPLINE"===u.interpolation&&(e.createInterpolant=function(t){return new(this instanceof Ib?wO:bO)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const c=e.name?e.name:"animation_"+t;return new Db(c,void 0,l)}))}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))}loadNode(t){const e=this.json,n=this.extensions,i=this,r=e.nodes[t],s=r.name?i.createUniqueName(r.name):"";return function(){const e=[],n=i._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return n&&e.push(n),void 0!==r.camera&&e.push(i.getDependency("camera",r.camera).then((function(t){return i._getNodeRef(i.cameraCache,r.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let o;if(o=!0===r.isBone?new wy:e.length>1?new Uv:1===e.length?e[0]:new Qp,o!==e[0])for(let t=0,n=e.length;t<n;t++)o.add(e[t]);if(r.name&&(o.userData.name=r.name,o.name=s),kO(o,r),r.extensions&&OO(n,o,r),void 0!==r.matrix){const t=new Ep;t.fromArray(r.matrix),o.applyMatrix4(t)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=t,o}))}loadScene(t){const e=this.json,n=this.extensions,i=this.json.scenes[t],r=this,s=new Uv;i.name&&(s.name=r.createUniqueName(i.name)),kO(s,i),i.extensions&&OO(n,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(VO(o[l],s,e,r));return Promise.all(a).then((function(){return r.associations=(t=>{const e=new Map;for(const[n,i]of r.associations)(n instanceof pf||n instanceof qd)&&e.set(n,i);return t.traverse((t=>{const n=r.associations.get(t);null!=n&&e.set(t,n)})),e})(s),s}))}}function VO(t,e,n,i){const r=n.nodes[t];return i.getDependency("node",t).then((function(t){return void 0===r.skin?t:i.getDependency("skin",r.skin).then((function(e){return t.traverse((function(t){t.isSkinnedMesh&&t.bind(e,t.matrixWorld)})),t}))})).then((function(t){e.add(t);const s=[];if(r.children){const e=r.children;for(let r=0,o=e.length;r<o;r++){const o=e[r];s.push(VO(o,t,n,i))}}return Promise.all(s)}))}function WO(t,e,n){const i=e.attributes,r=[];function s(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const o in i){const e=EO[o]||o.toLowerCase();e in t.attributes||r.push(s(i[o],e))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));r.push(i)}return kO(t,e),function(t,e,n){const i=e.attributes,r=new ep;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return;if(r.set(new Jd(e[0],e[1],e[2]),new Jd(s[0],s[1],s[2])),t.normalized){const e=zO(MO[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new Jd,e=new Jd;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const t=zO(MO[i.componentType]);e.multiplyScalar(t)}t.max(e)}}}r.expandByVector(t)}t.boundingBox=r;const o=new _p;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=o}(t,e,n),Promise.all(r).then((function(){return void 0!==e.targets?function(t,e,n){let i=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const t=e[c];if(void 0!==t.POSITION&&(i=!0),void 0!==t.NORMAL&&(r=!0),void 0!==t.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const u=e[c];if(i){const e=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):t.attributes.position;o.push(e)}if(r){const e=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):t.attributes.normal;a.push(e)}if(s){const e=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const n=e[0],o=e[1],a=e[2];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function GO(t,e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,r=[];if(2===e)for(let o=1;o<=i;o++)r.push(n.getX(0)),r.push(n.getX(o)),r.push(n.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(r.push(n.getX(o)),r.push(n.getX(o+1)),r.push(n.getX(o+2))):(r.push(n.getX(o+2)),r.push(n.getX(o+1)),r.push(n.getX(o)));r.length;const s=t.clone();return s.setIndex(r),s}const HO=new WeakMap;class jO extends Fb{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,n,i){const r=new Ub(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(t=>{this.decodeDracoFile(t,e).catch(i)}),n,i)}decodeDracoFile(t,e,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};return this.decodeGeometry(t,r).then(e)}decodeGeometry(t,e){const n=JSON.stringify(e);if(HO.has(t)){const e=HO.get(t);if(e.key===n)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=t.byteLength,o=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return o.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),HO.set(t,{key:n,promise:o}),o}_createGeometry(t){const e=new Ef;t.index&&e.setIndex(new vf(t.index.array,1));for(let n=0;n<t.attributes.length;n++){const i=t.attributes[n],r=i.name,s=i.array,o=i.itemSize;e.setAttribute(r,new vf(s,o))}return e}_loadLibrary(t,e){const n=new Ub(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise(((e,i)=>{n.load(t,e,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const n=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const i=qO.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const n=e.data;switch(n.type){case"decode":t._callbacks[n.id].resolve(n);break;case"error":t._callbacks[n.id].reject(n)}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=e,n._taskLoad+=e,n}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function qO(){let t,e;function n(t,e,n,i,r,s){const o=s.num_components(),a=n.num_points()*o,l=a*r.BYTES_PER_ELEMENT,c=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),u=t._malloc(l);e.GetAttributeDataArrayForAllPoints(n,s,c,l,u);const h=new r(t.HEAPF32.buffer,u,a).slice();return t._free(u),{name:i,array:h,itemSize:o}}onmessage=function(i){const r=i.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const i=r.buffer,s=r.taskConfig;e.then((t=>{const e=t.draco,o=new e.Decoder,a=new e.DecoderBuffer;a.Init(new Int8Array(i),i.byteLength);try{const t=function(t,e,i,r){const s=r.attributeIDs,o=r.attributeTypes;let a,l;const c=e.GetEncodedGeometryType(i);if(c===t.TRIANGULAR_MESH)a=new t.Mesh,l=e.DecodeBufferToMesh(i,a);else{if(c!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,l=e.DecodeBufferToPointCloud(i,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const h in s){const i=self[o[h]];let l,c;if(r.useUniqueIDs)c=s[h],l=e.GetAttributeByUniqueId(a,c);else{if(c=e.GetAttributeId(a,t[s[h]]),-1===c)continue;l=e.GetAttribute(a,c)}u.attributes.push(n(t,e,a,h,i,l))}c===t.TRIANGULAR_MESH&&(u.index=function(t,e,n){const i=n.num_faces(),r=3*i,s=4*r,o=t._malloc(s);e.GetTrianglesUInt32Array(n,s,o);const a=new Uint32Array(t.HEAPF32.buffer,o,r).slice();return t._free(o),{array:a,itemSize:1}}(t,e,a));return t.destroy(a),u}(e,o,a,s),i=t.attributes.map((t=>t.array.buffer));t.index&&i.push(t.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:t},i)}catch(l){self.postMessage({type:"error",id:r.id,error:l.message})}finally{e.destroy(a),e.destroy(o)}}))}}}const XO=/^[og]\s*(.+)?/,YO=/^mtllib /,ZO=/^usemtl /,KO=/^usemap /,$O=/\s+/,JO=new Jd,QO=new Jd,tk=new Jd,ek=new Jd,nk=new Jd,ik=new Ud;function rk(){const t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const i={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){const e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){const e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"==typeof n.clone){const t=n.clone(0);t.inherited=!0,this.object.materials.push(t)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){const n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){const n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[t+0],i[t+1],i[t+2]),r.push(i[e+0],i[e+1],i[e+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){const i=this.normals,r=this.object.geometry.normals;r.push(i[t+0],i[t+1],i[t+2]),r.push(i[e+0],i[e+1],i[e+2]),r.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(t,e,n){const i=this.vertices,r=this.object.geometry.normals;JO.fromArray(i,t),QO.fromArray(i,e),tk.fromArray(i,n),nk.subVectors(tk,QO),ek.subVectors(JO,QO),nk.cross(ek),nk.normalize(),r.push(nk.x,nk.y,nk.z),r.push(nk.x,nk.y,nk.z),r.push(nk.x,nk.y,nk.z)},addColor:function(t,e,n){const i=this.colors,r=this.object.geometry.colors;void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[n]&&r.push(i[n+0],i[n+1],i[n+2])},addUV:function(t,e,n){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[t+0],i[t+1]),r.push(i[e+0],i[e+1]),r.push(i[n+0],i[n+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,i,r,s,o,a,l){const c=this.vertices.length;let u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),d=this.parseVertexIndex(n,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==o&&""!==o){const t=this.normals.length;u=this.parseNormalIndex(o,t),h=this.parseNormalIndex(a,t),d=this.parseNormalIndex(l,t),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==i&&""!==i){const t=this.uvs.length;u=this.parseUVIndex(i,t),h=this.parseUVIndex(r,t),d=this.parseUVIndex(s,t),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let n=0,i=t.length;n<i;n++){const i=this.parseVertexIndex(t[n],e);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let r=0,s=t.length;r<s;r++)this.addVertexLine(this.parseVertexIndex(t[r],n));for(let r=0,s=e.length;r<s;r++)this.addUVLine(this.parseUVIndex(e[r],i))}};return t.startObject("",!1),t}class sk extends Fb{constructor(t){super(t),this.materials=null}load(t,e,n,i){const r=this,s=new Ub(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(r.parse(n))}catch(xW){i&&i(xW),r.manager.itemError(t)}}),n,i)}setMaterials(t){return this.materials=t,this}parse(t){const e=new rk;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const n=t.split("\n");let i=[];for(let s=0,o=n.length;s<o;s++){const t=n[s].trimStart();if(0===t.length)continue;const r=t.charAt(0);if("#"!==r)if("v"===r){const n=t.split($O);switch(n[0]){case"v":e.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),n.length>=7?(ik.setRGB(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])).convertSRGBToLinear(),e.colors.push(ik.r,ik.g,ik.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"vt":e.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}}else if("f"===r){const n=t.slice(1).trim().split($O),i=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];if(e.length>0){const t=e.split("/");i.push(t)}}const r=i[0];for(let t=1,s=i.length-1;t<s;t++){const n=i[t],s=i[t+1];e.addFace(r[0],n[0],s[0],r[1],n[1],s[1],r[2],n[2],s[2])}}else if("l"===r){const n=t.substring(1).trim().split(" ");let i=[];const r=[];if(-1===t.indexOf("/"))i=n;else for(let t=0,e=n.length;t<e;t++){const e=n[t].split("/");""!==e[0]&&i.push(e[0]),""!==e[1]&&r.push(e[1])}e.addLineGeometry(i,r)}else if("p"===r){const n=t.slice(1).trim().split(" ");e.addPointGeometry(n)}else if(null!==(i=XO.exec(t))){const t=(" "+i[0].slice(1).trim()).slice(1);e.startObject(t)}else if(ZO.test(t))e.object.startMaterial(t.substring(7).trim(),e.materialLibraries);else if(YO.test(t))e.materialLibraries.push(t.substring(7).trim());else if(KO.test(t));else if("s"===r){if(i=t.split(" "),i.length>1){const t=i[1].trim().toLowerCase();e.object.smooth="0"!==t&&"off"!==t}else e.object.smooth=!0;const n=e.object.currentMaterial();n&&(n.smooth=e.object.smooth)}else if("\0"===t)continue}e.finalize();const r=new Uv;r.materialLibraries=[].concat(e.materialLibraries);if(!0===!(1===e.objects.length&&0===e.objects[0].geometry.vertices.length))for(let s=0,o=e.objects.length;s<o;s++){const t=e.objects[s],n=t.geometry,i=t.materials,o="Line"===n.type,a="Points"===n.type;let l=!1;if(0===n.vertices.length)continue;const c=new Ef;c.setAttribute("position",new bf(n.vertices,3)),n.normals.length>0&&c.setAttribute("normal",new bf(n.normals,3)),n.colors.length>0&&(l=!0,c.setAttribute("color",new bf(n.colors,3))),!0===n.hasUVIndices&&c.setAttribute("uv",new bf(n.uvs,2));const u=[];for(let r=0,s=i.length;r<s;r++){const t=i[r],n=t.name+"_"+t.smooth+"_"+l;let s=e.materials[n];if(null!==this.materials)if(s=this.materials.create(t.name),!o||!s||s instanceof Oy){if(a&&s&&!(s instanceof jy)){const t=new jy({size:10,sizeAttenuation:!1});pf.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,s=t}}else{const t=new Oy;pf.prototype.copy.call(t,s),t.color.copy(s.color),s=t}void 0===s&&(s=o?new Oy:a?new jy({size:1,sizeAttenuation:!1}):new ub,s.name=t.name,s.flatShading=!t.smooth,s.vertexColors=l,e.materials[n]=s),u.push(s)}let h;if(u.length>1){for(let t=0,e=i.length;t<e;t++){const e=i[t];c.addGroup(e.groupStart,e.groupCount,t)}h=o?new Gy(c,u):a?new Ky(c,u):new qf(c,u)}else h=o?new Gy(c,u[0]):a?new Ky(c,u[0]):new qf(c,u[0]);h.name=t.name,r.add(h)}else if(e.vertices.length>0){const t=new jy({size:1,sizeAttenuation:!1}),n=new Ef;n.setAttribute("position",new bf(e.vertices,3)),e.colors.length>0&&void 0!==e.colors[0]&&(n.setAttribute("color",new bf(e.colors,3)),t.vertexColors=!0);const i=new Ky(n,t);r.add(i)}return r}}class ok extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===this.path?ax.extractUrlBase(t):this.path,o=new Ub(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(r.parse(n,s))}catch(xW){i&&i(xW),r.manager.itemError(t)}}),n,i)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,e){const n=t.split("\n");let i={};const r=/\s+/,s={};for(let a=0;a<n.length;a++){let t=n[a];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const e=t.indexOf(" ");let o=e>=0?t.substring(0,e):t;o=o.toLowerCase();let l=e>=0?t.substring(e+1):"";if(l=l.trim(),"newmtl"===o)i={name:l},s[l]=i;else if("ka"===o||"kd"===o||"ks"===o||"ke"===o){const t=l.split(r,3);i[o]=[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])]}else i[o]=l}const o=new ak(this.resourcePath||e,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(s),o}}class ak{constructor(t="",e={}){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:Yc,this.wrap=void 0!==this.options.wrap?this.options.wrap:Vu}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;const e={};for(const n in t){const i=t[n],r={};e[n]=r;for(const t in i){let e=!0,n=i[t];const s=t.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(e=!1)}e&&(r[s]=n)}}return e}preload(){for(const t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(const e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray}create(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){const e=this,n=this.materialsInfo[t],i={name:t,side:this.side};function r(t,n){if(i[t])return;const r=e.getTextureParams(n,i),s=e.loadTexture((o=e.baseUrl,"string"!=typeof(a=r.url)||""===a?"":/^https?:\/\//i.test(a)?a:o+a));var o,a;s.repeat.copy(r.scale),s.offset.copy(r.offset),s.wrapS=e.wrap,s.wrapT=e.wrap,"map"!==t&&"emissiveMap"!==t||(s.encoding=td),i[t]=s}for(const s in n){const t=n[s];let e;if(""!==t)switch(s.toLowerCase()){case"kd":i.color=(new Ud).fromArray(t).convertSRGBToLinear();break;case"ks":i.specular=(new Ud).fromArray(t).convertSRGBToLinear();break;case"ke":i.emissive=(new Ud).fromArray(t).convertSRGBToLinear();break;case"map_kd":r("map",t);break;case"map_ks":r("specularMap",t);break;case"map_ke":r("emissiveMap",t);break;case"norm":r("normalMap",t);break;case"map_bump":case"bump":r("bumpMap",t);break;case"map_d":r("alphaMap",t),i.transparent=!0;break;case"ns":i.shininess=parseFloat(t);break;case"d":e=parseFloat(t),e<1&&(i.opacity=e,i.transparent=!0);break;case"tr":e=parseFloat(t),this.options&&this.options.invertTrProperty&&(e=1-e),e>0&&(i.opacity=1-e,i.transparent=!0)}}return this.materials[t]=new ub(i),this.materials[t]}getTextureParams(t,e){const n={scale:new Cd(1,1),offset:new Cd(0,0)},i=t.split(/\s+/);let r;return r=i.indexOf("-bm"),r>=0&&(e.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),r=i.indexOf("-s"),r>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),r=i.indexOf("-o"),r>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n}loadTexture(t,e,n,i,r){const s=void 0!==this.manager?this.manager:Pb;let o=s.getHandler(t);null===o&&(o=new Hb(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const a=o.load(t,n,i,r);return void 0!==e&&(a.mapping=e),a}}
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var lk={},ck=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},uk=function(t){return new Worker(t)};try{URL.revokeObjectURL(ck(""))}catch(xW){ck=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},uk=function(t){return new Worker(t,{type:"module"})}}var hk=Uint8Array,dk=Uint16Array,pk=Uint32Array,fk=new hk([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mk=new hk([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gk=new hk([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vk=function(t,e){for(var n=new dk(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var r=new pk(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},yk=vk(fk,2),_k=yk[0],bk=yk[1];_k[28]=258,bk[258]=28;for(var xk=vk(mk,0),wk=xk[0],Sk=xk[1],Mk=new dk(32768),Ck=0;Ck<32768;++Ck){var Ak=(43690&Ck)>>>1|(21845&Ck)<<1;Ak=(61680&(Ak=(52428&Ak)>>>2|(13107&Ak)<<2))>>>4|(3855&Ak)<<4,Mk[Ck]=((65280&Ak)>>>8|(255&Ak)<<8)>>>1}var Tk=function(t,e,n){for(var i=t.length,r=0,s=new dk(e);r<i;++r)++s[t[r]-1];var o,a=new dk(e);for(r=0;r<e;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new dk(1<<e);var l=15-e;for(r=0;r<i;++r)if(t[r])for(var c=r<<4|t[r],u=e-t[r],h=a[t[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)o[Mk[h]>>>l]=c}else for(o=new dk(i),r=0;r<i;++r)t[r]&&(o[r]=Mk[a[t[r]-1]++]>>>15-t[r]);return o},Ek=new hk(288);for(Ck=0;Ck<144;++Ck)Ek[Ck]=8;for(Ck=144;Ck<256;++Ck)Ek[Ck]=9;for(Ck=256;Ck<280;++Ck)Ek[Ck]=7;for(Ck=280;Ck<288;++Ck)Ek[Ck]=8;var Ik=new hk(32);for(Ck=0;Ck<32;++Ck)Ik[Ck]=5;var Rk=Tk(Ek,9,0),Nk=Tk(Ek,9,1),Dk=Tk(Ik,5,0),Lk=Tk(Ik,5,1),Ok=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},kk=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},Pk=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},Fk=function(t){return(t/8|0)+(7&t&&1)},Bk=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var i=new(t instanceof dk?dk:t instanceof pk?pk:hk)(n-e);return i.set(t.subarray(e,n)),i},zk=function(t,e,n){var i=t.length;if(!i||n&&!n.l&&i<5)return e||new hk(0);var r=!e||n,s=!n||n.i;n||(n={}),e||(e=new hk(3*i));var o=function(t){var n=e.length;if(t>n){var i=new hk(Math.max(2*n,t));i.set(e),e=i}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,h=n.d,d=n.m,p=n.n,f=8*i;do{if(!u){n.f=a=kk(t,l,1);var m=kk(t,l+1,3);if(l+=3,!m){var g=t[(T=Fk(l)+4)-4]|t[T-3]<<8,v=T+g;if(v>i){if(s)throw"unexpected EOF";break}r&&o(c+g),e.set(t.subarray(T,v),c),n.b=c+=g,n.p=l=8*v;continue}if(1==m)u=Nk,h=Lk,d=9,p=5;else{if(2!=m)throw"invalid block type";var y=kk(t,l,31)+257,_=kk(t,l+10,15)+4,b=y+kk(t,l+5,31)+1;l+=14;for(var x=new hk(b),w=new hk(19),S=0;S<_;++S)w[gk[S]]=kk(t,l+3*S,7);l+=3*_;var M=Ok(w),C=(1<<M)-1,A=Tk(w,M,1);for(S=0;S<b;){var T,E=A[kk(t,l,C)];if(l+=15&E,(T=E>>>4)<16)x[S++]=T;else{var I=0,R=0;for(16==T?(R=3+kk(t,l,3),l+=2,I=x[S-1]):17==T?(R=3+kk(t,l,7),l+=3):18==T&&(R=11+kk(t,l,127),l+=7);R--;)x[S++]=I}}var N=x.subarray(0,y),D=x.subarray(y);d=Ok(N),p=Ok(D),u=Tk(N,d,1),h=Tk(D,p,1)}if(l>f){if(s)throw"unexpected EOF";break}}r&&o(c+131072);for(var L=(1<<d)-1,O=(1<<p)-1,k=l;;k=l){var P=(I=u[Pk(t,l)&L])>>>4;if((l+=15&I)>f){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(P<256)e[c++]=P;else{if(256==P){k=l,u=null;break}var F=P-254;if(P>264){var B=fk[S=P-257];F=kk(t,l,(1<<B)-1)+_k[S],l+=B}var z=h[Pk(t,l)&O],U=z>>>4;if(!z)throw"invalid distance";l+=15&z;D=wk[U];if(U>3){B=mk[U];D+=Pk(t,l)&(1<<B)-1,l+=B}if(l>f){if(s)throw"unexpected EOF";break}r&&o(c+131072);for(var V=c+F;c<V;c+=4)e[c]=e[c-D],e[c+1]=e[c+1-D],e[c+2]=e[c+2-D],e[c+3]=e[c+3-D];c=V}}n.l=u,n.p=k,n.b=c,u&&(a=1,n.m=d,n.d=h,n.n=p)}while(!a);return c==e.length?e:Bk(e,0,c)},Uk=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8},Vk=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8,t[i+2]|=n>>>16},Wk=function(t,e){for(var n=[],i=0;i<t.length;++i)t[i]&&n.push({s:i,f:t[i]});var r=n.length,s=n.slice();if(!r)return[Zk,0];if(1==r){var o=new hk(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,h=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=r-1;)a=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var d=s[0].s;for(i=1;i<r;++i)s[i].s>d&&(d=s[i].s);var p=new dk(d+1),f=Gk(n[u-1],p,0);if(f>e){i=0;var m=0,g=f-e,v=1<<g;for(s.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));i<r;++i){var y=s[i].s;if(!(p[y]>e))break;m+=v-(1<<f-p[y]),p[y]=e}for(m>>>=g;m>0;){var _=s[i].s;p[_]<e?m-=1<<e-p[_]++-1:++i}for(;i>=0&&m;--i){var b=s[i].s;p[b]==e&&(--p[b],++m)}f=e}return[new hk(p),f]},Gk=function(t,e,n){return-1==t.s?Math.max(Gk(t.l,e,n+1),Gk(t.r,e,n+1)):e[t.s]=n},Hk=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new dk(++e),i=0,r=t[0],s=1,o=function(t){n[i++]=t},a=1;a<=e;++a)if(t[a]==r&&a!=e)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=t[a]}return[n.subarray(0,i),e]},jk=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},qk=function(t,e,n){var i=n.length,r=Fk(e+2);t[r]=255&i,t[r+1]=i>>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var s=0;s<i;++s)t[r+s+4]=n[s];return 8*(r+4+i)},Xk=function(t,e,n,i,r,s,o,a,l,c,u){Uk(e,u++,n),++r[256];for(var h=Wk(r,15),d=h[0],p=h[1],f=Wk(s,15),m=f[0],g=f[1],v=Hk(d),y=v[0],_=v[1],b=Hk(m),x=b[0],w=b[1],S=new dk(19),M=0;M<y.length;++M)S[31&y[M]]++;for(M=0;M<x.length;++M)S[31&x[M]]++;for(var C=Wk(S,7),A=C[0],T=C[1],E=19;E>4&&!A[gk[E-1]];--E);var I,R,N,D,L=c+5<<3,O=jk(r,Ek)+jk(s,Ik)+o,k=jk(r,d)+jk(s,m)+o+14+3*E+jk(S,A)+(2*S[16]+3*S[17]+7*S[18]);if(L<=O&&L<=k)return qk(e,u,t.subarray(l,l+c));if(Uk(e,u,1+(k<O)),u+=2,k<O){I=Tk(d,p,0),R=d,N=Tk(m,g,0),D=m;var P=Tk(A,T,0);Uk(e,u,_-257),Uk(e,u+5,w-1),Uk(e,u+10,E-4),u+=14;for(M=0;M<E;++M)Uk(e,u+3*M,A[gk[M]]);u+=3*E;for(var F=[y,x],B=0;B<2;++B){var z=F[B];for(M=0;M<z.length;++M){var U=31&z[M];Uk(e,u,P[U]),u+=A[U],U>15&&(Uk(e,u,z[M]>>>5&127),u+=z[M]>>>12)}}}else I=Rk,R=Ek,N=Dk,D=Ik;for(M=0;M<a;++M)if(i[M]>255){U=i[M]>>>18&31;Vk(e,u,I[U+257]),u+=R[U+257],U>7&&(Uk(e,u,i[M]>>>23&31),u+=fk[U]);var V=31&i[M];Vk(e,u,N[V]),u+=D[V],V>3&&(Vk(e,u,i[M]>>>5&8191),u+=mk[V])}else Vk(e,u,I[i[M]]),u+=R[i[M]];return Vk(e,u,I[256]),u+R[256]},Yk=new pk([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Zk=new hk(0),Kk=function(t,e,n,i,r,s){var o=t.length,a=new hk(i+o+5*(1+Math.ceil(o/7e3))+r),l=a.subarray(i,a.length-r),c=0;if(!e||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?c=qk(l,c,t.subarray(u,h)):(l[u]=s,c=qk(l,c,t.subarray(u,o)))}else{for(var d=Yk[e-1],p=d>>>13,f=8191&d,m=(1<<n)-1,g=new dk(32768),v=new dk(m+1),y=Math.ceil(n/3),_=2*y,b=function(e){return(t[e]^t[e+1]<<y^t[e+2]<<_)&m},x=new pk(25e3),w=new dk(288),S=new dk(32),M=0,C=0,A=(u=0,0),T=0,E=0;u<o;++u){var I=b(u),R=32767&u,N=v[I];if(g[R]=N,v[I]=R,T<=u){var D=o-u;if((M>7e3||A>24576)&&D>423){c=Xk(t,l,0,x,w,S,C,A,E,u-E,c),A=M=C=0,E=u;for(var L=0;L<286;++L)w[L]=0;for(L=0;L<30;++L)S[L]=0}var O=2,k=0,P=f,F=R-N&32767;if(D>2&&I==b(u-F))for(var B=Math.min(p,D)-1,z=Math.min(32767,u),U=Math.min(258,D);F<=z&&--P&&R!=N;){if(t[u+O]==t[u+O-F]){for(var V=0;V<U&&t[u+V]==t[u+V-F];++V);if(V>O){if(O=V,k=F,V>B)break;var W=Math.min(F,V-2),G=0;for(L=0;L<W;++L){var H=u-F+L+32768&32767,j=H-g[H]+32768&32767;j>G&&(G=j,N=H)}}}F+=(R=N)-(N=g[R])+32768&32767}if(k){x[A++]=268435456|bk[O]<<18|Sk[k];var q=31&bk[O],X=31&Sk[k];C+=fk[q]+mk[X],++w[257+q],++S[X],T=u+O,++M}else x[A++]=t[u],++w[t[u]]}}c=Xk(t,l,s,x,w,S,C,A,E,u-E,c),!s&&7&c&&(c=qk(l,c+1,Zk))}return Bk(a,0,i+Fk(c)+r)},$k=function(){for(var t=new pk(256),e=0;e<256;++e){for(var n=e,i=9;--i;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),Jk=function(){var t=-1;return{p:function(e){for(var n=t,i=0;i<e.length;++i)n=$k[255&n^e[i]]^n>>>8;t=n},d:function(){return~t}}},Qk=function(){var t=1,e=0;return{p:function(n){for(var i=t,r=e,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}t=i,e=r},d:function(){return(255&(t%=65521))<<24|t>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},tP=function(t,e,n,i,r){return Kk(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,i,!r)},eP=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},nP=function(t,e,n){for(var i=t(),r=t.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if("function"==typeof a){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;e+=c.slice(u,c.indexOf("(",u))}else for(var h in e+=c,a.prototype)e+=";"+l+".prototype."+h+"="+a.prototype[h].toString();else e+=c}else n[l]=a}return[e,n]},iP=[],rP=function(t,e,n,i){var r;if(!iP[n]){for(var s="",o={},a=t.length-1,l=0;l<a;++l)s=(r=nP(t[l],s,o))[0],o=r[1];iP[n]=nP(t[a],s,o)}var c=eP({},iP[n][1]);return function(t,e,n,i,r){var s=uk(lk[e]||(lk[e]=ck(t)));return s.onerror=function(t){return r(t.error,null)},s.onmessage=function(t){return r(null,t.data)},s.postMessage(n,i),s}(iP[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,c,function(t){var e=[];for(var n in t)(t[n]instanceof hk||t[n]instanceof dk||t[n]instanceof pk)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e}(c),i)},sP=function(){return[hk,dk,pk,fk,mk,gk,_k,wk,Nk,Lk,Mk,Tk,Ok,kk,Pk,Fk,Bk,zk,OP,hP,dP]},oP=function(){return[hk,dk,pk,fk,mk,gk,bk,Sk,Rk,Ek,Dk,Ik,Mk,Yk,Zk,Tk,Uk,Vk,Wk,Gk,Hk,jk,qk,Xk,Fk,Bk,Kk,tP,RP,hP]},aP=function(){return[bP,SP,_P,Jk,$k]},lP=function(){return[xP,wP]},cP=function(){return[MP,_P,Qk]},uP=function(){return[CP]},hP=function(t){return postMessage(t,[t.buffer])},dP=function(t){return t&&t.size&&new hk(t.size)},pP=function(t,e,n,i,r,s){var o=rP(n,i,r,(function(t,e){o.terminate(),s(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}},fP=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},mP=function(t,e,n,i,r){var s,o=rP(t,i,r,(function(t,n){t?(o.terminate(),e.ondata.call(e,t)):(n[1]&&o.terminate(),e.ondata.call(e,t,n[0],n[1]))}));o.postMessage(n),e.push=function(t,n){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([t,s=n],[t.buffer])},e.terminate=function(){o.terminate()}},gP=function(t,e){return t[e]|t[e+1]<<8},vP=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},yP=function(t,e){return vP(t,e)+4294967296*vP(t,e+4)},_P=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},bP=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&_P(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var i=0;i<=n.length;++i)t[i+10]=n.charCodeAt(i)}},xP=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],n=10;4&e&&(n+=t[10]|2+(t[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[n++]);return n+(2&e)},wP=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},SP=function(t){return 10+(t.filename&&t.filename.length+1||0)},MP=function(t,e){var n=e.level,i=0==n?0:n<6?1:9==n?3:2;t[0]=120,t[1]=i<<6|(i?32-2*i:1)},CP=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function AP(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var TP=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(tP(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}(),EP=function(){return function(t,e){mP([oP,function(){return[fP,TP]}],this,AP.call(this,t,e),(function(t){var e=new TP(t.data);onmessage=fP(e)}),6)}}();function IP(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return pP(t,e,[oP],(function(t){return hP(RP(t.data[0],t.data[1]))}),0,n)}function RP(t,e){return tP(t,e||{},0,0)}var NP=function(){function t(t){this.s={},this.p=new hk(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,n=new hk(e+t.length);n.set(this.p),n.set(t,e),this.p=n},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,n=zk(this.p,this.o,this.s);this.ondata(Bk(n,e,this.s.b),this.d),this.o=Bk(n,this.s.b-32768),this.s.b=this.o.length,this.p=Bk(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}(),DP=function(){return function(t){this.ondata=t,mP([sP,function(){return[fP,NP]}],this,0,(function(){var t=new NP;onmessage=fP(t)}),7)}}();function LP(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return pP(t,e,[sP],(function(t){return hP(OP(t.data[0],dP(t.data[1])))}),1,n)}function OP(t,e){return zk(t,e)}var kP=function(){function t(t,e){this.c=Jk(),this.l=0,this.v=1,TP.call(this,t,e)}return t.prototype.push=function(t,e){TP.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var n=tP(t,this.o,this.v&&SP(this.o),e&&8,!e);this.v&&(bP(n,this.o),this.v=0),e&&(_P(n,n.length-8,this.c.d()),_P(n,n.length-4,this.l)),this.ondata(n,e)},t}(),PP=function(){return function(t,e){mP([oP,aP,function(){return[fP,TP,kP]}],this,AP.call(this,t,e),(function(t){var e=new kP(t.data);onmessage=fP(e)}),8)}}();function FP(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return pP(t,e,[oP,aP,function(){return[BP]}],(function(t){return hP(BP(t.data[0],t.data[1]))}),2,n)}function BP(t,e){e||(e={});var n=Jk(),i=t.length;n.p(t);var r=tP(t,e,SP(e),8),s=r.length;return bP(r,e),_P(r,s-8,n.d()),_P(r,s-4,i),r}var zP=function(){function t(t){this.v=1,NP.call(this,t)}return t.prototype.push=function(t,e){if(NP.prototype.e.call(this,t),this.v){var n=this.p.length>3?xP(this.p):4;if(n>=this.p.length&&!e)return;this.p=this.p.subarray(n),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}NP.prototype.c.call(this,e)},t}(),UP=function(){return function(t){this.ondata=t,mP([sP,lP,function(){return[fP,NP,zP]}],this,0,(function(){var t=new zP;onmessage=fP(t)}),9)}}();function VP(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return pP(t,e,[sP,lP,function(){return[WP]}],(function(t){return hP(WP(t.data[0]))}),3,n)}function WP(t,e){return zk(t.subarray(xP(t),-8),e||new hk(wP(t)))}var GP=function(){function t(t,e){this.c=Qk(),this.v=1,TP.call(this,t,e)}return t.prototype.push=function(t,e){TP.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var n=tP(t,this.o,this.v&&2,e&&4,!e);this.v&&(MP(n,this.o),this.v=0),e&&_P(n,n.length-4,this.c.d()),this.ondata(n,e)},t}(),HP=function(){return function(t,e){mP([oP,cP,function(){return[fP,TP,GP]}],this,AP.call(this,t,e),(function(t){var e=new GP(t.data);onmessage=fP(e)}),10)}}();function jP(t,e){e||(e={});var n=Qk();n.p(t);var i=tP(t,e,2,4);return MP(i,e),_P(i,i.length-4,n.d()),i}var qP=function(){function t(t){this.v=1,NP.call(this,t)}return t.prototype.push=function(t,e){if(NP.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}NP.prototype.c.call(this,e)},t}(),XP=function(){return function(t){this.ondata=t,mP([sP,uP,function(){return[fP,NP,qP]}],this,0,(function(){var t=new qP;onmessage=fP(t)}),11)}}();function YP(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return pP(t,e,[sP,uP,function(){return[ZP]}],(function(t){return hP(ZP(t.data[0],dP(t.data[1])))}),5,n)}function ZP(t,e){return zk((CP(t),t.subarray(2,-4)),e)}var KP=function(){function t(t){this.G=zP,this.I=NP,this.Z=qP,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var n=new hk(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,e),this.p=null}}},t}(),$P=function(){function t(t){this.G=UP,this.I=DP,this.Z=XP,this.ondata=t}return t.prototype.push=function(t,e){KP.prototype.push.call(this,t,e)},t}();var JP=function(t,e,n,i){for(var r in t){var s=t[r],o=e+r;s instanceof hk?n[o]=[s,i]:Array.isArray(s)?n[o]=[s[0],eP(i,s[1])]:JP(s,o+"/",n,i)}},QP="undefined"!=typeof TextEncoder&&new TextEncoder,tF="undefined"!=typeof TextDecoder&&new TextDecoder,eF=0;try{tF.decode(Zk,{stream:!0}),eF=1}catch(xW){}var nF=function(t){for(var e="",n=0;;){var i=t[n++],r=(i>127)+(i>223)+(i>239);if(n+r>t.length)return[e,Bk(t,n-1)];r?3==r?(i=((15&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&r?String.fromCharCode((31&i)<<6|63&t[n++]):String.fromCharCode((15&i)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(i)}},iF=function(){function t(t){this.ondata=t,eF?this.t=new TextDecoder:this.p=Zk}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new hk(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var i=nF(n),r=i[0],s=i[1];if(e){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,e)}},t}(),rF=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(sF(t),this.d=e||!1)},t}();function sF(t,e){if(e){for(var n=new hk(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}if(QP)return QP.encode(t);var r=t.length,s=new hk(t.length+(t.length>>1)),o=0,a=function(t){s[o++]=t};for(i=0;i<r;++i){if(o+5>s.length){var l=new hk(o+8+(r-i<<1));l.set(s),s=l}var c=t.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(a(240|(c=65536+(1047552&c)|1023&t.charCodeAt(++i))>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return Bk(s,0,o)}function oF(t,e){if(e){for(var n="",i=0;i<t.length;i+=16384)n+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return n}if(tF)return tF.decode(t);var r=nF(t),s=r[0];if(r[1].length)throw"invalid utf-8 data";return s}var aF=function(t){return 1==t?3:t<6?2:9==t?1:0},lF=function(t,e){return e+30+gP(t,e+26)+gP(t,e+28)},cF=function(t,e,n){var i=gP(t,e+28),r=oF(t.subarray(e+46,e+46+i),!(2048&gP(t,e+8))),s=e+46+i,o=vP(t,e+20),a=n&&4294967295==o?uF(t,s):[o,vP(t,e+24),vP(t,e+42)],l=a[0],c=a[1],u=a[2];return[gP(t,e+10),l,c,r,s+gP(t,e+30)+gP(t,e+32),u]},uF=function(t,e){for(;1!=gP(t,e);e+=4+gP(t,e+2));return[yP(t,e+12),yP(t,e+4),yP(t,e+20)]},hF=function(t){var e=0;if(t)for(var n in t){var i=t[n].length;if(i>65535)throw"extra field too long";e+=i+4}return e},dF=function(t,e,n,i,r,s,o,a){var l=i.length,c=n.extra,u=a&&a.length,h=hF(c);_P(t,e,null!=o?33639248:67324752),e+=4,null!=o&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(null==s&&8),t[e++]=r&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(_P(t,e,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),e+=4,null!=s&&(_P(t,e,n.crc),_P(t,e+4,s),_P(t,e+8,n.size)),_P(t,e+12,l),_P(t,e+14,h),e+=16,null!=o&&(_P(t,e,u),_P(t,e+6,n.attrs),_P(t,e+10,o),e+=14),t.set(i,e),e+=l,h)for(var f in c){var m=c[f],g=m.length;_P(t,e,+f),_P(t,e+2,g),t.set(m,e+4),e+=4+g}return u&&(t.set(a,e),e+=u),e},pF=function(t,e,n,i,r){_P(t,e,101010256),_P(t,e+8,n),_P(t,e+10,n),_P(t,e+12,i),_P(t,e+16,r)},fF=function(){function t(t){this.filename=t,this.c=Jk(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),mF=function(){function t(t,e){var n=this;e||(e={}),fF.call(this,t),this.d=new TP(e,(function(t,e){n.ondata(null,t,e)})),this.compression=8,this.flag=aF(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(xW){this.ondata(xW,null,e)}},t.prototype.push=function(t,e){fF.prototype.push.call(this,t,e)},t}(),gF=function(){function t(t,e){var n=this;e||(e={}),fF.call(this,t),this.d=new EP(e,(function(t,e,i){n.ondata(t,e,i)})),this.compression=8,this.flag=aF(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){fF.prototype.push.call(this,t,e)},t}(),vF=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var n=sF(t.filename),i=n.length,r=t.comment,s=r&&sF(r),o=i!=t.filename.length||s&&r.length!=s.length,a=i+hF(t.extra)+30;if(i>65535)throw"filename too long";var l=new hk(a);dF(l,0,t,n,o);var c=[l],u=function(){for(var t=0,n=c;t<n.length;t++){var i=n[t];e.ondata(null,i,!1)}c=[]},h=this.d;this.d=0;var d=this.u.length,p=eP(t,{f:n,u:o,o:s,t:function(){t.terminate&&t.terminate()},r:function(){if(u(),h){var t=e.u[d+1];t?t.r():e.d=1}h=1}}),f=0;t.ondata=function(n,i,r){if(n)e.ondata(n,i,r),e.terminate();else if(f+=i.length,c.push(i),r){var s=new hk(16);_P(s,0,134695760),_P(s,4,t.crc),_P(s,8,f),_P(s,12,t.size),c.push(s),p.c=f,p.b=a+f+16,p.crc=t.crc,p.size=t.size,h&&p.r(),h=1}else h&&u()},this.u.push(p)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,n=0,i=0,r=this.u;i<r.length;i++){n+=46+(l=r[i]).f.length+hF(l.extra)+(l.o?l.o.length:0)}for(var s=new hk(n+22),o=0,a=this.u;o<a.length;o++){var l=a[o];dF(s,t,l,l.f,l.u,l.c,e,l.o),t+=46+l.f.length+hF(l.extra)+(l.o?l.o.length:0),e+=l.b}pF(s,t,this.u.length,n,e),this.ondata(null,s,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++){e[t].t()}this.d=2},t}();var yF=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}(),_F=function(){function t(){var t=this;this.i=new NP((function(e,n){t.ondata(null,e,n)}))}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(xW){this.ondata(xW,t,e)}},t.compression=8,t}(),bF=function(){function t(t,e){var n=this;e<32e4?this.i=new NP((function(t,e){n.ondata(null,t,e)})):(this.i=new DP((function(t,e,i){n.ondata(t,e,i)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=Bk(t,0)),this.i.push(t,e)},t.compression=8,t}(),xF=function(){function t(t){this.onfile=t,this.k=[],this.o={0:yF},this.p=Zk}return t.prototype.push=function(t,e){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,t.length),r=t.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),(t=t.subarray(i)).length)return this.push(t,e)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?t.length?((l=new hk(this.p.length+t.length)).set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var c=l.length,u=this.c,h=u&&this.d,d=function(){var t,e=vP(l,o);if(67324752==e){s=1,a=o,p.d=null,p.c=0;var i=gP(l,o+6),r=gP(l,o+8),h=2048&i,d=8&i,f=gP(l,o+26),m=gP(l,o+28);if(c>o+30+f+m){var g=[];p.k.unshift(g),s=2;var v,y=vP(l,o+18),_=vP(l,o+22),b=oF(l.subarray(o+30,o+=30+f),!h);4294967295==y?(t=d?[-2]:uF(l,o),y=t[0],_=t[1]):d&&(y=-1),o+=m,p.c=y;var x={name:b,compression:r,start:function(){if(!x.ondata)throw"no callback";if(y){var t=n.o[r];if(!t)throw"unknown compression type "+r;(v=y<0?new t(b):new t(b,y,_)).ondata=function(t,e,n){x.ondata(t,e,n)};for(var e=0,i=g;e<i.length;e++){var s=i[e];v.push(s,!1)}n.k[0]==g&&n.c?n.d=v:v.push(Zk,!0)}else x.ondata(null,Zk,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(x.size=y,x.originalSize=_),p.onfile(x)}return"break"}if(u){if(134695760==e)return a=o+=12+(-2==u&&8),s=3,p.c=0,"break";if(33639248==e)return a=o-=4,s=3,p.c=0,"break"}},p=this;o<c-4;++o){if("break"===d())break}if(this.p=Zk,u<0){var f=s?l.subarray(0,a-12-(-2==u&&8)-(134695760==vP(l,a-16)&&4)):l.subarray(0,o);h?h.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),e);this.p=l.subarray(o)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();Symbol.toStringTag;function wF(t,e,n){const i=n.length-t-1;if(e>=n[i])return i-1;if(e<=n[t])return t;let r=t,s=i,o=Math.floor((r+s)/2);for(;e<n[o]||e>=n[o+1];)e<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function SF(t,e){let n=1;for(let r=2;r<=t;++r)n*=r;let i=1;for(let r=2;r<=e;++r)i*=r;for(let r=2;r<=t-e;++r)i*=r;return n/i}function MF(t,e,n,i,r){const s=function(t,e,n,i,r){const s=r<t?r:t,o=[],a=wF(t,i,e),l=function(t,e,n,i,r){const s=[];for(let h=0;h<=n;++h)s[h]=0;const o=[];for(let h=0;h<=i;++h)o[h]=s.slice(0);const a=[];for(let h=0;h<=n;++h)a[h]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let h=1;h<=n;++h){l[h]=e-r[t+1-h],c[h]=r[t+h]-e;let n=0;for(let t=0;t<h;++t){const e=c[t+1],i=l[h-t];a[h][t]=e+i;const r=a[t][h-1]/a[h][t];a[t][h]=n+e*r,n=i*r}a[h][h]=n}for(let h=0;h<=n;++h)o[0][h]=a[h][n];for(let h=0;h<=n;++h){let t=0,e=1;const r=[];for(let i=0;i<=n;++i)r[i]=s.slice(0);r[0][0]=1;for(let s=1;s<=i;++s){let i=0;const l=h-s,c=n-s;h>=s&&(r[e][0]=r[t][0]/a[c+1][l],i=r[e][0]*a[l][c]);const u=h-1<=c?s-1:n-h;for(let n=l>=-1?1:-l;n<=u;++n)r[e][n]=(r[t][n]-r[t][n-1])/a[c+1][l+n],i+=r[e][n]*a[l+n][c];h<=c&&(r[e][s]=-r[t][s-1]/a[c+1][h],i+=r[e][s]*a[h][c]),o[s][h]=i;const d=t;t=e,e=d}}let u=n;for(let h=1;h<=i;++h){for(let t=0;t<=n;++t)o[h][t]*=u;u*=n-h}return o}(a,i,t,s,e),c=[];for(let u=0;u<n.length;++u){const t=n[u].clone(),e=t.w;t.x*=e,t.y*=e,t.z*=e,c[u]=t}for(let u=0;u<=s;++u){const e=c[a-t].clone().multiplyScalar(l[u][0]);for(let n=1;n<=t;++n)e.add(c[a-t+n].clone().multiplyScalar(l[u][n]));o[u]=e}for(let u=s+1;u<=r+1;++u)o[u]=new Xd(0,0,0);return o}(t,e,n,i,r);return function(t){const e=t.length,n=[],i=[];for(let s=0;s<e;++s){const e=t[s];n[s]=new Jd(e.x,e.y,e.z),i[s]=e.w}const r=[];for(let s=0;s<e;++s){const t=n[s].clone();for(let e=1;e<=s;++e)t.sub(r[s-e].clone().multiplyScalar(SF(s,e)*i[e]));r[s]=t.divideScalar(i[0])}return r}(s)}class CF extends Qy{constructor(t,e,n,i,r){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let s=0;s<n.length;++s){const t=n[s];this.controlPoints[s]=new Xd(t.x,t.y,t.z,t.w)}}getPoint(t,e=new Jd){const n=e,i=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(t,e,n,i){const r=wF(t,i,e),s=function(t,e,n,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=e-i[t+1-a],o[a]=i[t+a]-e;let n=0;for(let t=0;t<a;++t){const e=o[t+1],i=s[a-t],l=r[t]/(e+i);r[t]=n+e*l,n=i*l}r[a]=n}return r}(r,i,t,e),o=new Xd(0,0,0,0);for(let a=0;a<=t;++a){const e=n[r-t+a],i=s[a],l=e.w*i;o.x+=e.x*l,o.y+=e.y*l,o.z+=e.z*l,o.w+=e.w*i}return o}(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(t,e=new Jd){const n=e,i=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),r=MF(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let AF,TF,EF;class IF extends Fb{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===r.path?ax.extractUrlBase(t):r.path,o=new Ub(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(t,(function(n){try{e(r.parse(n,s))}catch(xW){i&&i(xW),r.manager.itemError(t)}}),n,i)}parse(t,e){if(function(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===qF(t,0,e.length)}(t))AF=(new OF).parse(t);else{const e=qF(t);if(!function(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(e){const i=t[e-1];return t=t.slice(n+e),n++,i}for(let r=0;r<e.length;++r){if(i(1)===e[r])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(FF(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+FF(e));AF=(new LF).parse(e)}const n=new Hb(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new RF(n,this.manager).parse(AF)}}class RF{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){TF=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),i=this.parseDeformers(),r=(new NF).parse(i);return this.parseScene(i,r,n),EF}parseConnections(){const t=new Map;if("Connections"in AF){AF.Connections.connections.forEach((function(e){const n=e[0],i=e[1],r=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};t.get(n).parents.push(s),t.has(i)||t.set(i,{parents:[],children:[]});const o={ID:n,relationship:r};t.get(i).children.push(o)}))}return t}parseImages(){const t={},e={};if("Video"in AF.Objects){const n=AF.Objects.Video;for(const i in n){const r=n[i];if(t[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const t=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(t||s){const t=this.parseImage(n[i]);e[r.RelativeFilename||r.Filename]=t}}}}for(const n in t){const i=t[n];void 0!==e[i]?t[n]=e[i]:t[n]=t[n].split("\\").pop()}return t}parseImage(t){const e=t.Content,n=t.RelativeFilename||t.Filename;let i;switch(n.slice(n.lastIndexOf(".")+1).toLowerCase()){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":this.manager.getHandler(".tga"),i="image/tga";break;default:return}if("string"==typeof e)return"data:"+i+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:i}))}}parseTextures(t){const e=new Map;if("Texture"in AF.Objects){const n=AF.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],t);e.set(parseInt(i),r)}}return e}parseTexture(t,e){const n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;const i=t.WrapModeU,r=t.WrapModeV,s=void 0!==i?i.value:0,o=void 0!==r?r.value:0;if(n.wrapS=0===s?Vu:Wu,n.wrapT=0===o?Vu:Wu,"Scaling"in t){const e=t.Scaling.value;n.repeat.x=e[0],n.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;n.offset.x=e[0],n.offset.y=e[1]}return n}loadTexture(t,e){let n;const i=this.textureLoader.path,r=TF.get(t.id).children;let s;void 0!==r&&r.length>0&&void 0!==e[r[0].ID]&&(n=e[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const o=t.FileName.slice(-3).toLowerCase();if("tga"===o){const t=this.manager.getHandler(".tga");null===t?s=new qd:(t.setPath(this.textureLoader.path),s=t.load(n))}else s="psd"===o?new qd:this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(t){const e=new Map;if("Material"in AF.Objects){const n=AF.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],t);null!==r&&e.set(parseInt(i),r)}}return e}parseMaterial(t,e){const n=t.id,i=t.attrName;let r=t.ShadingModel;if("object"==typeof r&&(r=r.value),!TF.has(n))return null;const s=this.parseParameters(t,e,n);let o;switch(r.toLowerCase()){case"phong":default:o=new ub;break;case"lambert":o=new db}return o.setValues(s),o.name=i,o}parseParameters(t,e,n){const i={};t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse?i.color=(new Ud).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(i.color=(new Ud).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.Emissive?i.emissive=(new Ud).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(i.emissive=(new Ud).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Shininess&&(i.shininess=t.Shininess.value),t.Specular?i.specular=(new Ud).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(i.specular=(new Ud).fromArray(t.SpecularColor.value));const r=this;return TF.get(n).children.forEach((function(t){switch(t.relationship){case"Bump":i.bumpMap=r.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(e,t.ID),void 0!==i.map&&(i.map.encoding=td);break;case"DisplacementColor":i.displacementMap=r.getTexture(e,t.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(e,t.ID),void 0!==i.emissiveMap&&(i.emissiveMap.encoding=td);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(e,t.ID);break;case"ReflectionColor":i.envMap=r.getTexture(e,t.ID),void 0!==i.envMap&&(i.envMap.mapping=Bu,i.envMap.encoding=td);break;case"SpecularColor":i.specularMap=r.getTexture(e,t.ID),void 0!==i.specularMap&&(i.specularMap.encoding=td);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(e,t.ID),i.transparent=!0}})),i}getTexture(t,e){return"LayeredTexture"in AF.Objects&&e in AF.Objects.LayeredTexture&&(e=TF.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in AF.Objects){const n=AF.Objects.Deformer;for(const i in n){const r=n[i],s=TF.get(parseInt(i));if("Skin"===r.attrType){const e=this.parseSkeleton(s,n);e.ID=i,s.parents.length,e.geometryID=s.parents[0].ID,t[i]=e}else if("BlendShape"===r.attrType){const t={id:i};t.rawTargets=this.parseMorphTargets(s,n),t.id=i,s.parents.length,e[i]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const n=[];return t.children.forEach((function(t){const i=e[t.ID];if("Cluster"!==i.attrType)return;const r={ID:t.ID,indices:[],weights:[],transformLink:(new Ep).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(t,e){const n=[];for(let i=0;i<t.children.length;i++){const r=t.children[i],s=e[r.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=TF.get(parseInt(r.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,n.push(o)}return n}parseScene(t,e,n){EF=new Uv;const i=this.parseModels(t.skeletons,e,n),r=AF.Objects.Model,s=this;i.forEach((function(t){const e=r[t.ID];s.setLookAtProperties(t,e);TF.get(t.ID).parents.forEach((function(e){const n=i.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&EF.add(t)})),this.bindSkeleton(t.skeletons,e,i),this.createAmbientLight(),EF.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=GF(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const o=(new DF).parse();1===EF.children.length&&EF.children[0].isGroup&&(EF.children[0].animations=o,EF=EF.children[0]),EF.animations=o}parseModels(t,e,n){const i=new Map,r=AF.Objects.Model;for(const s in r){const o=parseInt(s),a=r[s],l=TF.get(o);let c=this.buildSkeleton(l,t,o,a.attrName);if(!c){switch(a.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,e,n);break;case"NurbsCurve":c=this.createCurve(l,e);break;case"LimbNode":case"Root":c=new wy;break;default:c=new Uv}c.name=a.attrName?Lx.sanitizeNodeName(a.attrName):"",c.ID=o}this.getTransformData(c,a),i.set(o,c)}return i}buildSkeleton(t,e,n,i){let r=null;return t.parents.forEach((function(t){for(const s in e){const o=e[s];o.rawBones.forEach((function(e,s){if(e.ID===t.ID){const t=r;r=new wy,r.matrixWorld.copy(e.transformLink),r.name=i?Lx.sanitizeNodeName(i):"",r.ID=n,o.bones[s]=r,null!==t&&r.add(t)}}))}})),r}createCamera(t){let e,n;if(t.children.forEach((function(t){const e=AF.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new Qp;else{let t=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(t=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,o=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,o=n.AspectHeight.value);const a=s/o;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(t){case 0:e=new em(l,a,i,r),null!==c&&e.setFocalLength(c);break;case 1:e=new Am(-s/2,s/2,o/2,-o/2,i,r);break;default:e=new Qp}}return e}createLight(t){let e,n;if(t.children.forEach((function(t){const e=AF.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new Qp;else{let t;t=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new Ud).fromArray(n.Color.value));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const o=1;switch(t){case 0:e=new ix(i,r,s,o);break;case 1:e=new sx(i,r);break;case 2:let t=Math.PI/3;void 0!==n.InnerAngle&&(t=Md.degToRad(n.InnerAngle.value));let a=0;void 0!==n.OuterAngle&&(a=Md.degToRad(n.OuterAngle.value),a=Math.max(a,1)),e=new Jb(i,r,s,t,a,o);break;default:e=new ix(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,n){let i,r=null,s=null;const o=[];return t.children.forEach((function(t){e.has(t.ID)&&(r=e.get(t.ID)),n.has(t.ID)&&o.push(n.get(t.ID))})),o.length>1?s=o:o.length>0?s=o[0]:(s=new ub({color:13421772}),o.push(s)),"color"in r.attributes&&o.forEach((function(t){t.vertexColors=!0})),r.FBX_Deformer?(i=new xy(r,s),i.normalizeSkinWeights()):i=new qf(r,s),i}createCurve(t,e){const n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),i=new Oy({color:3342591,linewidth:1});return new Uy(n,i)}getTransformData(t,e){const n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?HF(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}setLookAtProperties(t,e){if("LookAtProperty"in e){TF.get(t.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){const n=AF.Objects.Model[e.ID];if("Lcl_Translation"in n){const e=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),EF.add(t.target)):t.lookAt((new Jd).fromArray(e))}}}))}}bindSkeleton(t,e,n){const i=this.parsePoseNodes();for(const r in t){const s=t[r];TF.get(parseInt(s.ID)).parents.forEach((function(t){if(e.has(t.ID)){const e=t.ID;TF.get(e).parents.forEach((function(t){if(n.has(t.ID)){n.get(t.ID).bind(new Ay(s.bones),i[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in AF.Objects){const e=AF.Objects.Pose;for(const n in e)if("BindPose"===e[n].attrType&&e[n].NbPoseNodes>0){const i=e[n].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new Ep).fromArray(e.Matrix.a)})):t[i.Node]=(new Ep).fromArray(i.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in AF&&"AmbientColor"in AF.GlobalSettings){const t=AF.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],i=t[2];if(0!==e||0!==n||0!==i){const t=new Ud(e,n,i);EF.add(new ox(t,1))}}}}class NF{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in AF.Objects){const n=AF.Objects.Geometry;for(const i in n){const r=TF.get(parseInt(i)),s=this.parseGeometry(r,n[i],t);e.set(parseInt(i),s)}}return this.negativeMaterialIndices,e}parseGeometry(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,n){const i=n.skeletons,r=[],s=t.parents.map((function(t){return AF.Objects.Model[t.ID]}));if(0===s.length)return;const o=t.children.reduce((function(t,e){return void 0!==i[e.ID]&&(t=i[e.ID]),t}),null);t.children.forEach((function(t){void 0!==n.morphTargets[t.ID]&&r.push(n.morphTargets[t.ID])}));const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=HF(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=GF(l);return this.genGeometry(e,o,r,c)}genGeometry(t,e,n,i){const r=new Ef;t.attrName&&(r.name=t.attrName);const s=this.parseGeoNode(t,e),o=this.genBuffers(s),a=new bf(o.vertex,3);if(a.applyMatrix4(i),r.setAttribute("position",a),o.colors.length>0&&r.setAttribute("color",new bf(o.colors,3)),e&&(r.setAttribute("skinIndex",new yf(o.weightsIndices,4)),r.setAttribute("skinWeight",new bf(o.vertexWeights,4)),r.FBX_Deformer=e),o.normal.length>0){const t=(new Ad).getNormalMatrix(i),e=new bf(o.normal,3);e.applyNormalMatrix(t),r.setAttribute("normal",e)}if(o.uvs.forEach((function(t,e){let n="uv"+(e+1).toString();0===e&&(n="uv"),r.setAttribute(n,new bf(o.uvs[e],2))})),s.material&&"AllSame"!==s.material.mappingType){let t=o.materialIndex[0],e=0;if(o.materialIndex.forEach((function(n,i){n!==t&&(r.addGroup(e,i-e,t),t=n,e=i)})),r.groups.length>0){const e=r.groups[r.groups.length-1],n=e.start+e.count;n!==o.materialIndex.length&&r.addGroup(n,o.materialIndex.length-n,t)}0===r.groups.length&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,t,n,i),r}parseGeoNode(t,e){const n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];let e=0;for(;t.LayerElementUV[e];)t.LayerElementUV[e].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:e,weight:t.weights[r]})}))}))),n}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],o=[],a=[],l=[],c=[],u=[];const h=this;return t.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d=~d,m=!0);let g=[],v=[];if(s.push(3*d,3*d+1,3*d+2),t.color){const e=UF(p,n,d,t.color);a.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[d]&&t.weightTable[d].forEach((function(t){v.push(t.weight),g.push(t.id)})),v.length>4){r||(r=!0);const t=[0,0,0,0],e=[0,0,0,0];v.forEach((function(n,i){let r=n,s=g[i];e.forEach((function(e,n,i){if(r>e){i[n]=r,r=e;const o=t[n];t[n]=s,s=o}}))})),g=t,v=e}for(;v.length<4;)v.push(0),g.push(0);for(let t=0;t<4;++t)c.push(v[t]),u.push(g[t])}if(t.normal){const e=UF(p,n,d,t.normal);o.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(f=UF(p,n,d,t.material)[0],f<0&&(h.negativeMaterialIndices=!0,f=0)),t.uv&&t.uv.forEach((function(t,e){const i=UF(p,n,d,t);void 0===l[e]&&(l[e]=[]),l[e].push(i[0]),l[e].push(i[1])})),i++,m&&(h.genFace(e,t,s,f,o,a,l,c,u,i),n++,i=0,s=[],o=[],a=[],l=[],c=[],u=[])})),e}genFace(t,e,n,i,r,s,o,a,l,c){for(let u=2;u<c;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(u-1)]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+2]]),t.vertex.push(e.vertexPositions[n[3*u]]),t.vertex.push(e.vertexPositions[n[3*u+1]]),t.vertex.push(e.vertexPositions[n[3*u+2]]),e.skeleton&&(t.vertexWeights.push(a[0]),t.vertexWeights.push(a[1]),t.vertexWeights.push(a[2]),t.vertexWeights.push(a[3]),t.vertexWeights.push(a[4*(u-1)]),t.vertexWeights.push(a[4*(u-1)+1]),t.vertexWeights.push(a[4*(u-1)+2]),t.vertexWeights.push(a[4*(u-1)+3]),t.vertexWeights.push(a[4*u]),t.vertexWeights.push(a[4*u+1]),t.vertexWeights.push(a[4*u+2]),t.vertexWeights.push(a[4*u+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(u-1)]),t.weightsIndices.push(l[4*(u-1)+1]),t.weightsIndices.push(l[4*(u-1)+2]),t.weightsIndices.push(l[4*(u-1)+3]),t.weightsIndices.push(l[4*u]),t.weightsIndices.push(l[4*u+1]),t.weightsIndices.push(l[4*u+2]),t.weightsIndices.push(l[4*u+3])),e.color&&(t.colors.push(s[0]),t.colors.push(s[1]),t.colors.push(s[2]),t.colors.push(s[3*(u-1)]),t.colors.push(s[3*(u-1)+1]),t.colors.push(s[3*(u-1)+2]),t.colors.push(s[3*u]),t.colors.push(s[3*u+1]),t.colors.push(s[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(i),t.materialIndex.push(i),t.materialIndex.push(i)),e.normal&&(t.normal.push(r[0]),t.normal.push(r[1]),t.normal.push(r[2]),t.normal.push(r[3*(u-1)]),t.normal.push(r[3*(u-1)+1]),t.normal.push(r[3*(u-1)+2]),t.normal.push(r[3*u]),t.normal.push(r[3*u+1]),t.normal.push(r[3*u+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(o[n][0]),t.uvs[n].push(o[n][1]),t.uvs[n].push(o[n][2*(u-1)]),t.uvs[n].push(o[n][2*(u-1)+1]),t.uvs[n].push(o[n][2*u]),t.uvs[n].push(o[n][2*u+1])}))}addMorphTargets(t,e,n,i){if(0===n.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=AF.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(t,e,s,i,n.name)}))}))}genMorphGeometry(t,e,n,i,r){const s=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],a=void 0!==n.Indexes?n.Indexes.a:[],l=3*t.attributes.position.count,c=new Float32Array(l);for(let p=0;p<a.length;p++){const t=3*a[p];c[t]=o[3*p],c[t+1]=o[3*p+1],c[t+2]=o[3*p+2]}const u={vertexIndices:s,vertexPositions:c},h=this.genBuffers(u),d=new bf(h.vertex,3);d.name=r||n.attrName,d.applyMatrix4(i),t.morphAttributes.position.push(d)}parseNormals(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:e,referenceType:n}}parseUVs(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.UV.a;let r=[];return"IndexToDirect"===n&&(r=t.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:e,referenceType:n}}parseVertexColors(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Colors.a;let r=[];return"IndexToDirect"===n&&(r=t.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:e,referenceType:n}}parseMaterialIndices(t){const e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=t.Materials.a,r=[];for(let s=0;s<i.length;++s)r.push(s);return{dataSize:1,buffer:i,indices:r,mappingType:e,referenceType:n}}parseNurbsGeometry(t){if(void 0===CF)return new Ef;const e=parseInt(t.Order);if(isNaN(e))return new Ef;const n=e-1,i=t.KnotVector.a,r=[],s=t.Points.a;for(let c=0,u=s.length;c<u;c+=4)r.push((new Xd).fromArray(s,c));let o,a;if("Closed"===t.Form)r.push(r[0]);else if("Periodic"===t.Form){o=n,a=i.length-1-o;for(let t=0;t<n;++t)r.push(r[t])}const l=new CF(n,i,r,o,a).getPoints(12*r.length);return(new Ef).setFromPoints(l)}}class DF{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const n in e){const i=e[n],r=this.addClip(i);t.push(r)}return t}parseClips(){if(void 0===AF.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=AF.Objects.AnimationCurveNode,e=new Map;for(const n in t){const i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const t={id:i.id,attr:i.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=AF.Objects.AnimationCurve;for(const n in e){const i={id:e[n].id,times:e[n].KeyTime.a.map(BF),values:e[n].KeyValueFloat.a},r=TF.get(i.id);if(void 0!==r){const e=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?t.get(e).curves.x=i:n.match(/Y/)?t.get(e).curves.y=i:n.match(/Z/)?t.get(e).curves.z=i:n.match(/d|DeformPercent/)&&t.has(e)&&(t.get(e).curves.morph=i)}}}parseAnimationLayers(t){const e=AF.Objects.AnimationLayer,n=new Map;for(const i in e){const e=[],r=TF.get(parseInt(i));if(void 0!==r){r.children.forEach((function(n,i){if(t.has(n.ID)){const r=t.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===e[i]){const t=TF.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const n=AF.Objects.Model[t.toString()];if(void 0===n)return;const r={modelName:n.attrName?Lx.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};EF.traverse((function(t){t.ID===n.id&&(r.transform=t.matrix,t.userData.transformData&&(r.eulerOrder=t.userData.transformData.eulerOrder))})),r.transform||(r.transform=new Ep),"PreRotation"in n&&(r.preRotation=n.PreRotation.value),"PostRotation"in n&&(r.postRotation=n.PostRotation.value),e[i]=r}}e[i]&&(e[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===e[i]){const t=TF.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,r=TF.get(t).parents[0].ID,s=TF.get(r).parents[0].ID,o=TF.get(s).parents[0].ID,a=AF.Objects.Model[o],l={modelName:a.attrName?Lx.sanitizeNodeName(a.attrName):"",morphName:AF.Objects.Deformer[t].attrName};e[i]=l}e[i][r.attr]=r}}})),n.set(parseInt(i),e)}}return n}parseAnimStacks(t){const e=AF.Objects.AnimationStack,n={};for(const i in e){const r=TF.get(parseInt(i)).children;r.length;const s=t.get(r[0].ID);n[i]={name:e[i].attrName,layer:s}}return n}addClip(t){let e=[];const n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new Db(t.name,-1,e)}generateTracks(t){const e=[];let n=new Jd,i=new $d,r=new Jd;if(t.transform&&t.transform.decompose(n,i,r),n=n.toArray(),i=(new Bp).setFromQuaternion(i,t.eulerOrder).toArray(),r=r.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const i=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==i&&e.push(i)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const n=this.generateRotationTrack(t.modelName,t.R.curves,i,t.preRotation,t.postRotation,t.eulerOrder);void 0!==n&&e.push(n)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.S.curves,r,"scale");void 0!==n&&e.push(n)}if(void 0!==t.DeformPercent){const n=this.generateMorphTrack(t);void 0!==n&&e.push(n)}return e}generateVectorTrack(t,e,n,i){const r=this.getTimesForAllAxes(e),s=this.getKeyframeTrackValues(r,e,n);return new Nb(t+"."+i,r,s)}generateRotationTrack(t,e,n,i,r,s){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(Md.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(Md.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(Md.degToRad));const o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,n);void 0!==i&&((i=i.map(Md.degToRad)).push(s),i=(new Bp).fromArray(i),i=(new $d).setFromEuler(i)),void 0!==r&&((r=r.map(Md.degToRad)).push(s),r=(new Bp).fromArray(r),r=(new $d).setFromEuler(r).invert());const l=new $d,c=new Bp,u=[];for(let h=0;h<a.length;h+=3)c.set(a[h],a[h+1],a[h+2],s),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==r&&l.multiply(r),l.toArray(u,h/3*4);return new Ib(t+".quaternion",o,u)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,n=e.values.map((function(t){return t/100})),i=EF.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Tb(t.modelName+".morphTargetInfluences["+i+"]",e.times,n)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,n=e[0];for(let i=1;i<e.length;i++){const r=e[i];r!==n&&(e[t]=r,n=r,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,n){const i=n,r=[];let s=-1,o=-1,a=-1;return t.forEach((function(t){if(e.x&&(s=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==s){const t=e.x.values[s];r.push(t),i[0]=t}else r.push(i[0]);if(-1!==o){const t=e.y.values[o];r.push(t),i[1]=t}else r.push(i[1]);if(-1!==a){const t=e.z.values[a];r.push(t),i[2]=t}else r.push(i[2])})),r}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const n=t.values[e-1],i=t.values[e]-n,r=Math.abs(i);if(r>=180){const s=r/180,o=i/s;let a=n+o;const l=t.times[e-1],c=(t.times[e]-l)/s;let u=l+c;const h=[],d=[];for(;u<t.times[e];)h.push(u),u+=c,d.push(a),a+=o;t.times=XF(t.times,e,h),t.values=XF(t.values,e,d)}}}}class LF{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new PF,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,i){const r=t.match(/^[\s\t]*;/),s=t.match(/^[\s\t]*$/);if(r||s)return;const o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):a?e.parseNodeProperty(t,a,n[++i]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const n=e[1].trim().replace(/^"/,"").replace(/"$/,""),i=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in o?("PoseNode"===n?o.PoseNode.push(r):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==s.id&&(o[n][s.id]=r)):"number"==typeof s.id?(o[n]={},o[n][s.id]=r):"Properties70"!==n&&(o[n]="PoseNode"===n?[r]:r),"number"==typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let n="",i="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),i=t[2]),{id:e,name:n,type:i}}parseNodeProperty(t,e,n){let i=e[1].replace(/^"/,"").replace(/"$/,"").trim(),r=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const t=r.split(",").slice(1),e=parseInt(t[0]),n=parseInt(t[1]);let o=r.split(",").slice(3);o=o.map((function(t){return t.trim().replace(/^"/,"")})),i="connections",r=[e,n],function(t,e){for(let n=0,i=t.length,r=e.length;n<r;n++,i++)t[i]=e[n]}(r,o),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=jF(r))}else this.parseNodeSpecialProperty(t,i,r)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=jF(e.a))}parseNodeSpecialProperty(t,e,n){const i=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],o=i[2],a=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=jF(l)}this.getPrevNode()[r]={type:s,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class OF{parse(t){const e=new kF(t);e.skip(23);const n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new PF;for(;!this.endOfContent(e);){const t=this.parseNode(e,n);null!==t&&i.add(t.name,t)}return i}endOfContent(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const n={},i=e>=7500?t.getUint64():t.getUint32(),r=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const s=t.getUint8(),o=t.getString(s);if(0===i)return null;const a=[];for(let h=0;h<r;h++)a.push(this.parseProperty(t));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===r&&t.getOffset()===i;i>t.getOffset();){const i=this.parseNode(t,e);null!==i&&this.parseSubNode(o,n,i)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==o&&(n.name=o),n}parseSubNode(t,e,n){if(!0===n.singleProperty){const t=n.propertyList[0];Array.isArray(t)?(e[n.name]=n,n.a=t):e[n.name]=t}else if("Connections"===t&&"C"===n.name){const t=[];n.propertyList.forEach((function(e,n){0!==n&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===n.name){Object.keys(n).forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){let t=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let o;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),o="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[t]={type:i,type2:r,flag:s,value:o}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)}parseProperty(t){const e=t.getString(1);let n;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=t.getUint32(),r=t.getUint32(),s=t.getUint32();if(0===r)switch(e){case"b":case"c":return t.getBooleanArray(i);case"d":return t.getFloat64Array(i);case"f":return t.getFloat32Array(i);case"i":return t.getInt32Array(i);case"l":return t.getInt64Array(i)}const o=ZP(new Uint8Array(t.getArrayBuffer(s))),a=new kF(o.buffer);switch(e){case"b":case"c":return a.getBooleanArray(i);case"d":return a.getFloat64Array(i);case"f":return a.getFloat32Array(i);case"i":return a.getInt32Array(i);case"l":return a.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class kF{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(t){const e=[];for(let n=0;n<t;n++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){let e=[];for(let i=0;i<t;i++)e[i]=this.getUint8();const n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),ax.decodeText(new Uint8Array(e))}}class PF{add(t,e){this[t]=e}}function FF(t){const e=t.match(/FBXVersion: (\d+)/);if(e){return parseInt(e[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function BF(t){return t/46186158e3}const zF=[];function UF(t,e,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=t;break;case"ByPolygon":r=e;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0]}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return function(t,e,n,i){for(let r=n,s=0;r<i;r++,s++)t[s]=e[r];return t}(zF,i.buffer,s,o)}const VF=new Bp,WF=new Jd;function GF(t){const e=new Ep,n=new Ep,i=new Ep,r=new Ep,s=new Ep,o=new Ep,a=new Ep,l=new Ep,c=new Ep,u=new Ep,h=new Ep,d=new Ep,p=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(WF.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(Md.degToRad);e.push(t.eulerOrder||Bp.DefaultOrder),n.makeRotationFromEuler(VF.fromArray(e))}if(t.rotation){const e=t.rotation.map(Md.degToRad);e.push(t.eulerOrder||Bp.DefaultOrder),i.makeRotationFromEuler(VF.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(Md.degToRad);e.push(t.eulerOrder||Bp.DefaultOrder),r.makeRotationFromEuler(VF.fromArray(e)),r.invert()}t.scale&&s.scale(WF.fromArray(t.scale)),t.scalingOffset&&a.setPosition(WF.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(WF.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(WF.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(WF.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h.copy(t.parentMatrix),u.copy(t.parentMatrixWorld));const f=n.clone().multiply(i).multiply(r),m=new Ep;m.extractRotation(u);const g=new Ep;g.copyPosition(u);const v=g.clone().invert().multiply(u),y=m.clone().invert().multiply(v),_=s,b=new Ep;if(0===p)b.copy(m).multiply(f).multiply(y).multiply(_);else if(1===p)b.copy(m).multiply(y).multiply(f).multiply(_);else{const t=(new Ep).scale((new Jd).setFromMatrixScale(h)).clone().invert(),e=y.clone().multiply(t);b.copy(m).multiply(f).multiply(e).multiply(_)}const x=c.clone().invert(),w=o.clone().invert();let S=e.clone().multiply(l).multiply(c).multiply(n).multiply(i).multiply(r).multiply(x).multiply(a).multiply(o).multiply(s).multiply(w);const M=(new Ep).copyPosition(S),C=u.clone().multiply(M);return d.copyPosition(C),S=d.clone().multiply(b),S.premultiply(u.invert()),S}function HF(t){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?e[0]:e[t]}function jF(t){return t.split(",").map((function(t){return parseFloat(t)}))}function qF(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),ax.decodeText(new Uint8Array(t,e,n))}function XF(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}var YF,ZF;function KF(t){return t.nodeType===t.ELEMENT_NODE}function $F(t){var e=null==t?void 0:t.host;return Boolean((null==e?void 0:e.shadowRoot)===t)}function JF(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function QF(t){try{var e=t.rules||t.cssRules;return e?((n=Array.from(e).map(tB).join("")).includes(" background-clip: text;")&&!n.includes(" -webkit-background-clip: text;")&&(n=n.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),n):null}catch(i){return null}var n}function tB(t){var e=t.cssText;if(function(t){return"styleSheet"in t}(t))try{e=QF(t.styleSheet)||e}catch(n){}return e}(ZF=YF||(YF={}))[ZF.Document=0]="Document",ZF[ZF.DocumentType=1]="DocumentType",ZF[ZF.Element=2]="Element",ZF[ZF.Text=3]="Text",ZF[ZF.CDATA=4]="CDATA",ZF[ZF.Comment=5]="Comment";var eB=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach((function(t){return e.removeNodeFromMap(t)}))},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var i=this.nodeMetaMap.get(n);i&&this.nodeMetaMap.set(e,i)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function nB(){return new eB}function iB(t){var e=t.maskInputOptions,n=t.tagName,i=t.type,r=t.value,s=t.maskInputFn,o=r||"";return(e[n.toLowerCase()]||e[i])&&(o=s?s(o):"*".repeat(o.length)),o}var rB="__rrweb_original__";var sB,oB,aB=1,lB=new RegExp("[^a-z0-9-_:]"),cB=-2;function uB(){return aB++}var hB=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,dB=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,pB=/^(data:)([^,]*),(.*)/i;function fB(t,e){return(t||"").replace(hB,(function(t,n,i,r,s,o){var a,l=i||s||o,c=n||r||"";if(!l)return t;if(!dB.test(l))return"url(".concat(c).concat(l).concat(c,")");if(pB.test(l))return"url(".concat(c).concat(l).concat(c,")");if("/"===l[0])return"url(".concat(c).concat((a=e,(a.indexOf("//")>-1?a.split("/").slice(0,3).join("/"):a.split("/")[0]).split("?")[0]+l)).concat(c,")");var u=e.split("/"),h=l.split("/");u.pop();for(var d=0,p=h;d<p.length;d++){var f=p[d];"."!==f&&(".."===f?u.pop():u.push(f))}return"url(".concat(c).concat(u.join("/")).concat(c,")")}))}var mB=/^[^ \t\n\r\u000c]+/,gB=/^[, \t\n\r\u000c]+/;function vB(t,e){if(!e||""===e.trim())return e;var n=t.createElement("a");return n.href=e,n.href}function yB(t){return Boolean("svg"===t.tagName||t.ownerSVGElement)}function _B(){var t=document.createElement("a");return t.href="",t.href}function bB(t,e,n,i){return"src"===n||"href"===n&&i&&("use"!==e||"#"!==i[0])||"xlink:href"===n&&i&&"#"!==i[0]?vB(t,i):"background"!==n||!i||"table"!==e&&"td"!==e&&"th"!==e?"srcset"===n&&i?function(t,e){if(""===e.trim())return e;var n=0;function i(t){var i,r=t.exec(e.substring(n));return r?(i=r[0],n+=i.length,i):""}for(var r=[];i(gB),!(n>=e.length);){var s=i(mB);if(","===s.slice(-1))s=vB(t,s.substring(0,s.length-1)),r.push(s);else{var o="";s=vB(t,s);for(var a=!1;;){var l=e.charAt(n);if(""===l){r.push((s+o).trim());break}if(a)")"===l&&(a=!1);else{if(","===l){n+=1,r.push((s+o).trim());break}"("===l&&(a=!0)}o+=l,n+=1}}}return r.join(", ")}(t,i):"style"===n&&i?fB(i,_B()):"object"===e&&"data"===n&&i?vB(t,i):i:vB(t,i)}function xB(t,e,n){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return!!n&&xB(t.parentNode,e,n);for(var i=t.classList.length;i--;){var r=t.classList[i];if(e.test(r))return!0}return!!n&&xB(t.parentNode,e,n)}function wB(t,e,n){var i=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===i)return!1;if("string"==typeof e){if(i.classList.contains(e))return!0;if(i.closest(".".concat(e)))return!0}else if(xB(i,e,!0))return!0;if(n){if(i.matches(n))return!0;if(i.closest(n))return!0}return!1}function SB(t,e){var n=e.doc,i=e.mirror,r=e.blockClass,s=e.blockSelector,o=e.maskTextClass,a=e.maskTextSelector,l=e.inlineStylesheet,c=e.maskInputOptions,u=void 0===c?{}:c,h=e.maskTextFn,d=e.maskInputFn,p=e.dataURLOptions,f=void 0===p?{}:p,m=e.inlineImages,g=e.recordCanvas,v=e.keepIframeSrcFn,y=e.newlyAddedElement,_=void 0!==y&&y,b=function(t,e){if(!e.hasNode(t))return;var n=e.getId(t);return 1===n?void 0:n}(n,i);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:YF.Document,childNodes:[],compatMode:t.compatMode}:{type:YF.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:YF.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:b};case t.ELEMENT_NODE:return function(t,e){for(var n=e.doc,i=e.blockClass,r=e.blockSelector,s=e.inlineStylesheet,o=e.maskInputOptions,a=void 0===o?{}:o,l=e.maskInputFn,c=e.dataURLOptions,u=void 0===c?{}:c,h=e.inlineImages,d=e.recordCanvas,p=e.keepIframeSrcFn,f=e.newlyAddedElement,m=void 0!==f&&f,g=e.rootId,v=function(t,e,n){if("string"==typeof e){if(t.classList.contains(e))return!0}else for(var i=t.classList.length;i--;){var r=t.classList[i];if(e.test(r))return!0}return!!n&&t.matches(n)}(t,i,r),y=function(t){if(t instanceof HTMLFormElement)return"form";var e=t.tagName.toLowerCase().trim();return lB.test(e)?"div":e}(t),_={},b=t.attributes.length,x=0;x<b;x++){var w=t.attributes[x];_[w.name]=bB(n,y,w.name,w.value)}if("link"===y&&s){var S=Array.from(n.styleSheets).find((function(e){return e.href===t.href})),M=null;S&&(M=QF(S)),M&&(delete _.rel,delete _.href,_._cssText=fB(M,S.href))}if("style"===y&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){(M=QF(t.sheet))&&(_._cssText=fB(M,_B()))}if("input"===y||"textarea"===y||"select"===y){var C=t.value,A=t.checked;"radio"!==_.type&&"checkbox"!==_.type&&"submit"!==_.type&&"button"!==_.type&&C?_.value=iB({type:_.type,tagName:y,value:C,maskInputOptions:a,maskInputFn:l}):A&&(_.checked=A)}"option"===y&&(t.selected&&!a.select?_.selected=!0:delete _.selected);if("canvas"===y&&d)if("2d"===t.__context)(function(t){var e=t.getContext("2d");if(!e)return!0;for(var n=0;n<t.width;n+=50)for(var i=0;i<t.height;i+=50){var r=e.getImageData,s=rB in r?r[rB]:r;if(new Uint32Array(s.call(e,n,i,Math.min(50,t.width-n),Math.min(50,t.height-i)).data.buffer).some((function(t){return 0!==t})))return!1}return!0})(t)||(_.rr_dataURL=t.toDataURL(u.type,u.quality));else if(!("__context"in t)){var T=t.toDataURL(u.type,u.quality),E=document.createElement("canvas");E.width=t.width,E.height=t.height,T!==E.toDataURL(u.type,u.quality)&&(_.rr_dataURL=T)}if("img"===y&&h){sB||(sB=n.createElement("canvas"),oB=sB.getContext("2d"));var I=t,R=I.crossOrigin;I.crossOrigin="anonymous";var N=function(){try{sB.width=I.naturalWidth,sB.height=I.naturalHeight,oB.drawImage(I,0,0),_.rr_dataURL=sB.toDataURL(u.type,u.quality)}catch(t){}R?_.crossOrigin=R:I.removeAttribute("crossorigin")};I.complete&&0!==I.naturalWidth?N():I.onload=N}"audio"!==y&&"video"!==y||(_.rr_mediaState=t.paused?"paused":"played",_.rr_mediaCurrentTime=t.currentTime);m||(t.scrollLeft&&(_.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(_.rr_scrollTop=t.scrollTop));if(v){var D=t.getBoundingClientRect(),L=D.width,O=D.height;_={class:_.class,rr_width:"".concat(L,"px"),rr_height:"".concat(O,"px")}}"iframe"!==y||p(_.src)||(t.contentDocument||(_.rr_src=_.src),delete _.src);return{type:YF.Element,tagName:y,attributes:_,childNodes:[],isSVG:yB(t)||void 0,needBlock:v,rootId:g}}(t,{doc:n,blockClass:r,blockSelector:s,inlineStylesheet:l,maskInputOptions:u,maskInputFn:d,dataURLOptions:f,inlineImages:m,recordCanvas:g,keepIframeSrcFn:v,newlyAddedElement:_,rootId:b});case t.TEXT_NODE:return function(t,e){var n,i=e.maskTextClass,r=e.maskTextSelector,s=e.maskTextFn,o=e.rootId,a=t.parentNode&&t.parentNode.tagName,l=t.textContent,c="STYLE"===a||void 0,u="SCRIPT"===a||void 0;if(c&&l){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(l=(h=t.parentNode.sheet).cssRules?Array.from(h.cssRules).map((function(t){return t.cssText||""})).join(""):"")}catch(d){}l=fB(l,_B())}var h;u&&(l="SCRIPT_PLACEHOLDER");!c&&!u&&l&&wB(t,i,r)&&(l=s?s(l):l.replace(/[\S]/g,"*"));return{type:YF.Text,textContent:l||"",isStyle:c,rootId:o}}(t,{maskTextClass:o,maskTextSelector:a,maskTextFn:h,rootId:b});case t.CDATA_SECTION_NODE:return{type:YF.CDATA,textContent:"",rootId:b};case t.COMMENT_NODE:return{type:YF.Comment,textContent:t.textContent||"",rootId:b};default:return!1}}function MB(t){return void 0===t?"":t.toLowerCase()}function CB(t,e){var n,i=e.doc,r=e.mirror,s=e.blockClass,o=e.blockSelector,a=e.maskTextClass,l=e.maskTextSelector,c=e.skipChild,u=void 0!==c&&c,h=e.inlineStylesheet,d=void 0===h||h,p=e.maskInputOptions,f=void 0===p?{}:p,m=e.maskTextFn,g=e.maskInputFn,v=e.slimDOMOptions,y=e.dataURLOptions,_=void 0===y?{}:y,b=e.inlineImages,x=void 0!==b&&b,w=e.recordCanvas,S=void 0!==w&&w,M=e.onSerialize,C=e.onIframeLoad,A=e.iframeLoadTimeout,T=void 0===A?5e3:A,E=e.onStylesheetLoad,I=e.stylesheetLoadTimeout,R=void 0===I?5e3:I,N=e.keepIframeSrcFn,D=void 0===N?function(){return!1}:N,L=e.newlyAddedElement,O=void 0!==L&&L,k=e.preserveWhiteSpace,P=void 0===k||k,F=SB(t,{doc:i,mirror:r,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,inlineStylesheet:d,maskInputOptions:f,maskTextFn:m,maskInputFn:g,dataURLOptions:_,inlineImages:x,recordCanvas:S,keepIframeSrcFn:D,newlyAddedElement:O});if(!F)return null;n=r.hasNode(t)?r.getId(t):!function(t,e){if(e.comment&&t.type===YF.Comment)return!0;if(t.type===YF.Element){if(e.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(MB(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===MB(t.attributes.name)||"icon"===MB(t.attributes.rel)||"apple-touch-icon"===MB(t.attributes.rel)||"shortcut icon"===MB(t.attributes.rel))))return!0;if("meta"===t.tagName){if(e.headMetaDescKeywords&&MB(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(MB(t.attributes.property).match(/^(og|twitter|fb):/)||MB(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===MB(t.attributes.name)))return!0;if(e.headMetaRobots&&("robots"===MB(t.attributes.name)||"googlebot"===MB(t.attributes.name)||"bingbot"===MB(t.attributes.name)))return!0;if(e.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(e.headMetaAuthorship&&("author"===MB(t.attributes.name)||"generator"===MB(t.attributes.name)||"framework"===MB(t.attributes.name)||"publisher"===MB(t.attributes.name)||"progid"===MB(t.attributes.name)||MB(t.attributes.property).match(/^article:/)||MB(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&("google-site-verification"===MB(t.attributes.name)||"yandex-verification"===MB(t.attributes.name)||"csrf-token"===MB(t.attributes.name)||"p:domain_verify"===MB(t.attributes.name)||"verify-v1"===MB(t.attributes.name)||"verification"===MB(t.attributes.name)||"shopify-checkout-api-token"===MB(t.attributes.name)))return!0}}return!1}(F,v)&&(P||F.type!==YF.Text||F.isStyle||F.textContent.replace(/^\s+|\s+$/gm,"").length)?uB():cB;var B=Object.assign(F,{id:n});if(r.add(t,B),n===cB)return null;M&&M(t);var z=!u;if(B.type===YF.Element){z=z&&!B.needBlock,delete B.needBlock;var U=t.shadowRoot;U&&JF(U)&&(B.isShadowHost=!0)}if((B.type===YF.Document||B.type===YF.Element)&&z){v.headWhitespace&&B.type===YF.Element&&"head"===B.tagName&&(P=!1);for(var V={doc:i,mirror:r,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,skipChild:u,inlineStylesheet:d,maskInputOptions:f,maskTextFn:m,maskInputFn:g,slimDOMOptions:v,dataURLOptions:_,inlineImages:x,recordCanvas:S,preserveWhiteSpace:P,onSerialize:M,onIframeLoad:C,iframeLoadTimeout:T,onStylesheetLoad:E,stylesheetLoadTimeout:R,keepIframeSrcFn:D},W=0,G=Array.from(t.childNodes);W<G.length;W++){(q=CB(G[W],V))&&B.childNodes.push(q)}if(KF(t)&&t.shadowRoot)for(var H=0,j=Array.from(t.shadowRoot.childNodes);H<j.length;H++){var q;(q=CB(j[H],V))&&(JF(t.shadowRoot)&&(q.isShadow=!0),B.childNodes.push(q))}}return t.parentNode&&$F(t.parentNode)&&JF(t.parentNode)&&(B.isShadow=!0),B.type===YF.Element&&"iframe"===B.tagName&&function(t,e,n){var i=t.contentWindow;if(i){var r,s=!1;try{r=i.document.readyState}catch(l){return}if("complete"===r){var o="about:blank";if(i.location.href!==o||t.src===o||""===t.src)return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}else{var a=setTimeout((function(){s||(e(),s=!0)}),n);t.addEventListener("load",(function(){clearTimeout(a),s=!0,e()}))}}}(t,(function(){var e=t.contentDocument;if(e&&C){var n=CB(e,{doc:e,mirror:r,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,skipChild:!1,inlineStylesheet:d,maskInputOptions:f,maskTextFn:m,maskInputFn:g,slimDOMOptions:v,dataURLOptions:_,inlineImages:x,recordCanvas:S,preserveWhiteSpace:P,onSerialize:M,onIframeLoad:C,iframeLoadTimeout:T,onStylesheetLoad:E,stylesheetLoadTimeout:R,keepIframeSrcFn:D});n&&C(t,n)}}),T),B.type===YF.Element&&"link"===B.tagName&&"stylesheet"===B.attributes.rel&&function(t,e,n){var i,r=!1;try{i=t.sheet}catch(o){return}if(!i){var s=setTimeout((function(){r||(e(),r=!0)}),n);t.addEventListener("load",(function(){clearTimeout(s),r=!0,e()}))}}(t,(function(){if(E){var e=CB(t,{doc:i,mirror:r,blockClass:s,blockSelector:o,maskTextClass:a,maskTextSelector:l,skipChild:!1,inlineStylesheet:d,maskInputOptions:f,maskTextFn:m,maskInputFn:g,slimDOMOptions:v,dataURLOptions:_,inlineImages:x,recordCanvas:S,preserveWhiteSpace:P,onSerialize:M,onIframeLoad:C,iframeLoadTimeout:T,onStylesheetLoad:E,stylesheetLoadTimeout:R,keepIframeSrcFn:D});e&&E(t,e)}}),R),B}var AB=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function TB(t,e){void 0===e&&(e={});var n=1,i=1;function r(t){var e=t.match(/\n/g);e&&(n+=e.length);var r=t.lastIndexOf("\n");i=-1===r?i+t.length:t.length-r}function s(){var t={line:n,column:i};return function(e){return e.position=new o(t),p(),e}}var o=function(t){this.start=t,this.end={line:n,column:i},this.source=e.source};o.prototype.content=t;var a=[];function l(r){var s=new Error("".concat(e.source||"",":").concat(n,":").concat(i,": ").concat(r));if(s.reason=r,s.filename=e.source,s.line=n,s.column=i,s.source=t,!e.silent)throw s;a.push(s)}function c(){return d(/^{\s*/)}function u(){return d(/^}/)}function h(){var e,n=[];for(p(),f(n);t.length&&"}"!==t.charAt(0)&&(e=C()||A());)!1!==e&&(n.push(e),f(n));return n}function d(e){var n=e.exec(t);if(n){var i=n[0];return r(i),t=t.slice(i.length),n}}function p(){d(/^\s*/)}function f(t){var e;for(void 0===t&&(t=[]);e=m();)!1!==e&&t.push(e),e=m();return t}function m(){var e=s();if("/"===t.charAt(0)&&"*"===t.charAt(1)){for(var n=2;""!==t.charAt(n)&&("*"!==t.charAt(n)||"/"!==t.charAt(n+1));)++n;if(n+=2,""===t.charAt(n-1))return l("End of comment missing");var o=t.slice(2,n-2);return i+=2,r(o),t=t.slice(n),i+=2,e({type:"comment",comment:o})}}function g(){var t=d(/^([^{]+)/);if(t)return EB(t[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,(function(t){return t.replace(/,/g,"")})).split(/\s*(?![^(]*\)),\s*/).map((function(t){return t.replace(/\u200C/g,",")}))}function v(){var t=s(),e=d(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(e){var n=EB(e[0]);if(!d(/^:\s*/))return l("property missing ':'");var i=d(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),r=t({type:"declaration",property:n.replace(AB,""),value:i?EB(i[0]).replace(AB,""):""});return d(/^[;\s]*/),r}}function y(){var t,e=[];if(!c())return l("missing '{'");for(f(e);t=v();)!1!==t&&(e.push(t),f(e)),t=v();return u()?e:l("missing '}'")}function _(){for(var t,e=[],n=s();t=d(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)e.push(t[1]),d(/^,\s*/);if(e.length)return n({type:"keyframe",values:e,declarations:y()})}var b,x=M("import"),w=M("charset"),S=M("namespace");function M(t){var e=new RegExp("^@"+t+"\\s*([^;]+);");return function(){var n=s(),i=d(e);if(i){var r={type:t};return r[t]=i[1].trim(),n(r)}}}function C(){if("@"===t[0])return function(){var t=s(),e=d(/^@([-\w]+)?keyframes\s*/);if(e){var n=e[1];if(!(e=d(/^([-\w]+)\s*/)))return l("@keyframes missing name");var i,r=e[1];if(!c())return l("@keyframes missing '{'");for(var o=f();i=_();)o.push(i),o=o.concat(f());return u()?t({type:"keyframes",name:r,vendor:n,keyframes:o}):l("@keyframes missing '}'")}}()||function(){var t=s(),e=d(/^@media *([^{]+)/);if(e){var n=EB(e[1]);if(!c())return l("@media missing '{'");var i=f().concat(h());return u()?t({type:"media",media:n,rules:i}):l("@media missing '}'")}}()||function(){var t=s(),e=d(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(e)return t({type:"custom-media",name:EB(e[1]),media:EB(e[2])})}()||function(){var t=s(),e=d(/^@supports *([^{]+)/);if(e){var n=EB(e[1]);if(!c())return l("@supports missing '{'");var i=f().concat(h());return u()?t({type:"supports",supports:n,rules:i}):l("@supports missing '}'")}}()||x()||w()||S()||function(){var t=s(),e=d(/^@([-\w]+)?document *([^{]+)/);if(e){var n=EB(e[1]),i=EB(e[2]);if(!c())return l("@document missing '{'");var r=f().concat(h());return u()?t({type:"document",document:i,vendor:n,rules:r}):l("@document missing '}'")}}()||function(){var t=s();if(d(/^@page */)){var e=g()||[];if(!c())return l("@page missing '{'");for(var n,i=f();n=v();)i.push(n),i=i.concat(f());return u()?t({type:"page",selectors:e,declarations:i}):l("@page missing '}'")}}()||function(){var t=s();if(d(/^@host\s*/)){if(!c())return l("@host missing '{'");var e=f().concat(h());return u()?t({type:"host",rules:e}):l("@host missing '}'")}}()||function(){var t=s();if(d(/^@font-face\s*/)){if(!c())return l("@font-face missing '{'");for(var e,n=f();e=v();)n.push(e),n=n.concat(f());return u()?t({type:"font-face",declarations:n}):l("@font-face missing '}'")}}()}function A(){var t=s(),e=g();return e?(f(),t({type:"rule",selectors:e,declarations:y()})):l("selector missing")}return IB((b=h(),{type:"stylesheet",stylesheet:{source:e.source,rules:b,parsingErrors:a}}))}function EB(t){return t?t.replace(/^\s+|\s+$/g,""):""}function IB(t,e){for(var n=t&&"string"==typeof t.type,i=n?t:e,r=0,s=Object.keys(t);r<s.length;r++){var o=t[s[r]];Array.isArray(o)?o.forEach((function(t){IB(t,i)})):o&&"object"==typeof o&&IB(o,i)}return n&&Object.defineProperty(t,"parent",{configurable:!0,writable:!0,enumerable:!1,value:e||null}),t}var RB={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};var NB=/([^\\]):hover/,DB=new RegExp(NB.source,"g");function LB(t,e){var n=null==e?void 0:e.stylesWithHoverClass.get(t);if(n)return n;var i=TB(t,{silent:!0});if(!i.stylesheet)return t;var r=[];if(i.stylesheet.rules.forEach((function(t){"selectors"in t&&(t.selectors||[]).forEach((function(t){NB.test(t)&&r.push(t)}))})),0===r.length)return t;var s=new RegExp(r.filter((function(t,e){return r.indexOf(t)===e})).sort((function(t,e){return e.length-t.length})).map((function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|"),"g"),o=t.replace(s,(function(t){var e=t.replace(DB,"$1.\\:hover");return"".concat(t,", ").concat(e)}));return null==e||e.stylesWithHoverClass.set(t,o),o}function OB(){return{stylesWithHoverClass:new Map}}function kB(t,e){var n=e.doc,i=e.hackCss,r=e.cache;switch(t.type){case YF.Document:return n.implementation.createDocument(null,"",null);case YF.DocumentType:return n.implementation.createDocumentType(t.name||"html",t.publicId,t.systemId);case YF.Element:var s,o=function(t){var e=RB[t.tagName]?RB[t.tagName]:t.tagName;return"link"===e&&t.attributes._cssText&&(e="style"),e}(t);s=t.isSVG?n.createElementNS("http://www.w3.org/2000/svg",o):n.createElement(o);var a={};for(var l in t.attributes)if(Object.prototype.hasOwnProperty.call(t.attributes,l)){var c=t.attributes[l];if("option"!==o||"selected"!==l||!1!==c)if(!0===c&&(c=""),l.startsWith("rr_"))a[l]=c;else{var u="textarea"===o&&"value"===l,h="style"===o&&"_cssText"===l;if(h&&i&&"string"==typeof c&&(c=LB(c,r)),!u&&!h||"string"!=typeof c)try{if(t.isSVG&&"xlink:href"===l)s.setAttributeNS("http://www.w3.org/1999/xlink",l,c.toString());else if("onload"===l||"onclick"===l||"onmouse"===l.substring(0,7))s.setAttribute("_"+l,c.toString());else{if("meta"===o&&"Content-Security-Policy"===t.attributes["http-equiv"]&&"content"===l){s.setAttribute("csp-content",c.toString());continue}"link"===o&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===o&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")||("img"===o&&t.attributes.srcset&&t.attributes.rr_dataURL?s.setAttribute("rrweb-original-srcset",t.attributes.srcset):s.setAttribute(l,c.toString()))}}catch(y){}else{for(var d=n.createTextNode(c),p=0,f=Array.from(s.childNodes);p<f.length;p++){var m=f[p];m.nodeType===s.TEXT_NODE&&s.removeChild(m)}s.appendChild(d)}}}var g=function(e){var n=a[e];if("canvas"===o&&"rr_dataURL"===e){var i=document.createElement("img");i.onload=function(){var t=s.getContext("2d");t&&t.drawImage(i,0,0,i.width,i.height)},i.src=n.toString(),s.RRNodeType&&(s.rr_dataURL=n.toString())}else if("img"===o&&"rr_dataURL"===e){var r=s;r.currentSrc.startsWith("data:")||(r.setAttribute("rrweb-original-src",t.attributes.src),r.src=n.toString())}if("rr_width"===e)s.style.width=n.toString();else if("rr_height"===e)s.style.height=n.toString();else if("rr_mediaCurrentTime"===e&&"number"==typeof n)s.currentTime=n;else if("rr_mediaState"===e)switch(n){case"played":s.play().catch((function(t){}));break;case"paused":s.pause()}};for(var v in a)g(v);if(t.isShadowHost)if(s.shadowRoot)for(;s.shadowRoot.firstChild;)s.shadowRoot.removeChild(s.shadowRoot.firstChild);else s.attachShadow({mode:"open"});return s;case YF.Text:return n.createTextNode(t.isStyle&&i?LB(t.textContent,r):t.textContent);case YF.CDATA:return n.createCDATASection(t.textContent);case YF.Comment:return n.createComment(t.textContent);default:return null}}function PB(t,e){var n=e.doc,i=e.mirror,r=e.skipChild,s=void 0!==r&&r,o=e.hackCss,a=void 0===o||o,l=e.afterAppend,c=e.cache,u=kB(t,{doc:n,hackCss:a,cache:c});if(!u)return null;if(t.rootId&&i.getNode(t.rootId)!==n&&i.replace(t.rootId,n),t.type===YF.Document&&(n.close(),n.open(),"BackCompat"===t.compatMode&&t.childNodes&&t.childNodes[0].type!==YF.DocumentType&&(t.childNodes[0].type===YF.Element&&"xmlns"in t.childNodes[0].attributes&&"http://www.w3.org/1999/xhtml"===t.childNodes[0].attributes.xmlns?n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'):n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">')),u=n),i.add(u,t),(t.type===YF.Document||t.type===YF.Element)&&!s)for(var h=0,d=t.childNodes;h<d.length;h++){var p=d[h],f=PB(p,{doc:n,mirror:i,skipChild:!1,hackCss:a,afterAppend:l,cache:c});f&&(p.isShadow&&KF(u)&&u.shadowRoot?u.shadowRoot.appendChild(f):u.appendChild(f),l&&l(f,p.id))}return u}function FB(t,e){var n=e.doc,i=e.onVisit,r=e.hackCss,s=void 0===r||r,o=e.afterAppend,a=e.cache,l=e.mirror,c=void 0===l?new eB:l,u=PB(t,{doc:n,mirror:c,skipChild:!1,hackCss:s,afterAppend:o,cache:a});return function(t,e){for(var n=0,i=t.getIds();n<i.length;n++){var r=i[n];t.has(r)&&e(t.getNode(r))}}(c,(function(t){i&&i(t),function(t,e){var n=e.getMeta(t);if((null==n?void 0:n.type)===YF.Element){var i=t;for(var r in n.attributes)if(Object.prototype.hasOwnProperty.call(n.attributes,r)&&r.startsWith("rr_")){var s=n.attributes[r];"rr_scrollLeft"===r&&(i.scrollLeft=s),"rr_scrollTop"===r&&(i.scrollTop=s)}}}(t,c)})),u}function BB(t,e,n=document){const i={capture:!0,passive:!0};return n.addEventListener(t,e,i),()=>n.removeEventListener(t,e,i)}let zB={map:{},getId:()=>-1,getNode:()=>null,removeNodeFromMap(){},has:()=>!1,reset(){}};function UB(t,e,n={}){let i=null,r=0;return function(...s){const o=Date.now();r||!1!==n.leading||(r=o);const a=e-(o-r),l=this;a<=0||a>e?(i&&(clearTimeout(i),i=null),r=o,t.apply(l,s)):i||!1===n.trailing||(i=setTimeout((()=>{r=!1===n.leading?0:Date.now(),i=null,t.apply(l,s)}),a))}}function VB(t,e,n,i,r=window){const s=r.Object.getOwnPropertyDescriptor(t,e);return r.Object.defineProperty(t,e,i?n:{set(t){setTimeout((()=>{n.set.call(this,t)}),0),s&&s.set&&s.set.call(this,t)}}),()=>VB(t,e,s||{},!0)}function WB(t,e,n){try{if(!(e in t))return()=>{};const i=t[e],r=n(i);return"function"==typeof r&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:i}})),t[e]=r,()=>{t[e]=i}}catch(i){return()=>{}}}function GB(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function HB(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function jB(t,e,n,i){if(!t)return!1;const r=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!r)return!1;if("string"==typeof e){if(r.classList.contains(e))return!0;if(i&&null!==r.closest("."+e))return!0}else if(xB(r,e,i))return!0;if(n){if(t.matches(n))return!0;if(i&&null!==r.closest(n))return!0}return!1}function qB(t,e){return e.getId(t)===cB}function XB(t,e){if($F(t))return!1;const n=e.getId(t);return!e.has(n)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||XB(t.parentNode,e))}function YB(t){return Boolean(t.changedTouches)}function ZB(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let e=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}function KB(t){const e={},n=(t,n)=>{const i={value:t,parent:n,children:[]};return e[t.node.id]=i,i},i=[];for(const r of t){const{nextId:t,parentId:s}=r;if(t&&t in e){const s=e[t];if(s.parent){const t=s.parent.children.indexOf(s);s.parent.children.splice(t,0,n(r,s.parent))}else{const t=i.indexOf(s);i.splice(t,0,n(r,null))}}else if(s in e){const t=e[s];t.children.push(n(r,t))}else i.push(n(r,null))}return i}function $B(t,e){e(t.value);for(let n=t.children.length-1;n>=0;n--)$B(t.children[n],e)}function JB(t,e){return Boolean("IFRAME"===t.nodeName&&e.getMeta(t))}function QB(t,e){return Boolean("LINK"===t.nodeName&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&"stylesheet"===t.getAttribute("rel")&&e.getMeta(t))}function tz(t,e){var n,i;const r=null===(i=null===(n=t.ownerDocument)||void 0===n?void 0:n.defaultView)||void 0===i?void 0:i.frameElement;if(!r||r===e)return{x:0,y:0,relativeScale:1,absoluteScale:1};const s=r.getBoundingClientRect(),o=tz(r,e),a=s.height/r.clientHeight;return{x:s.x*o.relativeScale+o.x,y:s.y*o.relativeScale+o.y,relativeScale:a,absoluteScale:o.absoluteScale*a}}function ez(t){return Boolean(null==t?void 0:t.shadowRoot)}function nz(t,e){const n=t[e[0]];return 1===e.length?n:nz(n.cssRules[e[1]].cssRules,e.slice(2))}function iz(t){const e=[...t],n=e.pop();return{positions:e,index:n}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(zB=new Proxy(zB,{get:(t,e,n)=>Reflect.get(t,e,n)}));class rz{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var e;return null!==(e=this.styleIDMap.get(t))&&void 0!==e?e:-1}has(t){return this.styleIDMap.has(t)}add(t,e){if(this.has(t))return this.getId(t);let n;return n=void 0===e?this.id++:e,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var sz=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(sz||{}),oz=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t))(oz||{}),az=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(az||{}),lz=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(lz||{}),cz=(t=>(t.Start="start",t.Pause="pause",t.Resume="resume",t.Resize="resize",t.Finish="finish",t.FullsnapshotRebuilded="fullsnapshot-rebuilded",t.LoadStylesheetStart="load-stylesheet-start",t.LoadStylesheetEnd="load-stylesheet-end",t.SkipStart="skip-start",t.SkipEnd="skip-end",t.MouseInteraction="mouse-interaction",t.EventCast="event-cast",t.CustomEvent="custom-event",t.Flush="flush",t.StateChange="state-change",t.PlayBack="play-back",t.Destroy="destroy",t))(cz||{});function uz(t){return"__ln"in t}class hz{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let e=this.head;for(let n=0;n<t;n++)e=(null==e?void 0:e.next)||null;return e}addNode(t){const e={value:t,previous:null,next:null};if(t.__ln=e,t.previousSibling&&uz(t.previousSibling)){const n=t.previousSibling.__ln.next;e.next=n,e.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=e,n&&(n.previous=e)}else if(t.nextSibling&&uz(t.nextSibling)&&t.nextSibling.__ln.previous){const n=t.nextSibling.__ln.previous;e.previous=n,e.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=e,n&&(n.next=e)}else this.head&&(this.head.previous=e),e.next=this.head,this.head=e;this.length++}removeNode(t){const e=t.__ln;this.head&&(e.previous?(e.previous.next=e.next,e.next&&(e.next.previous=e.previous)):(this.head=e.next,this.head&&(this.head.previous=null)),t.__ln&&delete t.__ln,this.length--)}}const dz=(t,e)=>`${t}@${e}`;class pz{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],e=new hz,n=t=>{let e=t,n=cB;for(;n===cB;)e=e&&e.nextSibling,n=e&&this.mirror.getId(e);return n},i=i=>{var r,s,o,a;let l=null;(null===(s=null===(r=i.getRootNode)||void 0===r?void 0:r.call(i))||void 0===s?void 0:s.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&i.getRootNode().host&&(l=i.getRootNode().host);let c=l;for(;(null===(a=null===(o=null==c?void 0:c.getRootNode)||void 0===o?void 0:o.call(c))||void 0===a?void 0:a.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&c.getRootNode().host;)c=c.getRootNode().host;const u=!(this.doc.contains(i)||c&&this.doc.contains(c));if(!i.parentNode||u)return;const h=$F(i.parentNode)?this.mirror.getId(l):this.mirror.getId(i.parentNode),d=n(i);if(-1===h||-1===d)return e.addNode(i);const p=CB(i,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{JB(t,this.mirror)&&this.iframeManager.addIframe(t),QB(t,this.mirror)&&this.stylesheetManager.trackLinkElement(t),ez(i)&&this.shadowDomManager.addShadowRoot(i.shadowRoot,this.doc)},onIframeLoad:(t,e)=>{this.iframeManager.attachIframe(t,e),this.shadowDomManager.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{this.stylesheetManager.attachLinkElement(t,e)}});p&&t.push({parentId:h,nextId:d,node:p})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const o of Array.from(this.movedSet.values()))mz(this.removes,o,this.mirror)&&!this.movedSet.has(o.parentNode)||i(o);for(const o of Array.from(this.addedSet.values()))vz(this.droppedSet,o)||mz(this.removes,o,this.mirror)?vz(this.movedSet,o)?i(o):this.droppedSet.add(o):i(o);let r=null;for(;e.length;){let t=null;if(r){const e=this.mirror.getId(r.value.parentNode),i=n(r.value);-1!==e&&-1!==i&&(t=r)}if(!t)for(let i=e.length-1;i>=0;i--){const r=e.get(i);if(r){const e=this.mirror.getId(r.value.parentNode);if(-1===n(r.value))continue;if(-1!==e){t=r;break}{const e=r.value;if(e.parentNode&&e.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const n=e.parentNode.host;if(-1!==this.mirror.getId(n)){t=r;break}}}}}if(!t){for(;e.head;)e.removeNode(e.head.value);break}r=t.previous,e.removeNode(t.value),i(t.value)}const s={texts:this.texts.map((t=>({id:this.mirror.getId(t.node),value:t.value}))).filter((t=>this.mirror.has(t.id))),attributes:this.attributes.map((t=>({id:this.mirror.getId(t.node),attributes:t.attributes}))).filter((t=>this.mirror.has(t.id))),removes:this.removes,adds:t};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.processMutation=t=>{if(!qB(t.target,this.mirror))switch(t.type){case"characterData":{const e=t.target.textContent;jB(t.target,this.blockClass,this.blockSelector,!1)||e===t.oldValue||this.texts.push({value:wB(t.target,this.maskTextClass,this.maskTextSelector)&&e?this.maskTextFn?this.maskTextFn(e):e.replace(/[\S]/g,"*"):e,node:t.target});break}case"attributes":{const e=t.target;let n=t.target.getAttribute(t.attributeName);if("value"===t.attributeName&&(n=iB({maskInputOptions:this.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:n,maskInputFn:this.maskInputFn})),jB(t.target,this.blockClass,this.blockSelector,!1)||n===t.oldValue)return;let i=this.attributes.find((e=>e.node===t.target));if("IFRAME"===e.tagName&&"src"===t.attributeName&&!this.keepIframeSrcFn(n)){if(e.contentDocument)return;t.attributeName="rr_src"}if(i||(i={node:t.target,attributes:{}},this.attributes.push(i)),"style"===t.attributeName){const n=this.doc.createElement("span");t.oldValue&&n.setAttribute("style",t.oldValue),void 0!==i.attributes.style&&null!==i.attributes.style||(i.attributes.style={});const r=i.attributes.style;for(const t of Array.from(e.style)){const i=e.style.getPropertyValue(t),s=e.style.getPropertyPriority(t);i===n.style.getPropertyValue(t)&&s===n.style.getPropertyPriority(t)||(r[t]=""===s?i:[i,s])}for(const t of Array.from(n.style))""===e.style.getPropertyValue(t)&&(r[t]=!1)}else i.attributes[t.attributeName]=bB(this.doc,e.tagName,t.attributeName,n);break}case"childList":if(jB(t.target,this.blockClass,this.blockSelector,!0))return;t.addedNodes.forEach((e=>this.genAdds(e,t.target))),t.removedNodes.forEach((e=>{const n=this.mirror.getId(e),i=$F(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);jB(t.target,this.blockClass,this.blockSelector,!1)||qB(e,this.mirror)||!function(t,e){return-1!==e.getId(t)}(e,this.mirror)||(this.addedSet.has(e)?(fz(this.addedSet,e),this.droppedSet.add(e)):this.addedSet.has(t.target)&&-1===n||XB(t.target,this.mirror)||(this.movedSet.has(e)&&this.movedMap[dz(n,i)]?fz(this.movedSet,e):this.removes.push({parentId:i,id:n,isShadow:!(!$F(t.target)||!JF(t.target))||void 0})),this.mapRemoves.push(e))}))}},this.genAdds=(t,e)=>{if(this.mirror.hasNode(t)){if(qB(t,this.mirror))return;this.movedSet.add(t);let n=null;e&&this.mirror.hasNode(e)&&(n=this.mirror.getId(e)),n&&-1!==n&&(this.movedMap[dz(this.mirror.getId(t),n)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);jB(t,this.blockClass,this.blockSelector,!1)||t.childNodes.forEach((t=>this.genAdds(t)))}}init(t){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager"].forEach((e=>{this[e]=t[e]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function fz(t,e){t.delete(e),e.childNodes.forEach((e=>fz(t,e)))}function mz(t,e,n){return 0!==t.length&&gz(t,e,n)}function gz(t,e,n){const{parentNode:i}=e;if(!i)return!1;const r=n.getId(i);return!!t.some((t=>t.id===r))||gz(t,i,n)}function vz(t,e){return 0!==t.size&&yz(t,e)}function yz(t,e){const{parentNode:n}=e;return!!n&&(!!t.has(n)||yz(t,n))}const _z=[],bz="undefined"!=typeof CSSGroupingRule,xz="undefined"!=typeof CSSMediaRule,wz="undefined"!=typeof CSSSupportsRule,Sz="undefined"!=typeof CSSConditionRule;function Mz(t){try{if("composedPath"in t){const e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0];return t.target}catch(e){return t.target}}function Cz(t,e){var n,i;const r=new pz;_z.push(r),r.init(t);let s=window.MutationObserver||window.__rrMutationObserver;const o=null===(i=null===(n=null===window||void 0===window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===i?void 0:i.call(n,"MutationObserver");o&&window[o]&&(s=window[o]);const a=new s(r.processMutations.bind(r));return a.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function Az({mouseInteractionCb:t,doc:e,mirror:n,blockClass:i,blockSelector:r,sampling:s}){if(!1===s.mouseInteraction)return()=>{};const o=!0===s.mouseInteraction||void 0===s.mouseInteraction?{}:s.mouseInteraction,a=[];return Object.keys(az).filter((t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==o[t])).forEach((s=>{const o=s.toLowerCase(),l=(e=>s=>{const o=Mz(s);if(jB(o,i,r,!0))return;const a=YB(s)?s.changedTouches[0]:s;if(!a)return;const l=n.getId(o),{clientX:c,clientY:u}=a;t({type:az[e],id:l,x:c,y:u})})(s);a.push(BB(o,l,e))})),()=>{a.forEach((t=>t()))}}function Tz({scrollCb:t,doc:e,mirror:n,blockClass:i,blockSelector:r,sampling:s}){return BB("scroll",UB((s=>{const o=Mz(s);if(!o||jB(o,i,r,!0))return;const a=n.getId(o);if(o===e){const n=e.scrollingElement||e.documentElement;t({id:a,x:n.scrollLeft,y:n.scrollTop})}else t({id:a,x:o.scrollLeft,y:o.scrollTop})}),s.scroll||100),e)}function Ez(t,e){const n=Object.assign({},t);return e||delete n.userTriggered,n}const Iz=["INPUT","TEXTAREA","SELECT"],Rz=new WeakMap;function Nz(t){return function(t,e){if(bz&&t.parentRule instanceof CSSGroupingRule||xz&&t.parentRule instanceof CSSMediaRule||wz&&t.parentRule instanceof CSSSupportsRule||Sz&&t.parentRule instanceof CSSConditionRule){const n=Array.from(t.parentRule.cssRules).indexOf(t);e.unshift(n)}else if(t.parentStyleSheet){const n=Array.from(t.parentStyleSheet.cssRules).indexOf(t);e.unshift(n)}return e}(t,[])}function Dz(t,e,n){let i,r;return t?(t.ownerNode?i=e.getId(t.ownerNode):r=n.getId(t),{styleId:r,id:i}):{}}function Lz({mirror:t,stylesheetManager:e},n){var i,r,s;let o=null;o="#document"===n.nodeName?t.getId(n):t.getId(n.host);const a="#document"===n.nodeName?null===(i=n.defaultView)||void 0===i?void 0:i.Document:null===(s=null===(r=n.ownerDocument)||void 0===r?void 0:r.defaultView)||void 0===s?void 0:s.ShadowRoot,l=Object.getOwnPropertyDescriptor(null==a?void 0:a.prototype,"adoptedStyleSheets");return null!==o&&-1!==o&&a&&l?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:l.configurable,enumerable:l.enumerable,get(){var t;return null===(t=l.get)||void 0===t?void 0:t.call(this)},set(t){var n;const i=null===(n=l.set)||void 0===n?void 0:n.call(this,t);if(null!==o&&-1!==o)try{e.adoptStyleSheets(t,o)}catch(xW){}return i}}),()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:l.configurable,enumerable:l.enumerable,get:l.get,set:l.set})}):()=>{}}function Oz(t,e={}){const n=t.doc.defaultView;if(!n)return()=>{};!function(t,e){const{mutationCb:n,mousemoveCb:i,mouseInteractionCb:r,scrollCb:s,viewportResizeCb:o,inputCb:a,mediaInteractionCb:l,styleSheetRuleCb:c,styleDeclarationCb:u,canvasMutationCb:h,fontCb:d,selectionCb:p}=t;t.mutationCb=(...t)=>{e.mutation&&e.mutation(...t),n(...t)},t.mousemoveCb=(...t)=>{e.mousemove&&e.mousemove(...t),i(...t)},t.mouseInteractionCb=(...t)=>{e.mouseInteraction&&e.mouseInteraction(...t),r(...t)},t.scrollCb=(...t)=>{e.scroll&&e.scroll(...t),s(...t)},t.viewportResizeCb=(...t)=>{e.viewportResize&&e.viewportResize(...t),o(...t)},t.inputCb=(...t)=>{e.input&&e.input(...t),a(...t)},t.mediaInteractionCb=(...t)=>{e.mediaInteaction&&e.mediaInteaction(...t),l(...t)},t.styleSheetRuleCb=(...t)=>{e.styleSheetRule&&e.styleSheetRule(...t),c(...t)},t.styleDeclarationCb=(...t)=>{e.styleDeclaration&&e.styleDeclaration(...t),u(...t)},t.canvasMutationCb=(...t)=>{e.canvasMutation&&e.canvasMutation(...t),h(...t)},t.fontCb=(...t)=>{e.font&&e.font(...t),d(...t)},t.selectionCb=(...t)=>{e.selection&&e.selection(...t),p(...t)}}(t,e);const i=Cz(t,t.doc),r=function({mousemoveCb:t,sampling:e,doc:n,mirror:i}){if(!1===e.mousemove)return()=>{};const r="number"==typeof e.mousemove?e.mousemove:50,s="number"==typeof e.mousemoveCallback?e.mousemoveCallback:500;let o,a=[];const l=UB((e=>{const n=Date.now()-o;t(a.map((t=>(t.timeOffset-=n,t))),e),a=[],o=null}),s),c=UB((t=>{const e=Mz(t),{clientX:n,clientY:r}=YB(t)?t.changedTouches[0]:t;o||(o=Date.now()),a.push({x:n,y:r,id:i.getId(e),timeOffset:Date.now()-o}),l("undefined"!=typeof DragEvent&&t instanceof DragEvent?oz.Drag:t instanceof MouseEvent?oz.MouseMove:oz.TouchMove)}),r,{trailing:!1}),u=[BB("mousemove",c,n),BB("touchmove",c,n),BB("drag",c,n)];return()=>{u.forEach((t=>t()))}}(t),s=Az(t),o=Tz(t),a=function({viewportResizeCb:t}){let e=-1,n=-1;return BB("resize",UB((()=>{const i=GB(),r=HB();e===i&&n===r||(t({width:Number(r),height:Number(i)}),e=i,n=r)}),200),window)}(t),l=function({inputCb:t,doc:e,mirror:n,blockClass:i,blockSelector:r,ignoreClass:s,maskInputOptions:o,maskInputFn:a,sampling:l,userTriggeredOnInput:c}){function u(t){let n=Mz(t);const l=t.isTrusted;if(n&&"OPTION"===n.tagName&&(n=n.parentElement),!n||!n.tagName||Iz.indexOf(n.tagName)<0||jB(n,i,r,!0))return;const u=n.type;if(n.classList.contains(s))return;let d=n.value,p=!1;"radio"===u||"checkbox"===u?p=n.checked:(o[n.tagName.toLowerCase()]||o[u])&&(d=iB({maskInputOptions:o,tagName:n.tagName,type:u,value:d,maskInputFn:a})),h(n,Ez({text:d,isChecked:p,userTriggered:l},c));const f=n.name;"radio"===u&&f&&p&&e.querySelectorAll(`input[type="radio"][name="${f}"]`).forEach((t=>{t!==n&&h(t,Ez({text:t.value,isChecked:!p,userTriggered:!1},c))}))}function h(e,i){const r=Rz.get(e);if(!r||r.text!==i.text||r.isChecked!==i.isChecked){Rz.set(e,i);const r=n.getId(e);t(Object.assign(Object.assign({},i),{id:r}))}}const d=("last"===l.input?["change"]:["input","change"]).map((t=>BB(t,u,e))),p=e.defaultView;if(!p)return()=>{d.forEach((t=>t()))};const f=p.Object.getOwnPropertyDescriptor(p.HTMLInputElement.prototype,"value"),m=[[p.HTMLInputElement.prototype,"value"],[p.HTMLInputElement.prototype,"checked"],[p.HTMLSelectElement.prototype,"value"],[p.HTMLTextAreaElement.prototype,"value"],[p.HTMLSelectElement.prototype,"selectedIndex"],[p.HTMLOptionElement.prototype,"selected"]];return f&&f.set&&d.push(...m.map((t=>VB(t[0],t[1],{set(){u({target:this})}},!1,p)))),()=>{d.forEach((t=>t()))}}(t),c=function({mediaInteractionCb:t,blockClass:e,blockSelector:n,mirror:i,sampling:r}){const s=s=>UB((r=>{const o=Mz(r);if(!o||jB(o,e,n,!0))return;const{currentTime:a,volume:l,muted:c,playbackRate:u}=o;t({type:s,id:i.getId(o),currentTime:a,volume:l,muted:c,playbackRate:u})}),r.media||500),o=[BB("play",s(0)),BB("pause",s(1)),BB("seeked",s(2)),BB("volumechange",s(3)),BB("ratechange",s(4))];return()=>{o.forEach((t=>t()))}}(t),u=function({styleSheetRuleCb:t,mirror:e,stylesheetManager:n},{win:i}){const r=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=function(i,s){const{id:o,styleId:a}=Dz(this,e,n.styleMirror);return(o&&-1!==o||a&&-1!==a)&&t({id:o,styleId:a,adds:[{rule:i,index:s}]}),r.apply(this,[i,s])};const s=i.CSSStyleSheet.prototype.deleteRule;let o,a;i.CSSStyleSheet.prototype.deleteRule=function(i){const{id:r,styleId:o}=Dz(this,e,n.styleMirror);return(r&&-1!==r||o&&-1!==o)&&t({id:r,styleId:o,removes:[{index:i}]}),s.apply(this,[i])},i.CSSStyleSheet.prototype.replace&&(o=i.CSSStyleSheet.prototype.replace,i.CSSStyleSheet.prototype.replace=function(i){const{id:r,styleId:s}=Dz(this,e,n.styleMirror);return(r&&-1!==r||s&&-1!==s)&&t({id:r,styleId:s,replace:i}),o.apply(this,[i])}),i.CSSStyleSheet.prototype.replaceSync&&(a=i.CSSStyleSheet.prototype.replaceSync,i.CSSStyleSheet.prototype.replaceSync=function(i){const{id:r,styleId:s}=Dz(this,e,n.styleMirror);return(r&&-1!==r||s&&-1!==s)&&t({id:r,styleId:s,replaceSync:i}),a.apply(this,[i])});const l={};bz?l.CSSGroupingRule=i.CSSGroupingRule:(xz&&(l.CSSMediaRule=i.CSSMediaRule),Sz&&(l.CSSConditionRule=i.CSSConditionRule),wz&&(l.CSSSupportsRule=i.CSSSupportsRule));const c={};return Object.entries(l).forEach((([i,r])=>{c[i]={insertRule:r.prototype.insertRule,deleteRule:r.prototype.deleteRule},r.prototype.insertRule=function(r,s){const{id:o,styleId:a}=Dz(this.parentStyleSheet,e,n.styleMirror);return(o&&-1!==o||a&&-1!==a)&&t({id:o,styleId:a,adds:[{rule:r,index:[...Nz(this),s||0]}]}),c[i].insertRule.apply(this,[r,s])},r.prototype.deleteRule=function(r){const{id:s,styleId:o}=Dz(this.parentStyleSheet,e,n.styleMirror);return(s&&-1!==s||o&&-1!==o)&&t({id:s,styleId:o,removes:[{index:[...Nz(this),r]}]}),c[i].deleteRule.apply(this,[r])}})),()=>{i.CSSStyleSheet.prototype.insertRule=r,i.CSSStyleSheet.prototype.deleteRule=s,o&&(i.CSSStyleSheet.prototype.replace=o),a&&(i.CSSStyleSheet.prototype.replaceSync=a),Object.entries(l).forEach((([t,e])=>{e.prototype.insertRule=c[t].insertRule,e.prototype.deleteRule=c[t].deleteRule}))}}(t,{win:n}),h=Lz(t,t.doc),d=function({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:n,stylesheetManager:i},{win:r}){const s=r.CSSStyleDeclaration.prototype.setProperty;r.CSSStyleDeclaration.prototype.setProperty=function(r,o,a){var l;if(n.has(r))return s.apply(this,[r,o,a]);const{id:c,styleId:u}=Dz(null===(l=this.parentRule)||void 0===l?void 0:l.parentStyleSheet,e,i.styleMirror);return(c&&-1!==c||u&&-1!==u)&&t({id:c,styleId:u,set:{property:r,value:o,priority:a},index:Nz(this.parentRule)}),s.apply(this,[r,o,a])};const o=r.CSSStyleDeclaration.prototype.removeProperty;return r.CSSStyleDeclaration.prototype.removeProperty=function(r){var s;if(n.has(r))return o.apply(this,[r]);const{id:a,styleId:l}=Dz(null===(s=this.parentRule)||void 0===s?void 0:s.parentStyleSheet,e,i.styleMirror);return(a&&-1!==a||l&&-1!==l)&&t({id:a,styleId:l,remove:{property:r},index:Nz(this.parentRule)}),o.apply(this,[r])},()=>{r.CSSStyleDeclaration.prototype.setProperty=s,r.CSSStyleDeclaration.prototype.removeProperty=o}}(t,{win:n}),p=t.collectFonts?function({fontCb:t,doc:e}){const n=e.defaultView;if(!n)return()=>{};const i=[],r=new WeakMap,s=n.FontFace;n.FontFace=function(t,e,n){const i=new s(t,e,n);return r.set(i,{family:t,buffer:"string"!=typeof e,descriptors:n,fontSource:"string"==typeof e?e:JSON.stringify(Array.from(new Uint8Array(e)))}),i};const o=WB(e.fonts,"add",(function(e){return function(n){return setTimeout((()=>{const e=r.get(n);e&&(t(e),r.delete(n))}),0),e.apply(this,[n])}}));return i.push((()=>{n.FontFace=s})),i.push(o),()=>{i.forEach((t=>t()))}}(t):()=>{},f=function(t){const{doc:e,mirror:n,blockClass:i,blockSelector:r,selectionCb:s}=t;let o=!0;const a=()=>{const t=e.getSelection();if(!t||o&&(null==t?void 0:t.isCollapsed))return;o=t.isCollapsed||!1;const a=[],l=t.rangeCount||0;for(let e=0;e<l;e++){const s=t.getRangeAt(e),{startContainer:o,startOffset:l,endContainer:c,endOffset:u}=s;jB(o,i,r,!0)||jB(c,i,r,!0)||a.push({start:n.getId(o),startOffset:l,end:n.getId(c),endOffset:u})}s({ranges:a})};return a(),BB("selectionchange",a)}(t),m=[];for(const g of t.plugins)m.push(g.observer(g.callback,n,g.options));return()=>{_z.forEach((t=>t.reset())),i.disconnect(),r(),s(),o(),a(),l(),c(),u(),h(),d(),p(),f(),m.forEach((t=>t()))}}class kz{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,e,n,i){const r=n||this.getIdToRemoteIdMap(t),s=i||this.getRemoteIdToIdMap(t);let o=r.get(e);return o||(o=this.generateIdFn(),r.set(e,o),s.set(o,e)),o}getIds(t,e){const n=this.getIdToRemoteIdMap(t),i=this.getRemoteIdToIdMap(t);return e.map((e=>this.getId(t,e,n,i)))}getRemoteId(t,e,n){const i=n||this.getRemoteIdToIdMap(t);if("number"!=typeof e)return e;const r=i.get(e);return r||-1}getRemoteIds(t,e){const n=this.getRemoteIdToIdMap(t);return e.map((e=>this.getRemoteId(t,e,n)))}reset(t){if(!t)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let e=this.iframeIdToRemoteIdMap.get(t);return e||(e=new Map,this.iframeIdToRemoteIdMap.set(t,e)),e}getRemoteIdToIdMap(t){let e=this.iframeRemoteIdToIdMap.get(t);return e||(e=new Map,this.iframeRemoteIdToIdMap.set(t,e)),e}}class Pz{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new kz(uB),this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new kz(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,e){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:e}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){if("rrweb"===t.data.type){if(!t.source)return;const e=this.crossOriginIframeMap.get(t.source);if(!e)return;const n=this.transformCrossOriginEvent(e,t.data.event);n&&this.wrappedEmit(n,t.data.isCheckout)}}transformCrossOriginEvent(t,e){var n;switch(e.type){case sz.FullSnapshot:return this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(e.data.node,t),{timestamp:e.timestamp,type:sz.IncrementalSnapshot,data:{source:oz.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:e.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}};case sz.Meta:case sz.Load:case sz.DomContentLoaded:return!1;case sz.Plugin:return e;case sz.Custom:return this.replaceIds(e.data.payload,t,["id","parentId","previousId","nextId"]),e;case sz.IncrementalSnapshot:switch(e.data.source){case oz.Mutation:return e.data.adds.forEach((e=>{this.replaceIds(e,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(e.node,t)})),e.data.removes.forEach((e=>{this.replaceIds(e,t,["parentId","id"])})),e.data.attributes.forEach((e=>{this.replaceIds(e,t,["id"])})),e.data.texts.forEach((e=>{this.replaceIds(e,t,["id"])})),e;case oz.Drag:case oz.TouchMove:case oz.MouseMove:return e.data.positions.forEach((e=>{this.replaceIds(e,t,["id"])})),e;case oz.ViewportResize:return!1;case oz.MediaInteraction:case oz.MouseInteraction:case oz.Scroll:case oz.CanvasMutation:case oz.Input:return this.replaceIds(e.data,t,["id"]),e;case oz.StyleSheetRule:case oz.StyleDeclaration:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleId"]),e;case oz.Font:return e;case oz.Selection:return e.data.ranges.forEach((e=>{this.replaceIds(e,t,["start","end"])})),e;case oz.AdoptedStyleSheet:return this.replaceIds(e.data,t,["id"]),this.replaceStyleIds(e.data,t,["styleIds"]),null===(n=e.data.styles)||void 0===n||n.forEach((e=>{this.replaceStyleIds(e,t,["styleId"])})),e}}}replace(t,e,n,i){for(const r of i)(Array.isArray(e[r])||"number"==typeof e[r])&&(Array.isArray(e[r])?e[r]=t.getIds(n,e[r]):e[r]=t.getId(n,e[r]));return e}replaceIds(t,e,n){return this.replace(this.crossOriginIframeMirror,t,e,n)}replaceStyleIds(t,e,n){return this.replace(this.crossOriginIframeStyleMirror,t,e,n)}replaceIdOnNode(t,e){this.replaceIds(t,e,["id"]),"childNodes"in t&&t.childNodes.forEach((t=>{this.replaceIdOnNode(t,e)}))}}class Fz{constructor(t){this.shadowDoms=new WeakSet,this.restorePatches=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror;const e=this;this.restorePatches.push(WB(Element.prototype,"attachShadow",(function(t){return function(n){const i=t.call(this,n);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,this.ownerDocument),i}})))}addShadowRoot(t,e){JF(t)&&(this.shadowDoms.has(t)||(this.shadowDoms.add(t),Cz(Object.assign(Object.assign({},this.bypassOptions),{doc:e,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t),Tz(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror})),setTimeout((()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),Lz({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t)}),0)))}observeAttachShadow(t){if(t.contentWindow){const e=this;this.restorePatches.push(WB(t.contentWindow.HTMLElement.prototype,"attachShadow",(function(n){return function(i){const r=n.call(this,i);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,t.contentDocument),r}})))}}reset(){this.restorePatches.forEach((t=>t())),this.shadowDoms=new WeakSet}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Bz(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(xW){s(xW)}}function a(t){try{l(i.throw(t))}catch(xW){s(xW)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))}for(var zz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Uz="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Vz=0;Vz<64;Vz++)Uz[zz.charCodeAt(Vz)]=Vz;var Wz=function(t){var e,n,i,r,s,o=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;e<a;e+=4)n=Uz[t.charCodeAt(e)],i=Uz[t.charCodeAt(e+1)],r=Uz[t.charCodeAt(e+2)],s=Uz[t.charCodeAt(e+3)],u[l++]=n<<2|i>>4,u[l++]=(15&i)<<4|r>>2,u[l++]=(3&r)<<6|63&s;return c};const Gz=new Map;const Hz=(t,e,n)=>{if(!t||!Xz(t,e)&&"object"!=typeof t)return;const i=function(t,e){let n=Gz.get(t);return n||(n=new Map,Gz.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}(n,t.constructor.name);let r=i.indexOf(t);return-1===r&&(r=i.length,i.push(t)),r};function jz(t,e,n){if(t instanceof Array)return t.map((t=>jz(t,e,n)));if(null===t)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray){return{rr_type:t.constructor.name,args:[Object.values(t)]}}if(t instanceof ArrayBuffer){return{rr_type:t.constructor.name,base64:function(t){var e,n=new Uint8Array(t),i=n.length,r="";for(e=0;e<i;e+=3)r+=zz[n[e]>>2],r+=zz[(3&n[e])<<4|n[e+1]>>4],r+=zz[(15&n[e+1])<<2|n[e+2]>>6],r+=zz[63&n[e+2]];return i%3==2?r=r.substring(0,r.length-1)+"=":i%3==1&&(r=r.substring(0,r.length-2)+"=="),r}(t)}}if(t instanceof DataView){return{rr_type:t.constructor.name,args:[jz(t.buffer,e,n),t.byteOffset,t.byteLength]}}if(t instanceof HTMLImageElement){const e=t.constructor.name,{src:n}=t;return{rr_type:e,src:n}}if(t instanceof HTMLCanvasElement){return{rr_type:"HTMLImageElement",src:t.toDataURL()}}if(t instanceof ImageData){return{rr_type:t.constructor.name,args:[jz(t.data,e,n),t.width,t.height]}}if(Xz(t,e)||"object"==typeof t){return{rr_type:t.constructor.name,index:Hz(t,e,n)}}return t}const qz=(t,e,n)=>[...t].map((t=>jz(t,e,n))),Xz=(t,e)=>{const n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((t=>"function"==typeof e[t]));return Boolean(n.find((n=>t instanceof e[n])))};function Yz(t,e,n){const i=[];try{const r=WB(t.HTMLCanvasElement.prototype,"getContext",(function(t){return function(i,...r){return jB(this,e,n,!0)||"__context"in this||(this.__context=i),t.apply(this,[i,...r])}}));i.push(r)}catch(r){}return()=>{i.forEach((t=>t()))}}function Zz(t,e,n,i,r,s,o){const a=[],l=Object.getOwnPropertyNames(t);for(const u of l)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(u))try{if("function"!=typeof t[u])continue;const s=WB(t,u,(function(t){return function(...s){const a=t.apply(this,s);if(Hz(a,o,this),!jB(this.canvas,i,r,!0)){const t=qz([...s],o,this),i={type:e,property:u,args:t};n(this.canvas,i)}return a}}));a.push(s)}catch(c){const i=VB(t,u,{set(t){n(this.canvas,{type:e,property:u,args:[t],setter:!0})}});a.push(i)}return a}var Kz=null;try{var $z="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");Kz=$z.Worker}catch(xW){}function Jz(t,e,n){var i=void 0===e?null:e,r=function(t,e){return Buffer.from(t,"base64").toString(e?"utf16":"utf8")}(t,void 0!==n&&n),s=r.indexOf("\n",10)+1,o=r.substring(s)+(i?"//# sourceMappingURL="+i:"");return function(t){return new Kz(o,Object.assign({},t,{eval:!0}))}}function Qz(t,e,n){var i=void 0===e?null:e,r=function(t,e){var n=atob(t);if(e){for(var i=new Uint8Array(n.length),r=0,s=n.length;r<s;++r)i[r]=n.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(t,void 0!==n&&n),s=r.indexOf("\n",10)+1,o=r.substring(s)+(i?"//# sourceMappingURL="+i:""),a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}var tU="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);var eU,nU,iU,rU=(eU="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",nU=null,iU=!1,tU?Jz(eU,nU,iU):function(t,e,n){var i;return function(r){return i=i||Qz(t,e,n),new Worker(i,r)}}(eU,nU,iU));class sU{constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(t,e)=>{!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(t)||this.pendingCanvasMutations.set(t,[]),this.pendingCanvasMutations.get(t).push(e)};const{sampling:e="all",win:n,blockClass:i,blockSelector:r,recordCanvas:s,dataURLOptions:o}=t;this.mutationCb=t.mutationCb,this.mirror=t.mirror,s&&"all"===e&&this.initCanvasMutationObserver(n,i,r),s&&"number"==typeof e&&this.initCanvasFPSObserver(e,n,i,r,{dataURLOptions:o})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(t,e,n,i,r){const s=Yz(e,n,i),o=new Map,a=new rU;a.onmessage=t=>{const{id:e}=t.data;if(o.set(e,!1),!("base64"in t.data))return;const{base64:n,type:i,width:r,height:s}=t.data;this.mutationCb({id:e,type:lz["2D"],commands:[{property:"clearRect",args:[0,0,r,s]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:n}],type:i}]},0,0]}]})};const l=1e3/t;let c,u=0;const h=t=>{u&&t-u<l||(u=t,(()=>{const t=[];return e.document.querySelectorAll("canvas").forEach((e=>{jB(e,n,i,!0)||t.push(e)})),t})().forEach((t=>Bz(this,void 0,void 0,(function*(){var e;const n=this.mirror.getId(t);if(o.get(n))return;if(o.set(n,!0),["webgl","webgl2"].includes(t.__context)){const n=t.getContext(t.__context);!1===(null===(e=null==n?void 0:n.getContextAttributes())||void 0===e?void 0:e.preserveDrawingBuffer)&&(null==n||n.clear(n.COLOR_BUFFER_BIT))}const i=yield createImageBitmap(t);a.postMessage({id:n,bitmap:i,width:t.width,height:t.height,dataURLOptions:r.dataURLOptions},[i])}))))),c=requestAnimationFrame(h)};c=requestAnimationFrame(h),this.resetObservers=()=>{s(),cancelAnimationFrame(c)}}initCanvasMutationObserver(t,e,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const i=Yz(t,e,n),r=function(t,e,n,i){const r=[],s=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const a of s)try{if("function"!=typeof e.CanvasRenderingContext2D.prototype[a])continue;const s=WB(e.CanvasRenderingContext2D.prototype,a,(function(r){return function(...s){return jB(this.canvas,n,i,!0)||setTimeout((()=>{const n=qz([...s],e,this);t(this.canvas,{type:lz["2D"],property:a,args:n})}),0),r.apply(this,s)}}));r.push(s)}catch(o){const n=VB(e.CanvasRenderingContext2D.prototype,a,{set(e){t(this.canvas,{type:lz["2D"],property:a,args:[e],setter:!0})}});r.push(n)}return()=>{r.forEach((t=>t()))}}(this.processMutation.bind(this),t,e,n),s=function(t,e,n,i,r){const s=[];return s.push(...Zz(e.WebGLRenderingContext.prototype,lz.WebGL,t,n,i,0,e)),void 0!==e.WebGL2RenderingContext&&s.push(...Zz(e.WebGL2RenderingContext.prototype,lz.WebGL2,t,n,i,0,e)),()=>{s.forEach((t=>t()))}}(this.processMutation.bind(this),t,e,n,this.mirror);this.resetObservers=()=>{i(),r(),s()}}startPendingCanvasMutationFlusher(){requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}startRAFTimestamping(){const t=e=>{this.rafStamps.latestId=e,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach(((t,e)=>{const n=this.mirror.getId(e);this.flushPendingCanvasMutationFor(e,n)})),requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}flushPendingCanvasMutationFor(t,e){if(this.frozen||this.locked)return;const n=this.pendingCanvasMutations.get(t);if(!n||-1===e)return;const i=n.map((t=>function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(t,["type"]))),{type:r}=n[0];this.mutationCb({id:e,type:r,commands:i}),this.pendingCanvasMutations.delete(t)}}class oU{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new rz,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,e){"_cssText"in e.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:e.id,attributes:e.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,e){if(0===t.length)return;const n={id:e,styleIds:[]},i=[];for(const r of t){let t;if(this.styleMirror.has(r))t=this.styleMirror.getId(r);else{t=this.styleMirror.add(r);const e=Array.from(r.rules||CSSRule);i.push({styleId:t,rules:e.map(((t,e)=>({rule:tB(t),index:e})))})}n.styleIds.push(t)}i.length>0&&(n.styles=i),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}}function aU(t){return Object.assign(Object.assign({},t),{timestamp:Date.now()})}let lU,cU,uU,hU=!1;const dU=nB();function pU(t={}){const{emit:e,checkoutEveryNms:n,checkoutEveryNth:i,blockClass:r="rr-block",blockSelector:s=null,ignoreClass:o="rr-ignore",maskTextClass:a="rr-mask",maskTextSelector:l=null,inlineStylesheet:c=!0,maskAllInputs:u,maskInputOptions:h,slimDOMOptions:d,maskInputFn:p,maskTextFn:f,hooks:m,packFn:g,sampling:v={},dataURLOptions:y={},mousemoveWait:_,recordCanvas:b=!1,recordCrossOriginIframes:x=!1,userTriggeredOnInput:w=!1,collectFonts:S=!1,inlineImages:M=!1,plugins:C,keepIframeSrcFn:A=()=>!1,ignoreCSSAttributes:T=new Set([])}=t,E=!x||window.parent===window;let I=!1;if(!E)try{window.parent.document,I=!1}catch(xW){I=!0}if(E&&!e)throw new Error("emit function is required");void 0!==_&&void 0===v.mousemove&&(v.mousemove=_),dU.reset();const R=!0===u?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==h?h:{password:!0},N=!0===d||"all"===d?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===d,headMetaDescKeywords:"all"===d}:d||{};let D;ZB();let L=0;const O=t=>{for(const e of C||[])e.eventProcessor&&(t=e.eventProcessor(t));return g&&(t=g(t)),t};lU=(t,r)=>{var s;if(!(null===(s=_z[0])||void 0===s?void 0:s.isFrozen())||t.type===sz.FullSnapshot||t.type===sz.IncrementalSnapshot&&t.data.source===oz.Mutation||_z.forEach((t=>t.unfreeze())),E)null==e||e(O(t),r);else if(I){const e={type:"rrweb",event:O(t),isCheckout:r};window.parent.postMessage(e,"*")}if(t.type===sz.FullSnapshot)D=t,L=0;else if(t.type===sz.IncrementalSnapshot){if(t.data.source===oz.Mutation&&t.data.isAttachIframe)return;L++;const e=i&&L>=i,r=n&&t.timestamp-D.timestamp>n;(e||r)&&cU(!0)}};const k=t=>{lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.Mutation},t)}))},P=t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.Scroll},t)})),F=t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.CanvasMutation},t)})),B=new oU({mutationCb:k,adoptedStyleSheetCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.AdoptedStyleSheet},t)}))}),z=new Pz({mirror:dU,mutationCb:k,stylesheetManager:B,recordCrossOriginIframes:x,wrappedEmit:lU});for(const W of C||[])W.getMirror&&W.getMirror({nodeMirror:dU,crossOriginIframeMirror:z.crossOriginIframeMirror,crossOriginIframeStyleMirror:z.crossOriginIframeStyleMirror});uU=new sU({recordCanvas:b,mutationCb:F,win:window,blockClass:r,blockSelector:s,mirror:dU,sampling:v.canvas,dataURLOptions:y});const U=new Fz({mutationCb:k,scrollCb:P,bypassOptions:{blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:l,inlineStylesheet:c,maskInputOptions:R,dataURLOptions:y,maskTextFn:f,maskInputFn:p,recordCanvas:b,inlineImages:M,sampling:v,slimDOMOptions:N,iframeManager:z,stylesheetManager:B,canvasManager:uU,keepIframeSrcFn:A},mirror:dU});cU=(t=!1)=>{var e,n,i,o,u,h;lU(aU({type:sz.Meta,data:{href:window.location.href,width:HB(),height:GB()}}),t),B.reset(),_z.forEach((t=>t.lock()));const d=function(t,e){var n=e||{},i=n.mirror,r=void 0===i?new eB:i,s=n.blockClass,o=void 0===s?"rr-block":s,a=n.blockSelector,l=void 0===a?null:a,c=n.maskTextClass,u=void 0===c?"rr-mask":c,h=n.maskTextSelector,d=void 0===h?null:h,p=n.inlineStylesheet,f=void 0===p||p,m=n.inlineImages,g=void 0!==m&&m,v=n.recordCanvas,y=void 0!==v&&v,_=n.maskAllInputs,b=void 0!==_&&_,x=n.maskTextFn,w=n.maskInputFn,S=n.slimDOM,M=void 0!==S&&S,C=n.dataURLOptions,A=n.preserveWhiteSpace,T=n.onSerialize,E=n.onIframeLoad,I=n.iframeLoadTimeout,R=n.onStylesheetLoad,N=n.stylesheetLoadTimeout,D=n.keepIframeSrcFn;return CB(t,{doc:t,mirror:r,blockClass:o,blockSelector:l,maskTextClass:u,maskTextSelector:d,skipChild:!1,inlineStylesheet:f,maskInputOptions:!0===b?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===b?{password:!0}:b,maskTextFn:x,maskInputFn:w,slimDOMOptions:!0===M||"all"===M?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===M,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===M?{}:M,dataURLOptions:C,inlineImages:g,recordCanvas:y,preserveWhiteSpace:A,onSerialize:T,onIframeLoad:E,iframeLoadTimeout:I,onStylesheetLoad:R,stylesheetLoadTimeout:N,keepIframeSrcFn:void 0===D?function(){return!1}:D,newlyAddedElement:!1})}(document,{mirror:dU,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:l,inlineStylesheet:c,maskAllInputs:R,maskTextFn:f,slimDOM:N,dataURLOptions:y,recordCanvas:b,inlineImages:M,onSerialize:t=>{JB(t,dU)&&z.addIframe(t),QB(t,dU)&&B.trackLinkElement(t),ez(t)&&U.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,e)=>{z.attachIframe(t,e),U.observeAttachShadow(t)},onStylesheetLoad:(t,e)=>{B.attachLinkElement(t,e)},keepIframeSrcFn:A});d&&(lU(aU({type:sz.FullSnapshot,data:{node:d,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(e=null===document||void 0===document?void 0:document.body)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===(i=null===document||void 0===document?void 0:document.body)||void 0===i?void 0:i.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(u=null===(o=null===document||void 0===document?void 0:document.body)||void 0===o?void 0:o.parentElement)||void 0===u?void 0:u.scrollTop)||(null===(h=null===document||void 0===document?void 0:document.body)||void 0===h?void 0:h.scrollTop)||0}}})),_z.forEach((t=>t.unlock())),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&B.adoptStyleSheets(document.adoptedStyleSheets,dU.getId(document)))};try{const t=[];t.push(BB("DOMContentLoaded",(()=>{lU(aU({type:sz.DomContentLoaded,data:{}}))})));const e=t=>{var e;return Oz({mutationCb:k,mousemoveCb:(t,e)=>lU(aU({type:sz.IncrementalSnapshot,data:{source:e,positions:t}})),mouseInteractionCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.MouseInteraction},t)})),scrollCb:P,viewportResizeCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.ViewportResize},t)})),inputCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.Input},t)})),mediaInteractionCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.MediaInteraction},t)})),styleSheetRuleCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.StyleSheetRule},t)})),styleDeclarationCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.StyleDeclaration},t)})),canvasMutationCb:F,fontCb:t=>lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.Font},t)})),selectionCb:t=>{lU(aU({type:sz.IncrementalSnapshot,data:Object.assign({source:oz.Selection},t)}))},blockClass:r,ignoreClass:o,maskTextClass:a,maskTextSelector:l,maskInputOptions:R,inlineStylesheet:c,sampling:v,recordCanvas:b,inlineImages:M,userTriggeredOnInput:w,collectFonts:S,doc:t,maskInputFn:p,maskTextFn:f,keepIframeSrcFn:A,blockSelector:s,slimDOMOptions:N,dataURLOptions:y,mirror:dU,iframeManager:z,stylesheetManager:B,shadowDomManager:U,canvasManager:uU,ignoreCSSAttributes:T,plugins:(null===(e=null==C?void 0:C.filter((t=>t.observer)))||void 0===e?void 0:e.map((t=>({observer:t.observer,options:t.options,callback:e=>lU(aU({type:sz.Plugin,data:{plugin:t.name,payload:e}}))}))))||[]},m)};z.addLoadListener((n=>{t.push(e(n.contentDocument))}));const n=()=>{cU(),t.push(e(document)),hU=!0};return"interactive"===document.readyState||"complete"===document.readyState?n():t.push(BB("load",(()=>{lU(aU({type:sz.Load,data:{}})),n()}),window)),()=>{t.forEach((t=>t())),hU=!1}}catch(V){}}var fU;pU.addCustomEvent=(t,e)=>{if(!hU)throw new Error("please add custom event after start recording");lU(aU({type:sz.Custom,data:{tag:t,payload:e}}))},pU.freezePage=()=>{_z.forEach((t=>t.freeze()))},pU.takeFullSnapshot=t=>{if(!hU)throw new Error("please take full snapshot after start recording");cU(t)},pU.mirror=dU,function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(fU||(fU={}));var mU=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach((function(t){return e.removeNodeFromMap(t)}))},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var i=this.nodeMetaMap.get(n);i&&this.nodeMetaMap.set(e,i)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function gU(t){const e=[];for(const n in t){const i=t[n];if("string"!=typeof i)continue;const r=xU(n);e.push(`${r}: ${i};`)}return e.join(" ")}const vU=/-([a-z])/g,yU=/^--[a-zA-Z0-9-]+$/,_U=t=>yU.test(t)?t:t.replace(vU,((t,e)=>e?e.toUpperCase():"")),bU=/\B([A-Z])/g,xU=t=>t.replace(bU,"-$1").toLowerCase();class wU{constructor(...t){this.childNodes=[],this.parentElement=null,this.parentNode=null,this.ELEMENT_NODE=IU.ELEMENT_NODE,this.TEXT_NODE=IU.TEXT_NODE}get firstChild(){return this.childNodes[0]||null}get lastChild(){return this.childNodes[this.childNodes.length-1]||null}get nextSibling(){const t=this.parentNode;if(!t)return null;const e=t.childNodes,n=e.indexOf(this);return e[n+1]||null}contains(t){if(t===this)return!0;for(const e of this.childNodes)if(e.contains(t))return!0;return!1}appendChild(t){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")}insertBefore(t,e){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")}removeChild(t){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")}toString(){return"RRNode"}}function SU(t){return class extends t{constructor(t,e,n){super(),this.nodeType=IU.DOCUMENT_TYPE_NODE,this.RRNodeType=fU.DocumentType,this.textContent=null,this.name=t,this.publicId=e,this.systemId=n,this.nodeName=t}toString(){return"RRDocumentType"}}}function MU(t){return class extends t{constructor(t){super(),this.nodeType=IU.ELEMENT_NODE,this.RRNodeType=fU.Element,this.attributes={},this.shadowRoot=null,this.tagName=t.toUpperCase(),this.nodeName=t.toUpperCase()}get textContent(){let t="";return this.childNodes.forEach((e=>t+=e.textContent)),t}set textContent(t){this.childNodes=[this.ownerDocument.createTextNode(t)]}get classList(){return new EU(this.attributes.class,(t=>{this.attributes.class=t}))}get id(){return this.attributes.id||""}get className(){return this.attributes.class||""}get style(){const t=this.attributes.style?function(t){const e={},n=/:(.+)/;return t.replace(/\/\*.*?\*\//g,"").split(/;(?![^(]*\))/g).forEach((function(t){if(t){const i=t.split(n);i.length>1&&(e[_U(i[0].trim())]=i[1].trim())}})),e}(this.attributes.style):{},e=/\B([A-Z])/g;return t.setProperty=(n,i,r)=>{if(e.test(n))return;const s=_U(n);i?t[s]=i:delete t[s],"important"===r&&(t[s]+=" !important"),this.attributes.style=gU(t)},t.removeProperty=n=>{if(e.test(n))return"";const i=_U(n),r=t[i]||"";return delete t[i],this.attributes.style=gU(t),r},t}getAttribute(t){return this.attributes[t]||null}setAttribute(t,e){this.attributes[t]=e}setAttributeNS(t,e,n){this.setAttribute(e,n)}removeAttribute(t){delete this.attributes[t]}appendChild(t){return this.childNodes.push(t),t.parentNode=this,t.parentElement=this,t}insertBefore(t,e){if(null===e)return this.appendChild(t);const n=this.childNodes.indexOf(e);if(-1==n)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return this.childNodes.splice(n,0,t),t.parentElement=this,t.parentNode=this,t}removeChild(t){const e=this.childNodes.indexOf(t);if(-1===e)throw new Error("Failed to execute 'removeChild' on 'RRElement': The RRNode to be removed is not a child of this RRNode.");return this.childNodes.splice(e,1),t.parentElement=null,t.parentNode=null,t}attachShadow(t){const e=this.ownerDocument.createElement("SHADOWROOT");return this.shadowRoot=e,e}dispatchEvent(t){return!0}toString(){let t="";for(const e in this.attributes)t+=`${e}="${this.attributes[e]}" `;return`${this.tagName} ${t}`}}}function CU(t){return class extends t{constructor(t){super(),this.nodeType=IU.TEXT_NODE,this.nodeName="#text",this.RRNodeType=fU.Text,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRText text=${JSON.stringify(this.data)}`}}}function AU(t){return class extends t{constructor(t){super(),this.nodeType=IU.COMMENT_NODE,this.nodeName="#comment",this.RRNodeType=fU.Comment,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRComment text=${JSON.stringify(this.data)}`}}}function TU(t){return class extends t{constructor(t){super(),this.nodeName="#cdata-section",this.nodeType=IU.CDATA_SECTION_NODE,this.RRNodeType=fU.CDATA,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRCDATASection data=${JSON.stringify(this.data)}`}}}class EU{constructor(t,e){if(this.classes=[],this.add=(...t)=>{for(const e of t){const t=String(e);this.classes.indexOf(t)>=0||this.classes.push(t)}this.onChange&&this.onChange(this.classes.join(" "))},this.remove=(...t)=>{this.classes=this.classes.filter((e=>-1===t.indexOf(e))),this.onChange&&this.onChange(this.classes.join(" "))},t){const e=t.trim().split(/\s+/);this.classes.push(...e)}this.onChange=e}}var IU;!function(t){t[t.PLACEHOLDER=0]="PLACEHOLDER",t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",t[t.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",t[t.ENTITY_NODE=6]="ENTITY_NODE",t[t.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.DOCUMENT_NODE=9]="DOCUMENT_NODE",t[t.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",t[t.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(IU||(IU={}));const RU={svg:"http://www.w3.org/2000/svg","xlink:href":"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},NU={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function DU(t,e,n,i){const r=t.childNodes,s=e.childNodes;i=i||e.mirror||e.ownerDocument.mirror,(r.length>0||s.length>0)&&LU(Array.from(r),s,t,n,i);let o=null,a=null;switch(e.RRNodeType){case fU.Document:a=e.scrollData;break;case fU.Element:{const r=t,s=e;switch(function(t,e,n){const i=t.attributes,r=e.attributes;for(const s in r){const i=r[s],o=n.getMeta(e);if(o&&"isSVG"in o&&o.isSVG&&RU[s])t.setAttributeNS(RU[s],s,i);else if("CANVAS"===e.tagName&&"rr_dataURL"===s){const e=document.createElement("img");e.src=i,e.onload=()=>{const n=t.getContext("2d");n&&n.drawImage(e,0,0,e.width,e.height)}}else t.setAttribute(s,i)}for(const{name:s}of Array.from(i))s in r||t.removeAttribute(s);e.scrollLeft&&(t.scrollLeft=e.scrollLeft),e.scrollTop&&(t.scrollTop=e.scrollTop)}(r,s,i),a=s.scrollData,o=s.inputData,s.tagName){case"AUDIO":case"VIDEO":{const e=t,n=s;void 0!==n.paused&&(n.paused?e.pause():e.play()),void 0!==n.muted&&(e.muted=n.muted),void 0!==n.volume&&(e.volume=n.volume),void 0!==n.currentTime&&(e.currentTime=n.currentTime),void 0!==n.playbackRate&&(e.playbackRate=n.playbackRate);break}case"CANVAS":{const i=e;if(null!==i.rr_dataURL){const t=document.createElement("img");t.onload=()=>{const e=r.getContext("2d");e&&e.drawImage(t,0,0,t.width,t.height)},t.src=i.rr_dataURL}i.canvasMutations.forEach((e=>n.applyCanvas(e.event,e.mutation,t)))}break;case"STYLE":{const t=r.sheet;t&&e.rules.forEach((e=>n.applyStyleSheetMutation(e,t)))}}if(s.shadowRoot){r.shadowRoot||r.attachShadow({mode:"open"});const t=r.shadowRoot.childNodes,e=s.shadowRoot.childNodes;(t.length>0||e.length>0)&&LU(Array.from(t),e,r.shadowRoot,n,i)}break}case fU.Text:case fU.Comment:case fU.CDATA:t.textContent!==e.data&&(t.textContent=e.data)}if(a&&n.applyScroll(a,!0),o&&n.applyInput(o),"IFRAME"===e.nodeName){const r=t.contentDocument,s=e;if(r){const t=i.getMeta(s.contentDocument);t&&n.mirror.add(r,Object.assign({},t)),DU(r,s.contentDocument,n,i)}}}function LU(t,e,n,i,r){var s;let o,a,l=0,c=t.length-1,u=0,h=e.length-1,d=t[l],p=t[c],f=e[u],m=e[h];for(;l<=c&&u<=h;){const g=i.mirror.getId(d),v=i.mirror.getId(p),y=r.getId(f),_=r.getId(m);if(void 0===d)d=t[++l];else if(void 0===p)p=t[--c];else if(-1!==g&&g===y)DU(d,f,i,r),d=t[++l],f=e[++u];else if(-1!==v&&v===_)DU(p,m,i,r),p=t[--c],m=e[--h];else if(-1!==g&&g===_)n.insertBefore(d,p.nextSibling),DU(d,m,i,r),d=t[++l],m=e[--h];else if(-1!==v&&v===y)n.insertBefore(p,d),DU(p,f,i,r),p=t[--c],f=e[++u];else{if(!o){o={};for(let e=l;e<=c;e++){const n=t[e];n&&i.mirror.hasNode(n)&&(o[i.mirror.getId(n)]=e)}}if(a=o[r.getId(f)],a){const e=t[a];n.insertBefore(e,d),DU(e,f,i,r),t[a]=void 0}else{const e=OU(f,i.mirror,r);"#document"===n.nodeName&&(null===(s=i.mirror.getMeta(e))||void 0===s?void 0:s.type)===fU.Element&&n.documentElement&&(n.removeChild(n.documentElement),t[l]=void 0,d=void 0),n.insertBefore(e,d||null),DU(e,f,i,r)}f=e[++u]}}if(l>c){const t=e[h+1];let s=null;for(t&&n.childNodes.forEach((e=>{i.mirror.getId(e)===r.getId(t)&&(s=e)}));u<=h;++u){const t=OU(e[u],i.mirror,r);n.insertBefore(t,s),DU(t,e[u],i,r)}}else if(u>h)for(;l<=c;l++){const e=t[l];e&&(n.removeChild(e),i.mirror.removeNodeFromMap(e))}}function OU(t,e,n){const i=n.getId(t),r=n.getMeta(t);let s=null;if(i>-1&&(s=e.getNode(i)),null!==s)return s;switch(t.RRNodeType){case fU.Document:s=new Document;break;case fU.DocumentType:s=document.implementation.createDocumentType(t.name,t.publicId,t.systemId);break;case fU.Element:{let e=t.tagName.toLowerCase();e=NU[e]||e,s=r&&"isSVG"in r&&(null==r?void 0:r.isSVG)?document.createElementNS(RU.svg,e):document.createElement(t.tagName);break}case fU.Text:s=document.createTextNode(t.data);break;case fU.Comment:s=document.createComment(t.data);break;case fU.CDATA:s=document.createCDATASection(t.data)}return r&&e.add(s,Object.assign({},r)),s}class kU extends(function(t){return class e extends t{constructor(){super(...arguments),this.nodeType=IU.DOCUMENT_NODE,this.nodeName="#document",this.compatMode="CSS1Compat",this.RRNodeType=fU.Document,this.textContent=null}get documentElement(){return this.childNodes.find((t=>t.RRNodeType===fU.Element&&"HTML"===t.tagName))||null}get body(){var t;return(null===(t=this.documentElement)||void 0===t?void 0:t.childNodes.find((t=>t.RRNodeType===fU.Element&&"BODY"===t.tagName)))||null}get head(){var t;return(null===(t=this.documentElement)||void 0===t?void 0:t.childNodes.find((t=>t.RRNodeType===fU.Element&&"HEAD"===t.tagName)))||null}get implementation(){return this}get firstElementChild(){return this.documentElement}appendChild(t){const e=t.RRNodeType;if((e===fU.Element||e===fU.DocumentType)&&this.childNodes.some((t=>t.RRNodeType===e)))throw new Error(`RRDomException: Failed to execute 'appendChild' on 'RRNode': Only one ${e===fU.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);return t.parentElement=null,t.parentNode=this,this.childNodes.push(t),t}insertBefore(t,e){const n=t.RRNodeType;if((n===fU.Element||n===fU.DocumentType)&&this.childNodes.some((t=>t.RRNodeType===n)))throw new Error(`RRDomException: Failed to execute 'insertBefore' on 'RRNode': Only one ${n===fU.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);if(null===e)return this.appendChild(t);const i=this.childNodes.indexOf(e);if(-1==i)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return this.childNodes.splice(i,0,t),t.parentElement=null,t.parentNode=this,t}removeChild(t){const e=this.childNodes.indexOf(t);if(-1===e)throw new Error("Failed to execute 'removeChild' on 'RRDocument': The RRNode to be removed is not a child of this RRNode.");return this.childNodes.splice(e,1),t.parentElement=null,t.parentNode=null,t}open(){this.childNodes=[]}close(){}write(t){let e;if('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'===t?e="-//W3C//DTD XHTML 1.0 Transitional//EN":'<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">'===t&&(e="-//W3C//DTD HTML 4.0 Transitional//EN"),e){const t=this.createDocumentType("html",e,"");this.open(),this.appendChild(t)}}createDocument(t,n,i){return new e}createDocumentType(t,e,n){const i=new(SU(wU))(t,e,n);return i.ownerDocument=this,i}createElement(t){const e=new(MU(wU))(t);return e.ownerDocument=this,e}createElementNS(t,e){return this.createElement(e)}createTextNode(t){const e=new(CU(wU))(t);return e.ownerDocument=this,e}createComment(t){const e=new(AU(wU))(t);return e.ownerDocument=this,e}createCDATASection(t){const e=new(TU(wU))(t);return e.ownerDocument=this,e}toString(){return"RRDocument"}}}(wU)){constructor(t){super(),this.UNSERIALIZED_STARTING_ID=-2,this._unserializedId=this.UNSERIALIZED_STARTING_ID,this.mirror=new XU,this.scrollData=null,t&&(this.mirror=t)}get unserializedId(){return this._unserializedId--}createDocument(t,e,n){return new kU}createDocumentType(t,e,n){const i=new PU(t,e,n);return i.ownerDocument=this,i}createElement(t){const e=t.toUpperCase();let n;switch(e){case"AUDIO":case"VIDEO":n=new BU(e);break;case"IFRAME":n=new VU(e,this.mirror);break;case"CANVAS":n=new zU(e);break;case"STYLE":n=new UU(e);break;default:n=new FU(e)}return n.ownerDocument=this,n}createComment(t){const e=new GU(t);return e.ownerDocument=this,e}createCDATASection(t){const e=new HU(t);return e.ownerDocument=this,e}createTextNode(t){const e=new WU(t);return e.ownerDocument=this,e}destroyTree(){this.childNodes=[],this.mirror.reset()}open(){super.open(),this._unserializedId=this.UNSERIALIZED_STARTING_ID}}const PU=SU(wU);class FU extends(MU(wU)){constructor(){super(...arguments),this.inputData=null,this.scrollData=null}}class BU extends(function(t){return class extends t{attachShadow(t){throw new Error("RRDomException: Failed to execute 'attachShadow' on 'RRElement': This RRElement does not support attachShadow")}play(){this.paused=!1}pause(){this.paused=!0}}}(FU)){}class zU extends FU{constructor(){super(...arguments),this.rr_dataURL=null,this.canvasMutations=[]}getContext(){return null}}class UU extends FU{constructor(){super(...arguments),this.rules=[]}}class VU extends FU{constructor(t,e){super(t),this.contentDocument=new kU,this.contentDocument.mirror=e}}const WU=CU(wU),GU=AU(wU),HU=TU(wU);function jU(t,e,n,i){let r;switch(t.nodeType){case IU.DOCUMENT_NODE:i&&"IFRAME"===i.nodeName?r=i.contentDocument:(r=e,r.compatMode=t.compatMode);break;case IU.DOCUMENT_TYPE_NODE:{const n=t;r=e.createDocumentType(n.name,n.publicId,n.systemId);break}case IU.ELEMENT_NODE:{const n=t,i=(s=n)instanceof HTMLFormElement?"FORM":s.tagName.toUpperCase();r=e.createElement(i);const o=r;for(const{name:t,value:e}of Array.from(n.attributes))o.attributes[t]=e;n.scrollLeft&&(o.scrollLeft=n.scrollLeft),n.scrollTop&&(o.scrollTop=n.scrollTop);break}case IU.TEXT_NODE:r=e.createTextNode(t.textContent||"");break;case IU.CDATA_SECTION_NODE:r=e.createCDATASection(t.data);break;case IU.COMMENT_NODE:r=e.createComment(t.textContent||"");break;case IU.DOCUMENT_FRAGMENT_NODE:r=i.attachShadow({mode:"open"});break;default:return null}var s;let o=n.getMeta(t);return e instanceof kU&&(o||(o=YU(r,e.unserializedId),n.add(t,o)),e.mirror.add(r,Object.assign({},o))),r}function qU(t,e=function(){return new mU}(),n=new kU){return function t(i,r){const s=jU(i,n,e,r);if(null!==s)if("IFRAME"!==(null==r?void 0:r.nodeName)&&i.nodeType!==IU.DOCUMENT_FRAGMENT_NODE&&(null==r||r.appendChild(s),s.parentNode=r,s.parentElement=r),"IFRAME"===i.nodeName){const e=i.contentDocument;e&&t(e,s)}else i.nodeType!==IU.DOCUMENT_NODE&&i.nodeType!==IU.ELEMENT_NODE&&i.nodeType!==IU.DOCUMENT_FRAGMENT_NODE||(i.nodeType===IU.ELEMENT_NODE&&i.shadowRoot&&t(i.shadowRoot,s),i.childNodes.forEach((e=>t(e,s))))}(t,null),n}class XU{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var e;if(!t)return-1;const n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const e=this.getId(t);this.idNodeMap.delete(e),t.childNodes&&t.childNodes.forEach((t=>this.removeNodeFromMap(t)))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,e){const n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)}replace(t,e){const n=this.getNode(t);if(n){const t=this.nodeMetaMap.get(n);t&&this.nodeMetaMap.set(e,t)}this.idNodeMap.set(t,e)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function YU(t,e){switch(t.RRNodeType){case fU.Document:return{id:e,type:t.RRNodeType,childNodes:[]};case fU.DocumentType:{const n=t;return{id:e,type:t.RRNodeType,name:n.name,publicId:n.publicId,systemId:n.systemId}}case fU.Element:return{id:e,type:t.RRNodeType,tagName:t.tagName.toLowerCase(),attributes:{},childNodes:[]};case fU.Text:case fU.Comment:return{id:e,type:t.RRNodeType,textContent:t.textContent||""};case fU.CDATA:return{id:e,type:t.RRNodeType,textContent:""}}}function ZU(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map((function(t){t(n)})),(i=t.get("*"))&&i.slice().map((function(t){t(e,n)}))}}}const KU=Object.freeze(Object.defineProperty({__proto__:null,default:ZU},Symbol.toStringTag,{value:"Module"}));function $U(t=window,e=document){if("scrollBehavior"in e.documentElement.style&&!0!==t.__forceSmoothScrollPolyfill__)return;const n=t.HTMLElement||t.Element,i=468,r={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:n.prototype.scroll||l,scrollIntoView:n.prototype.scrollIntoView},s=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now;const o=(a=t.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(a)?1:0);var a;function l(t,e){this.scrollLeft=t,this.scrollTop=e}function c(t){if(null===t||"object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return!0;if("object"==typeof t&&"smooth"===t.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+t.behavior+" is not a valid value for enumeration ScrollBehavior.")}function u(t,e){return"Y"===e?t.clientHeight+o<t.scrollHeight:"X"===e?t.clientWidth+o<t.scrollWidth:void 0}function h(e,n){const i=t.getComputedStyle(e,null)["overflow"+n];return"auto"===i||"scroll"===i}function d(t){const e=u(t,"Y")&&h(t,"Y"),n=u(t,"X")&&h(t,"X");return e||n}function p(e){let n,r,o,a=(s()-e.startTime)/i;var l;a=a>1?1:a,l=a,n=.5*(1-Math.cos(Math.PI*l)),r=e.startX+(e.x-e.startX)*n,o=e.startY+(e.y-e.startY)*n,e.method.call(e.scrollable,r,o),r===e.x&&o===e.y||t.requestAnimationFrame(p.bind(t,e))}function f(n,i,o){let a,c,u,h;const d=s();n===e.body?(a=t,c=t.scrollX||t.pageXOffset,u=t.scrollY||t.pageYOffset,h=r.scroll):(a=n,c=n.scrollLeft,u=n.scrollTop,h=l),p({scrollable:a,method:h,startTime:d,startX:c,startY:u,x:i,y:o})}t.scroll=t.scrollTo=function(){void 0!==arguments[0]&&(!0!==c(arguments[0])?f.call(t,e.body,void 0!==arguments[0].left?~~arguments[0].left:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:t.scrollY||t.pageYOffset):r.scroll.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:t.scrollY||t.pageYOffset))},t.scrollBy=function(){void 0!==arguments[0]&&(c(arguments[0])?r.scrollBy.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):f.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset)))},n.prototype.scroll=n.prototype.scrollTo=function(){if(void 0===arguments[0])return;if(!0===c(arguments[0])){if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");return void r.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}const t=arguments[0].left,e=arguments[0].top;f.call(this,this,void 0===t?this.scrollLeft:~~t,void 0===e?this.scrollTop:~~e)},n.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==c(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):r.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},n.prototype.scrollIntoView=function(){if(!0===c(arguments[0]))return void r.scrollIntoView.call(this,void 0===arguments[0]||arguments[0]);const n=function(t){for(;t!==e.body&&!1===d(t);)t=t.parentNode||t.host;return t}(this),i=n.getBoundingClientRect(),s=this.getBoundingClientRect();n!==e.body?(f.call(this,n,n.scrollLeft+s.left-i.left,n.scrollTop+s.top-i.top),"fixed"!==t.getComputedStyle(n).position&&t.scrollBy({left:i.left,top:i.top,behavior:"smooth"})):t.scrollBy({left:s.left,top:s.top,behavior:"smooth"})}}class JU{constructor(t=[],e){this.timeOffset=0,this.raf=null,this.actions=t,this.speed=e.speed,this.liveMode=e.liveMode}addAction(t){if(!this.actions.length||this.actions[this.actions.length-1].delay<=t.delay)return void this.actions.push(t);const e=this.findActionIndex(t);this.actions.splice(e,0,t)}start(){this.timeOffset=0;let t=performance.now();const e=()=>{const n=performance.now();for(this.timeOffset+=(n-t)*this.speed,t=n;this.actions.length;){const t=this.actions[0];if(!(this.timeOffset>=t.delay))break;this.actions.shift(),t.doAction()}(this.actions.length>0||this.liveMode)&&(this.raf=requestAnimationFrame(e))};this.raf=requestAnimationFrame(e)}clear(){this.raf&&(cancelAnimationFrame(this.raf),this.raf=null),this.actions.length=0}setSpeed(t){this.speed=t}toggleLiveMode(t){this.liveMode=t}isActive(){return null!==this.raf}findActionIndex(t){let e=0,n=this.actions.length-1;for(;e<=n;){const i=Math.floor((e+n)/2);if(this.actions[i].delay<t.delay)e=i+1;else{if(!(this.actions[i].delay>t.delay))return i+1;n=i-1}}return e}}function QU(t,e){if(t.type===sz.IncrementalSnapshot&&t.data.source===oz.MouseMove&&t.data.positions&&t.data.positions.length){const n=t.data.positions[0].timeOffset,i=t.timestamp+n;return t.delay=i-e,i-e}return t.delay=t.timestamp-e,t.delay}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function tV(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}var eV,nV;(nV=eV||(eV={}))[nV.NotStarted=0]="NotStarted",nV[nV.Running=1]="Running",nV[nV.Stopped=2]="Stopped";var iV={type:"xstate.init"};function rV(t){return void 0===t?[]:[].concat(t)}function sV(t){return{type:"xstate.assign",assignment:t}}function oV(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function aV(t){return function(e){return t===e}}function lV(t){return"string"==typeof t?{type:t}:t}function cV(t,e){return{value:t,context:e,actions:[],changed:!1,matches:aV(t)}}function uV(t,e,n){var i=e,r=!1;return[t.filter((function(t){if("xstate.assign"===t.type){r=!0;var e=Object.assign({},i);return"function"==typeof t.assignment?e=t.assignment(i,n):Object.keys(t.assignment).forEach((function(r){e[r]="function"==typeof t.assignment[r]?t.assignment[r](i,n):t.assignment[r]})),i=e,!1}return!0})),i,r]}function hV(t,e){void 0===e&&(e={});var n=tV(uV(rV(t.states[t.initial].entry).map((function(t){return oV(t,e.actions)})),t.context,iV),2),i=n[0],r=n[1],s={config:t,_options:e,initialState:{value:t.initial,actions:i,context:r,matches:aV(t.initial)},transition:function(e,n){var i,r,o="string"==typeof e?{value:e,context:t.context}:e,a=o.value,l=o.context,c=lV(n),u=t.states[a];if(u.on){var h=rV(u.on[c.type]);try{for(var d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(h),p=d.next();!p.done;p=d.next()){var f=p.value;if(void 0===f)return cV(a,l);var m="string"==typeof f?{target:f}:f,g=m.target,v=m.actions,y=void 0===v?[]:v,_=m.cond,b=void 0===_?function(){return!0}:_,x=void 0===g,w=null!=g?g:a,S=t.states[w];if(b(l,c)){var M=tV(uV((x?rV(y):[].concat(u.exit,y,S.entry).filter((function(t){return t}))).map((function(t){return oV(t,s._options.actions)})),l,c),3),C=M[0],A=M[1],T=M[2],E=null!=g?g:a;return{value:E,context:A,actions:C,changed:g!==a||C.length>0||T,matches:aV(E)}}}}catch(nV){i={error:nV}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(i)throw i.error}}}return cV(a,l)}};return s}var dV=function(t,e){return t.actions.forEach((function(n){var i=n.exec;return i&&i(t.context,e)}))};function pV(t){var e=t.initialState,n=eV.NotStarted,i=new Set,r={_machine:t,send:function(r){n===eV.Running&&(e=t.transition(e,r),dV(e,lV(r)),i.forEach((function(t){return t(e)})))},subscribe:function(t){return i.add(t),t(e),{unsubscribe:function(){return i.delete(t)}}},start:function(i){if(i){var s="object"==typeof i?i:{context:t.config.context,value:i};e={value:s.value,actions:[],context:s.context,matches:aV(s.value)}}return n=eV.Running,dV(e,iV),r},stop:function(){return n=eV.Stopped,i.clear(),r},get state(){return e},get status(){return n}};return r}function fV(t,{getCastFn:e,applyEventsSynchronously:n,emitter:i}){return pV(hV({id:"player",context:t,initial:"paused",states:{playing:{on:{PAUSE:{target:"paused",actions:["pause"]},CAST_EVENT:{target:"playing",actions:"castEvent"},END:{target:"paused",actions:["resetLastPlayedEvent","pause"]},ADD_EVENT:{target:"playing",actions:["addEvent"]}}},paused:{on:{PLAY:{target:"playing",actions:["recordTimeOffset","play"]},CAST_EVENT:{target:"paused",actions:"castEvent"},TO_LIVE:{target:"live",actions:["startLive"]},ADD_EVENT:{target:"paused",actions:["addEvent"]}}},live:{on:{ADD_EVENT:{target:"live",actions:["addEvent"]},CAST_EVENT:{target:"live",actions:["castEvent"]}}}}},{actions:{castEvent:sV({lastPlayedEvent:(t,e)=>"CAST_EVENT"===e.type?e.payload.event:t.lastPlayedEvent}),recordTimeOffset:sV(((t,e)=>{let n=t.timeOffset;return"payload"in e&&"timeOffset"in e.payload&&(n=e.payload.timeOffset),Object.assign(Object.assign({},t),{timeOffset:n,baselineTime:t.events[0].timestamp+n})})),play(t){var r;const{timer:s,events:o,baselineTime:a,lastPlayedEvent:l}=t;s.clear();for(const e of o)QU(e,a);const c=function(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.type===sz.Meta&&i.timestamp<=e)return t.slice(n)}return t}(o,a);let u=null==l?void 0:l.timestamp;(null==l?void 0:l.type)===sz.IncrementalSnapshot&&l.data.source===oz.MouseMove&&(u=l.timestamp+(null===(r=l.data.positions[0])||void 0===r?void 0:r.timeOffset)),a<(u||0)&&i.emit(cz.PlayBack);const h=new Array;for(const n of c)if(!(u&&u<a&&(n.timestamp<=u||n===l)))if(n.timestamp<a)h.push(n);else{const t=e(n,!1);s.addAction({doAction:()=>{t()},delay:n.delay})}n(h),i.emit(cz.Flush),s.start()},pause(t){t.timer.clear()},resetLastPlayedEvent:sV((t=>Object.assign(Object.assign({},t),{lastPlayedEvent:null}))),startLive:sV({baselineTime:(t,e)=>(t.timer.toggleLiveMode(!0),t.timer.start(),"TO_LIVE"===e.type&&e.payload.baselineTime?e.payload.baselineTime:Date.now())}),addEvent:sV(((t,n)=>{const{baselineTime:i,timer:r,events:s}=t;if("ADD_EVENT"===n.type){const{event:t}=n.payload;QU(t,i);let o=s.length-1;if(!s[o]||s[o].timestamp<=t.timestamp)s.push(t);else{let e=-1,n=0;for(;n<=o;){const e=Math.floor((n+o)/2);s[e].timestamp<=t.timestamp?n=e+1:o=e-1}-1===e&&(e=n),s.splice(e,0,t)}const a=t.timestamp<i,l=e(t,a);a?l():r.isActive()&&r.addAction({doAction:()=>{l()},delay:t.delay})}return Object.assign(Object.assign({},t),{events:s})}))}}))}const mV=new Map;function gV(t,e){let n=mV.get(t);return n||(n=new Map,mV.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}function vV(t,e,n){return i=>Bz(this,void 0,void 0,(function*(){if(i&&"object"==typeof i&&"rr_type"in i){if(n&&(n.isUnchanged=!1),"ImageBitmap"===i.rr_type&&"args"in i){const r=yield vV(t,e,n)(i.args);return yield createImageBitmap.apply(null,r)}if("index"in i){if(n||null===e)return i;const{rr_type:t,index:r}=i;return gV(e,t)[r]}if("args"in i){const{rr_type:r,args:s}=i;return new(0,window[r])(...yield Promise.all(s.map(vV(t,e,n))))}if("base64"in i)return Wz(i.base64);if("src"in i){const e=t.get(i.src);if(e)return e;{const e=new Image;return e.src=i.src,t.set(i.src,e),e}}if("data"in i&&"Blob"===i.rr_type){const r=yield Promise.all(i.data.map(vV(t,e,n)));return new Blob(r,{type:i.type})}}else if(Array.isArray(i)){return yield Promise.all(i.map(vV(t,e,n)))}return i}))}const yV=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject"];function _V({mutation:t,target:e,type:n,imageMap:i,errorHandler:r}){return Bz(this,void 0,void 0,(function*(){try{const r=function(t,e){try{return e===lz.WebGL?t.getContext("webgl")||t.getContext("experimental-webgl"):t.getContext("webgl2")}catch(xW){return null}}(e,n);if(!r)return;if(t.setter)return void(r[t.property]=t.args[0]);const s=r[t.property],o=yield Promise.all(t.args.map(vV(i,r)));!function(t,e){if(!(null==e?void 0:e.constructor))return;const{name:n}=e.constructor;if(!yV.includes(n))return;const i=gV(t,n);i.includes(e)||i.push(e)}(r,s.apply(r,o))}catch(s){r(t,s)}}))}function bV({event:t,mutation:e,target:n,imageMap:i,errorHandler:r}){return Bz(this,void 0,void 0,(function*(){try{const r=n.getContext("2d");if(e.setter)return void(r[e.property]=e.args[0]);const s=r[e.property];if("drawImage"===e.property&&"string"==typeof e.args[0])i.get(t),s.apply(r,e.args);else{const t=yield Promise.all(e.args.map(vV(i,r)));s.apply(r,t)}}catch(s){r(e,s)}}))}function xV({event:t,mutation:e,target:n,imageMap:i,canvasEventMap:r,errorHandler:s}){return Bz(this,void 0,void 0,(function*(){try{const o=r.get(t)||e,a="commands"in o?o.commands:[o];if([lz.WebGL,lz.WebGL2].includes(e.type)){for(let t=0;t<a.length;t++){const r=a[t];yield _V({mutation:r,type:e.type,target:n,imageMap:i,errorHandler:s})}return}for(let e=0;e<a.length;e++){const r=a[e];yield bV({event:t,mutation:r,target:n,imageMap:i,errorHandler:s})}}catch(o){s(e,o)}}))}const wV=ZU||KU,SV={duration:500,lineCap:"round",lineWidth:3,strokeStyle:"red"};function MV(t){return t.type==sz.IncrementalSnapshot&&(t.data.source==oz.TouchMove||t.data.source==oz.MouseInteraction&&t.data.type==az.TouchStart)}class CV{constructor(t,e){if(this.usingVirtualDom=!1,this.virtualDom=new kU,this.mouseTail=null,this.tailPositions=[],this.emitter=wV(),this.legacy_missingNodeRetryMap={},this.cache=OB(),this.imageMap=new Map,this.canvasEventMap=new Map,this.mirror=nB(),this.styleMirror=new rz,this.firstFullSnapshot=null,this.newDocumentQueue=[],this.mousePos=null,this.touchActive=null,this.lastSelectionData=null,this.constructedStyleMutations=[],this.adoptedStyleSheets=[],this.handleResize=t=>{this.iframe.style.display="inherit";for(const e of[this.mouseTail,this.iframe])e&&(e.setAttribute("width",String(t.width)),e.setAttribute("height",String(t.height)))},this.applyEventsSynchronously=t=>{for(const e of t){switch(e.type){case sz.DomContentLoaded:case sz.Load:case sz.Custom:continue;case sz.FullSnapshot:case sz.Meta:case sz.Plugin:case sz.IncrementalSnapshot:}this.getCastFn(e,!0)()}!0===this.touchActive?this.mouse.classList.add("touch-active"):!1===this.touchActive&&this.mouse.classList.remove("touch-active"),this.touchActive=null},this.getCastFn=(t,e=!1)=>{let n;switch(t.type){case sz.DomContentLoaded:case sz.Load:break;case sz.Custom:n=()=>{this.emitter.emit(cz.CustomEvent,t)};break;case sz.Meta:n=()=>this.emitter.emit(cz.Resize,{width:t.data.width,height:t.data.height});break;case sz.FullSnapshot:n=()=>{var n;if(this.firstFullSnapshot){if(this.firstFullSnapshot===t)return void(this.firstFullSnapshot=!0)}else this.firstFullSnapshot=!0;this.rebuildFullSnapshot(t,e),null===(n=this.iframe.contentWindow)||void 0===n||n.scrollTo(t.data.initialOffset),this.styleMirror.reset()};break;case sz.IncrementalSnapshot:n=()=>{if(this.applyIncremental(t,e),!e&&(t===this.nextUserInteractionEvent&&(this.nextUserInteractionEvent=null,this.backToNormal()),this.config.skipInactive&&!this.nextUserInteractionEvent)){for(const e of this.service.state.context.events)if(!(e.timestamp<=t.timestamp)&&this.isUserInteraction(e)){e.delay-t.delay>1e4*this.speedService.state.context.timer.speed&&(this.nextUserInteractionEvent=e);break}if(this.nextUserInteractionEvent){const e=this.nextUserInteractionEvent.delay-t.delay,n={speed:Math.min(Math.round(e/5e3),this.config.maxSpeed)};this.speedService.send({type:"FAST_FORWARD",payload:n}),this.emitter.emit(cz.SkipStart,n)}}}}return()=>{n&&n();for(const n of this.config.plugins||[])n.handler&&n.handler(t,e,{replayer:this});this.service.send({type:"CAST_EVENT",payload:{event:t}});const i=this.service.state.context.events.length-1;if(t===this.service.state.context.events[i]){const e=()=>{i<this.service.state.context.events.length-1||(this.backToNormal(),this.service.send("END"),this.emitter.emit(cz.Finish))};t.type===sz.IncrementalSnapshot&&t.data.source===oz.MouseMove&&t.data.positions.length?setTimeout((()=>{e()}),Math.max(0,50-t.data.positions[0].timeOffset)):e()}this.emitter.emit(cz.EventCast,t)}},!(null==e?void 0:e.liveMode)&&t.length<2)throw new Error("Replayer need at least 2 events.");const n={speed:1,maxSpeed:360,root:document.body,loadTimeout:0,skipInactive:!1,showWarning:!0,showDebug:!1,blockClass:"rr-block",liveMode:!1,insertStyleRules:[],triggerFocus:!0,UNSAFE_replayCanvas:!1,pauseAnimation:!0,mouseTail:SV,useVirtualDom:!0};this.config=Object.assign({},n,e),this.handleResize=this.handleResize.bind(this),this.getCastFn=this.getCastFn.bind(this),this.applyEventsSynchronously=this.applyEventsSynchronously.bind(this),this.emitter.on(cz.Resize,this.handleResize),this.setupDom();for(const o of this.config.plugins||[])o.getMirror&&o.getMirror({nodeMirror:this.mirror});this.emitter.on(cz.Flush,(()=>{if(this.usingVirtualDom){const e={mirror:this.mirror,applyCanvas:(t,e,n)=>{xV({event:t,mutation:e,target:n,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})},applyInput:this.applyInput.bind(this),applyScroll:this.applyScroll.bind(this),applyStyleSheetMutation:(t,e)=>{t.source===oz.StyleSheetRule?this.applyStyleSheetRule(t,e):t.source===oz.StyleDeclaration&&this.applyStyleDeclaration(t,e)}};if(this.iframe.contentDocument&&DU(this.iframe.contentDocument,this.virtualDom,e,this.virtualDom.mirror),this.virtualDom.destroyTree(),this.usingVirtualDom=!1,Object.keys(this.legacy_missingNodeRetryMap).length)for(const n in this.legacy_missingNodeRetryMap)try{const t=this.legacy_missingNodeRetryMap[n],i=OU(t.node,this.mirror,this.virtualDom.mirror);DU(i,t.node,e,this.virtualDom.mirror),t.node=i}catch(t){this.config.showWarning}this.constructedStyleMutations.forEach((t=>{this.applyStyleSheetMutation(t)})),this.constructedStyleMutations=[],this.adoptedStyleSheets.forEach((t=>{this.applyAdoptedStyleSheet(t)})),this.adoptedStyleSheets=[]}this.mousePos&&(this.moveAndHover(this.mousePos.x,this.mousePos.y,this.mousePos.id,!0,this.mousePos.debugData),this.mousePos=null),this.lastSelectionData&&(this.applySelection(this.lastSelectionData),this.lastSelectionData=null)})),this.emitter.on(cz.PlayBack,(()=>{this.firstFullSnapshot=null,this.mirror.reset(),this.styleMirror.reset()}));const i=new JU([],{speed:this.config.speed,liveMode:this.config.liveMode});this.service=fV({events:t.map((t=>e&&e.unpackFn?e.unpackFn(t):t)).sort(((t,e)=>t.timestamp-e.timestamp)),timer:i,timeOffset:0,baselineTime:0,lastPlayedEvent:null},{getCastFn:this.getCastFn,applyEventsSynchronously:this.applyEventsSynchronously,emitter:this.emitter}),this.service.start(),this.service.subscribe((t=>{this.emitter.emit(cz.StateChange,{player:t})})),this.speedService=pV(hV({id:"speed",context:{normalSpeed:-1,timer:i},initial:"normal",states:{normal:{on:{FAST_FORWARD:{target:"skipping",actions:["recordSpeed","setSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}},skipping:{on:{BACK_TO_NORMAL:{target:"normal",actions:["restoreSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}}}},{actions:{setSpeed:(t,e)=>{"payload"in e&&t.timer.setSpeed(e.payload.speed)},recordSpeed:sV({normalSpeed:t=>t.timer.speed}),restoreSpeed:t=>{t.timer.setSpeed(t.normalSpeed)}}})),this.speedService.start(),this.speedService.subscribe((t=>{this.emitter.emit(cz.StateChange,{speed:t})}));const r=this.service.state.context.events.find((t=>t.type===sz.Meta)),s=this.service.state.context.events.find((t=>t.type===sz.FullSnapshot));if(r){const{width:t,height:e}=r.data;setTimeout((()=>{this.emitter.emit(cz.Resize,{width:t,height:e})}),0)}s&&setTimeout((()=>{var t;this.firstFullSnapshot||(this.firstFullSnapshot=s,this.rebuildFullSnapshot(s),null===(t=this.iframe.contentWindow)||void 0===t||t.scrollTo(s.data.initialOffset))}),1),this.service.state.context.events.find(MV)&&this.mouse.classList.add("touch-device")}get timer(){return this.service.state.context.timer}on(t,e){return this.emitter.on(t,e),this}off(t,e){return this.emitter.off(t,e),this}setConfig(t){Object.keys(t).forEach((e=>{t[e],this.config[e]=t[e]})),this.config.skipInactive||this.backToNormal(),void 0!==t.speed&&this.speedService.send({type:"SET_SPEED",payload:{speed:t.speed}}),void 0!==t.mouseTail&&(!1===t.mouseTail?this.mouseTail&&(this.mouseTail.style.display="none"):(this.mouseTail||(this.mouseTail=document.createElement("canvas"),this.mouseTail.width=Number.parseFloat(this.iframe.width),this.mouseTail.height=Number.parseFloat(this.iframe.height),this.mouseTail.classList.add("replayer-mouse-tail"),this.wrapper.insertBefore(this.mouseTail,this.iframe)),this.mouseTail.style.display="inherit"))}getMetaData(){const t=this.service.state.context.events[0],e=this.service.state.context.events[this.service.state.context.events.length-1];return{startTime:t.timestamp,endTime:e.timestamp,totalTime:e.timestamp-t.timestamp}}getCurrentTime(){return this.timer.timeOffset+this.getTimeOffset()}getTimeOffset(){const{baselineTime:t,events:e}=this.service.state.context;return t-e[0].timestamp}getMirror(){return this.mirror}play(t=0){var e,n;this.service.state.matches("paused")||this.service.send({type:"PAUSE"}),this.service.send({type:"PLAY",payload:{timeOffset:t}}),null===(n=null===(e=this.iframe.contentDocument)||void 0===e?void 0:e.getElementsByTagName("html")[0])||void 0===n||n.classList.remove("rrweb-paused"),this.emitter.emit(cz.Start)}pause(t){var e,n;void 0===t&&this.service.state.matches("playing")&&this.service.send({type:"PAUSE"}),"number"==typeof t&&(this.play(t),this.service.send({type:"PAUSE"})),null===(n=null===(e=this.iframe.contentDocument)||void 0===e?void 0:e.getElementsByTagName("html")[0])||void 0===n||n.classList.add("rrweb-paused"),this.emitter.emit(cz.Pause)}resume(t=0){this.play(t),this.emitter.emit(cz.Resume)}destroy(){this.pause(),this.config.root.removeChild(this.wrapper),this.emitter.emit(cz.Destroy)}startLive(t){this.service.send({type:"TO_LIVE",payload:{baselineTime:t}})}addEvent(t){const e=this.config.unpackFn?this.config.unpackFn(t):t;MV(e)&&this.mouse.classList.add("touch-device"),Promise.resolve().then((()=>this.service.send({type:"ADD_EVENT",payload:{event:e}})))}enableInteract(){this.iframe.setAttribute("scrolling","auto"),this.iframe.style.pointerEvents="auto"}disableInteract(){this.iframe.setAttribute("scrolling","no"),this.iframe.style.pointerEvents="none"}resetCache(){this.cache=OB()}setupDom(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("replayer-wrapper"),this.config.root.appendChild(this.wrapper),this.mouse=document.createElement("div"),this.mouse.classList.add("replayer-mouse"),this.wrapper.appendChild(this.mouse),!1!==this.config.mouseTail&&(this.mouseTail=document.createElement("canvas"),this.mouseTail.classList.add("replayer-mouse-tail"),this.mouseTail.style.display="inherit",this.wrapper.appendChild(this.mouseTail)),this.iframe=document.createElement("iframe");const t=["allow-same-origin"];this.config.UNSAFE_replayCanvas&&t.push("allow-scripts"),this.iframe.style.display="none",this.iframe.setAttribute("sandbox",t.join(" ")),this.disableInteract(),this.wrapper.appendChild(this.iframe),this.iframe.contentWindow&&this.iframe.contentDocument&&($U(this.iframe.contentWindow,this.iframe.contentDocument),ZB(this.iframe.contentWindow))}rebuildFullSnapshot(t,e=!1){if(!this.iframe.contentDocument)return;Object.keys(this.legacy_missingNodeRetryMap).length,this.legacy_missingNodeRetryMap={};const n=[],i=(t,e)=>{this.collectIframeAndAttachDocument(n,t);for(const n of this.config.plugins||[])n.onBuild&&n.onBuild(t,{id:e,replayer:this})};FB(t.data.node,{doc:this.iframe.contentDocument,afterAppend:i,cache:this.cache,mirror:this.mirror}),i(this.iframe.contentDocument,t.data.node.id);for(const{mutationInQueue:o,builtNode:a}of n)this.attachDocumentToIframe(o,a),this.newDocumentQueue=this.newDocumentQueue.filter((t=>t!==o));const{documentElement:r,head:s}=this.iframe.contentDocument;this.insertStyleRules(r,s),this.service.state.matches("playing")||this.iframe.contentDocument.getElementsByTagName("html")[0].classList.add("rrweb-paused"),this.emitter.emit(cz.FullsnapshotRebuilded,t),e||this.waitForStylesheetLoad(),this.config.UNSAFE_replayCanvas&&this.preloadAllImages()}insertStyleRules(t,e){var n;const i=(r=this.config.blockClass,[`.${r} { background: currentColor }`,"noscript { display: none !important; }"]).concat(this.config.insertStyleRules);var r;if(this.config.pauseAnimation&&i.push("html.rrweb-paused *, html.rrweb-paused *:before, html.rrweb-paused *:after { animation-play-state: paused !important; }"),this.usingVirtualDom){const n=this.virtualDom.createElement("style");this.virtualDom.mirror.add(n,YU(n,this.virtualDom.unserializedId)),t.insertBefore(n,e),n.rules.push({source:oz.StyleSheetRule,adds:i.map(((t,e)=>({rule:t,index:e})))})}else{const r=document.createElement("style");t.insertBefore(r,e);for(let t=0;t<i.length;t++)null===(n=r.sheet)||void 0===n||n.insertRule(i[t],t)}}attachDocumentToIframe(t,e){const n=this.usingVirtualDom?this.virtualDom.mirror:this.mirror,i=[],r=(t,r)=>{this.collectIframeAndAttachDocument(i,t);const s=n.getMeta(t);if((null==s?void 0:s.type)===YF.Element&&"HTML"===(null==s?void 0:s.tagName.toUpperCase())){const{documentElement:t,head:n}=e.contentDocument;this.insertStyleRules(t,n)}for(const e of this.config.plugins||[])e.onBuild&&e.onBuild(t,{id:r,replayer:this})};PB(t.node,{doc:e.contentDocument,mirror:n,hackCss:!0,skipChild:!1,afterAppend:r,cache:this.cache}),r(e.contentDocument,t.node.id);for(const{mutationInQueue:s,builtNode:o}of i)this.attachDocumentToIframe(s,o),this.newDocumentQueue=this.newDocumentQueue.filter((t=>t!==s))}collectIframeAndAttachDocument(t,e){if(JB(e,this.mirror)){const n=this.newDocumentQueue.find((t=>t.parentId===this.mirror.getId(e)));n&&t.push({mutationInQueue:n,builtNode:e})}}waitForStylesheetLoad(){var t;const e=null===(t=this.iframe.contentDocument)||void 0===t?void 0:t.head;if(e){const t=new Set;let n,i=this.service.state;const r=()=>{i=this.service.state};this.emitter.on(cz.Start,r),this.emitter.on(cz.Pause,r);const s=()=>{this.emitter.off(cz.Start,r),this.emitter.off(cz.Pause,r)};e.querySelectorAll('link[rel="stylesheet"]').forEach((e=>{e.sheet||(t.add(e),e.addEventListener("load",(()=>{t.delete(e),0===t.size&&-1!==n&&(i.matches("playing")&&this.play(this.getCurrentTime()),this.emitter.emit(cz.LoadStylesheetEnd),n&&clearTimeout(n),s())})))})),t.size>0&&(this.service.send({type:"PAUSE"}),this.emitter.emit(cz.LoadStylesheetStart),n=setTimeout((()=>{i.matches("playing")&&this.play(this.getCurrentTime()),n=-1,s()}),this.config.loadTimeout))}}preloadAllImages(){return Bz(this,void 0,void 0,(function*(){this.service.state;const t=()=>{this.service.state};this.emitter.on(cz.Start,t),this.emitter.on(cz.Pause,t);const e=[];for(const n of this.service.state.context.events)if(n.type===sz.IncrementalSnapshot&&n.data.source===oz.CanvasMutation){e.push(this.deserializeAndPreloadCanvasEvents(n.data,n));("commands"in n.data?n.data.commands:[n.data]).forEach((t=>{this.preloadImages(t,n)}))}return Promise.all(e)}))}preloadImages(t,e){if("drawImage"===t.property&&"string"==typeof t.args[0]&&!this.imageMap.has(e)){const e=document.createElement("canvas"),n=e.getContext("2d"),i=null==n?void 0:n.createImageData(e.width,e.height);null==i||i.data,JSON.parse(t.args[0]),null==n||n.putImageData(i,0,0)}}deserializeAndPreloadCanvasEvents(t,e){return Bz(this,void 0,void 0,(function*(){if(!this.canvasEventMap.has(e)){const n={isUnchanged:!0};if("commands"in t){const i=yield Promise.all(t.commands.map((t=>Bz(this,void 0,void 0,(function*(){const e=yield Promise.all(t.args.map(vV(this.imageMap,null,n)));return Object.assign(Object.assign({},t),{args:e})})))));!1===n.isUnchanged&&this.canvasEventMap.set(e,Object.assign(Object.assign({},t),{commands:i}))}else{const i=yield Promise.all(t.args.map(vV(this.imageMap,null,n)));!1===n.isUnchanged&&this.canvasEventMap.set(e,Object.assign(Object.assign({},t),{args:i}))}}}))}applyIncremental(t,e){var n,i,r;const{data:s}=t;switch(s.source){case oz.Mutation:try{this.applyMutation(s,e)}catch(o){this.warn(`Exception in mutation ${o.message||o}`,s)}break;case oz.Drag:case oz.TouchMove:case oz.MouseMove:if(e){const t=s.positions[s.positions.length-1];this.mousePos={x:t.x,y:t.y,id:t.id,debugData:s}}else s.positions.forEach((n=>{const i={doAction:()=>{this.moveAndHover(n.x,n.y,n.id,e,s)},delay:n.timeOffset+t.timestamp-this.service.state.context.baselineTime};this.timer.addAction(i)})),this.timer.addAction({doAction(){},delay:t.delay-(null===(n=s.positions[0])||void 0===n?void 0:n.timeOffset)});break;case oz.MouseInteraction:{if(-1===s.id||e)break;const t=new Event(az[s.type].toLowerCase()),n=this.mirror.getNode(s.id);if(!n)return this.debugNodeNotFound(s,s.id);this.emitter.emit(cz.MouseInteraction,{type:s.type,target:n});const{triggerFocus:i}=this.config;switch(s.type){case az.Blur:"blur"in n&&n.blur();break;case az.Focus:i&&n.focus&&n.focus({preventScroll:!0});break;case az.Click:case az.TouchStart:case az.TouchEnd:e?(s.type===az.TouchStart?this.touchActive=!0:s.type===az.TouchEnd&&(this.touchActive=!1),this.mousePos={x:s.x,y:s.y,id:s.id,debugData:s}):(s.type===az.TouchStart&&(this.tailPositions.length=0),this.moveAndHover(s.x,s.y,s.id,e,s),s.type===az.Click?(this.mouse.classList.remove("active"),this.mouse.offsetWidth,this.mouse.classList.add("active")):s.type===az.TouchStart?(this.mouse.offsetWidth,this.mouse.classList.add("touch-active")):s.type===az.TouchEnd&&this.mouse.classList.remove("touch-active"));break;case az.TouchCancel:e?this.touchActive=!1:this.mouse.classList.remove("touch-active");break;default:n.dispatchEvent(t)}break}case oz.Scroll:if(-1===s.id)break;if(this.usingVirtualDom){const t=this.virtualDom.mirror.getNode(s.id);if(!t)return this.debugNodeNotFound(s,s.id);t.scrollData=s;break}this.applyScroll(s,e);break;case oz.ViewportResize:this.emitter.emit(cz.Resize,{width:s.width,height:s.height});break;case oz.Input:if(-1===s.id)break;if(this.usingVirtualDom){const t=this.virtualDom.mirror.getNode(s.id);if(!t)return this.debugNodeNotFound(s,s.id);t.inputData=s;break}this.applyInput(s);break;case oz.MediaInteraction:{const t=this.usingVirtualDom?this.virtualDom.mirror.getNode(s.id):this.mirror.getNode(s.id);if(!t)return this.debugNodeNotFound(s,s.id);const e=t;try{s.currentTime&&(e.currentTime=s.currentTime),s.volume&&(e.volume=s.volume),s.muted&&(e.muted=s.muted),1===s.type&&e.pause(),0===s.type&&e.play(),4===s.type&&(e.playbackRate=s.playbackRate)}catch(o){this.config.showWarning}break}case oz.StyleSheetRule:case oz.StyleDeclaration:this.usingVirtualDom?s.styleId?this.constructedStyleMutations.push(s):s.id&&(null===(i=this.virtualDom.mirror.getNode(s.id))||void 0===i||i.rules.push(s)):this.applyStyleSheetMutation(s);break;case oz.CanvasMutation:if(!this.config.UNSAFE_replayCanvas)return;if(this.usingVirtualDom){const e=this.virtualDom.mirror.getNode(s.id);if(!e)return this.debugNodeNotFound(s,s.id);e.canvasMutations.push({event:t,mutation:s})}else{const e=this.mirror.getNode(s.id);if(!e)return this.debugNodeNotFound(s,s.id);xV({event:t,mutation:s,target:e,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})}break;case oz.Font:try{const t=new FontFace(s.family,s.buffer?new Uint8Array(JSON.parse(s.fontSource)):s.fontSource,s.descriptors);null===(r=this.iframe.contentDocument)||void 0===r||r.fonts.add(t)}catch(o){this.config.showWarning}break;case oz.Selection:if(e){this.lastSelectionData=s;break}this.applySelection(s);break;case oz.AdoptedStyleSheet:this.usingVirtualDom?this.adoptedStyleSheets.push(s):this.applyAdoptedStyleSheet(s)}}applyMutation(t,e){if(this.config.useVirtualDom&&!this.usingVirtualDom&&e&&(this.usingVirtualDom=!0,qU(this.iframe.contentDocument,this.mirror,this.virtualDom),Object.keys(this.legacy_missingNodeRetryMap).length))for(const l in this.legacy_missingNodeRetryMap)try{const t=this.legacy_missingNodeRetryMap[l],e=jU(t.node,this.virtualDom,this.mirror);e&&(t.node=e)}catch(a){this.config.showWarning}const n=this.usingVirtualDom?this.virtualDom.mirror:this.mirror;t.removes.forEach((e=>{var i;const r=n.getNode(e.id);if(!r){if(t.removes.find((t=>t.id===e.parentId)))return;return this.warnNodeNotFound(t,e.id)}let s=n.getNode(e.parentId);if(!s)return this.warnNodeNotFound(t,e.parentId);if(e.isShadow&&ez(s)&&(s=s.shadowRoot),n.removeNodeFromMap(r),s)try{s.removeChild(r),this.usingVirtualDom&&"#text"===r.nodeName&&"STYLE"===s.nodeName&&(null===(i=s.rules)||void 0===i?void 0:i.length)>0&&(s.rules=[])}catch(a){if(!(a instanceof DOMException))throw a;this.warn("parent could not remove child in mutation",s,r,t)}}));const i=Object.assign({},this.legacy_missingNodeRetryMap),r=[],s=t=>{var e;if(!this.iframe.contentDocument)return;let s=n.getNode(t.parentId);if(!s)return t.node.type===YF.Document?this.newDocumentQueue.push(t):r.push(t);t.node.isShadow&&(ez(s)||s.attachShadow({mode:"open"}),s=s.shadowRoot);let o=null,a=null;if(t.previousId&&(o=n.getNode(t.previousId)),t.nextId&&(a=n.getNode(t.nextId)),(t=>{let e=null;return t.nextId&&(e=n.getNode(t.nextId)),null!==t.nextId&&void 0!==t.nextId&&-1!==t.nextId&&!e})(t))return r.push(t);if(t.node.rootId&&!n.getNode(t.node.rootId))return;const l=t.node.rootId?n.getNode(t.node.rootId):this.usingVirtualDom?this.virtualDom:this.iframe.contentDocument;if(JB(s,n))return void this.attachDocumentToIframe(t,s);const c=(t,e)=>{for(const n of this.config.plugins||[])n.onBuild&&n.onBuild(t,{id:e,replayer:this})},u=PB(t.node,{doc:l,mirror:n,skipChild:!0,hackCss:!0,cache:this.cache,afterAppend:c});if(-1===t.previousId||-1===t.nextId)return void(i[t.node.id]={node:u,mutation:t});const h=n.getMeta(s);if(h&&h.type===YF.Element&&"textarea"===h.tagName&&t.node.type===YF.Text){const t=Array.isArray(s.childNodes)?s.childNodes:Array.from(s.childNodes);for(const e of t)e.nodeType===s.TEXT_NODE&&s.removeChild(e)}if(o&&o.nextSibling&&o.nextSibling.parentNode)s.insertBefore(u,o.nextSibling);else if(a&&a.parentNode)s.contains(a)?s.insertBefore(u,a):s.insertBefore(u,null);else{if(s===l)for(;l.firstChild;)l.removeChild(l.firstChild);s.appendChild(u)}if(c(u,t.node.id),this.usingVirtualDom&&"#text"===u.nodeName&&"STYLE"===s.nodeName&&(null===(e=s.rules)||void 0===e?void 0:e.length)>0&&(s.rules=[]),JB(u,this.mirror)){const t=this.mirror.getId(u),e=this.newDocumentQueue.find((e=>e.parentId===t));e&&(this.attachDocumentToIframe(e,u),this.newDocumentQueue=this.newDocumentQueue.filter((t=>t!==e)))}(t.previousId||t.nextId)&&this.legacy_resolveMissingNode(i,s,u,t)};t.adds.forEach((t=>{s(t)}));const o=Date.now();for(;r.length;){const t=KB(r);if(r.length=0,Date.now()-o>500){this.warn("Timeout in the loop, please check the resolve tree data:",t);break}for(const e of t){n.getNode(e.value.parentId)?$B(e,(t=>{s(t)})):this.debug("Drop resolve tree since there is no parent for the root node.",e)}}Object.keys(i).length&&Object.assign(this.legacy_missingNodeRetryMap,i),function(t){const e=new Set,n=[];for(let i=t.length;i--;){const r=t[i];e.has(r.id)||(n.push(r),e.add(r.id))}return n}(t.texts).forEach((e=>{var i;const r=n.getNode(e.id);if(!r){if(t.removes.find((t=>t.id===e.id)))return;return this.warnNodeNotFound(t,e.id)}if(r.textContent=e.value,this.usingVirtualDom){const t=r.parentNode;(null===(i=null==t?void 0:t.rules)||void 0===i?void 0:i.length)>0&&(t.rules=[])}})),t.attributes.forEach((e=>{const i=n.getNode(e.id);if(!i){if(t.removes.find((t=>t.id===e.id)))return;return this.warnNodeNotFound(t,e.id)}for(const t in e.attributes)if("string"==typeof t){const r=e.attributes[t];if(null===r)i.removeAttribute(t);else if("string"==typeof r)try{if("_cssText"===t&&("LINK"===i.nodeName||"STYLE"===i.nodeName))try{const t=n.getMeta(i);Object.assign(t.attributes,e.attributes);const r=PB(t,{doc:i.ownerDocument,mirror:n,skipChild:!0,hackCss:!0,cache:this.cache}),s=i.nextSibling,o=i.parentNode;if(r&&o){o.removeChild(i),o.insertBefore(r,s),n.replace(e.id,r);break}}catch(xW){}i.setAttribute(t,r)}catch(a){this.config.showWarning}else if("style"===t){const t=r,e=i;for(const n in t)if(!1===t[n])e.style.removeProperty(n);else if(t[n]instanceof Array){const i=t[n];e.style.setProperty(n,i[0],i[1])}else{const i=t[n];e.style.setProperty(n,i)}}}}))}applyScroll(t,e){var n,i;const r=this.mirror.getNode(t.id);if(!r)return this.debugNodeNotFound(t,t.id);const s=this.mirror.getMeta(r);if(r===this.iframe.contentDocument)null===(n=this.iframe.contentWindow)||void 0===n||n.scrollTo({top:t.y,left:t.x,behavior:e?"auto":"smooth"});else if((null==s?void 0:s.type)===YF.Document)null===(i=r.defaultView)||void 0===i||i.scrollTo({top:t.y,left:t.x,behavior:e?"auto":"smooth"});else try{r.scrollTo({top:t.y,left:t.x,behavior:e?"auto":"smooth"})}catch(o){}}applyInput(t){const e=this.mirror.getNode(t.id);if(!e)return this.debugNodeNotFound(t,t.id);try{e.checked=t.isChecked,e.value=t.text}catch(n){}}applySelection(t){try{const e=new Set,n=t.ranges.map((({start:t,startOffset:n,end:i,endOffset:r})=>{const s=this.mirror.getNode(t),o=this.mirror.getNode(i);if(!s||!o)return;const a=new Range;a.setStart(s,n),a.setEnd(o,r);const l=s.ownerDocument,c=null==l?void 0:l.getSelection();return c&&e.add(c),{range:a,selection:c}}));e.forEach((t=>t.removeAllRanges())),n.forEach((t=>{var e;return t&&(null===(e=t.selection)||void 0===e?void 0:e.addRange(t.range))}))}catch(e){}}applyStyleSheetMutation(t){var e;let n=null;t.styleId?n=this.styleMirror.getStyle(t.styleId):t.id&&(n=(null===(e=this.mirror.getNode(t.id))||void 0===e?void 0:e.sheet)||null),n&&(t.source===oz.StyleSheetRule?this.applyStyleSheetRule(t,n):t.source===oz.StyleDeclaration&&this.applyStyleDeclaration(t,n))}applyStyleSheetRule(t,e){var n,i,r,s;if(null===(n=t.adds)||void 0===n||n.forEach((({rule:t,index:n})=>{try{if(Array.isArray(n)){const{positions:i,index:r}=iz(n);nz(e.cssRules,i).insertRule(t,r)}else{const i=void 0===n?void 0:Math.min(n,e.cssRules.length);null==e||e.insertRule(t,i)}}catch(xW){}})),null===(i=t.removes)||void 0===i||i.forEach((({index:t})=>{try{if(Array.isArray(t)){const{positions:n,index:i}=iz(t);nz(e.cssRules,n).deleteRule(i||0)}else null==e||e.deleteRule(t)}catch(xW){}})),t.replace)try{null===(r=e.replace)||void 0===r||r.call(e,t.replace)}catch(xW){}if(t.replaceSync)try{null===(s=e.replaceSync)||void 0===s||s.call(e,t.replaceSync)}catch(xW){}}applyStyleDeclaration(t,e){if(t.set){nz(e.rules,t.index).style.setProperty(t.set.property,t.set.value,t.set.priority)}if(t.remove){nz(e.rules,t.index).style.removeProperty(t.remove.property)}}applyAdoptedStyleSheet(t){var e;const n=this.mirror.getNode(t.id);if(!n)return;null===(e=t.styles)||void 0===e||e.forEach((t=>{var e;let i=null,r=null;if(ez(n)?r=(null===(e=n.ownerDocument)||void 0===e?void 0:e.defaultView)||null:"#document"===n.nodeName&&(r=n.defaultView),r)try{i=new r.CSSStyleSheet,this.styleMirror.add(i,t.styleId),this.applyStyleSheetRule({source:oz.StyleSheetRule,adds:t.rules},i)}catch(xW){}}));let i=0;const r=(t,e)=>{const n=e.map((t=>this.styleMirror.getStyle(t))).filter((t=>null!==t));ez(t)?t.shadowRoot.adoptedStyleSheets=n:"#document"===t.nodeName&&(t.adoptedStyleSheets=n),n.length!==e.length&&i<10&&(setTimeout((()=>r(t,e)),0+100*i),i++)};r(n,t.styleIds)}legacy_resolveMissingNode(t,e,n,i){const{previousId:r,nextId:s}=i,o=r&&t[r],a=s&&t[s];if(o){const{node:i,mutation:r}=o;e.insertBefore(i,n),delete t[r.node.id],delete this.legacy_missingNodeRetryMap[r.node.id],(r.previousId||r.nextId)&&this.legacy_resolveMissingNode(t,e,i,r)}if(a){const{node:i,mutation:r}=a;e.insertBefore(i,n.nextSibling),delete t[r.node.id],delete this.legacy_missingNodeRetryMap[r.node.id],(r.previousId||r.nextId)&&this.legacy_resolveMissingNode(t,e,i,r)}}moveAndHover(t,e,n,i,r){const s=this.mirror.getNode(n);if(!s)return this.debugNodeNotFound(r,n);const o=tz(s,this.iframe),a=t*o.absoluteScale+o.x,l=e*o.absoluteScale+o.y;this.mouse.style.left=`${a}px`,this.mouse.style.top=`${l}px`,i||this.drawMouseTail({x:a,y:l}),this.hoverElements(s)}drawMouseTail(t){if(!this.mouseTail)return;const{lineCap:e,lineWidth:n,strokeStyle:i,duration:r}=!0===this.config.mouseTail?SV:Object.assign({},SV,this.config.mouseTail),s=()=>{if(!this.mouseTail)return;const t=this.mouseTail.getContext("2d");t&&this.tailPositions.length&&(t.clearRect(0,0,this.mouseTail.width,this.mouseTail.height),t.beginPath(),t.lineWidth=n,t.lineCap=e,t.strokeStyle=i,t.moveTo(this.tailPositions[0].x,this.tailPositions[0].y),this.tailPositions.forEach((e=>t.lineTo(e.x,e.y))),t.stroke())};this.tailPositions.push(t),s(),setTimeout((()=>{this.tailPositions=this.tailPositions.filter((e=>e!==t)),s()}),r/this.speedService.state.context.timer.speed)}hoverElements(t){var e;null===(e=this.iframe.contentDocument)||void 0===e||e.querySelectorAll(".\\:hover").forEach((t=>{t.classList.remove(":hover")}));let n=t;for(;n;)n.classList&&n.classList.add(":hover"),n=n.parentElement}isUserInteraction(t){return t.type===sz.IncrementalSnapshot&&(t.data.source>oz.Mutation&&t.data.source<=oz.Input)}backToNormal(){this.nextUserInteractionEvent=null,this.speedService.state.matches("normal")||(this.speedService.send({type:"BACK_TO_NORMAL"}),this.emitter.emit(cz.SkipEnd,{speed:this.speedService.state.context.normalSpeed}))}warnNodeNotFound(t,e){this.warn(`Node with id '${e}' not found. `,t)}warnCanvasMutationFailed(t,e){this.warn("Has error on canvas update",e,"canvas mutation:",t)}debugNodeNotFound(t,e){this.debug("[replayer]",`Node with id '${e}' not found. `,t)}warn(...t){this.config.showWarning}debug(...t){this.config.showDebug}}function AV(){}function TV(t,e){for(const n in e)t[n]=e[n];return t}function EV(t){return t()}function IV(){return Object.create(null)}function RV(t){t.forEach(EV)}function NV(t){return"function"==typeof t}function DV(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function LV(t){const e={};for(const n in t)"$"!==n[0]&&(e[n]=t[n]);return e}function OV(t,e){t.appendChild(e)}function kV(t,e,n){t.insertBefore(e,n||null)}function PV(t){t.parentNode.removeChild(t)}function FV(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function BV(t){return document.createElement(t)}function zV(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function UV(t){return document.createTextNode(t)}function VV(){return UV(" ")}function WV(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function GV(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function HV(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function jV(t,e,n,i){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,i?"important":"")}function qV(t,e,n){t.classList[n?"add":"remove"](e)}let XV;function YV(t){XV=t}function ZV(){if(!XV)throw new Error("Function called outside component initialization");return XV}function KV(t){ZV().$$.on_mount.push(t)}function $V(t){ZV().$$.on_destroy.push(t)}const JV=[],QV=[],tW=[],eW=[],nW=Promise.resolve();let iW=!1;function rW(t){tW.push(t)}const sW=new Set;let oW=0;function aW(){const t=XV;do{for(;oW<JV.length;){const t=JV[oW];oW++,YV(t),lW(t.$$)}for(YV(null),JV.length=0,oW=0;QV.length;)QV.pop()();for(let t=0;t<tW.length;t+=1){const e=tW[t];sW.has(e)||(sW.add(e),e())}tW.length=0}while(JV.length);for(;eW.length;)eW.pop()();iW=!1,sW.clear(),YV(t)}function lW(t){if(null!==t.fragment){t.update(),RV(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(rW)}}const cW=new Set;let uW;function hW(){uW={r:0,c:[],p:uW}}function dW(){uW.r||RV(uW.c),uW=uW.p}function pW(t,e){t&&t.i&&(cW.delete(t),t.i(e))}function fW(t,e,n,i){if(t&&t.o){if(cW.has(t))return;cW.add(t),uW.c.push((()=>{cW.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}else i&&i()}function mW(t){t&&t.c()}function gW(t,e,n,i){const{fragment:r,on_mount:s,on_destroy:o,after_update:a}=t.$$;r&&r.m(e,n),i||rW((()=>{const e=s.map(EV).filter(NV);o?o.push(...e):RV(e),t.$$.on_mount=[]})),a.forEach(rW)}function vW(t,e){const n=t.$$;null!==n.fragment&&(RV(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yW(t,e,n,i,r,s,o,a=[-1]){const l=XV;YV(t);const c=t.$$={fragment:null,ctx:null,props:s,update:AV,not_equal:r,bound:IV(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:IV(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},((e,n,...i)=>{const s=i.length?i[0]:n;return c.ctx&&r(c.ctx[e],c.ctx[e]=s)&&(!c.skip_bound&&c.bound[e]&&c.bound[e](s),u&&function(t,e){-1===t.$$.dirty[0]&&(JV.push(t),iW||(iW=!0,nW.then(aW)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n})):[],c.update(),u=!0,RV(c.before_update),c.fragment=!!i&&i(c.ctx),e.target){if(e.hydrate){const t=(h=e.target,Array.from(h.childNodes));c.fragment&&c.fragment.l(t),t.forEach(PV)}else c.fragment&&c.fragment.c();e.intro&&pW(t.$$.fragment),gW(t,e.target,e.anchor,e.customElement),aW()}var h;YV(l)}class _W{$destroy(){vW(this,1),this.$destroy=AV}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var bW,xW;function wW(t){return t.nodeType===t.ELEMENT_NODE}(xW=bW||(bW={}))[xW.Document=0]="Document",xW[xW.DocumentType=1]="DocumentType",xW[xW.Element=2]="Element",xW[xW.Text=3]="Text",xW[xW.CDATA=4]="CDATA",xW[xW.Comment=5]="Comment";var SW=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach((function(t){return e.removeNodeFromMap(t)}))},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var i=this.nodeMetaMap.get(n);i&&this.nodeMetaMap.set(e,i)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function MW(){return new SW}var CW=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function AW(t,e){void 0===e&&(e={});var n=1,i=1;function r(t){var e=t.match(/\n/g);e&&(n+=e.length);var r=t.lastIndexOf("\n");i=-1===r?i+t.length:t.length-r}function s(){var t={line:n,column:i};return function(e){return e.position=new o(t),p(),e}}var o=function(t){this.start=t,this.end={line:n,column:i},this.source=e.source};o.prototype.content=t;var a=[];function l(r){var s=new Error("".concat(e.source||"",":").concat(n,":").concat(i,": ").concat(r));if(s.reason=r,s.filename=e.source,s.line=n,s.column=i,s.source=t,!e.silent)throw s;a.push(s)}function c(){return d(/^{\s*/)}function u(){return d(/^}/)}function h(){var e,n=[];for(p(),f(n);t.length&&"}"!==t.charAt(0)&&(e=C()||A());)!1!==e&&(n.push(e),f(n));return n}function d(e){var n=e.exec(t);if(n){var i=n[0];return r(i),t=t.slice(i.length),n}}function p(){d(/^\s*/)}function f(t){var e;for(void 0===t&&(t=[]);e=m();)!1!==e&&t.push(e),e=m();return t}function m(){var e=s();if("/"===t.charAt(0)&&"*"===t.charAt(1)){for(var n=2;""!==t.charAt(n)&&("*"!==t.charAt(n)||"/"!==t.charAt(n+1));)++n;if(n+=2,""===t.charAt(n-1))return l("End of comment missing");var o=t.slice(2,n-2);return i+=2,r(o),t=t.slice(n),i+=2,e({type:"comment",comment:o})}}function g(){var t=d(/^([^{]+)/);if(t)return TW(t[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,(function(t){return t.replace(/,/g,"")})).split(/\s*(?![^(]*\)),\s*/).map((function(t){return t.replace(/\u200C/g,",")}))}function v(){var t=s(),e=d(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(e){var n=TW(e[0]);if(!d(/^:\s*/))return l("property missing ':'");var i=d(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),r=t({type:"declaration",property:n.replace(CW,""),value:i?TW(i[0]).replace(CW,""):""});return d(/^[;\s]*/),r}}function y(){var t,e=[];if(!c())return l("missing '{'");for(f(e);t=v();)!1!==t&&(e.push(t),f(e)),t=v();return u()?e:l("missing '}'")}function _(){for(var t,e=[],n=s();t=d(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)e.push(t[1]),d(/^,\s*/);if(e.length)return n({type:"keyframe",values:e,declarations:y()})}var b,x=M("import"),w=M("charset"),S=M("namespace");function M(t){var e=new RegExp("^@"+t+"\\s*([^;]+);");return function(){var n=s(),i=d(e);if(i){var r={type:t};return r[t]=i[1].trim(),n(r)}}}function C(){if("@"===t[0])return function(){var t=s(),e=d(/^@([-\w]+)?keyframes\s*/);if(e){var n=e[1];if(!(e=d(/^([-\w]+)\s*/)))return l("@keyframes missing name");var i,r=e[1];if(!c())return l("@keyframes missing '{'");for(var o=f();i=_();)o.push(i),o=o.concat(f());return u()?t({type:"keyframes",name:r,vendor:n,keyframes:o}):l("@keyframes missing '}'")}}()||function(){var t=s(),e=d(/^@media *([^{]+)/);if(e){var n=TW(e[1]);if(!c())return l("@media missing '{'");var i=f().concat(h());return u()?t({type:"media",media:n,rules:i}):l("@media missing '}'")}}()||function(){var t=s(),e=d(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(e)return t({type:"custom-media",name:TW(e[1]),media:TW(e[2])})}()||function(){var t=s(),e=d(/^@supports *([^{]+)/);if(e){var n=TW(e[1]);if(!c())return l("@supports missing '{'");var i=f().concat(h());return u()?t({type:"supports",supports:n,rules:i}):l("@supports missing '}'")}}()||x()||w()||S()||function(){var t=s(),e=d(/^@([-\w]+)?document *([^{]+)/);if(e){var n=TW(e[1]),i=TW(e[2]);if(!c())return l("@document missing '{'");var r=f().concat(h());return u()?t({type:"document",document:i,vendor:n,rules:r}):l("@document missing '}'")}}()||function(){var t=s();if(d(/^@page */)){var e=g()||[];if(!c())return l("@page missing '{'");for(var n,i=f();n=v();)i.push(n),i=i.concat(f());return u()?t({type:"page",selectors:e,declarations:i}):l("@page missing '}'")}}()||function(){var t=s();if(d(/^@host\s*/)){if(!c())return l("@host missing '{'");var e=f().concat(h());return u()?t({type:"host",rules:e}):l("@host missing '}'")}}()||function(){var t=s();if(d(/^@font-face\s*/)){if(!c())return l("@font-face missing '{'");for(var e,n=f();e=v();)n.push(e),n=n.concat(f());return u()?t({type:"font-face",declarations:n}):l("@font-face missing '}'")}}()}function A(){var t=s(),e=g();return e?(f(),t({type:"rule",selectors:e,declarations:y()})):l("selector missing")}return EW((b=h(),{type:"stylesheet",stylesheet:{source:e.source,rules:b,parsingErrors:a}}))}function TW(t){return t?t.replace(/^\s+|\s+$/g,""):""}function EW(t,e){for(var n=t&&"string"==typeof t.type,i=n?t:e,r=0,s=Object.keys(t);r<s.length;r++){var o=t[s[r]];Array.isArray(o)?o.forEach((function(t){EW(t,i)})):o&&"object"==typeof o&&EW(o,i)}return n&&Object.defineProperty(t,"parent",{configurable:!0,writable:!0,enumerable:!1,value:e||null}),t}var IW={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"},RW=/([^\\]):hover/,NW=new RegExp(RW.source,"g");function DW(t,e){var n=null==e?void 0:e.stylesWithHoverClass.get(t);if(n)return n;var i=AW(t,{silent:!0});if(!i.stylesheet)return t;var r=[];if(i.stylesheet.rules.forEach((function(t){"selectors"in t&&(t.selectors||[]).forEach((function(t){RW.test(t)&&r.push(t)}))})),0===r.length)return t;var s=new RegExp(r.filter((function(t,e){return r.indexOf(t)===e})).sort((function(t,e){return e.length-t.length})).map((function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|"),"g"),o=t.replace(s,(function(t){var e=t.replace(NW,"$1.\\:hover");return"".concat(t,", ").concat(e)}));return null==e||e.stylesWithHoverClass.set(t,o),o}function LW(){return{stylesWithHoverClass:new Map}}function OW(t,e){var n=e.doc,i=e.mirror,r=e.skipChild,s=void 0!==r&&r,o=e.hackCss,a=void 0===o||o,l=e.afterAppend,c=e.cache,u=function(t,e){var n,i,r=e.doc,s=e.hackCss,o=e.cache;switch(t.type){case bW.Document:return r.implementation.createDocument(null,"",null);case bW.DocumentType:return r.implementation.createDocumentType(t.name||"html",t.publicId,t.systemId);case bW.Element:var a,l=("link"===(i=IW[(n=t).tagName]?IW[n.tagName]:n.tagName)&&n.attributes._cssText&&(i="style"),i);a=t.isSVG?r.createElementNS("http://www.w3.org/2000/svg",l):r.createElement(l);var c={};for(var u in t.attributes)if(Object.prototype.hasOwnProperty.call(t.attributes,u)){var h=t.attributes[u];if("option"!==l||"selected"!==u||!1!==h)if(!0===h&&(h=""),u.startsWith("rr_"))c[u]=h;else{var d="textarea"===l&&"value"===u,p="style"===l&&"_cssText"===u;if(p&&s&&"string"==typeof h&&(h=DW(h,o)),!d&&!p||"string"!=typeof h)try{if(t.isSVG&&"xlink:href"===u)a.setAttributeNS("http://www.w3.org/1999/xlink",u,h.toString());else if("onload"===u||"onclick"===u||"onmouse"===u.substring(0,7))a.setAttribute("_"+u,h.toString());else{if("meta"===l&&"Content-Security-Policy"===t.attributes["http-equiv"]&&"content"===u){a.setAttribute("csp-content",h.toString());continue}"link"===l&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===l&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")||("img"===l&&t.attributes.srcset&&t.attributes.rr_dataURL?a.setAttribute("rrweb-original-srcset",t.attributes.srcset):a.setAttribute(u,h.toString()))}}catch(n){}else{for(var f=r.createTextNode(h),m=0,g=Array.from(a.childNodes);m<g.length;m++){var v=g[m];v.nodeType===a.TEXT_NODE&&a.removeChild(v)}a.appendChild(f)}}}var y=function(e){var n=c[e];if("canvas"===l&&"rr_dataURL"===e){var i=document.createElement("img");i.onload=function(){var t=a.getContext("2d");t&&t.drawImage(i,0,0,i.width,i.height)},i.src=n.toString(),a.RRNodeType&&(a.rr_dataURL=n.toString())}else if("img"===l&&"rr_dataURL"===e){var r=a;r.currentSrc.startsWith("data:")||(r.setAttribute("rrweb-original-src",t.attributes.src),r.src=n.toString())}if("rr_width"===e)a.style.width=n.toString();else if("rr_height"===e)a.style.height=n.toString();else if("rr_mediaCurrentTime"===e&&"number"==typeof n)a.currentTime=n;else if("rr_mediaState"===e)switch(n){case"played":a.play().catch((function(t){}));break;case"paused":a.pause()}};for(var _ in c)y(_);if(t.isShadowHost)if(a.shadowRoot)for(;a.shadowRoot.firstChild;)a.shadowRoot.removeChild(a.shadowRoot.firstChild);else a.attachShadow({mode:"open"});return a;case bW.Text:return r.createTextNode(t.isStyle&&s?DW(t.textContent,o):t.textContent);case bW.CDATA:return r.createCDATASection(t.textContent);case bW.Comment:return r.createComment(t.textContent);default:return null}}(t,{doc:n,hackCss:a,cache:c});if(!u)return null;if(t.rootId&&i.getNode(t.rootId)!==n&&i.replace(t.rootId,n),t.type===bW.Document&&(n.close(),n.open(),"BackCompat"===t.compatMode&&t.childNodes&&t.childNodes[0].type!==bW.DocumentType&&(t.childNodes[0].type===bW.Element&&"xmlns"in t.childNodes[0].attributes&&"http://www.w3.org/1999/xhtml"===t.childNodes[0].attributes.xmlns?n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'):n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">')),u=n),i.add(u,t),(t.type===bW.Document||t.type===bW.Element)&&!s)for(var h=0,d=t.childNodes;h<d.length;h++){var p=d[h],f=OW(p,{doc:n,mirror:i,skipChild:!1,hackCss:a,afterAppend:l,cache:c});f&&(p.isShadow&&wW(u)&&u.shadowRoot?u.shadowRoot.appendChild(f):u.appendChild(f),l&&l(f,p.id))}return u}let kW={map:{},getId:()=>-1,getNode:()=>null,removeNodeFromMap(){},has:()=>!1,reset(){}};function PW(t){const e={},n=(t,n)=>{const i={value:t,parent:n,children:[]};return e[t.node.id]=i,i},i=[];for(const r of t){const{nextId:t,parentId:s}=r;if(t&&t in e){const s=e[t];if(s.parent){const t=s.parent.children.indexOf(s);s.parent.children.splice(t,0,n(r,s.parent))}else{const t=i.indexOf(s);i.splice(t,0,n(r,null))}}else if(s in e){const t=e[s];t.children.push(n(r,t))}else i.push(n(r,null))}return i}function FW(t,e){e(t.value);for(let n=t.children.length-1;n>=0;n--)FW(t.children[n],e)}function BW(t,e){return Boolean("IFRAME"===t.nodeName&&e.getMeta(t))}function zW(t,e){var n,i;const r=null===(i=null===(n=t.ownerDocument)||void 0===n?void 0:n.defaultView)||void 0===i?void 0:i.frameElement;if(!r||r===e)return{x:0,y:0,relativeScale:1,absoluteScale:1};const s=r.getBoundingClientRect(),o=zW(r,e),a=s.height/r.clientHeight;return{x:s.x*o.relativeScale+o.x,y:s.y*o.relativeScale+o.y,relativeScale:a,absoluteScale:o.absoluteScale*a}}function UW(t){return Boolean(null==t?void 0:t.shadowRoot)}function VW(t,e){const n=t[e[0]];return 1===e.length?n:VW(n.cssRules[e[1]].cssRules,e.slice(2))}function WW(t){const e=[...t],n=e.pop();return{positions:e,index:n}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(kW=new Proxy(kW,{get:(t,e,n)=>Reflect.get(t,e,n)}));class GW{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var e;return null!==(e=this.styleIDMap.get(t))&&void 0!==e?e:-1}has(t){return this.styleIDMap.has(t)}add(t,e){if(this.has(t))return this.getId(t);let n;return n=void 0===e?this.id++:e,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}var HW=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(HW||{}),jW=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t))(jW||{}),qW=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(qW||{}),XW=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(XW||{}),YW=(t=>(t.Start="start",t.Pause="pause",t.Resume="resume",t.Resize="resize",t.Finish="finish",t.FullsnapshotRebuilded="fullsnapshot-rebuilded",t.LoadStylesheetStart="load-stylesheet-start",t.LoadStylesheetEnd="load-stylesheet-end",t.SkipStart="skip-start",t.SkipEnd="skip-end",t.MouseInteraction="mouse-interaction",t.EventCast="event-cast",t.CustomEvent="custom-event",t.Flush="flush",t.StateChange="state-change",t.PlayBack="play-back",t.Destroy="destroy",t))(YW||{});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ZW(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{l(i.next(t))}catch(e){s(e)}}function a(t){try{l(i.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))}for(var KW="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$W="undefined"==typeof Uint8Array?[]:new Uint8Array(256),JW=0;JW<64;JW++)$W[KW.charCodeAt(JW)]=JW;var QW;try{var tG="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");tG.Worker}catch(ZX){}"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&function(t,e,n){var i,r,s=void 0===e?null:e,o=(i=t,r=void 0!==n&&n,Buffer.from(i,"base64").toString(r?"utf16":"utf8")),a=o.indexOf("\n",10)+1,l=o.substring(a)+(s?"//# sourceMappingURL="+s:"")}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",null,false),MW(),function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(QW||(QW={}));var eG=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach((function(t){return e.removeNodeFromMap(t)}))},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var n=this.getNode(t);if(n){var i=this.nodeMetaMap.get(n);i&&this.nodeMetaMap.set(e,i)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();function nG(t){const e=[];for(const n in t){const i=t[n];if("string"!=typeof i)continue;const r=aG(n);e.push(`${r}: ${i};`)}return e.join(" ")}const iG=/-([a-z])/g,rG=/^--[a-zA-Z0-9-]+$/,sG=t=>rG.test(t)?t:t.replace(iG,((t,e)=>e?e.toUpperCase():"")),oG=/\B([A-Z])/g,aG=t=>t.replace(oG,"-$1").toLowerCase();class lG{constructor(...t){this.childNodes=[],this.parentElement=null,this.parentNode=null,this.ELEMENT_NODE=mG.ELEMENT_NODE,this.TEXT_NODE=mG.TEXT_NODE}get firstChild(){return this.childNodes[0]||null}get lastChild(){return this.childNodes[this.childNodes.length-1]||null}get nextSibling(){const t=this.parentNode;if(!t)return null;const e=t.childNodes,n=e.indexOf(this);return e[n+1]||null}contains(t){if(t===this)return!0;for(const e of this.childNodes)if(e.contains(t))return!0;return!1}appendChild(t){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")}insertBefore(t,e){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")}removeChild(t){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")}toString(){return"RRNode"}}function cG(t){return class extends t{constructor(t,e,n){super(),this.nodeType=mG.DOCUMENT_TYPE_NODE,this.RRNodeType=QW.DocumentType,this.textContent=null,this.name=t,this.publicId=e,this.systemId=n,this.nodeName=t}toString(){return"RRDocumentType"}}}function uG(t){return class extends t{constructor(t){super(),this.nodeType=mG.ELEMENT_NODE,this.RRNodeType=QW.Element,this.attributes={},this.shadowRoot=null,this.tagName=t.toUpperCase(),this.nodeName=t.toUpperCase()}get textContent(){let t="";return this.childNodes.forEach((e=>t+=e.textContent)),t}set textContent(t){this.childNodes=[this.ownerDocument.createTextNode(t)]}get classList(){return new fG(this.attributes.class,(t=>{this.attributes.class=t}))}get id(){return this.attributes.id||""}get className(){return this.attributes.class||""}get style(){const t=this.attributes.style?function(t){const e={},n=/:(.+)/;return t.replace(/\/\*.*?\*\//g,"").split(/;(?![^(]*\))/g).forEach((function(t){if(t){const i=t.split(n);i.length>1&&(e[sG(i[0].trim())]=i[1].trim())}})),e}(this.attributes.style):{},e=/\B([A-Z])/g;return t.setProperty=(n,i,r)=>{if(e.test(n))return;const s=sG(n);i?t[s]=i:delete t[s],"important"===r&&(t[s]+=" !important"),this.attributes.style=nG(t)},t.removeProperty=n=>{if(e.test(n))return"";const i=sG(n),r=t[i]||"";return delete t[i],this.attributes.style=nG(t),r},t}getAttribute(t){return this.attributes[t]||null}setAttribute(t,e){this.attributes[t]=e}setAttributeNS(t,e,n){this.setAttribute(e,n)}removeAttribute(t){delete this.attributes[t]}appendChild(t){return this.childNodes.push(t),t.parentNode=this,t.parentElement=this,t}insertBefore(t,e){if(null===e)return this.appendChild(t);const n=this.childNodes.indexOf(e);if(-1==n)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return this.childNodes.splice(n,0,t),t.parentElement=this,t.parentNode=this,t}removeChild(t){const e=this.childNodes.indexOf(t);if(-1===e)throw new Error("Failed to execute 'removeChild' on 'RRElement': The RRNode to be removed is not a child of this RRNode.");return this.childNodes.splice(e,1),t.parentElement=null,t.parentNode=null,t}attachShadow(t){const e=this.ownerDocument.createElement("SHADOWROOT");return this.shadowRoot=e,e}dispatchEvent(t){return!0}toString(){let t="";for(const e in this.attributes)t+=`${e}="${this.attributes[e]}" `;return`${this.tagName} ${t}`}}}function hG(t){return class extends t{constructor(t){super(),this.nodeType=mG.TEXT_NODE,this.nodeName="#text",this.RRNodeType=QW.Text,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRText text=${JSON.stringify(this.data)}`}}}function dG(t){return class extends t{constructor(t){super(),this.nodeType=mG.COMMENT_NODE,this.nodeName="#comment",this.RRNodeType=QW.Comment,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRComment text=${JSON.stringify(this.data)}`}}}function pG(t){return class extends t{constructor(t){super(),this.nodeName="#cdata-section",this.nodeType=mG.CDATA_SECTION_NODE,this.RRNodeType=QW.CDATA,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRCDATASection data=${JSON.stringify(this.data)}`}}}class fG{constructor(t,e){if(this.classes=[],this.add=(...t)=>{for(const e of t){const t=String(e);this.classes.indexOf(t)>=0||this.classes.push(t)}this.onChange&&this.onChange(this.classes.join(" "))},this.remove=(...t)=>{this.classes=this.classes.filter((e=>-1===t.indexOf(e))),this.onChange&&this.onChange(this.classes.join(" "))},t){const e=t.trim().split(/\s+/);this.classes.push(...e)}this.onChange=e}}var mG;!function(t){t[t.PLACEHOLDER=0]="PLACEHOLDER",t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",t[t.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",t[t.ENTITY_NODE=6]="ENTITY_NODE",t[t.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.DOCUMENT_NODE=9]="DOCUMENT_NODE",t[t.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",t[t.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(mG||(mG={}));const gG={svg:"http://www.w3.org/2000/svg","xlink:href":"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},vG={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function yG(t,e,n,i){const r=t.childNodes,s=e.childNodes;i=i||e.mirror||e.ownerDocument.mirror,(r.length>0||s.length>0)&&_G(Array.from(r),s,t,n,i);let o=null,a=null;switch(e.RRNodeType){case QW.Document:a=e.scrollData;break;case QW.Element:{const r=t,s=e;switch(function(t,e,n){const i=t.attributes,r=e.attributes;for(const s in r){const i=r[s],o=n.getMeta(e);if(o&&"isSVG"in o&&o.isSVG&&gG[s])t.setAttributeNS(gG[s],s,i);else if("CANVAS"===e.tagName&&"rr_dataURL"===s){const e=document.createElement("img");e.src=i,e.onload=()=>{const n=t.getContext("2d");n&&n.drawImage(e,0,0,e.width,e.height)}}else t.setAttribute(s,i)}for(const{name:s}of Array.from(i))s in r||t.removeAttribute(s);e.scrollLeft&&(t.scrollLeft=e.scrollLeft),e.scrollTop&&(t.scrollTop=e.scrollTop)}(r,s,i),a=s.scrollData,o=s.inputData,s.tagName){case"AUDIO":case"VIDEO":{const e=t,n=s;void 0!==n.paused&&(n.paused?e.pause():e.play()),void 0!==n.muted&&(e.muted=n.muted),void 0!==n.volume&&(e.volume=n.volume),void 0!==n.currentTime&&(e.currentTime=n.currentTime),void 0!==n.playbackRate&&(e.playbackRate=n.playbackRate);break}case"CANVAS":{const i=e;if(null!==i.rr_dataURL){const t=document.createElement("img");t.onload=()=>{const e=r.getContext("2d");e&&e.drawImage(t,0,0,t.width,t.height)},t.src=i.rr_dataURL}i.canvasMutations.forEach((e=>n.applyCanvas(e.event,e.mutation,t)))}break;case"STYLE":{const t=r.sheet;t&&e.rules.forEach((e=>n.applyStyleSheetMutation(e,t)))}}if(s.shadowRoot){r.shadowRoot||r.attachShadow({mode:"open"});const t=r.shadowRoot.childNodes,e=s.shadowRoot.childNodes;(t.length>0||e.length>0)&&_G(Array.from(t),e,r.shadowRoot,n,i)}break}case QW.Text:case QW.Comment:case QW.CDATA:t.textContent!==e.data&&(t.textContent=e.data)}if(a&&n.applyScroll(a,!0),o&&n.applyInput(o),"IFRAME"===e.nodeName){const r=t.contentDocument,s=e;if(r){const t=i.getMeta(s.contentDocument);t&&n.mirror.add(r,Object.assign({},t)),yG(r,s.contentDocument,n,i)}}}function _G(t,e,n,i,r){var s;let o,a,l=0,c=t.length-1,u=0,h=e.length-1,d=t[l],p=t[c],f=e[u],m=e[h];for(;l<=c&&u<=h;){const g=i.mirror.getId(d),v=i.mirror.getId(p),y=r.getId(f),_=r.getId(m);if(void 0===d)d=t[++l];else if(void 0===p)p=t[--c];else if(-1!==g&&g===y)yG(d,f,i,r),d=t[++l],f=e[++u];else if(-1!==v&&v===_)yG(p,m,i,r),p=t[--c],m=e[--h];else if(-1!==g&&g===_)n.insertBefore(d,p.nextSibling),yG(d,m,i,r),d=t[++l],m=e[--h];else if(-1!==v&&v===y)n.insertBefore(p,d),yG(p,f,i,r),p=t[--c],f=e[++u];else{if(!o){o={};for(let e=l;e<=c;e++){const n=t[e];n&&i.mirror.hasNode(n)&&(o[i.mirror.getId(n)]=e)}}if(a=o[r.getId(f)],a){const e=t[a];n.insertBefore(e,d),yG(e,f,i,r),t[a]=void 0}else{const e=bG(f,i.mirror,r);"#document"===n.nodeName&&(null===(s=i.mirror.getMeta(e))||void 0===s?void 0:s.type)===QW.Element&&n.documentElement&&(n.removeChild(n.documentElement),t[l]=void 0,d=void 0),n.insertBefore(e,d||null),yG(e,f,i,r)}f=e[++u]}}if(l>c){const t=e[h+1];let s=null;for(t&&n.childNodes.forEach((e=>{i.mirror.getId(e)===r.getId(t)&&(s=e)}));u<=h;++u){const t=bG(e[u],i.mirror,r);n.insertBefore(t,s),yG(t,e[u],i,r)}}else if(u>h)for(;l<=c;l++){const e=t[l];e&&(n.removeChild(e),i.mirror.removeNodeFromMap(e))}}function bG(t,e,n){const i=n.getId(t),r=n.getMeta(t);let s=null;if(i>-1&&(s=e.getNode(i)),null!==s)return s;switch(t.RRNodeType){case QW.Document:s=new Document;break;case QW.DocumentType:s=document.implementation.createDocumentType(t.name,t.publicId,t.systemId);break;case QW.Element:{let e=t.tagName.toLowerCase();e=vG[e]||e,s=r&&"isSVG"in r&&(null==r?void 0:r.isSVG)?document.createElementNS(gG.svg,e):document.createElement(t.tagName);break}case QW.Text:s=document.createTextNode(t.data);break;case QW.Comment:s=document.createComment(t.data);break;case QW.CDATA:s=document.createCDATASection(t.data)}return r&&e.add(s,Object.assign({},r)),s}class xG extends(function(t){return class e extends t{constructor(){super(...arguments),this.nodeType=mG.DOCUMENT_NODE,this.nodeName="#document",this.compatMode="CSS1Compat",this.RRNodeType=QW.Document,this.textContent=null}get documentElement(){return this.childNodes.find((t=>t.RRNodeType===QW.Element&&"HTML"===t.tagName))||null}get body(){var t;return(null===(t=this.documentElement)||void 0===t?void 0:t.childNodes.find((t=>t.RRNodeType===QW.Element&&"BODY"===t.tagName)))||null}get head(){var t;return(null===(t=this.documentElement)||void 0===t?void 0:t.childNodes.find((t=>t.RRNodeType===QW.Element&&"HEAD"===t.tagName)))||null}get implementation(){return this}get firstElementChild(){return this.documentElement}appendChild(t){const e=t.RRNodeType;if((e===QW.Element||e===QW.DocumentType)&&this.childNodes.some((t=>t.RRNodeType===e)))throw new Error(`RRDomException: Failed to execute 'appendChild' on 'RRNode': Only one ${e===QW.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);return t.parentElement=null,t.parentNode=this,this.childNodes.push(t),t}insertBefore(t,e){const n=t.RRNodeType;if((n===QW.Element||n===QW.DocumentType)&&this.childNodes.some((t=>t.RRNodeType===n)))throw new Error(`RRDomException: Failed to execute 'insertBefore' on 'RRNode': Only one ${n===QW.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);if(null===e)return this.appendChild(t);const i=this.childNodes.indexOf(e);if(-1==i)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return this.childNodes.splice(i,0,t),t.parentElement=null,t.parentNode=this,t}removeChild(t){const e=this.childNodes.indexOf(t);if(-1===e)throw new Error("Failed to execute 'removeChild' on 'RRDocument': The RRNode to be removed is not a child of this RRNode.");return this.childNodes.splice(e,1),t.parentElement=null,t.parentNode=null,t}open(){this.childNodes=[]}close(){}write(t){let e;if('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'===t?e="-//W3C//DTD XHTML 1.0 Transitional//EN":'<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">'===t&&(e="-//W3C//DTD HTML 4.0 Transitional//EN"),e){const t=this.createDocumentType("html",e,"");this.open(),this.appendChild(t)}}createDocument(t,n,i){return new e}createDocumentType(t,e,n){const i=new(cG(lG))(t,e,n);return i.ownerDocument=this,i}createElement(t){const e=new(uG(lG))(t);return e.ownerDocument=this,e}createElementNS(t,e){return this.createElement(e)}createTextNode(t){const e=new(hG(lG))(t);return e.ownerDocument=this,e}createComment(t){const e=new(dG(lG))(t);return e.ownerDocument=this,e}createCDATASection(t){const e=new(pG(lG))(t);return e.ownerDocument=this,e}toString(){return"RRDocument"}}}(lG)){constructor(t){super(),this.UNSERIALIZED_STARTING_ID=-2,this._unserializedId=this.UNSERIALIZED_STARTING_ID,this.mirror=new DG,this.scrollData=null,t&&(this.mirror=t)}get unserializedId(){return this._unserializedId--}createDocument(t,e,n){return new xG}createDocumentType(t,e,n){const i=new wG(t,e,n);return i.ownerDocument=this,i}createElement(t){const e=t.toUpperCase();let n;switch(e){case"AUDIO":case"VIDEO":n=new MG(e);break;case"IFRAME":n=new TG(e,this.mirror);break;case"CANVAS":n=new CG(e);break;case"STYLE":n=new AG(e);break;default:n=new SG(e)}return n.ownerDocument=this,n}createComment(t){const e=new IG(t);return e.ownerDocument=this,e}createCDATASection(t){const e=new RG(t);return e.ownerDocument=this,e}createTextNode(t){const e=new EG(t);return e.ownerDocument=this,e}destroyTree(){this.childNodes=[],this.mirror.reset()}open(){super.open(),this._unserializedId=this.UNSERIALIZED_STARTING_ID}}const wG=cG(lG);class SG extends(uG(lG)){constructor(){super(...arguments),this.inputData=null,this.scrollData=null}}class MG extends(function(t){return class extends t{attachShadow(t){throw new Error("RRDomException: Failed to execute 'attachShadow' on 'RRElement': This RRElement does not support attachShadow")}play(){this.paused=!1}pause(){this.paused=!0}}}(SG)){}class CG extends SG{constructor(){super(...arguments),this.rr_dataURL=null,this.canvasMutations=[]}getContext(){return null}}class AG extends SG{constructor(){super(...arguments),this.rules=[]}}class TG extends SG{constructor(t,e){super(t),this.contentDocument=new xG,this.contentDocument.mirror=e}}const EG=hG(lG),IG=dG(lG),RG=pG(lG);function NG(t,e,n,i){let r;switch(t.nodeType){case mG.DOCUMENT_NODE:i&&"IFRAME"===i.nodeName?r=i.contentDocument:(r=e,r.compatMode=t.compatMode);break;case mG.DOCUMENT_TYPE_NODE:{const n=t;r=e.createDocumentType(n.name,n.publicId,n.systemId);break}case mG.ELEMENT_NODE:{const n=t,i=(s=n)instanceof HTMLFormElement?"FORM":s.tagName.toUpperCase();r=e.createElement(i);const o=r;for(const{name:t,value:e}of Array.from(n.attributes))o.attributes[t]=e;n.scrollLeft&&(o.scrollLeft=n.scrollLeft),n.scrollTop&&(o.scrollTop=n.scrollTop);break}case mG.TEXT_NODE:r=e.createTextNode(t.textContent||"");break;case mG.CDATA_SECTION_NODE:r=e.createCDATASection(t.data);break;case mG.COMMENT_NODE:r=e.createComment(t.textContent||"");break;case mG.DOCUMENT_FRAGMENT_NODE:r=i.attachShadow({mode:"open"});break;default:return null}var s;let o=n.getMeta(t);return e instanceof xG&&(o||(o=LG(r,e.unserializedId),n.add(t,o)),e.mirror.add(r,Object.assign({},o))),r}class DG{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var e;if(!t)return-1;const n=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=n?n:-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const e=this.getId(t);this.idNodeMap.delete(e),t.childNodes&&t.childNodes.forEach((t=>this.removeNodeFromMap(t)))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,e){const n=e.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,e)}replace(t,e){const n=this.getNode(t);if(n){const t=this.nodeMetaMap.get(n);t&&this.nodeMetaMap.set(e,t)}this.idNodeMap.set(t,e)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function LG(t,e){switch(t.RRNodeType){case QW.Document:return{id:e,type:t.RRNodeType,childNodes:[]};case QW.DocumentType:{const n=t;return{id:e,type:t.RRNodeType,name:n.name,publicId:n.publicId,systemId:n.systemId}}case QW.Element:return{id:e,type:t.RRNodeType,tagName:t.tagName.toLowerCase(),attributes:{},childNodes:[]};case QW.Text:case QW.Comment:return{id:e,type:t.RRNodeType,textContent:t.textContent||""};case QW.CDATA:return{id:e,type:t.RRNodeType,textContent:""}}}var OG=Uint8Array,kG=Uint16Array,PG=Uint32Array,FG=new OG([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),BG=new OG([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zG=new OG([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UG=function(t,e){for(var n=new kG(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var r=new PG(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},VG=UG(FG,2),WG=VG[0],GG=VG[1];WG[28]=258,GG[258]=28;for(var HG=UG(BG,0)[0],jG=new kG(32768),qG=0;qG<32768;++qG){var XG=(43690&qG)>>>1|(21845&qG)<<1;XG=(61680&(XG=(52428&XG)>>>2|(13107&XG)<<2))>>>4|(3855&XG)<<4,jG[qG]=((65280&XG)>>>8|(255&XG)<<8)>>>1}var YG=function(t,e,n){for(var i=t.length,r=0,s=new kG(e);r<i;++r)++s[t[r]-1];var o,a=new kG(e);for(r=0;r<e;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new kG(1<<e);var l=15-e;for(r=0;r<i;++r)if(t[r])for(var c=r<<4|t[r],u=e-t[r],h=a[t[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)o[jG[h]>>>l]=c}else for(o=new kG(i),r=0;r<i;++r)o[r]=jG[a[t[r]-1]++]>>>15-t[r];return o},ZG=new OG(288);for(qG=0;qG<144;++qG)ZG[qG]=8;for(qG=144;qG<256;++qG)ZG[qG]=9;for(qG=256;qG<280;++qG)ZG[qG]=7;for(qG=280;qG<288;++qG)ZG[qG]=8;var KG=new OG(32);for(qG=0;qG<32;++qG)KG[qG]=5;var $G=YG(ZG,9,1),JG=YG(KG,5,1),QG=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},tH=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>>(7&e)&n},eH=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>>(7&e)},nH=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var i=new(t instanceof kG?kG:t instanceof PG?PG:OG)(n-e);return i.set(t.subarray(e,n)),i};const iH=t=>{if("string"!=typeof t)return t;try{const e=JSON.parse(t);if(e.timestamp)return e}catch(e){}try{const e=JSON.parse(function(t,e){var n="";if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var i=0;i<t.length;){var r=t[i++];r<128?n+=String.fromCharCode(r):r<224?n+=String.fromCharCode((31&r)<<6|63&t[i++]):r<240?n+=String.fromCharCode((15&r)<<12|(63&t[i++])<<6|63&t[i++]):(r=((15&r)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536,n+=String.fromCharCode(55296|r>>10,56320|1023&r))}return n}(function(t,e){return function(t,e,n){var i=t.length,r=!e||n,s=!n||n.i;n||(n={}),e||(e=new OG(3*i));var o,a=function(t){var n=e.length;if(t>n){var i=new OG(Math.max(2*n,t));i.set(e),e=i}},l=n.f||0,c=n.p||0,u=n.b||0,h=n.l,d=n.d,p=n.m,f=n.n,m=8*i;do{if(!h){n.f=l=tH(t,c,1);var g=tH(t,c+1,3);if(c+=3,!g){var v=t[(E=((o=c)/8|0)+(7&o&&1)+4)-4]|t[E-3]<<8,y=E+v;if(y>i){if(s)throw"unexpected EOF";break}r&&a(u+v),e.set(t.subarray(E,y),u),n.b=u+=v,n.p=c=8*y;continue}if(1==g)h=$G,d=JG,p=9,f=5;else{if(2!=g)throw"invalid block type";var _=tH(t,c,31)+257,b=tH(t,c+10,15)+4,x=_+tH(t,c+5,31)+1;c+=14;for(var w=new OG(x),S=new OG(19),M=0;M<b;++M)S[zG[M]]=tH(t,c+3*M,7);c+=3*b;var C=QG(S),A=(1<<C)-1;if(!s&&c+x*(C+7)>m)break;var T=YG(S,C,1);for(M=0;M<x;){var E,I=T[tH(t,c,A)];if(c+=15&I,(E=I>>>4)<16)w[M++]=E;else{var R=0,N=0;for(16==E?(N=3+tH(t,c,3),c+=2,R=w[M-1]):17==E?(N=3+tH(t,c,7),c+=3):18==E&&(N=11+tH(t,c,127),c+=7);N--;)w[M++]=R}}var D=w.subarray(0,_),L=w.subarray(_);p=QG(D),f=QG(L),h=YG(D,p,1),d=YG(L,f,1)}if(c>m)throw"unexpected EOF"}r&&a(u+131072);for(var O=(1<<p)-1,k=(1<<f)-1,P=p+f+18;s||c+P<m;){var F=(R=h[eH(t,c)&O])>>>4;if((c+=15&R)>m)throw"unexpected EOF";if(!R)throw"invalid length/literal";if(F<256)e[u++]=F;else{if(256==F){h=null;break}var B=F-254;if(F>264){var z=FG[M=F-257];B=tH(t,c,(1<<z)-1)+WG[M],c+=z}var U=d[eH(t,c)&k],V=U>>>4;if(!U)throw"invalid distance";if(c+=15&U,L=HG[V],V>3&&(z=BG[V],L+=eH(t,c)&(1<<z)-1,c+=z),c>m)throw"unexpected EOF";r&&a(u+131072);for(var W=u+B;u<W;u+=4)e[u]=e[u-L],e[u+1]=e[u+1-L],e[u+2]=e[u+2-L],e[u+3]=e[u+3-L];u=W}}n.l=h,n.p=c,n.b=u,h&&(l=1,n.m=p,n.d=d,n.n=f)}while(!l);return u==e.length?e:nH(e,0,u)}((function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"}(t),t.subarray(2,-4)),e)}(function(t,e){var n=t.length;for(var i=new OG(t.length+(t.length>>>1)),r=0,s=function(t){i[r++]=t},o=0;o<n;++o){if(r+5>i.length){var a=new OG(r+8+(n-o<<1));a.set(i),i=a}var l=t.charCodeAt(o);s(l)}return nH(i,0,r)}(t))));if("v1"===e.v)return e;throw new Error(`These events were packed with packer ${e.v} which is incompatible with current packer v1.`)}catch(e){throw new Error("Unknown data format.")}};function rH(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map((function(t){t(n)})),(i=t.get("*"))&&i.slice().map((function(t){t(e,n)}))}}}var sH,oH=Object.freeze({__proto__:null,default:rH});function aH(t=window,e=document){if("scrollBehavior"in e.documentElement.style&&!0!==t.__forceSmoothScrollPolyfill__)return;const n=t.HTMLElement||t.Element,i={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:n.prototype.scroll||a,scrollIntoView:n.prototype.scrollIntoView},r=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,s=(o=t.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(o)?1:0);var o;function a(t,e){this.scrollLeft=t,this.scrollTop=e}function l(t){if(null===t||"object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return!0;if("object"==typeof t&&"smooth"===t.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+t.behavior+" is not a valid value for enumeration ScrollBehavior.")}function c(t,e){return"Y"===e?t.clientHeight+s<t.scrollHeight:"X"===e?t.clientWidth+s<t.scrollWidth:void 0}function u(e,n){const i=t.getComputedStyle(e,null)["overflow"+n];return"auto"===i||"scroll"===i}function h(t){const e=c(t,"Y")&&u(t,"Y"),n=c(t,"X")&&u(t,"X");return e||n}function d(e){let n,i,s,o=(r()-e.startTime)/468;var a;o=o>1?1:o,a=o,n=.5*(1-Math.cos(Math.PI*a)),i=e.startX+(e.x-e.startX)*n,s=e.startY+(e.y-e.startY)*n,e.method.call(e.scrollable,i,s),i===e.x&&s===e.y||t.requestAnimationFrame(d.bind(t,e))}function p(n,s,o){let l,c,u,h;const p=r();n===e.body?(l=t,c=t.scrollX||t.pageXOffset,u=t.scrollY||t.pageYOffset,h=i.scroll):(l=n,c=n.scrollLeft,u=n.scrollTop,h=a),d({scrollable:l,method:h,startTime:p,startX:c,startY:u,x:s,y:o})}t.scroll=t.scrollTo=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?p.call(t,e.body,void 0!==arguments[0].left?~~arguments[0].left:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:t.scrollY||t.pageYOffset):i.scroll.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:t.scrollY||t.pageYOffset))},t.scrollBy=function(){void 0!==arguments[0]&&(l(arguments[0])?i.scrollBy.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):p.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset)))},n.prototype.scroll=n.prototype.scrollTo=function(){if(void 0===arguments[0])return;if(!0===l(arguments[0])){if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");return void i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}const t=arguments[0].left,e=arguments[0].top;p.call(this,this,void 0===t?this.scrollLeft:~~t,void 0===e?this.scrollTop:~~e)},n.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},n.prototype.scrollIntoView=function(){if(!0===l(arguments[0]))return void i.scrollIntoView.call(this,void 0===arguments[0]||arguments[0]);const n=function(t){for(;t!==e.body&&!1===h(t);)t=t.parentNode||t.host;return t}(this),r=n.getBoundingClientRect(),s=this.getBoundingClientRect();n!==e.body?(p.call(this,n,n.scrollLeft+s.left-r.left,n.scrollTop+s.top-r.top),"fixed"!==t.getComputedStyle(n).position&&t.scrollBy({left:r.left,top:r.top,behavior:"smooth"})):t.scrollBy({left:s.left,top:s.top,behavior:"smooth"})}}class lH{constructor(t=[],e){this.timeOffset=0,this.raf=null,this.actions=t,this.speed=e.speed,this.liveMode=e.liveMode}addAction(t){if(!this.actions.length||this.actions[this.actions.length-1].delay<=t.delay)return void this.actions.push(t);const e=this.findActionIndex(t);this.actions.splice(e,0,t)}start(){this.timeOffset=0;let t=performance.now();const e=()=>{const n=performance.now();for(this.timeOffset+=(n-t)*this.speed,t=n;this.actions.length;){const t=this.actions[0];if(!(this.timeOffset>=t.delay))break;this.actions.shift(),t.doAction()}(this.actions.length>0||this.liveMode)&&(this.raf=requestAnimationFrame(e))};this.raf=requestAnimationFrame(e)}clear(){this.raf&&(cancelAnimationFrame(this.raf),this.raf=null),this.actions.length=0}setSpeed(t){this.speed=t}toggleLiveMode(t){this.liveMode=t}isActive(){return null!==this.raf}findActionIndex(t){let e=0,n=this.actions.length-1;for(;e<=n;){const i=Math.floor((e+n)/2);if(this.actions[i].delay<t.delay)e=i+1;else{if(!(this.actions[i].delay>t.delay))return i+1;n=i-1}}return e}}function cH(t,e){if(t.type===HW.IncrementalSnapshot&&t.data.source===jW.MouseMove&&t.data.positions&&t.data.positions.length){const n=t.data.positions[0].timeOffset,i=t.timestamp+n;return t.delay=i-e,i-e}return t.delay=t.timestamp-e,t.delay
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */}function uH(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(sH||(sH={}));var hH={type:"xstate.init"};function dH(t){return void 0===t?[]:[].concat(t)}function pH(t){return{type:"xstate.assign",assignment:t}}function fH(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function mH(t){return function(e){return t===e}}function gH(t){return"string"==typeof t?{type:t}:t}function vH(t,e){return{value:t,context:e,actions:[],changed:!1,matches:mH(t)}}function yH(t,e,n){var i=e,r=!1;return[t.filter((function(t){if("xstate.assign"===t.type){r=!0;var e=Object.assign({},i);return"function"==typeof t.assignment?e=t.assignment(i,n):Object.keys(t.assignment).forEach((function(r){e[r]="function"==typeof t.assignment[r]?t.assignment[r](i,n):t.assignment[r]})),i=e,!1}return!0})),i,r]}function _H(t,e){void 0===e&&(e={});var n=uH(yH(dH(t.states[t.initial].entry).map((function(t){return fH(t,e.actions)})),t.context,hH),2),i=n[0],r=n[1],s={config:t,_options:e,initialState:{value:t.initial,actions:i,context:r,matches:mH(t.initial)},transition:function(e,n){var i,r,o="string"==typeof e?{value:e,context:t.context}:e,a=o.value,l=o.context,c=gH(n),u=t.states[a];if(u.on){var h=dH(u.on[c.type]);try{for(var d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(h),p=d.next();!p.done;p=d.next()){var f=p.value;if(void 0===f)return vH(a,l);var m="string"==typeof f?{target:f}:f,g=m.target,v=m.actions,y=void 0===v?[]:v,_=m.cond,b=void 0===_?function(){return!0}:_,x=void 0===g,w=null!=g?g:a,S=t.states[w];if(b(l,c)){var M=uH(yH((x?dH(y):[].concat(u.exit,y,S.entry).filter((function(t){return t}))).map((function(t){return fH(t,s._options.actions)})),l,c),3),C=M[0],A=M[1],T=M[2],E=null!=g?g:a;return{value:E,context:A,actions:C,changed:g!==a||C.length>0||T,matches:mH(E)}}}}catch(I){i={error:I}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(i)throw i.error}}}return vH(a,l)}};return s}var bH=function(t,e){return t.actions.forEach((function(n){var i=n.exec;return i&&i(t.context,e)}))};function xH(t){var e=t.initialState,n=sH.NotStarted,i=new Set,r={_machine:t,send:function(r){n===sH.Running&&(e=t.transition(e,r),bH(e,gH(r)),i.forEach((function(t){return t(e)})))},subscribe:function(t){return i.add(t),t(e),{unsubscribe:function(){return i.delete(t)}}},start:function(i){if(i){var s="object"==typeof i?i:{context:t.config.context,value:i};e={value:s.value,actions:[],context:s.context,matches:mH(s.value)}}return n=sH.Running,bH(e,hH),r},stop:function(){return n=sH.Stopped,i.clear(),r},get state(){return e},get status(){return n}};return r}const wH=new Map;function SH(t,e){let n=wH.get(t);return n||(n=new Map,wH.set(t,n)),n.has(e)||n.set(e,[]),n.get(e)}function MH(t,e,n){return i=>ZW(this,void 0,void 0,(function*(){if(i&&"object"==typeof i&&"rr_type"in i){if(n&&(n.isUnchanged=!1),"ImageBitmap"===i.rr_type&&"args"in i){const r=yield MH(t,e,n)(i.args);return yield createImageBitmap.apply(null,r)}if("index"in i){if(n||null===e)return i;const{rr_type:t,index:r}=i;return SH(e,t)[r]}if("args"in i){const{rr_type:r,args:s}=i;return new window[r](...yield Promise.all(s.map(MH(t,e,n))))}if("base64"in i)return function(t){var e,n,i,r,s,o=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;e<a;e+=4)n=$W[t.charCodeAt(e)],i=$W[t.charCodeAt(e+1)],r=$W[t.charCodeAt(e+2)],s=$W[t.charCodeAt(e+3)],u[l++]=n<<2|i>>4,u[l++]=(15&i)<<4|r>>2,u[l++]=(3&r)<<6|63&s;return c}(i.base64);if("src"in i){const e=t.get(i.src);if(e)return e;{const e=new Image;return e.src=i.src,t.set(i.src,e),e}}if("data"in i&&"Blob"===i.rr_type){const r=yield Promise.all(i.data.map(MH(t,e,n)));return new Blob(r,{type:i.type})}}else if(Array.isArray(i))return yield Promise.all(i.map(MH(t,e,n)));return i}))}const CH=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject"];function AH({mutation:t,target:e,type:n,imageMap:i,errorHandler:r}){return ZW(this,void 0,void 0,(function*(){try{const r=function(t,e){try{return e===XW.WebGL?t.getContext("webgl")||t.getContext("experimental-webgl"):t.getContext("webgl2")}catch(n){return null}}(e,n);if(!r)return;if(t.setter)return void(r[t.property]=t.args[0]);const s=r[t.property],o=yield Promise.all(t.args.map(MH(i,r)));!function(t,e){if(!(null==e?void 0:e.constructor))return;const{name:n}=e.constructor;if(!CH.includes(n))return;const i=SH(t,n);i.includes(e)||i.push(e)}(r,s.apply(r,o))}catch(s){r(t,s)}}))}function TH({event:t,mutation:e,target:n,imageMap:i,errorHandler:r}){return ZW(this,void 0,void 0,(function*(){try{const r=n.getContext("2d");if(e.setter)return void(r[e.property]=e.args[0]);const s=r[e.property];if("drawImage"===e.property&&"string"==typeof e.args[0])i.get(t),s.apply(r,e.args);else{const t=yield Promise.all(e.args.map(MH(i,r)));s.apply(r,t)}}catch(s){r(e,s)}}))}function EH({event:t,mutation:e,target:n,imageMap:i,canvasEventMap:r,errorHandler:s}){return ZW(this,void 0,void 0,(function*(){try{const o=r.get(t)||e,a="commands"in o?o.commands:[o];if([XW.WebGL,XW.WebGL2].includes(e.type)){for(let t=0;t<a.length;t++){const r=a[t];yield AH({mutation:r,type:e.type,target:n,imageMap:i,errorHandler:s})}return}for(let e=0;e<a.length;e++){const r=a[e];yield TH({event:t,mutation:r,target:n,imageMap:i,errorHandler:s})}}catch(o){s(e,o)}}))}const IH=rH||oH,RH={duration:500,lineCap:"round",lineWidth:3,strokeStyle:"red"};function NH(t){return t.type==HW.IncrementalSnapshot&&(t.data.source==jW.TouchMove||t.data.source==jW.MouseInteraction&&t.data.type==qW.TouchStart)}class DH{constructor(t,e){if(this.usingVirtualDom=!1,this.virtualDom=new xG,this.mouseTail=null,this.tailPositions=[],this.emitter=IH(),this.legacy_missingNodeRetryMap={},this.cache=LW(),this.imageMap=new Map,this.canvasEventMap=new Map,this.mirror=MW(),this.styleMirror=new GW,this.firstFullSnapshot=null,this.newDocumentQueue=[],this.mousePos=null,this.touchActive=null,this.lastSelectionData=null,this.constructedStyleMutations=[],this.adoptedStyleSheets=[],this.handleResize=t=>{this.iframe.style.display="inherit";for(const e of[this.mouseTail,this.iframe])e&&(e.setAttribute("width",String(t.width)),e.setAttribute("height",String(t.height)))},this.applyEventsSynchronously=t=>{for(const e of t){switch(e.type){case HW.DomContentLoaded:case HW.Load:case HW.Custom:continue;case HW.FullSnapshot:case HW.Meta:case HW.Plugin:case HW.IncrementalSnapshot:}this.getCastFn(e,!0)()}!0===this.touchActive?this.mouse.classList.add("touch-active"):!1===this.touchActive&&this.mouse.classList.remove("touch-active"),this.touchActive=null},this.getCastFn=(t,e=!1)=>{let n;switch(t.type){case HW.DomContentLoaded:case HW.Load:break;case HW.Custom:n=()=>{this.emitter.emit(YW.CustomEvent,t)};break;case HW.Meta:n=()=>this.emitter.emit(YW.Resize,{width:t.data.width,height:t.data.height});break;case HW.FullSnapshot:n=()=>{var n;if(this.firstFullSnapshot){if(this.firstFullSnapshot===t)return void(this.firstFullSnapshot=!0)}else this.firstFullSnapshot=!0;this.rebuildFullSnapshot(t,e),null===(n=this.iframe.contentWindow)||void 0===n||n.scrollTo(t.data.initialOffset),this.styleMirror.reset()};break;case HW.IncrementalSnapshot:n=()=>{if(this.applyIncremental(t,e),!e&&(t===this.nextUserInteractionEvent&&(this.nextUserInteractionEvent=null,this.backToNormal()),this.config.skipInactive&&!this.nextUserInteractionEvent)){for(const e of this.service.state.context.events)if(!(e.timestamp<=t.timestamp)&&this.isUserInteraction(e)){e.delay-t.delay>1e4*this.speedService.state.context.timer.speed&&(this.nextUserInteractionEvent=e);break}if(this.nextUserInteractionEvent){const e=this.nextUserInteractionEvent.delay-t.delay,n={speed:Math.min(Math.round(e/5e3),this.config.maxSpeed)};this.speedService.send({type:"FAST_FORWARD",payload:n}),this.emitter.emit(YW.SkipStart,n)}}}}return()=>{n&&n();for(const n of this.config.plugins||[])n.handler&&n.handler(t,e,{replayer:this});this.service.send({type:"CAST_EVENT",payload:{event:t}});const i=this.service.state.context.events.length-1;if(t===this.service.state.context.events[i]){const e=()=>{i<this.service.state.context.events.length-1||(this.backToNormal(),this.service.send("END"),this.emitter.emit(YW.Finish))};t.type===HW.IncrementalSnapshot&&t.data.source===jW.MouseMove&&t.data.positions.length?setTimeout((()=>{e()}),Math.max(0,50-t.data.positions[0].timeOffset)):e()}this.emitter.emit(YW.EventCast,t)}},!(null==e?void 0:e.liveMode)&&t.length<2)throw new Error("Replayer need at least 2 events.");const n={speed:1,maxSpeed:360,root:document.body,loadTimeout:0,skipInactive:!1,showWarning:!0,showDebug:!1,blockClass:"rr-block",liveMode:!1,insertStyleRules:[],triggerFocus:!0,UNSAFE_replayCanvas:!1,pauseAnimation:!0,mouseTail:RH,useVirtualDom:!0};this.config=Object.assign({},n,e),this.handleResize=this.handleResize.bind(this),this.getCastFn=this.getCastFn.bind(this),this.applyEventsSynchronously=this.applyEventsSynchronously.bind(this),this.emitter.on(YW.Resize,this.handleResize),this.setupDom();for(const o of this.config.plugins||[])o.getMirror&&o.getMirror({nodeMirror:this.mirror});this.emitter.on(YW.Flush,(()=>{if(this.usingVirtualDom){const e={mirror:this.mirror,applyCanvas:(t,e,n)=>{EH({event:t,mutation:e,target:n,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})},applyInput:this.applyInput.bind(this),applyScroll:this.applyScroll.bind(this),applyStyleSheetMutation:(t,e)=>{t.source===jW.StyleSheetRule?this.applyStyleSheetRule(t,e):t.source===jW.StyleDeclaration&&this.applyStyleDeclaration(t,e)}};if(this.iframe.contentDocument&&yG(this.iframe.contentDocument,this.virtualDom,e,this.virtualDom.mirror),this.virtualDom.destroyTree(),this.usingVirtualDom=!1,Object.keys(this.legacy_missingNodeRetryMap).length)for(const n in this.legacy_missingNodeRetryMap)try{const t=this.legacy_missingNodeRetryMap[n],i=bG(t.node,this.mirror,this.virtualDom.mirror);yG(i,t.node,e,this.virtualDom.mirror),t.node=i}catch(t){this.config.showWarning}this.constructedStyleMutations.forEach((t=>{this.applyStyleSheetMutation(t)})),this.constructedStyleMutations=[],this.adoptedStyleSheets.forEach((t=>{this.applyAdoptedStyleSheet(t)})),this.adoptedStyleSheets=[]}this.mousePos&&(this.moveAndHover(this.mousePos.x,this.mousePos.y,this.mousePos.id,!0,this.mousePos.debugData),this.mousePos=null),this.lastSelectionData&&(this.applySelection(this.lastSelectionData),this.lastSelectionData=null)})),this.emitter.on(YW.PlayBack,(()=>{this.firstFullSnapshot=null,this.mirror.reset(),this.styleMirror.reset()}));const i=new lH([],{speed:this.config.speed,liveMode:this.config.liveMode});this.service=function(t,{getCastFn:e,applyEventsSynchronously:n,emitter:i}){const r=_H({id:"player",context:t,initial:"paused",states:{playing:{on:{PAUSE:{target:"paused",actions:["pause"]},CAST_EVENT:{target:"playing",actions:"castEvent"},END:{target:"paused",actions:["resetLastPlayedEvent","pause"]},ADD_EVENT:{target:"playing",actions:["addEvent"]}}},paused:{on:{PLAY:{target:"playing",actions:["recordTimeOffset","play"]},CAST_EVENT:{target:"paused",actions:"castEvent"},TO_LIVE:{target:"live",actions:["startLive"]},ADD_EVENT:{target:"paused",actions:["addEvent"]}}},live:{on:{ADD_EVENT:{target:"live",actions:["addEvent"]},CAST_EVENT:{target:"live",actions:["castEvent"]}}}}},{actions:{castEvent:pH({lastPlayedEvent:(t,e)=>"CAST_EVENT"===e.type?e.payload.event:t.lastPlayedEvent}),recordTimeOffset:pH(((t,e)=>{let n=t.timeOffset;return"payload"in e&&"timeOffset"in e.payload&&(n=e.payload.timeOffset),Object.assign(Object.assign({},t),{timeOffset:n,baselineTime:t.events[0].timestamp+n})})),play(t){var r;const{timer:s,events:o,baselineTime:a,lastPlayedEvent:l}=t;s.clear();for(const e of o)cH(e,a);const c=function(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.type===HW.Meta&&i.timestamp<=e)return t.slice(n)}return t}(o,a);let u=null==l?void 0:l.timestamp;(null==l?void 0:l.type)===HW.IncrementalSnapshot&&l.data.source===jW.MouseMove&&(u=l.timestamp+(null===(r=l.data.positions[0])||void 0===r?void 0:r.timeOffset)),a<(u||0)&&i.emit(YW.PlayBack);const h=new Array;for(const n of c)if(!(u&&u<a&&(n.timestamp<=u||n===l)))if(n.timestamp<a)h.push(n);else{const t=e(n,!1);s.addAction({doAction:()=>{t()},delay:n.delay})}n(h),i.emit(YW.Flush),s.start()},pause(t){t.timer.clear()},resetLastPlayedEvent:pH((t=>Object.assign(Object.assign({},t),{lastPlayedEvent:null}))),startLive:pH({baselineTime:(t,e)=>(t.timer.toggleLiveMode(!0),t.timer.start(),"TO_LIVE"===e.type&&e.payload.baselineTime?e.payload.baselineTime:Date.now())}),addEvent:pH(((t,n)=>{const{baselineTime:i,timer:r,events:s}=t;if("ADD_EVENT"===n.type){const{event:t}=n.payload;cH(t,i);let o=s.length-1;if(!s[o]||s[o].timestamp<=t.timestamp)s.push(t);else{let e=-1,n=0;for(;n<=o;){const e=Math.floor((n+o)/2);s[e].timestamp<=t.timestamp?n=e+1:o=e-1}-1===e&&(e=n),s.splice(e,0,t)}const a=t.timestamp<i,l=e(t,a);a?l():r.isActive()&&r.addAction({doAction:()=>{l()},delay:t.delay})}return Object.assign(Object.assign({},t),{events:s})}))}});return xH(r)}({events:t.map((t=>e&&e.unpackFn?e.unpackFn(t):t)).sort(((t,e)=>t.timestamp-e.timestamp)),timer:i,timeOffset:0,baselineTime:0,lastPlayedEvent:null},{getCastFn:this.getCastFn,applyEventsSynchronously:this.applyEventsSynchronously,emitter:this.emitter}),this.service.start(),this.service.subscribe((t=>{this.emitter.emit(YW.StateChange,{player:t})})),this.speedService=xH(_H({id:"speed",context:{normalSpeed:-1,timer:i},initial:"normal",states:{normal:{on:{FAST_FORWARD:{target:"skipping",actions:["recordSpeed","setSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}},skipping:{on:{BACK_TO_NORMAL:{target:"normal",actions:["restoreSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}}}},{actions:{setSpeed:(t,e)=>{"payload"in e&&t.timer.setSpeed(e.payload.speed)},recordSpeed:pH({normalSpeed:t=>t.timer.speed}),restoreSpeed:t=>{t.timer.setSpeed(t.normalSpeed)}}})),this.speedService.start(),this.speedService.subscribe((t=>{this.emitter.emit(YW.StateChange,{speed:t})}));const r=this.service.state.context.events.find((t=>t.type===HW.Meta)),s=this.service.state.context.events.find((t=>t.type===HW.FullSnapshot));if(r){const{width:t,height:e}=r.data;setTimeout((()=>{this.emitter.emit(YW.Resize,{width:t,height:e})}),0)}s&&setTimeout((()=>{var t;this.firstFullSnapshot||(this.firstFullSnapshot=s,this.rebuildFullSnapshot(s),null===(t=this.iframe.contentWindow)||void 0===t||t.scrollTo(s.data.initialOffset))}),1),this.service.state.context.events.find(NH)&&this.mouse.classList.add("touch-device")}get timer(){return this.service.state.context.timer}on(t,e){return this.emitter.on(t,e),this}off(t,e){return this.emitter.off(t,e),this}setConfig(t){Object.keys(t).forEach((e=>{t[e],this.config[e]=t[e]})),this.config.skipInactive||this.backToNormal(),void 0!==t.speed&&this.speedService.send({type:"SET_SPEED",payload:{speed:t.speed}}),void 0!==t.mouseTail&&(!1===t.mouseTail?this.mouseTail&&(this.mouseTail.style.display="none"):(this.mouseTail||(this.mouseTail=document.createElement("canvas"),this.mouseTail.width=Number.parseFloat(this.iframe.width),this.mouseTail.height=Number.parseFloat(this.iframe.height),this.mouseTail.classList.add("replayer-mouse-tail"),this.wrapper.insertBefore(this.mouseTail,this.iframe)),this.mouseTail.style.display="inherit"))}getMetaData(){const t=this.service.state.context.events[0],e=this.service.state.context.events[this.service.state.context.events.length-1];return{startTime:t.timestamp,endTime:e.timestamp,totalTime:e.timestamp-t.timestamp}}getCurrentTime(){return this.timer.timeOffset+this.getTimeOffset()}getTimeOffset(){const{baselineTime:t,events:e}=this.service.state.context;return t-e[0].timestamp}getMirror(){return this.mirror}play(t=0){var e,n;this.service.state.matches("paused")||this.service.send({type:"PAUSE"}),this.service.send({type:"PLAY",payload:{timeOffset:t}}),null===(n=null===(e=this.iframe.contentDocument)||void 0===e?void 0:e.getElementsByTagName("html")[0])||void 0===n||n.classList.remove("rrweb-paused"),this.emitter.emit(YW.Start)}pause(t){var e,n;void 0===t&&this.service.state.matches("playing")&&this.service.send({type:"PAUSE"}),"number"==typeof t&&(this.play(t),this.service.send({type:"PAUSE"})),null===(n=null===(e=this.iframe.contentDocument)||void 0===e?void 0:e.getElementsByTagName("html")[0])||void 0===n||n.classList.add("rrweb-paused"),this.emitter.emit(YW.Pause)}resume(t=0){this.play(t),this.emitter.emit(YW.Resume)}destroy(){this.pause(),this.config.root.removeChild(this.wrapper),this.emitter.emit(YW.Destroy)}startLive(t){this.service.send({type:"TO_LIVE",payload:{baselineTime:t}})}addEvent(t){const e=this.config.unpackFn?this.config.unpackFn(t):t;NH(e)&&this.mouse.classList.add("touch-device"),Promise.resolve().then((()=>this.service.send({type:"ADD_EVENT",payload:{event:e}})))}enableInteract(){this.iframe.setAttribute("scrolling","auto"),this.iframe.style.pointerEvents="auto"}disableInteract(){this.iframe.setAttribute("scrolling","no"),this.iframe.style.pointerEvents="none"}resetCache(){this.cache=LW()}setupDom(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("replayer-wrapper"),this.config.root.appendChild(this.wrapper),this.mouse=document.createElement("div"),this.mouse.classList.add("replayer-mouse"),this.wrapper.appendChild(this.mouse),!1!==this.config.mouseTail&&(this.mouseTail=document.createElement("canvas"),this.mouseTail.classList.add("replayer-mouse-tail"),this.mouseTail.style.display="inherit",this.wrapper.appendChild(this.mouseTail)),this.iframe=document.createElement("iframe");const t=["allow-same-origin"];this.config.UNSAFE_replayCanvas&&t.push("allow-scripts"),this.iframe.style.display="none",this.iframe.setAttribute("sandbox",t.join(" ")),this.disableInteract(),this.wrapper.appendChild(this.iframe),this.iframe.contentWindow&&this.iframe.contentDocument&&(aH(this.iframe.contentWindow,this.iframe.contentDocument),function(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let e=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}(this.iframe.contentWindow))}rebuildFullSnapshot(t,e=!1){if(!this.iframe.contentDocument)return;Object.keys(this.legacy_missingNodeRetryMap).length,this.legacy_missingNodeRetryMap={};const n=[],i=(t,e)=>{this.collectIframeAndAttachDocument(n,t);for(const n of this.config.plugins||[])n.onBuild&&n.onBuild(t,{id:e,replayer:this})};(function(t,e){var n=e.doc,i=e.onVisit,r=e.hackCss,s=void 0===r||r,o=e.afterAppend,a=e.cache,l=e.mirror,c=void 0===l?new SW:l,u=OW(t,{doc:n,mirror:c,skipChild:!1,hackCss:s,afterAppend:o,cache:a});(function(t,e){for(var n=0,i=t.getIds();n<i.length;n++){var r=i[n];t.has(r)&&e(t.getNode(r))}})(c,(function(t){i&&i(t),function(t,e){var n=e.getMeta(t);if((null==n?void 0:n.type)===bW.Element){var i=t;for(var r in n.attributes)if(Object.prototype.hasOwnProperty.call(n.attributes,r)&&r.startsWith("rr_")){var s=n.attributes[r];"rr_scrollLeft"===r&&(i.scrollLeft=s),"rr_scrollTop"===r&&(i.scrollTop=s)}}}(t,c)}))})(t.data.node,{doc:this.iframe.contentDocument,afterAppend:i,cache:this.cache,mirror:this.mirror}),i(this.iframe.contentDocument,t.data.node.id);for(const{mutationInQueue:o,builtNode:a}of n)this.attachDocumentToIframe(o,a),this.newDocumentQueue=this.newDocumentQueue.filter((t=>t!==o));const{documentElement:r,head:s}=this.iframe.contentDocument;this.insertStyleRules(r,s),this.service.state.matches("playing")||this.iframe.contentDocument.getElementsByTagName("html")[0].classList.add("rrweb-paused"),this.emitter.emit(YW.FullsnapshotRebuilded,t),e||this.waitForStylesheetLoad(),this.config.UNSAFE_replayCanvas&&this.preloadAllImages()}insertStyleRules(t,e){var n;const i=(r=this.config.blockClass,[`.${r} { background: currentColor }`,"noscript { display: none !important; }"]).concat(this.config.insertStyleRules);var r;if(this.config.pauseAnimation&&i.push("html.rrweb-paused *, html.rrweb-paused *:before, html.rrweb-paused *:after { animation-play-state: paused !important; }"),this.usingVirtualDom){const n=this.virtualDom.createElement("style");this.virtualDom.mirror.add(n,LG(n,this.virtualDom.unserializedId)),t.insertBefore(n,e),n.rules.push({source:jW.StyleSheetRule,adds:i.map(((t,e)=>({rule:t,index:e})))})}else{const r=document.createElement("style");t.insertBefore(r,e);for(let t=0;t<i.length;t++)null===(n=r.sheet)||void 0===n||n.insertRule(i[t],t)}}attachDocumentToIframe(t,e){const n=this.usingVirtualDom?this.virtualDom.mirror:this.mirror,i=[],r=(t,r)=>{this.collectIframeAndAttachDocument(i,t);const s=n.getMeta(t);if((null==s?void 0:s.type)===bW.Element&&"HTML"===(null==s?void 0:s.tagName.toUpperCase())){const{documentElement:t,head:n}=e.contentDocument;this.insertStyleRules(t,n)}for(const e of this.config.plugins||[])e.onBuild&&e.onBuild(t,{id:r,replayer:this})};OW(t.node,{doc:e.contentDocument,mirror:n,hackCss:!0,skipChild:!1,afterAppend:r,cache:this.cache}),r(e.contentDocument,t.node.id);for(const{mutationInQueue:s,builtNode:o}of i)this.attachDocumentToIframe(s,o),this.newDocumentQueue=this.newDocumentQueue.filter((t=>t!==s))}collectIframeAndAttachDocument(t,e){if(BW(e,this.mirror)){const n=this.newDocumentQueue.find((t=>t.parentId===this.mirror.getId(e)));n&&t.push({mutationInQueue:n,builtNode:e})}}waitForStylesheetLoad(){var t;const e=null===(t=this.iframe.contentDocument)||void 0===t?void 0:t.head;if(e){const t=new Set;let n,i=this.service.state;const r=()=>{i=this.service.state};this.emitter.on(YW.Start,r),this.emitter.on(YW.Pause,r);const s=()=>{this.emitter.off(YW.Start,r),this.emitter.off(YW.Pause,r)};e.querySelectorAll('link[rel="stylesheet"]').forEach((e=>{e.sheet||(t.add(e),e.addEventListener("load",(()=>{t.delete(e),0===t.size&&-1!==n&&(i.matches("playing")&&this.play(this.getCurrentTime()),this.emitter.emit(YW.LoadStylesheetEnd),n&&clearTimeout(n),s())})))})),t.size>0&&(this.service.send({type:"PAUSE"}),this.emitter.emit(YW.LoadStylesheetStart),n=setTimeout((()=>{i.matches("playing")&&this.play(this.getCurrentTime()),n=-1,s()}),this.config.loadTimeout))}}preloadAllImages(){return ZW(this,void 0,void 0,(function*(){this.service.state;const t=()=>{this.service.state};this.emitter.on(YW.Start,t),this.emitter.on(YW.Pause,t);const e=[];for(const n of this.service.state.context.events)n.type===HW.IncrementalSnapshot&&n.data.source===jW.CanvasMutation&&(e.push(this.deserializeAndPreloadCanvasEvents(n.data,n)),("commands"in n.data?n.data.commands:[n.data]).forEach((t=>{this.preloadImages(t,n)})));return Promise.all(e)}))}preloadImages(t,e){if("drawImage"===t.property&&"string"==typeof t.args[0]&&!this.imageMap.has(e)){const e=document.createElement("canvas"),n=e.getContext("2d"),i=null==n?void 0:n.createImageData(e.width,e.height);null==i||i.data,JSON.parse(t.args[0]),null==n||n.putImageData(i,0,0)}}deserializeAndPreloadCanvasEvents(t,e){return ZW(this,void 0,void 0,(function*(){if(!this.canvasEventMap.has(e)){const n={isUnchanged:!0};if("commands"in t){const i=yield Promise.all(t.commands.map((t=>ZW(this,void 0,void 0,(function*(){const e=yield Promise.all(t.args.map(MH(this.imageMap,null,n)));return Object.assign(Object.assign({},t),{args:e})})))));!1===n.isUnchanged&&this.canvasEventMap.set(e,Object.assign(Object.assign({},t),{commands:i}))}else{const i=yield Promise.all(t.args.map(MH(this.imageMap,null,n)));!1===n.isUnchanged&&this.canvasEventMap.set(e,Object.assign(Object.assign({},t),{args:i}))}}}))}applyIncremental(t,e){var n,i,r;const{data:s}=t;switch(s.source){case jW.Mutation:try{this.applyMutation(s,e)}catch(o){this.warn(`Exception in mutation ${o.message||o}`,s)}break;case jW.Drag:case jW.TouchMove:case jW.MouseMove:if(e){const t=s.positions[s.positions.length-1];this.mousePos={x:t.x,y:t.y,id:t.id,debugData:s}}else s.positions.forEach((n=>{const i={doAction:()=>{this.moveAndHover(n.x,n.y,n.id,e,s)},delay:n.timeOffset+t.timestamp-this.service.state.context.baselineTime};this.timer.addAction(i)})),this.timer.addAction({doAction(){},delay:t.delay-(null===(n=s.positions[0])||void 0===n?void 0:n.timeOffset)});break;case jW.MouseInteraction:{if(-1===s.id||e)break;const t=new Event(qW[s.type].toLowerCase()),n=this.mirror.getNode(s.id);if(!n)return this.debugNodeNotFound(s,s.id);this.emitter.emit(YW.MouseInteraction,{type:s.type,target:n});const{triggerFocus:i}=this.config;switch(s.type){case qW.Blur:"blur"in n&&n.blur();break;case qW.Focus:i&&n.focus&&n.focus({preventScroll:!0});break;case qW.Click:case qW.TouchStart:case qW.TouchEnd:e?(s.type===qW.TouchStart?this.touchActive=!0:s.type===qW.TouchEnd&&(this.touchActive=!1),this.mousePos={x:s.x,y:s.y,id:s.id,debugData:s}):(s.type===qW.TouchStart&&(this.tailPositions.length=0),this.moveAndHover(s.x,s.y,s.id,e,s),s.type===qW.Click?(this.mouse.classList.remove("active"),this.mouse.offsetWidth,this.mouse.classList.add("active")):s.type===qW.TouchStart?(this.mouse.offsetWidth,this.mouse.classList.add("touch-active")):s.type===qW.TouchEnd&&this.mouse.classList.remove("touch-active"));break;case qW.TouchCancel:e?this.touchActive=!1:this.mouse.classList.remove("touch-active");break;default:n.dispatchEvent(t)}break}case jW.Scroll:if(-1===s.id)break;if(this.usingVirtualDom){const t=this.virtualDom.mirror.getNode(s.id);if(!t)return this.debugNodeNotFound(s,s.id);t.scrollData=s;break}this.applyScroll(s,e);break;case jW.ViewportResize:this.emitter.emit(YW.Resize,{width:s.width,height:s.height});break;case jW.Input:if(-1===s.id)break;if(this.usingVirtualDom){const t=this.virtualDom.mirror.getNode(s.id);if(!t)return this.debugNodeNotFound(s,s.id);t.inputData=s;break}this.applyInput(s);break;case jW.MediaInteraction:{const t=this.usingVirtualDom?this.virtualDom.mirror.getNode(s.id):this.mirror.getNode(s.id);if(!t)return this.debugNodeNotFound(s,s.id);const e=t;try{s.currentTime&&(e.currentTime=s.currentTime),s.volume&&(e.volume=s.volume),s.muted&&(e.muted=s.muted),1===s.type&&e.pause(),0===s.type&&e.play(),4===s.type&&(e.playbackRate=s.playbackRate)}catch(a){this.config.showWarning}break}case jW.StyleSheetRule:case jW.StyleDeclaration:this.usingVirtualDom?s.styleId?this.constructedStyleMutations.push(s):s.id&&(null===(i=this.virtualDom.mirror.getNode(s.id))||void 0===i||i.rules.push(s)):this.applyStyleSheetMutation(s);break;case jW.CanvasMutation:if(!this.config.UNSAFE_replayCanvas)return;if(this.usingVirtualDom){const e=this.virtualDom.mirror.getNode(s.id);if(!e)return this.debugNodeNotFound(s,s.id);e.canvasMutations.push({event:t,mutation:s})}else{const e=this.mirror.getNode(s.id);if(!e)return this.debugNodeNotFound(s,s.id);EH({event:t,mutation:s,target:e,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})}break;case jW.Font:try{const t=new FontFace(s.family,s.buffer?new Uint8Array(JSON.parse(s.fontSource)):s.fontSource,s.descriptors);null===(r=this.iframe.contentDocument)||void 0===r||r.fonts.add(t)}catch(o){this.config.showWarning}break;case jW.Selection:if(e){this.lastSelectionData=s;break}this.applySelection(s);break;case jW.AdoptedStyleSheet:this.usingVirtualDom?this.adoptedStyleSheets.push(s):this.applyAdoptedStyleSheet(s)}}applyMutation(t,e){if(this.config.useVirtualDom&&!this.usingVirtualDom&&e&&(this.usingVirtualDom=!0,function(t,e=function(){return new eG}(),n=new xG){(function t(i,r){const s=NG(i,n,e,r);if(null!==s)if("IFRAME"!==(null==r?void 0:r.nodeName)&&i.nodeType!==mG.DOCUMENT_FRAGMENT_NODE&&(null==r||r.appendChild(s),s.parentNode=r,s.parentElement=r),"IFRAME"===i.nodeName){const e=i.contentDocument;e&&t(e,s)}else i.nodeType!==mG.DOCUMENT_NODE&&i.nodeType!==mG.ELEMENT_NODE&&i.nodeType!==mG.DOCUMENT_FRAGMENT_NODE||(i.nodeType===mG.ELEMENT_NODE&&i.shadowRoot&&t(i.shadowRoot,s),i.childNodes.forEach((e=>t(e,s))))})(t,null)}(this.iframe.contentDocument,this.mirror,this.virtualDom),Object.keys(this.legacy_missingNodeRetryMap).length))for(const l in this.legacy_missingNodeRetryMap)try{const t=this.legacy_missingNodeRetryMap[l],e=NG(t.node,this.virtualDom,this.mirror);e&&(t.node=e)}catch(a){this.config.showWarning}const n=this.usingVirtualDom?this.virtualDom.mirror:this.mirror;t.removes.forEach((e=>{var i;const r=n.getNode(e.id);if(!r){if(t.removes.find((t=>t.id===e.parentId)))return;return this.warnNodeNotFound(t,e.id)}let s=n.getNode(e.parentId);if(!s)return this.warnNodeNotFound(t,e.parentId);if(e.isShadow&&UW(s)&&(s=s.shadowRoot),n.removeNodeFromMap(r),s)try{s.removeChild(r),this.usingVirtualDom&&"#text"===r.nodeName&&"STYLE"===s.nodeName&&(null===(i=s.rules)||void 0===i?void 0:i.length)>0&&(s.rules=[])}catch(o){if(!(o instanceof DOMException))throw o;this.warn("parent could not remove child in mutation",s,r,t)}}));const i=Object.assign({},this.legacy_missingNodeRetryMap),r=[],s=t=>{var e;if(!this.iframe.contentDocument)return;let s=n.getNode(t.parentId);if(!s)return t.node.type===bW.Document?this.newDocumentQueue.push(t):r.push(t);t.node.isShadow&&(UW(s)||s.attachShadow({mode:"open"}),s=s.shadowRoot);let o=null,a=null;if(t.previousId&&(o=n.getNode(t.previousId)),t.nextId&&(a=n.getNode(t.nextId)),(t=>{let e=null;return t.nextId&&(e=n.getNode(t.nextId)),null!==t.nextId&&void 0!==t.nextId&&-1!==t.nextId&&!e})(t))return r.push(t);if(t.node.rootId&&!n.getNode(t.node.rootId))return;const l=t.node.rootId?n.getNode(t.node.rootId):this.usingVirtualDom?this.virtualDom:this.iframe.contentDocument;if(BW(s,n))return void this.attachDocumentToIframe(t,s);const c=(t,e)=>{for(const n of this.config.plugins||[])n.onBuild&&n.onBuild(t,{id:e,replayer:this})},u=OW(t.node,{doc:l,mirror:n,skipChild:!0,hackCss:!0,cache:this.cache,afterAppend:c});if(-1===t.previousId||-1===t.nextId)return void(i[t.node.id]={node:u,mutation:t});const h=n.getMeta(s);if(h&&h.type===bW.Element&&"textarea"===h.tagName&&t.node.type===bW.Text){const t=Array.isArray(s.childNodes)?s.childNodes:Array.from(s.childNodes);for(const e of t)e.nodeType===s.TEXT_NODE&&s.removeChild(e)}if(o&&o.nextSibling&&o.nextSibling.parentNode)s.insertBefore(u,o.nextSibling);else if(a&&a.parentNode)s.contains(a)?s.insertBefore(u,a):s.insertBefore(u,null);else{if(s===l)for(;l.firstChild;)l.removeChild(l.firstChild);s.appendChild(u)}if(c(u,t.node.id),this.usingVirtualDom&&"#text"===u.nodeName&&"STYLE"===s.nodeName&&(null===(e=s.rules)||void 0===e?void 0:e.length)>0&&(s.rules=[]),BW(u,this.mirror)){const t=this.mirror.getId(u),e=this.newDocumentQueue.find((e=>e.parentId===t));e&&(this.attachDocumentToIframe(e,u),this.newDocumentQueue=this.newDocumentQueue.filter((t=>t!==e)))}(t.previousId||t.nextId)&&this.legacy_resolveMissingNode(i,s,u,t)};t.adds.forEach((t=>{s(t)}));const o=Date.now();for(;r.length;){const t=PW(r);if(r.length=0,Date.now()-o>500){this.warn("Timeout in the loop, please check the resolve tree data:",t);break}for(const e of t)n.getNode(e.value.parentId)?FW(e,(t=>{s(t)})):this.debug("Drop resolve tree since there is no parent for the root node.",e)}Object.keys(i).length&&Object.assign(this.legacy_missingNodeRetryMap,i),function(t){const e=new Set,n=[];for(let i=t.length;i--;){const r=t[i];e.has(r.id)||(n.push(r),e.add(r.id))}return n}(t.texts).forEach((e=>{var i;const r=n.getNode(e.id);if(!r){if(t.removes.find((t=>t.id===e.id)))return;return this.warnNodeNotFound(t,e.id)}if(r.textContent=e.value,this.usingVirtualDom){const t=r.parentNode;(null===(i=null==t?void 0:t.rules)||void 0===i?void 0:i.length)>0&&(t.rules=[])}})),t.attributes.forEach((e=>{const i=n.getNode(e.id);if(!i){if(t.removes.find((t=>t.id===e.id)))return;return this.warnNodeNotFound(t,e.id)}for(const t in e.attributes)if("string"==typeof t){const r=e.attributes[t];if(null===r)i.removeAttribute(t);else if("string"==typeof r)try{if("_cssText"===t&&("LINK"===i.nodeName||"STYLE"===i.nodeName))try{const t=n.getMeta(i);Object.assign(t.attributes,e.attributes);const r=OW(t,{doc:i.ownerDocument,mirror:n,skipChild:!0,hackCss:!0,cache:this.cache}),s=i.nextSibling,o=i.parentNode;if(r&&o){o.removeChild(i),o.insertBefore(r,s),n.replace(e.id,r);break}}catch(a){}i.setAttribute(t,r)}catch(a){this.config.showWarning}else if("style"===t){const t=r,e=i;for(const n in t)if(!1===t[n])e.style.removeProperty(n);else if(t[n]instanceof Array){const i=t[n];e.style.setProperty(n,i[0],i[1])}else{const i=t[n];e.style.setProperty(n,i)}}}}))}applyScroll(t,e){var n,i;const r=this.mirror.getNode(t.id);if(!r)return this.debugNodeNotFound(t,t.id);const s=this.mirror.getMeta(r);if(r===this.iframe.contentDocument)null===(n=this.iframe.contentWindow)||void 0===n||n.scrollTo({top:t.y,left:t.x,behavior:e?"auto":"smooth"});else if((null==s?void 0:s.type)===bW.Document)null===(i=r.defaultView)||void 0===i||i.scrollTo({top:t.y,left:t.x,behavior:e?"auto":"smooth"});else try{r.scrollTo({top:t.y,left:t.x,behavior:e?"auto":"smooth"})}catch(o){}}applyInput(t){const e=this.mirror.getNode(t.id);if(!e)return this.debugNodeNotFound(t,t.id);try{e.checked=t.isChecked,e.value=t.text}catch(n){}}applySelection(t){try{const e=new Set,n=t.ranges.map((({start:t,startOffset:n,end:i,endOffset:r})=>{const s=this.mirror.getNode(t),o=this.mirror.getNode(i);if(!s||!o)return;const a=new Range;a.setStart(s,n),a.setEnd(o,r);const l=s.ownerDocument,c=null==l?void 0:l.getSelection();return c&&e.add(c),{range:a,selection:c}}));e.forEach((t=>t.removeAllRanges())),n.forEach((t=>{var e;return t&&(null===(e=t.selection)||void 0===e?void 0:e.addRange(t.range))}))}catch(e){}}applyStyleSheetMutation(t){var e;let n=null;t.styleId?n=this.styleMirror.getStyle(t.styleId):t.id&&(n=(null===(e=this.mirror.getNode(t.id))||void 0===e?void 0:e.sheet)||null),n&&(t.source===jW.StyleSheetRule?this.applyStyleSheetRule(t,n):t.source===jW.StyleDeclaration&&this.applyStyleDeclaration(t,n))}applyStyleSheetRule(t,e){var n,i,r,s;if(null===(n=t.adds)||void 0===n||n.forEach((({rule:t,index:n})=>{try{if(Array.isArray(n)){const{positions:i,index:r}=WW(n);VW(e.cssRules,i).insertRule(t,r)}else{const i=void 0===n?void 0:Math.min(n,e.cssRules.length);null==e||e.insertRule(t,i)}}catch(i){}})),null===(i=t.removes)||void 0===i||i.forEach((({index:t})=>{try{if(Array.isArray(t)){const{positions:n,index:i}=WW(t);VW(e.cssRules,n).deleteRule(i||0)}else null==e||e.deleteRule(t)}catch(n){}})),t.replace)try{null===(r=e.replace)||void 0===r||r.call(e,t.replace)}catch(o){}if(t.replaceSync)try{null===(s=e.replaceSync)||void 0===s||s.call(e,t.replaceSync)}catch(o){}}applyStyleDeclaration(t,e){t.set&&VW(e.rules,t.index).style.setProperty(t.set.property,t.set.value,t.set.priority),t.remove&&VW(e.rules,t.index).style.removeProperty(t.remove.property)}applyAdoptedStyleSheet(t){var e;const n=this.mirror.getNode(t.id);if(!n)return;null===(e=t.styles)||void 0===e||e.forEach((t=>{var e;let i=null,r=null;if(UW(n)?r=(null===(e=n.ownerDocument)||void 0===e?void 0:e.defaultView)||null:"#document"===n.nodeName&&(r=n.defaultView),r)try{i=new r.CSSStyleSheet,this.styleMirror.add(i,t.styleId),this.applyStyleSheetRule({source:jW.StyleSheetRule,adds:t.rules},i)}catch(s){}}));let i=0;const r=(t,e)=>{const n=e.map((t=>this.styleMirror.getStyle(t))).filter((t=>null!==t));UW(t)?t.shadowRoot.adoptedStyleSheets=n:"#document"===t.nodeName&&(t.adoptedStyleSheets=n),n.length!==e.length&&i<10&&(setTimeout((()=>r(t,e)),0+100*i),i++)};r(n,t.styleIds)}legacy_resolveMissingNode(t,e,n,i){const{previousId:r,nextId:s}=i,o=r&&t[r],a=s&&t[s];if(o){const{node:i,mutation:r}=o;e.insertBefore(i,n),delete t[r.node.id],delete this.legacy_missingNodeRetryMap[r.node.id],(r.previousId||r.nextId)&&this.legacy_resolveMissingNode(t,e,i,r)}if(a){const{node:i,mutation:r}=a;e.insertBefore(i,n.nextSibling),delete t[r.node.id],delete this.legacy_missingNodeRetryMap[r.node.id],(r.previousId||r.nextId)&&this.legacy_resolveMissingNode(t,e,i,r)}}moveAndHover(t,e,n,i,r){const s=this.mirror.getNode(n);if(!s)return this.debugNodeNotFound(r,n);const o=zW(s,this.iframe),a=t*o.absoluteScale+o.x,l=e*o.absoluteScale+o.y;this.mouse.style.left=`${a}px`,this.mouse.style.top=`${l}px`,i||this.drawMouseTail({x:a,y:l}),this.hoverElements(s)}drawMouseTail(t){if(!this.mouseTail)return;const{lineCap:e,lineWidth:n,strokeStyle:i,duration:r}=!0===this.config.mouseTail?RH:Object.assign({},RH,this.config.mouseTail),s=()=>{if(!this.mouseTail)return;const t=this.mouseTail.getContext("2d");t&&this.tailPositions.length&&(t.clearRect(0,0,this.mouseTail.width,this.mouseTail.height),t.beginPath(),t.lineWidth=n,t.lineCap=e,t.strokeStyle=i,t.moveTo(this.tailPositions[0].x,this.tailPositions[0].y),this.tailPositions.forEach((e=>t.lineTo(e.x,e.y))),t.stroke())};this.tailPositions.push(t),s(),setTimeout((()=>{this.tailPositions=this.tailPositions.filter((e=>e!==t)),s()}),r/this.speedService.state.context.timer.speed)}hoverElements(t){var e;null===(e=this.iframe.contentDocument)||void 0===e||e.querySelectorAll(".\\:hover").forEach((t=>{t.classList.remove(":hover")}));let n=t;for(;n;)n.classList&&n.classList.add(":hover"),n=n.parentElement}isUserInteraction(t){return t.type===HW.IncrementalSnapshot&&t.data.source>jW.Mutation&&t.data.source<=jW.Input}backToNormal(){this.nextUserInteractionEvent=null,this.speedService.state.matches("normal")||(this.speedService.send({type:"BACK_TO_NORMAL"}),this.emitter.emit(YW.SkipEnd,{speed:this.speedService.state.context.normalSpeed}))}warnNodeNotFound(t,e){this.warn(`Node with id '${e}' not found. `,t)}warnCanvasMutationFailed(t,e){this.warn("Has error on canvas update",e,"canvas mutation:",t)}debugNodeNotFound(t,e){this.debug("[replayer]",`Node with id '${e}' not found. `,t)}warn(...t){this.config.showWarning}debug(...t){this.config.showDebug}}function LH(t){let e="";return Object.keys(t).forEach((n=>{e+=`${n}: ${t[n]};`})),e}function OH(t,e=2){let n=String(t);const i=Math.pow(10,e-1);if(t<i)for(;String(i).length>n.length;)n=`0${t}`;return n}function kH(t){if(t<=0)return"00:00";const e=Math.floor(t/36e5);t%=36e5;const n=Math.floor(t/6e4);t%=6e4;const i=Math.floor(t/1e3);return e?`${OH(e)}:${OH(n)}:${OH(i)}`:`${OH(n)}:${OH(i)}`}function PH(){let t=!1;return["fullscreen","webkitIsFullScreen","mozFullScreen","msFullscreenElement"].forEach((e=>{e in document&&(t=t||Boolean(document[e]))})),t}function FH(t){return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[Object.prototype.toString.call(t)]}function BH(t){return t.type===HW.IncrementalSnapshot&&t.data.source>jW.Mutation&&t.data.source<=jW.Input}function zH(t){let e,n,i,r,s,o,a,l,c;return{c(){e=BV("div"),n=BV("input"),i=VV(),r=BV("label"),s=VV(),o=BV("span"),a=UV(t[3]),GV(n,"type","checkbox"),GV(n,"id",t[2]),n.disabled=t[1],GV(n,"class","svelte-9brlez"),GV(r,"for",t[2]),GV(r,"class","svelte-9brlez"),GV(o,"class","label svelte-9brlez"),GV(e,"class","switch svelte-9brlez"),qV(e,"disabled",t[1])},m(u,h){kV(u,e,h),OV(e,n),n.checked=t[0],OV(e,i),OV(e,r),OV(e,s),OV(e,o),OV(o,a),l||(c=WV(n,"change",t[4]),l=!0)},p(t,[i]){4&i&&GV(n,"id",t[2]),2&i&&(n.disabled=t[1]),1&i&&(n.checked=t[0]),4&i&&GV(r,"for",t[2]),8&i&&HV(a,t[3]),2&i&&qV(e,"disabled",t[1])},i:AV,o:AV,d(t){t&&PV(e),l=!1,c()}}}function UH(t,e,n){let{disabled:i}=e,{checked:r}=e,{id:s}=e,{label:o}=e;return t.$$set=t=>{"disabled"in t&&n(1,i=t.disabled),"checked"in t&&n(0,r=t.checked),"id"in t&&n(2,s=t.id),"label"in t&&n(3,o=t.label)},[r,i,s,o,function(){r=this.checked,n(0,r)}]}class VH extends _W{constructor(t){super(),yW(this,t,UH,zH,DV,{disabled:1,checked:0,id:2,label:3})}}function WH(t,e,n){const i=t.slice();return i[39]=e[n],i}function GH(t,e,n){const i=t.slice();return i[42]=e[n],i}function HH(t,e,n){const i=t.slice();return i[45]=e[n],i}function jH(t){let e,n,i,r,s,o,a,l,c,u,h,d,p,f,m,g,v,y,_,b,x,w,S,M,C,A,T=kH(t[6])+"",E=kH(t[8].totalTime)+"",I=t[14],R=[];for(let U=0;U<I.length;U+=1)R[U]=qH(HH(t,I,U));let N=t[9],D=[];for(let U=0;U<N.length;U+=1)D[U]=XH(GH(t,N,U));function L(t,e){return"playing"===t[7]?ZH:YH}let O=L(t),k=O(t),P=t[3],F=[];for(let U=0;U<P.length;U+=1)F[U]=KH(WH(t,P,U));function B(e){t[30](e)}let z={id:"skip",disabled:"skipping"===t[10],label:"skip inactive"};return void 0!==t[0]&&(z.checked=t[0]),b=new VH({props:z}),QV.push((()=>function(t,e,n){const i=t.$$.props.checked;void 0!==i&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}(b,0,B))),{c(){e=BV("div"),n=BV("div"),i=BV("span"),r=UV(T),s=VV(),o=BV("div"),a=BV("div"),l=VV();for(let t=0;t<R.length;t+=1)R[t].c();c=VV();for(let t=0;t<D.length;t+=1)D[t].c();u=VV(),h=BV("div"),d=VV(),p=BV("span"),f=UV(E),m=VV(),g=BV("div"),v=BV("button"),k.c(),y=VV();for(let t=0;t<F.length;t+=1)F[t].c();_=VV(),mW(b.$$.fragment),w=VV(),S=BV("button"),S.innerHTML='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><defs><style type="text/css"></style></defs><path d="M916 380c-26.4 0-48-21.6-48-48L868 223.2 613.6 477.6c-18.4\n            18.4-48.8 18.4-68 0-18.4-18.4-18.4-48.8 0-68L800 156 692 156c-26.4\n            0-48-21.6-48-48 0-26.4 21.6-48 48-48l224 0c26.4 0 48 21.6 48 48l0\n            224C964 358.4 942.4 380 916 380zM231.2 860l108.8 0c26.4 0 48 21.6 48\n            48s-21.6 48-48 48l-224 0c-26.4 0-48-21.6-48-48l0-224c0-26.4 21.6-48\n            48-48 26.4 0 48 21.6 48 48L164 792l253.6-253.6c18.4-18.4 48.8-18.4\n            68 0 18.4 18.4 18.4 48.8 0 68L231.2 860z" p-id="1286"></path></svg>',GV(i,"class","rr-timeline__time svelte-19ke1iv"),GV(a,"class","rr-progress__step svelte-19ke1iv"),jV(a,"width",t[13]),GV(h,"class","rr-progress__handler svelte-19ke1iv"),jV(h,"left",t[13]),GV(o,"class","rr-progress svelte-19ke1iv"),qV(o,"disabled","skipping"===t[10]),GV(p,"class","rr-timeline__time svelte-19ke1iv"),GV(n,"class","rr-timeline svelte-19ke1iv"),GV(v,"class","svelte-19ke1iv"),GV(S,"class","svelte-19ke1iv"),GV(g,"class","rr-controller__btns svelte-19ke1iv"),GV(e,"class","rr-controller svelte-19ke1iv")},m(x,T){kV(x,e,T),OV(e,n),OV(n,i),OV(i,r),OV(n,s),OV(n,o),OV(o,a),t[27](a),OV(o,l);for(let t=0;t<R.length;t+=1)R[t].m(o,null);OV(o,c);for(let t=0;t<D.length;t+=1)D[t].m(o,null);OV(o,u),OV(o,h),t[28](o),OV(n,d),OV(n,p),OV(p,f),OV(e,m),OV(e,g),OV(g,v),k.m(v,null),OV(g,y);for(let t=0;t<F.length;t+=1)F[t].m(g,null);OV(g,_),gW(b,g,null),OV(g,w),OV(g,S),M=!0,C||(A=[WV(o,"click",t[16]),WV(v,"click",t[4]),WV(S,"click",t[31])],C=!0)},p(t,e){if((!M||64&e[0])&&T!==(T=kH(t[6])+"")&&HV(r,T),(!M||8192&e[0])&&jV(a,"width",t[13]),16384&e[0]){let n;for(I=t[14],n=0;n<I.length;n+=1){const i=HH(t,I,n);R[n]?R[n].p(i,e):(R[n]=qH(i),R[n].c(),R[n].m(o,c))}for(;n<R.length;n+=1)R[n].d(1);R.length=I.length}if(512&e[0]){let n;for(N=t[9],n=0;n<N.length;n+=1){const i=GH(t,N,n);D[n]?D[n].p(i,e):(D[n]=XH(i),D[n].c(),D[n].m(o,u))}for(;n<D.length;n+=1)D[n].d(1);D.length=N.length}if((!M||8192&e[0])&&jV(h,"left",t[13]),1024&e[0]&&qV(o,"disabled","skipping"===t[10]),(!M||256&e[0])&&E!==(E=kH(t[8].totalTime)+"")&&HV(f,E),O!==(O=L(t))&&(k.d(1),k=O(t),k&&(k.c(),k.m(v,null))),1066&e[0]){let n;for(P=t[3],n=0;n<P.length;n+=1){const i=WH(t,P,n);F[n]?F[n].p(i,e):(F[n]=KH(i),F[n].c(),F[n].m(g,_))}for(;n<F.length;n+=1)F[n].d(1);F.length=P.length}const n={};var i;1024&e[0]&&(n.disabled="skipping"===t[10]),!x&&1&e[0]&&(x=!0,n.checked=t[0],i=()=>x=!1,eW.push(i)),b.$set(n)},i(t){M||(pW(b.$$.fragment,t),M=!0)},o(t){fW(b.$$.fragment,t),M=!1},d(n){n&&PV(e),t[27](null),FV(R,n),FV(D,n),t[28](null),k.d(),FV(F,n),vW(b),C=!1,RV(A)}}}function qH(t){let e,n;return{c(){e=BV("div"),GV(e,"title",n=t[45].name),jV(e,"width",t[45].width),jV(e,"height","4px"),jV(e,"position","absolute"),jV(e,"background",t[45].background),jV(e,"left",t[45].position)},m(t,n){kV(t,e,n)},p(t,i){16384&i[0]&&n!==(n=t[45].name)&&GV(e,"title",n),16384&i[0]&&jV(e,"width",t[45].width),16384&i[0]&&jV(e,"background",t[45].background),16384&i[0]&&jV(e,"left",t[45].position)},d(t){t&&PV(e)}}}function XH(t){let e,n;return{c(){e=BV("div"),GV(e,"title",n=t[42].name),jV(e,"width","10px"),jV(e,"height","5px"),jV(e,"position","absolute"),jV(e,"top","2px"),jV(e,"transform","translate(-50%, -50%)"),jV(e,"background",t[42].background),jV(e,"left",t[42].position)},m(t,n){kV(t,e,n)},p(t,i){512&i[0]&&n!==(n=t[42].name)&&GV(e,"title",n),512&i[0]&&jV(e,"background",t[42].background),512&i[0]&&jV(e,"left",t[42].position)},d(t){t&&PV(e)}}}function YH(t){let e,n;return{c(){e=zV("svg"),n=zV("path"),GV(n,"d","M170.65984 896l0-768 640 384zM644.66944\n              512l-388.66944-233.32864 0 466.65728z"),GV(e,"class","icon"),GV(e,"viewBox","0 0 1024 1024"),GV(e,"version","1.1"),GV(e,"xmlns","http://www.w3.org/2000/svg"),GV(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),GV(e,"width","16"),GV(e,"height","16")},m(t,i){kV(t,e,i),OV(e,n)},d(t){t&&PV(e)}}}function ZH(t){let e,n;return{c(){e=zV("svg"),n=zV("path"),GV(n,"d","M682.65984 128q53.00224 0 90.50112 37.49888t37.49888 90.50112l0\n              512q0 53.00224-37.49888 90.50112t-90.50112\n              37.49888-90.50112-37.49888-37.49888-90.50112l0-512q0-53.00224\n              37.49888-90.50112t90.50112-37.49888zM341.34016 128q53.00224 0\n              90.50112 37.49888t37.49888 90.50112l0 512q0 53.00224-37.49888\n              90.50112t-90.50112\n              37.49888-90.50112-37.49888-37.49888-90.50112l0-512q0-53.00224\n              37.49888-90.50112t90.50112-37.49888zM341.34016 213.34016q-17.67424\n              0-30.16704 12.4928t-12.4928 30.16704l0 512q0 17.67424 12.4928\n              30.16704t30.16704 12.4928 30.16704-12.4928\n              12.4928-30.16704l0-512q0-17.67424-12.4928-30.16704t-30.16704-12.4928zM682.65984\n              213.34016q-17.67424 0-30.16704 12.4928t-12.4928 30.16704l0 512q0\n              17.67424 12.4928 30.16704t30.16704 12.4928 30.16704-12.4928\n              12.4928-30.16704l0-512q0-17.67424-12.4928-30.16704t-30.16704-12.4928z"),GV(e,"class","icon"),GV(e,"viewBox","0 0 1024 1024"),GV(e,"version","1.1"),GV(e,"xmlns","http://www.w3.org/2000/svg"),GV(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),GV(e,"width","16"),GV(e,"height","16")},m(t,i){kV(t,e,i),OV(e,n)},d(t){t&&PV(e)}}}function KH(t){let e,n,i,r,s,o,a=t[39]+"";function l(){return t[29](t[39])}return{c(){e=BV("button"),n=UV(a),i=UV("x"),e.disabled=r="skipping"===t[10],GV(e,"class","svelte-19ke1iv"),qV(e,"active",t[39]===t[1]&&"skipping"!==t[10])},m(t,r){kV(t,e,r),OV(e,n),OV(e,i),s||(o=WV(e,"click",l),s=!0)},p(i,s){t=i,8&s[0]&&a!==(a=t[39]+"")&&HV(n,a),1024&s[0]&&r!==(r="skipping"===t[10])&&(e.disabled=r),1034&s[0]&&qV(e,"active",t[39]===t[1]&&"skipping"!==t[10])},d(t){t&&PV(e),s=!1,o()}}}function $H(t){let e,n,i=t[2]&&jH(t);return{c(){i&&i.c(),e=UV("")},m(t,r){i&&i.m(t,r),kV(t,e,r),n=!0},p(t,n){t[2]?i?(i.p(t,n),4&n[0]&&pW(i,1)):(i=jH(t),i.c(),pW(i,1),i.m(e.parentNode,e)):i&&(hW(),fW(i,1,1,(()=>{i=null})),dW())},i(t){n||(pW(i),n=!0)},o(t){fW(i),n=!1},d(t){i&&i.d(t),t&&PV(e)}}}function JH(t,e,n){return(100-(e-n)/(e-t)*100).toFixed(2)}function QH(t,e,n){const i=function(){const t=ZV();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=function(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}(e,n,{cancelable:i});return r.slice().forEach((e=>{e.call(t,s)})),!s.defaultPrevented}return!0}}();let r,s,o,a,l,c,u,h,d,p,{replayer:f}=e,{showController:m}=e,{autoPlay:g}=e,{skipInactive:v}=e,{speedOption:y}=e,{speed:_=(y.length?y[0]:1)}=e,{tags:b={}}=e,{inactiveColor:x}=e,w=0,S=null,M=!1,C=null;const A=()=>{S&&(cancelAnimationFrame(S),S=null)},T=()=>{"paused"===r&&(l?(f.play(),l=!1):f.play(w))},E=()=>{"playing"===r&&(f.pause(),M=!1)},I=(t,e)=>{n(6,w=t),M=!1,("boolean"==typeof e?e:"playing"===r)?f.play(t):f.pause(t)},R=(t,e,i=!1,r)=>{C=i?{start:t,end:e}:null,n(6,w=t),M=e,c=r,f.play(t)},N=t=>{let e="playing"===r;n(1,_=t),e&&f.pause(),f.setConfig({speed:_}),e&&f.play(w)};var D;return KV((()=>{n(7,r=f.service.state.value),n(10,s=f.speedService.state.value),f.on("state-change",(t=>{const{player:e,speed:i}=t;if((null==e?void 0:e.value)&&r!==e.value)switch(n(7,r=e.value),r){case"playing":A(),S=requestAnimationFrame((function t(){n(6,w=f.getCurrentTime()),M&&w>=M&&(C?R(C.start,C.end,!0,void 0):(f.pause(),c&&(c(),c=null))),w<u.totalTime&&(S=requestAnimationFrame(t))}));break;case"paused":A()}(null==i?void 0:i.value)&&s!==i.value&&n(10,s=i.value)})),f.on("finish",(()=>{l=!0,c&&(c(),c=null)})),g&&f.play()})),D=()=>{v!==f.config.skipInactive&&f.setConfig({skipInactive:v})},ZV().$$.after_update.push(D),$V((()=>{f.pause(),A()})),t.$$set=t=>{"replayer"in t&&n(17,f=t.replayer),"showController"in t&&n(2,m=t.showController),"autoPlay"in t&&n(18,g=t.autoPlay),"skipInactive"in t&&n(0,v=t.skipInactive),"speedOption"in t&&n(3,y=t.speedOption),"speed"in t&&n(1,_=t.speed),"tags"in t&&n(19,b=t.tags),"inactiveColor"in t&&n(20,x=t.inactiveColor)},t.$$.update=()=>{if(64&t.$$.dirty[0]&&i("ui-update-current-time",{payload:w}),128&t.$$.dirty[0]&&i("ui-update-player-state",{payload:r}),131072&t.$$.dirty[0]&&n(8,u=f.getMetaData()),320&t.$$.dirty[0]){const t=Math.min(1,w/u.totalTime);n(13,h=100*t+"%"),i("ui-update-progress",{payload:t})}655360&t.$$.dirty[0]&&n(9,d=(()=>{const{context:t}=f.service.state,e=t.events.length,n=t.events[0].timestamp,i=t.events[e-1].timestamp,r=[];return t.events.forEach((t=>{if(t.type===HW.Custom){const e={name:t.data.tag,background:b[t.data.tag]||"rgb(73, 80, 246)",position:`${JH(n,i,t.timestamp)}%`};r.push(e)}})),r})()),1179648&t.$$.dirty[0]&&n(14,p=(()=>{try{const{context:t}=f.service.state,e=t.events.length,n=t.events[0].timestamp,i=t.events[e-1].timestamp,r=function(t){const e=[];let n=t[0].timestamp;for(const i of t)BH(i)&&(i.timestamp-n>1e4&&e.push([n,i.timestamp]),n=i.timestamp);return e}(t.events),s=(t,e,n,i)=>((i-n)/(e-t)*100).toFixed(2);return r.map((t=>({name:"inactive period",background:x,position:`${JH(n,i,t[0])}%`,width:`${s(n,i,t[0],t[1])}%`})))}catch(t){return[]}})())},[v,_,m,y,()=>{switch(r){case"playing":E();break;case"paused":T()}},N,w,r,u,d,s,o,a,h,p,i,t=>{if("skipping"===s)return;const e=o.getBoundingClientRect();let n=(t.clientX-e.left)/e.width;n<0?n=0:n>1&&(n=1);const i=u.totalTime*n;l=!1,I(i)},f,g,b,x,T,E,I,R,()=>{n(0,v=!v)},()=>Promise.resolve().then((()=>{n(8,u=f.getMetaData())})),function(t){QV[t?"unshift":"push"]((()=>{a=t,n(12,a)}))},function(t){QV[t?"unshift":"push"]((()=>{o=t,n(11,o)}))},t=>N(t),function(t){v=t,n(0,v)},()=>i("fullscreen")]}class tj extends _W{constructor(t){super(),yW(this,t,QH,$H,DV,{replayer:17,showController:2,autoPlay:18,skipInactive:0,speedOption:3,speed:1,tags:19,inactiveColor:20,toggle:4,play:21,pause:22,goto:23,playRange:24,setSpeed:5,toggleSkipInactive:25,triggerUpdateMeta:26},null,[-1,-1])}get toggle(){return this.$$.ctx[4]}get play(){return this.$$.ctx[21]}get pause(){return this.$$.ctx[22]}get goto(){return this.$$.ctx[23]}get playRange(){return this.$$.ctx[24]}get setSpeed(){return this.$$.ctx[5]}get toggleSkipInactive(){return this.$$.ctx[25]}get triggerUpdateMeta(){return this.$$.ctx[26]}}function ej(t){let e,n,i={replayer:t[7],showController:t[3],autoPlay:t[1],speedOption:t[2],skipInactive:t[0],tags:t[4],inactiveColor:t[5]};return e=new tj({props:i}),t[32](e),e.$on("fullscreen",t[33]),{c(){mW(e.$$.fragment)},m(t,i){gW(e,t,i),n=!0},p(t,n){const i={};128&n[0]&&(i.replayer=t[7]),8&n[0]&&(i.showController=t[3]),2&n[0]&&(i.autoPlay=t[1]),4&n[0]&&(i.speedOption=t[2]),1&n[0]&&(i.skipInactive=t[0]),16&n[0]&&(i.tags=t[4]),32&n[0]&&(i.inactiveColor=t[5]),e.$set(i)},i(t){n||(pW(e.$$.fragment,t),n=!0)},o(t){fW(e.$$.fragment,t),n=!1},d(n){t[32](null),vW(e,n)}}}function nj(t){let e,n,i,r,s=t[7]&&ej(t);return{c(){e=BV("div"),n=BV("div"),i=VV(),s&&s.c(),GV(n,"class","rr-player__frame"),GV(n,"style",t[11]),GV(e,"class","rr-player"),GV(e,"style",t[12])},m(o,a){kV(o,e,a),OV(e,n),t[31](n),OV(e,i),s&&s.m(e,null),t[34](e),r=!0},p(t,i){(!r||2048&i[0])&&GV(n,"style",t[11]),t[7]?s?(s.p(t,i),128&i[0]&&pW(s,1)):(s=ej(t),s.c(),pW(s,1),s.m(e,null)):s&&(hW(),fW(s,1,1,(()=>{s=null})),dW()),(!r||4096&i[0])&&GV(e,"style",t[12])},i(t){r||(pW(s),r=!0)},o(t){fW(s),r=!1},d(n){n&&PV(e),t[31](null),s&&s.d(),t[34](null)}}}function ij(t,e,n){let i,r,s,o,a,l,c,{width:u=1024}=e,{height:h=576}=e,{maxScale:d=1}=e,{events:p=[]}=e,{skipInactive:f=!0}=e,{autoPlay:m=!0}=e,{speedOption:g=[1,2,4,8]}=e,{speed:v=1}=e,{showController:y=!0}=e,{tags:_={}}=e,{inactiveColor:b="#D4D4D4"}=e,x=u,w=h;const S=(t,e)=>{const n=[u/e.width,h/e.height];d&&n.push(d),t.style.transform=`scale(${Math.min(...n)})translate(-50%, -50%)`},M=()=>{var t;r&&(PH()?document.exitFullscreen?document.exitFullscreen():document.mozExitFullscreen?document.mozExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():(t=r).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen())};return KV((()=>{if(void 0!==g&&"array"!==FH(g))throw new Error("speedOption must be array");if(g.forEach((t=>{if("number"!==FH(t))throw new Error("item of speedOption must be number")})),g.indexOf(v)<0)throw new Error(`speed must be one of speedOption,\n        current config:\n        {\n          ...\n          speed: ${v},\n          speedOption: [${g.toString()}]\n          ...\n        }\n        `);var t;n(7,i=new DH(p,Object.assign({speed:v,root:s,unpackFn:iH},e))),i.on("resize",(t=>{S(i.wrapper,t)})),t=()=>{PH()?setTimeout((()=>{x=u,w=h,n(13,u=r.offsetWidth),n(14,h=r.offsetHeight-(y?80:0)),S(i.wrapper,{width:i.iframe.offsetWidth,height:i.iframe.offsetHeight})}),0):(n(13,u=x),n(14,h=w),S(i.wrapper,{width:i.iframe.offsetWidth,height:i.iframe.offsetHeight}))},document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),o=()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}})),$V((()=>{o&&o()})),t.$$set=t=>{n(39,e=TV(TV({},e),LV(t))),"width"in t&&n(13,u=t.width),"height"in t&&n(14,h=t.height),"maxScale"in t&&n(15,d=t.maxScale),"events"in t&&n(16,p=t.events),"skipInactive"in t&&n(0,f=t.skipInactive),"autoPlay"in t&&n(1,m=t.autoPlay),"speedOption"in t&&n(2,g=t.speedOption),"speed"in t&&n(17,v=t.speed),"showController"in t&&n(3,y=t.showController),"tags"in t&&n(4,_=t.tags),"inactiveColor"in t&&n(5,b=t.inactiveColor)},t.$$.update=()=>{24576&t.$$.dirty[0]&&n(11,l=LH({width:`${u}px`,height:`${h}px`})),24584&t.$$.dirty[0]&&n(12,c=LH({width:`${u}px`,height:`${h+(y?80:0)}px`}))},e=LV(e),[f,m,g,y,_,b,M,i,r,s,a,l,c,u,h,d,p,v,()=>i.getMirror(),()=>{S(i.wrapper,{width:i.iframe.offsetWidth,height:i.iframe.offsetHeight})},(t,e)=>{switch(i.on(t,e),t){case"ui-update-current-time":case"ui-update-progress":case"ui-update-player-state":a.$on(t,(({detail:t})=>e(t)))}},t=>{i.addEvent(t),a.triggerUpdateMeta()},()=>i.getMetaData(),()=>i,()=>{a.toggle()},t=>{a.setSpeed(t)},()=>{a.toggleSkipInactive()},()=>{a.play()},()=>{a.pause()},(t,e)=>{a.goto(t,e)},(t,e,n=!1,i)=>{a.playRange(t,e,n,i)},function(t){QV[t?"unshift":"push"]((()=>{s=t,n(9,s)}))},function(t){QV[t?"unshift":"push"]((()=>{a=t,n(10,a)}))},()=>M(),function(t){QV[t?"unshift":"push"]((()=>{r=t,n(8,r)}))}]}class rj extends _W{constructor(t){super(),yW(this,t,ij,nj,DV,{width:13,height:14,maxScale:15,events:16,skipInactive:0,autoPlay:1,speedOption:2,speed:17,showController:3,tags:4,inactiveColor:5,getMirror:18,triggerResize:19,toggleFullscreen:6,addEventListener:20,addEvent:21,getMetaData:22,getReplayer:23,toggle:24,setSpeed:25,toggleSkipInactive:26,play:27,pause:28,goto:29,playRange:30},null,[-1,-1])}get getMirror(){return this.$$.ctx[18]}get triggerResize(){return this.$$.ctx[19]}get toggleFullscreen(){return this.$$.ctx[6]}get addEventListener(){return this.$$.ctx[20]}get addEvent(){return this.$$.ctx[21]}get getMetaData(){return this.$$.ctx[22]}get getReplayer(){return this.$$.ctx[23]}get toggle(){return this.$$.ctx[24]}get setSpeed(){return this.$$.ctx[25]}get toggleSkipInactive(){return this.$$.ctx[26]}get play(){return this.$$.ctx[27]}get pause(){return this.$$.ctx[28]}get goto(){return this.$$.ctx[29]}get playRange(){return this.$$.ctx[30]}}class sj extends rj{constructor(t){super({target:t.target,props:t.data||t.props})}}const oj=new Jd,aj=new Ux,lj=new Jd;class cj{constructor(t,e){this.object=t,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let n=0,i=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onPointerDown=function(t){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(t.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onPointerUp=function(t){if(this.activeLook)switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onPointerMove=function(t){this.domElement===document?(this.pointerX=t.pageX-this.viewHalfX,this.pointerY=t.pageY-this.viewHalfY):(this.pointerX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=t.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(t){switch(t.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}},this.onKeyUp=function(t){switch(t.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}},this.lookAt=function(t,e,n){return t.isVector3?lj.copy(t):lj.set(t,e,n),this.object.lookAt(lj),c(this),this},this.update=function(){const t=new Jd;return function(e){if(!1===this.enabled)return;if(this.heightSpeed){const t=Md.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;const r=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);let s=e*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.pointerX*s,this.lookVertical&&(n-=this.pointerY*s*o),n=Math.max(-85,Math.min(85,n));let a=Md.degToRad(90-n);const l=Md.degToRad(i);this.constrainVertical&&(a=Md.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;t.setFromSphericalCoords(1,a,l).add(c),this.object.lookAt(t)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",uj),this.domElement.removeEventListener("pointerdown",s),this.domElement.removeEventListener("pointermove",r),this.domElement.removeEventListener("pointerup",o),window.removeEventListener("keydown",a),window.removeEventListener("keyup",l)};const r=this.onPointerMove.bind(this),s=this.onPointerDown.bind(this),o=this.onPointerUp.bind(this),a=this.onKeyDown.bind(this),l=this.onKeyUp.bind(this);function c(t){const e=t.object.quaternion;oj.set(0,0,-1).applyQuaternion(e),aj.setFromVector3(oj),n=90-Md.radToDeg(aj.phi),i=Md.radToDeg(aj.theta)}this.domElement.addEventListener("contextmenu",uj),this.domElement.addEventListener("pointerdown",s),this.domElement.addEventListener("pointermove",r),this.domElement.addEventListener("pointerup",o),window.addEventListener("keydown",a),window.addEventListener("keyup",l),this.handleResize(),c(this)}}function uj(t){t.preventDefault()}class hj extends qf{constructor(t,e={}){super(t),this.isWater=!0;const n=this,i=void 0!==e.textureWidth?e.textureWidth:512,r=void 0!==e.textureHeight?e.textureHeight:512,s=void 0!==e.clipBias?e.clipBias:0,o=void 0!==e.alpha?e.alpha:1,a=void 0!==e.time?e.time:0,l=void 0!==e.waterNormals?e.waterNormals:null,c=void 0!==e.sunDirection?e.sunDirection:new Jd(.70707,.70707,0),u=new Ud(void 0!==e.sunColor?e.sunColor:16777215),h=new Ud(void 0!==e.waterColor?e.waterColor:8355711),d=void 0!==e.eye?e.eye:new Jd(0,0,0),p=void 0!==e.distortionScale?e.distortionScale:20,f=void 0!==e.side?e.side:Yc,m=void 0!==e.fog&&e.fog,g=new cm,v=new Jd,y=new Jd,_=new Jd,b=new Ep,x=new Jd(0,0,-1),w=new Xd,S=new Jd,M=new Jd,C=new Xd,A=new Ep,T=new em,E=new Yd(i,r),I={uniforms:Jf.merge([vm.fog,vm.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Ep},sunColor:{value:new Ud(8355711)},sunDirection:{value:new Jd(.70707,.70707,0)},eye:{value:new Jd},waterColor:{value:new Ud(5592405)}}]),vertexShader:"\n\t\t\t\tuniform mat4 textureMatrix;\n\t\t\t\tuniform float time;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tmirrorCoord = modelMatrix * vec4( position, 1.0 );\n\t\t\t\t\tworldPosition = mirrorCoord.xyzw;\n\t\t\t\t\tmirrorCoord = textureMatrix * mirrorCoord;\n\t\t\t\t\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <fog_vertex>\n\t\t\t\t#include <shadowmap_vertex>\n\t\t\t}",fragmentShader:"\n\t\t\t\tuniform sampler2D mirrorSampler;\n\t\t\t\tuniform float alpha;\n\t\t\t\tuniform float time;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float distortionScale;\n\t\t\t\tuniform sampler2D normalSampler;\n\t\t\t\tuniform vec3 sunColor;\n\t\t\t\tuniform vec3 sunDirection;\n\t\t\t\tuniform vec3 eye;\n\t\t\t\tuniform vec3 waterColor;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n\n\t\t\t\tvec4 getNoise( vec2 uv ) {\n\t\t\t\t\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n\t\t\t\t\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n\t\t\t\t\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n\t\t\t\t\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n\t\t\t\t\tvec4 noise = texture2D( normalSampler, uv0 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv1 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv2 ) +\n\t\t\t\t\t\ttexture2D( normalSampler, uv3 );\n\t\t\t\t\treturn noise * 0.5 - 1.0;\n\t\t\t\t}\n\n\t\t\t\tvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n\t\t\t\t\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n\t\t\t\t\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\n\t\t\t\t\tspecularColor += pow( direction, shiny ) * sunColor * spec;\n\t\t\t\t\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n\t\t\t\t}\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <packing>\n\t\t\t\t#include <bsdfs>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <lights_pars_begin>\n\t\t\t\t#include <shadowmap_pars_fragment>\n\t\t\t\t#include <shadowmask_pars_fragment>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t\tvec4 noise = getNoise( worldPosition.xz * size );\n\t\t\t\t\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n\t\t\t\t\tvec3 diffuseLight = vec3(0.0);\n\t\t\t\t\tvec3 specularLight = vec3(0.0);\n\n\t\t\t\t\tvec3 worldToEye = eye-worldPosition.xyz;\n\t\t\t\t\tvec3 eyeDirection = normalize( worldToEye );\n\t\t\t\t\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n\t\t\t\t\tfloat distance = length(worldToEye);\n\n\t\t\t\t\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n\t\t\t\t\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\n\t\t\t\t\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n\t\t\t\t\tfloat rf0 = 0.3;\n\t\t\t\t\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n\t\t\t\t\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n\t\t\t\t\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n\t\t\t\t\tvec3 outgoingLight = albedo;\n\t\t\t\t\tgl_FragColor = vec4( outgoingLight, alpha );\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t}"},R=new Qf({fragmentShader:I.fragmentShader,vertexShader:I.vertexShader,uniforms:Jf.clone(I.uniforms),lights:!0,side:f,fog:m});R.uniforms.mirrorSampler.value=E.texture,R.uniforms.textureMatrix.value=A,R.uniforms.alpha.value=o,R.uniforms.time.value=a,R.uniforms.normalSampler.value=l,R.uniforms.sunColor.value=u,R.uniforms.waterColor.value=h,R.uniforms.sunDirection.value=c,R.uniforms.distortionScale.value=p,R.uniforms.eye.value=d,n.material=R,n.onBeforeRender=function(t,e,i){if(y.setFromMatrixPosition(n.matrixWorld),_.setFromMatrixPosition(i.matrixWorld),b.extractRotation(n.matrixWorld),v.set(0,0,1),v.applyMatrix4(b),S.subVectors(y,_),S.dot(v)>0)return;S.reflect(v).negate(),S.add(y),b.extractRotation(i.matrixWorld),x.set(0,0,-1),x.applyMatrix4(b),x.add(_),M.subVectors(y,x),M.reflect(v).negate(),M.add(y),T.position.copy(S),T.up.set(0,1,0),T.up.applyMatrix4(b),T.up.reflect(v),T.lookAt(M),T.far=i.far,T.updateMatrixWorld(),T.projectionMatrix.copy(i.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(T.projectionMatrix),A.multiply(T.matrixWorldInverse),g.setFromNormalAndCoplanarPoint(v,y),g.applyMatrix4(T.matrixWorldInverse),w.set(g.normal.x,g.normal.y,g.normal.z,g.constant);const r=T.projectionMatrix;C.x=(Math.sign(w.x)+r.elements[8])/r.elements[0],C.y=(Math.sign(w.y)+r.elements[9])/r.elements[5],C.z=-1,C.w=(1+r.elements[10])/r.elements[14],w.multiplyScalar(2/w.dot(C)),r.elements[2]=w.x,r.elements[6]=w.y,r.elements[10]=w.z+1-s,r.elements[14]=w.w,d.setFromMatrixPosition(i.matrixWorld);const o=t.getRenderTarget(),a=t.xr.enabled,l=t.shadowMap.autoUpdate;n.visible=!1,t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(E),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,T),n.visible=!0,t.xr.enabled=a,t.shadowMap.autoUpdate=l,t.setRenderTarget(o);const c=i.viewport;void 0!==c&&t.state.viewport(c)}}}class dj extends qf{constructor(){const t=dj.SkyShader,e=new Qf({name:"SkyShader",fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:Jf.clone(t.uniforms),side:Zc,depthWrite:!1});super(new Yf(1,1,1),e),this.isSky=!0}}function pj(t,e){return t+Math.floor(Math.random()*(e-t+1))}dj.SkyShader={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Jd},up:{value:new Jd(0,1,0)}},vertexShader:"\n\t\tuniform vec3 sunPosition;\n\t\tuniform float rayleigh;\n\t\tuniform float turbidity;\n\t\tuniform float mieCoefficient;\n\t\tuniform vec3 up;\n\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float e = 2.71828182845904523536028747135266249775724709369995957;\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\t// wavelength of used primaries, according to preetham\n\t\tconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n\t\t// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n\t\t// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n\t\tconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n\t\t// mie stuff\n\t\t// K coefficient for the primaries\n\t\tconst float v = 4.0;\n\t\tconst vec3 K = vec3( 0.686, 0.678, 0.666 );\n\t\t// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n\t\tconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n\t\t// earth shadow hack\n\t\t// cutoffAngle = pi / 1.95;\n\t\tconst float cutoffAngle = 1.6110731556870734;\n\t\tconst float steepness = 1.5;\n\t\tconst float EE = 1000.0;\n\n\t\tfloat sunIntensity( float zenithAngleCos ) {\n\t\t\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n\t\t\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n\t\t}\n\n\t\tvec3 totalMie( float T ) {\n\t\t\tfloat c = ( 0.2 * T ) * 10E-18;\n\t\t\treturn 0.434 * c * MieConst;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvWorldPosition = worldPosition.xyz;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n\t\t\tvSunDirection = normalize( sunPosition );\n\n\t\t\tvSunE = sunIntensity( dot( vSunDirection, up ) );\n\n\t\t\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n\t\t\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n\t\t\t// extinction (absorbtion + out scattering)\n\t\t\t// rayleigh coefficients\n\t\t\tvBetaR = totalRayleigh * rayleighCoefficient;\n\n\t\t\t// mie coefficients\n\t\t\tvBetaM = totalMie( turbidity ) * mieCoefficient;\n\n\t\t}",fragmentShader:"\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\tuniform float mieDirectionalG;\n\t\tuniform vec3 up;\n\n\t\tconst vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n\t\t// constants for atmospheric scattering\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\tconst float n = 1.0003; // refractive index of air\n\t\tconst float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n\t\t// optical length at zenith for molecules\n\t\tconst float rayleighZenithLength = 8.4E3;\n\t\tconst float mieZenithLength = 1.25E3;\n\t\t// 66 arc seconds -> degrees, and the cosine of that\n\t\tconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n\t\t// 3.0 / ( 16.0 * pi )\n\t\tconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n\t\t// 1.0 / ( 4.0 * pi )\n\t\tconst float ONE_OVER_FOURPI = 0.07957747154594767;\n\n\t\tfloat rayleighPhase( float cosTheta ) {\n\t\t\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n\t\t}\n\n\t\tfloat hgPhase( float cosTheta, float g ) {\n\t\t\tfloat g2 = pow( g, 2.0 );\n\t\t\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n\t\t\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec3 direction = normalize( vWorldPosition - cameraPos );\n\n\t\t\t// optical length\n\t\t\t// cutoff angle at 90 to avoid singularity in next formula.\n\t\t\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n\t\t\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n\t\t\tfloat sR = rayleighZenithLength * inverse;\n\t\t\tfloat sM = mieZenithLength * inverse;\n\n\t\t\t// combined extinction factor\n\t\t\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n\t\t\t// in scattering\n\t\t\tfloat cosTheta = dot( direction, vSunDirection );\n\n\t\t\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n\t\t\tvec3 betaRTheta = vBetaR * rPhase;\n\n\t\t\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );\n\t\t\tvec3 betaMTheta = vBetaM * mPhase;\n\n\t\t\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n\t\t\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n\t\t\t// nightsky\n\t\t\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n\t\t\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n\t\t\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n\t\t\tvec3 L0 = vec3( 0.1 ) * Fex;\n\n\t\t\t// composition + solar disc\n\t\t\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n\t\t\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n\t\t\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n\t\t\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n\t\t\tgl_FragColor = vec4( retColor, 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\n\t\t}"};const fj={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class mj{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const gj=new Am(-1,1,1,-1,0,1),vj=new Ef;vj.setAttribute("position",new bf([-1,3,0,-1,-1,0,3,-1,0],3)),vj.setAttribute("uv",new bf([0,2,0,0,2,0],2));class yj{constructor(t){this._mesh=new qf(vj,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,gj)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class _j extends mj{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Qf?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Jf.clone(t.uniforms),this.material=new Qf({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new yj(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class bj extends mj{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const i=t.getContext(),r=t.state;let s,o;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),r.buffers.stencil.setClear(o),r.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class xj extends mj{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class wj{constructor(t,e){if(this.renderer=t,void 0===e){const n=t.getSize(new Cd);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new Yd(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new _j(fj),this.clock=new dx}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let i=0,r=this.passes.length;i<r;i++){const e=this.passes[i];if(!1!==e.enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),e.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==bj&&(e instanceof bj?n=!0:e instanceof xj&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new Cd);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}new Am(-1,1,1,-1,0,1);const Sj=new Ef;Sj.setAttribute("position",new bf([-1,3,0,-1,-1,0,3,-1,0],3)),Sj.setAttribute("uv",new bf([0,2,0,0,2,0],2));class Mj extends mj{constructor(t,e,n,i,r){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ud}render(t,e,n){const i=t.autoClear;let r,s;t.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),t.autoClear=i}}class Cj extends mj{constructor(t,e,n,i){super(),this.renderScene=e,this.renderCamera=n,this.selectedObjects=void 0!==i?i:[],this.visibleEdgeColor=new Ud(1,1,1),this.hiddenEdgeColor=new Ud(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==t?new Cd(t.x,t.y):new Cd(256,256);const r=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new Yd(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Nv,this.depthMaterial.side=Kc,this.depthMaterial.depthPacking=ed,this.depthMaterial.blending=$c,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Kc,this.prepareMaskMaterial.fragmentShader=function(t,e){const n=e.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new Yd(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new Yd(r,s),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new Yd(r,s),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new Yd(Math.round(r/2),Math.round(s/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new Yd(r,s),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new Yd(Math.round(r/2),Math.round(s/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(r,s),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(r/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const o=fj;this.copyUniforms=Jf.clone(o.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Qf({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:$c,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Ud,this.oldClearAlpha=1,this.fsQuad=new yj(null),this.tempPulseColor1=new Ud,this.tempPulseColor2=new Ud,this.textureMatrix=new Ep}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(t,e){this.renderTargetMaskBuffer.setSize(t,e),this.renderTargetDepthBuffer.setSize(t,e);let n=Math.round(t/this.downSampleRatio),i=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,i),this.renderTargetBlurBuffer1.setSize(n,i),this.renderTargetEdgeBuffer1.setSize(n,i),this.separableBlurMaterial1.uniforms.texSize.value.set(n,i),n=Math.round(n/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(n,i),this.renderTargetEdgeBuffer2.setSize(n,i),this.separableBlurMaterial2.uniforms.texSize.value.set(n,i)}changeVisibilityOfSelectedObjects(t){const e=this._visibilityCache;function n(n){n.isMesh&&(!0===t?n.visible=e.get(n):(e.set(n,n.visible),n.visible=t))}for(let i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(n)}}changeVisibilityOfNonSelectedObjects(t){const e=this._visibilityCache,n=[];function i(t){t.isMesh&&n.push(t)}for(let r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(i)}this.renderScene.traverse((function(i){if(i.isMesh||i.isSprite){let r=!1;for(let t=0;t<n.length;t++){if(n[t].id===i.id){r=!0;break}}if(!1===r){const n=i.visible;!1!==t&&!0!==e.get(i)||(i.visible=t),e.set(i,n)}}else(i.isPoints||i.isLine)&&(!0===t?i.visible=e.get(i):(e.set(i,i.visible),i.visible=t))}))}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(t,e,n,i,r){if(this.selectedObjects.length>0){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const e=t.autoClear;t.autoClear=!1,r&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const i=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=i,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const t=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(t),this.tempPulseColor2.multiplyScalar(t)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Cj.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Cj.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Cj.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Cj.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(n),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=e}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,t.setRenderTarget(null),this.fsQuad.render(t))}getPrepareMaskMaterial(){return new Qf({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Cd(.5,.5)},textureMatrix:{value:null}},vertexShader:"#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tuniform mat4 textureMatrix;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t\t#include <skinning_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t\tvPosition = mvPosition;\n\n\t\t\t\t\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t\t\t\t\t#ifdef USE_INSTANCING\n\n\t\t\t\t\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t\t\t\t\t#endif\n\t\t\t\t\t\n\t\t\t\t\tworldPosition = modelMatrix * worldPosition;\n\n\t\t\t\t\tprojTexCoord = textureMatrix * worldPosition;\n\n\t\t\t\t}",fragmentShader:"#include <packing>\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tuniform sampler2D depthTexture;\n\t\t\t\tuniform vec2 cameraNearFar;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\n\t\t\t\t\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\n\t\t\t\t\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\n\t\t\t\t\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\n\n\t\t\t\t}"})}getEdgeDetectionMaterial(){return new Qf({uniforms:{maskTexture:{value:null},texSize:{value:new Cd(.5,.5)},visibleEdgeColor:{value:new Jd(1,1,1)},hiddenEdgeColor:{value:new Jd(1,1,1)}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec3 visibleEdgeColor;\n\t\t\t\tuniform vec3 hiddenEdgeColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\n\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\n\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\n\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\n\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\n\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\n\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\n\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\n\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\n\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\n\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\n\t\t\t\t}"})}getSeperableBlurMaterial(t){return new Qf({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new Cd(.5,.5)},direction:{value:new Cd(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float kernelRadius;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat sigma = kernelRadius/2.0;\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, sigma);\n\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\n\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\n\t\t\t\t\tvec2 uvOffset = delta;\n\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = kernelRadius * float(i) / float(MAX_RADIUS);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, sigma);\n\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\t\t\tuvOffset += delta;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\n\t\t\t\t}"})}getOverlayMaterial(){return new Qf({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture1;\n\t\t\t\tuniform sampler2D edgeTexture2;\n\t\t\t\tuniform sampler2D patternTexture;\n\t\t\t\tuniform float edgeStrength;\n\t\t\t\tuniform float edgeGlow;\n\t\t\t\tuniform bool usePatternTexture;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\n\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\n\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\n\t\t\t\t\tif(usePatternTexture)\n\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\n\t\t\t\t\tgl_FragColor = finalColor;\n\t\t\t\t}",blending:Qc,depthTest:!1,depthWrite:!1,transparent:!0})}}Cj.BlurDirectionX=new Cd(1,0),Cj.BlurDirectionY=new Cd(0,1);const Aj={uniforms:{tDiffuse:{value:null},resolution:{value:new Cd(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\tprecision highp float;\n\n\tuniform sampler2D tDiffuse;\n\n\tuniform vec2 resolution;\n\n\tvarying vec2 vUv;\n\n\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n\t//----------------------------------------------------------------------------------\n\t// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n\t// SDK Version: v3.00\n\t// Email:       gameworks@nvidia.com\n\t// Site:        http://developer.nvidia.com/\n\t//\n\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n\t//\n\t// Redistribution and use in source and binary forms, with or without\n\t// modification, are permitted provided that the following conditions\n\t// are met:\n\t//  * Redistributions of source code must retain the above copyright\n\t//    notice, this list of conditions and the following disclaimer.\n\t//  * Redistributions in binary form must reproduce the above copyright\n\t//    notice, this list of conditions and the following disclaimer in the\n\t//    documentation and/or other materials provided with the distribution.\n\t//  * Neither the name of NVIDIA CORPORATION nor the names of its\n\t//    contributors may be used to endorse or promote products derived\n\t//    from this software without specific prior written permission.\n\t//\n\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY\n\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n\t// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t//\n\t//----------------------------------------------------------------------------------\n\n\t#ifndef FXAA_DISCARD\n\t\t\t//\n\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t//\n\t\t\t// 1 = Use discard on pixels which don't need AA.\n\t\t\t//     For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t// 0 = Return unchanged color on pixels which don't need AA.\n\t\t\t//\n\t\t\t#define FXAA_DISCARD 0\n\t#endif\n\n\t/*--------------------------------------------------------------------------*/\n\t#define FxaaTexTop(t, p) texture2D(t, p, -100.0)\n\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)\n\t/*--------------------------------------------------------------------------*/\n\n\t#define NUM_SAMPLES 5\n\n\t// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha\n\tfloat contrast( vec4 a, vec4 b ) {\n\t\t\tvec4 diff = abs( a - b );\n\t\t\treturn max( max( max( diff.r, diff.g ), diff.b ), diff.a );\n\t}\n\n\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\tFXAA3 QUALITY - PC\n\n\t============================================================================*/\n\n\t/*--------------------------------------------------------------------------*/\n\tvec4 FxaaPixelShader(\n\t\t\tvec2 posM,\n\t\t\tsampler2D tex,\n\t\t\tvec2 fxaaQualityRcpFrame,\n\t\t\tfloat fxaaQualityEdgeThreshold,\n\t\t\tfloat fxaaQualityinvEdgeThreshold\n\t) {\n\t\t\tvec4 rgbaM = FxaaTexTop(tex, posM);\n\t\t\tvec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\t// . S .\n\t\t\t// W M E\n\t\t\t// . N .\n\n\t\t\tbool earlyExit = max( max( max(\n\t\t\t\t\tcontrast( rgbaM, rgbaN ),\n\t\t\t\t\tcontrast( rgbaM, rgbaS ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaE ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaW ) )\n\t\t\t\t\t< fxaaQualityEdgeThreshold;\n\t\t\t// . 0 .\n\t\t\t// 0 0 0\n\t\t\t// . 0 .\n\n\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\tif(earlyExit) FxaaDiscard;\n\t\t\t#else\n\t\t\t\t\tif(earlyExit) return rgbaM;\n\t\t\t#endif\n\n\t\t\tfloat contrastN = contrast( rgbaM, rgbaN );\n\t\t\tfloat contrastS = contrast( rgbaM, rgbaS );\n\t\t\tfloat contrastE = contrast( rgbaM, rgbaE );\n\t\t\tfloat contrastW = contrast( rgbaM, rgbaW );\n\n\t\t\tfloat relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );\n\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\tbool horzSpan = relativeVContrast > 0.;\n\t\t\t// . 1 .\n\t\t\t// 0 0 0\n\t\t\t// . 1 .\n\n\t\t\t// 45 deg edge detection and corners of objects, aka V/H contrast is too similar\n\t\t\tif( abs( relativeVContrast ) < .3 ) {\n\t\t\t\t\t// locate the edge\n\t\t\t\t\tvec2 dirToEdge;\n\t\t\t\t\tdirToEdge.x = contrastE > contrastW ? 1. : -1.;\n\t\t\t\t\tdirToEdge.y = contrastS > contrastN ? 1. : -1.;\n\t\t\t\t\t// . 2 .      . 1 .\n\t\t\t\t\t// 1 0 2  ~=  0 0 1\n\t\t\t\t\t// . 1 .      . 0 .\n\n\t\t\t\t\t// tap 2 pixels and see which ones are \"outside\" the edge, to\n\t\t\t\t\t// determine if the edge is vertical or horizontal\n\n\t\t\t\t\tvec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongH = contrast( rgbaM, rgbaAlongH );\n\t\t\t\t\t// . 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 H\n\n\t\t\t\t\tvec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongV = contrast( rgbaM, rgbaAlongV );\n\t\t\t\t\t// V 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 .\n\n\t\t\t\t\trelativeVContrast = matchAlongV - matchAlongH;\n\t\t\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\t\t\tif( abs( relativeVContrast ) < .3 ) { // 45 deg edge\n\t\t\t\t\t\t\t// 1 1 .\n\t\t\t\t\t\t\t// 0 0 1\n\t\t\t\t\t\t\t// . 0 1\n\n\t\t\t\t\t\t\t// do a simple blur\n\t\t\t\t\t\t\treturn mix(\n\t\t\t\t\t\t\t\t\trgbaM,\n\t\t\t\t\t\t\t\t\t(rgbaN + rgbaS + rgbaE + rgbaW) * .25,\n\t\t\t\t\t\t\t\t\t.4\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\thorzSpan = relativeVContrast > 0.;\n\t\t\t}\n\n\t\t\tif(!horzSpan) rgbaN = rgbaW;\n\t\t\tif(!horzSpan) rgbaS = rgbaE;\n\t\t\t// . 0 .      1\n\t\t\t// 1 0 1  ->  0\n\t\t\t// . 0 .      1\n\n\t\t\tbool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );\n\t\t\tif(!pairN) rgbaN = rgbaS;\n\n\t\t\tvec2 offNP;\n\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\n\t\t\tbool doneN = false;\n\t\t\tbool doneP = false;\n\n\t\t\tfloat nDist = 0.;\n\t\t\tfloat pDist = 0.;\n\n\t\t\tvec2 posN = posM;\n\t\t\tvec2 posP = posM;\n\n\t\t\tint iterationsUsed = 0;\n\t\t\tint iterationsUsedN = 0;\n\t\t\tint iterationsUsedP = 0;\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i++ ) {\n\t\t\t\t\titerationsUsed = i;\n\n\t\t\t\t\tfloat increment = float(i + 1);\n\n\t\t\t\t\tif(!doneN) {\n\t\t\t\t\t\t\tnDist += increment;\n\t\t\t\t\t\t\tposN = posM + offNP * nDist;\n\t\t\t\t\t\t\tvec4 rgbaEndN = FxaaTexTop(tex, posN.xy);\n\t\t\t\t\t\t\tdoneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );\n\t\t\t\t\t\t\titerationsUsedN = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!doneP) {\n\t\t\t\t\t\t\tpDist += increment;\n\t\t\t\t\t\t\tposP = posM - offNP * pDist;\n\t\t\t\t\t\t\tvec4 rgbaEndP = FxaaTexTop(tex, posP.xy);\n\t\t\t\t\t\t\tdoneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );\n\t\t\t\t\t\t\titerationsUsedP = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(doneN || doneP) break;\n\t\t\t}\n\n\n\t\t\tif ( !doneP && !doneN ) return rgbaM; // failed to find end of edge\n\n\t\t\tfloat dist = min(\n\t\t\t\t\tdoneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,\n\t\t\t\t\tdoneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.\n\t\t\t);\n\n\t\t\t// hacky way of reduces blurriness of mostly diagonal edges\n\t\t\t// but reduces AA quality\n\t\t\tdist = pow(dist, .5);\n\n\t\t\tdist = 1. - dist;\n\n\t\t\treturn mix(\n\t\t\t\t\trgbaM,\n\t\t\t\t\trgbaN,\n\t\t\t\t\tdist * .5\n\t\t\t);\n\t}\n\n\tvoid main() {\n\t\t\tconst float edgeDetectionQuality = .2;\n\t\t\tconst float invEdgeDetectionQuality = 1. / edgeDetectionQuality;\n\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\t\tvUv,\n\t\t\t\t\ttDiffuse,\n\t\t\t\t\tresolution,\n\t\t\t\t\tedgeDetectionQuality, // [0,1] contrast needed, otherwise early discard\n\t\t\t\t\tinvEdgeDetectionQuality\n\t\t\t);\n\n\t}\n\t"};
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.16.0
 * @author George Michael Brower
 * @license MIT
 */class Tj{constructor(t,e,n,i,r="div"){this.parent=t,this.object=e,this.property=n,this._disabled=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(i),this.$name=document.createElement("div"),this.$name.classList.add("name"),Tj.nextNameID=Tj.nextNameID||0,this.$name.id="lil-gui-name-"+ ++Tj.nextNameID,this.$widget=document.createElement(r),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(n)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback),this.updateDisplay()}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class Ej extends Tj{constructor(t,e,n){super(t,e,n,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",(()=>{this.setValue(this.$input.checked),this._callOnFinishChange()})),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Ij(t){let e,n;return(e=t.match(/(#|0x)?([a-f0-9]{6})/i))?n=e[2]:(e=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?n=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!n&&"#"+n}const Rj={isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:Ij,toHexString:Ij},Nj={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},Dj={isPrimitive:!1,match:Array.isArray,fromHexString(t,e,n=1){const i=Nj.fromHexString(t);e[0]=(i>>16&255)/255*n,e[1]=(i>>8&255)/255*n,e[2]=(255&i)/255*n},toHexString:([t,e,n],i=1)=>Nj.toHexString(t*(i=255/i)<<16^e*i<<8^n*i)},Lj={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,e,n=1){const i=Nj.fromHexString(t);e.r=(i>>16&255)/255*n,e.g=(i>>8&255)/255*n,e.b=(255&i)/255*n},toHexString:({r:t,g:e,b:n},i=1)=>Nj.toHexString(t*(i=255/i)<<16^e*i<<8^n*i)},Oj=[Rj,Nj,Dj,Lj];class kj extends Tj{constructor(t,e,n,i){var r;super(t,e,n,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(r=this.initialValue,Oj.find((t=>t.match(r)))),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",(()=>{this._setValueFromHexString(this.$input.value)})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$text.addEventListener("input",(()=>{const t=Ij(this.$text.value);t&&this._setValueFromHexString(t)})),this.$text.addEventListener("focus",(()=>{this._textFocused=!0,this.$text.select()})),this.$text.addEventListener("blur",(()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()})),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Pj extends Tj{constructor(t,e,n){super(t,e,n,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(t=>{t.preventDefault(),this.getValue().call(this.object)})),this.$button.addEventListener("touchstart",(()=>{})),this.$disable=this.$button}}class Fj extends Tj{constructor(t,e,n,i,r,s){super(t,e,n,"number"),this._initInput(),this.min(i),this.max(r);const o=void 0!==s;this.step(o?s:this._getImplicitStep(),o),this.updateDisplay()}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=t),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const e=parseFloat(this.$input.value);isNaN(e)||(this._snapClampSetValue(e+t),this.$input.value=this.getValue())};let e,n,i,r,s,o=!1;const a=t=>{if(o){const i=t.clientX-e,r=t.clientY-n;Math.abs(r)>5?(t.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(i)>5&&l()}if(!o){const e=t.clientY-i;s-=e*this._step*this._arrowKeyMultiplier(t),r+s>this._max?s=this._max-r:r+s<this._min&&(s=this._min-r),this._snapClampSetValue(r+s)}i=t.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",(()=>{const t=parseFloat(this.$input.value);isNaN(t)||this.setValue(this._clamp(t))})),this.$input.addEventListener("keydown",(e=>{"Enter"===e.code&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))})),this.$input.addEventListener("wheel",(e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))})),this.$input.addEventListener("mousedown",(t=>{e=t.clientX,n=i=t.clientY,o=!0,r=this.getValue(),s=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",l)})),this.$input.addEventListener("focus",(()=>{this._inputFocused=!0})),this.$input.addEventListener("blur",(()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()}))}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const e=this.$slider.getBoundingClientRect();let n=(i=t,r=e.left,s=e.right,o=this._min,(i-r)/(s-r)*(this._max-o)+o);var i,r,s,o;this._snapClampSetValue(n)},e=e=>{t(e.clientX)},n=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)};let i,r,s=!1;const o=e=>{e.preventDefault(),this._setDraggingStyle(!0),t(e.touches[0].clientX),s=!1},a=e=>{if(s){const t=e.touches[0].clientX-i,n=e.touches[0].clientY-r;Math.abs(t)>Math.abs(n)?o(e):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",l))}else e.preventDefault(),t(e.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",l)},c=this._callOnFinishChange.bind(this);let u;this.$slider.addEventListener("mousedown",(i=>{this._setDraggingStyle(!0),t(i.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)})),this.$slider.addEventListener("touchstart",(t=>{t.touches.length>1||(this._hasScrollBar?(i=t.touches[0].clientX,r=t.touches[0].clientY,s=!0):o(t),window.addEventListener("touchmove",a),window.addEventListener("touchend",l))})),this.$slider.addEventListener("wheel",(t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const e=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(u),u=setTimeout(c,400)}))}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle("lil-gui-"+e,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:n}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,n=-t.wheelDelta/120,n*=this._stepExplicit?1:10),e+-n}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class Bj extends Tj{constructor(t,e,n,i){super(t,e,n,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(i)?i:Object.values(i),this._names=Array.isArray(i)?i:Object.keys(i),this._names.forEach((t=>{const e=document.createElement("option");e.innerHTML=t,this.$select.appendChild(e)})),this.$select.addEventListener("change",(()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()})),this.$select.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$select.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.innerHTML=-1===e?t:this._names[e],this}}class zj extends Tj{constructor(t,e,n){super(t,e,n,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",(()=>{this.setValue(this.$input.value)})),this.$input.addEventListener("keydown",(t=>{"Enter"===t.code&&this.$input.blur()})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Uj=!1;class Vj{constructor({parent:t,autoPlace:e=void 0===t,container:n,width:i,title:r="Controls",injectStyles:s=!0,touchStyles:o=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",(()=>this.openAnimated(this._closed))),this.$title.addEventListener("keydown",(t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())})),this.$title.addEventListener("touchstart",(()=>{})),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(r),o&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Uj&&s&&(function(t){const e=document.createElement("style");e.innerHTML='.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:""}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}';const n=document.querySelector("head link[rel=stylesheet], head style");n?document.head.insertBefore(e,n):document.head.appendChild(e)}(),Uj=!0),n?n.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this.domElement.addEventListener("keydown",(t=>t.stopPropagation())),this.domElement.addEventListener("keyup",(t=>t.stopPropagation()))}add(t,e,n,i,r){if(Object(n)===n)return new Bj(this,t,e,n);switch(typeof t[e]){case"number":return new Fj(this,t,e,n,i,r);case"boolean":return new Ej(this,t,e);case"string":return new zj(this,t,e);case"function":return new Pj(this,t,e)}}addColor(t,e,n=1){return new kj(this,t,e,n)}addFolder(t){return new Vj({parent:this,title:t})}load(t,e=!0){return t.controllers&&this.controllers.forEach((e=>{e instanceof Pj||e._name in t.controllers&&e.load(t.controllers[e._name])})),e&&t.folders&&this.folders.forEach((e=>{e._title in t.folders&&e.load(t.folders[e._title])})),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach((t=>{if(!(t instanceof Pj)){if(t._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);e.controllers[t._name]=t.save()}})),t&&this.folders.forEach((t=>{if(t._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);e.folders[t._title]=t.save()})),e}open(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame((()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const n=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",n))};this.$children.addEventListener("transitionend",n);const i=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame((()=>{this.$children.style.height=i+"px"}))})),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach((t=>t.reset())),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach((t=>t.destroy()))}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach((e=>{t=t.concat(e.controllersRecursive())})),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach((e=>{t=t.concat(e.foldersRecursive())})),t}}function Wj(t,e){return function(){return t.apply(e,arguments)}}const{toString:Gj}=Object.prototype,{getPrototypeOf:Hj}=Object,jj=(qj=Object.create(null),t=>{const e=Gj.call(t);return qj[e]||(qj[e]=e.slice(8,-1).toLowerCase())});var qj;const Xj=t=>(t=t.toLowerCase(),e=>jj(e)===t),Yj=t=>e=>typeof e===t,{isArray:Zj}=Array,Kj=Yj("undefined");const $j=Xj("ArrayBuffer");const Jj=Yj("string"),Qj=Yj("function"),tq=Yj("number"),eq=t=>null!==t&&"object"==typeof t,nq=t=>{if("object"!==jj(t))return!1;const e=Hj(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},iq=Xj("Date"),rq=Xj("File"),sq=Xj("Blob"),oq=Xj("FileList"),aq=Xj("URLSearchParams"),[lq,cq,uq,hq]=["ReadableStream","Request","Response","Headers"].map(Xj);function dq(t,e,{allOwnKeys:n=!1}={}){if(null==t)return;let i,r;if("object"!=typeof t&&(t=[t]),Zj(t))for(i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else{const r=n?Object.getOwnPropertyNames(t):Object.keys(t),s=r.length;let o;for(i=0;i<s;i++)o=r[i],e.call(null,t[o],o,t)}}function pq(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const fq="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,mq=t=>!Kj(t)&&t!==fq;const gq=(vq="undefined"!=typeof Uint8Array&&Hj(Uint8Array),t=>vq&&t instanceof vq);var vq;const yq=Xj("HTMLFormElement"),_q=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),bq=Xj("RegExp"),xq=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};dq(n,((n,r)=>{let s;!1!==(s=e(n,r,t))&&(i[r]=s||n)})),Object.defineProperties(t,i)},wq="abcdefghijklmnopqrstuvwxyz",Sq="0123456789",Mq={DIGIT:Sq,ALPHA:wq,ALPHA_DIGIT:wq+wq.toUpperCase()+Sq};const Cq=Xj("AsyncFunction"),Aq={isArray:Zj,isArrayBuffer:$j,isBuffer:function(t){return null!==t&&!Kj(t)&&null!==t.constructor&&!Kj(t.constructor)&&Qj(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&("function"==typeof FormData&&t instanceof FormData||Qj(t.append)&&("formdata"===(e=jj(t))||"object"===e&&Qj(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){let e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&$j(t.buffer),e},isString:Jj,isNumber:tq,isBoolean:t=>!0===t||!1===t,isObject:eq,isPlainObject:nq,isReadableStream:lq,isRequest:cq,isResponse:uq,isHeaders:hq,isUndefined:Kj,isDate:iq,isFile:rq,isBlob:sq,isRegExp:bq,isFunction:Qj,isStream:t=>eq(t)&&Qj(t.pipe),isURLSearchParams:aq,isTypedArray:gq,isFileList:oq,forEach:dq,merge:function t(){const{caseless:e}=mq(this)&&this||{},n={},i=(i,r)=>{const s=e&&pq(n,r)||r;nq(n[s])&&nq(i)?n[s]=t(n[s],i):nq(i)?n[s]=t({},i):Zj(i)?n[s]=i.slice():n[s]=i};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&dq(arguments[r],i);return n},extend:(t,e,n,{allOwnKeys:i}={})=>(dq(e,((e,i)=>{n&&Qj(e)?t[i]=Wj(e,n):t[i]=e}),{allOwnKeys:i}),t),trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,s,o;const a={};if(e=e||{},null==t)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)o=r[s],i&&!i(o,t,e)||a[o]||(e[o]=t[o],a[o]=!0);t=!1!==n&&Hj(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:jj,kindOfTest:Xj,endsWith:(t,e,n)=>{t=String(t),(void 0===n||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return-1!==i&&i===n},toArray:t=>{if(!t)return null;if(Zj(t))return t;let e=t.length;if(!tq(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const n=i.value;e.call(t,n[0],n[1])}},matchAll:(t,e)=>{let n;const i=[];for(;null!==(n=t.exec(e));)i.push(n);return i},isHTMLForm:yq,hasOwnProperty:_q,hasOwnProp:_q,reduceDescriptors:xq,freezeMethods:t=>{xq(t,((e,n)=>{if(Qj(t)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=t[n];Qj(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(t,e)=>{const n={},i=t=>{t.forEach((t=>{n[t]=!0}))};return Zj(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,n){return e.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(t,e)=>null!=t&&Number.isFinite(t=+t)?t:e,findKey:pq,global:fq,isContextDefined:mq,ALPHABET:Mq,generateString:(t=16,e=Mq.ALPHA_DIGIT)=>{let n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&Qj(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(t,i)=>{if(eq(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[i]=t;const r=Zj(t)?[]:{};return dq(t,((t,e)=>{const s=n(t,i+1);!Kj(s)&&(r[e]=s)})),e[i]=void 0,r}}return t};return n(t,0)},isAsyncFn:Cq,isThenable:t=>t&&(eq(t)||Qj(t))&&Qj(t.then)&&Qj(t.catch)};function Tq(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r)}Aq.inherits(Tq,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Aq.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Eq=Tq.prototype,Iq={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{Iq[t]={value:t}})),Object.defineProperties(Tq,Iq),Object.defineProperty(Eq,"isAxiosError",{value:!0}),Tq.from=(t,e,n,i,r,s)=>{const o=Object.create(Eq);return Aq.toFlatObject(t,o,(function(t){return t!==Error.prototype}),(t=>"isAxiosError"!==t)),Tq.call(o,t.message,e,n,i,r),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};function Rq(t){return Aq.isPlainObject(t)||Aq.isArray(t)}function Nq(t){return Aq.endsWith(t,"[]")?t.slice(0,-2):t}function Dq(t,e,n){return t?t.concat(e).map((function(t,e){return t=Nq(t),!n&&e?"["+t+"]":t})).join(n?".":""):e}const Lq=Aq.toFlatObject(Aq,{},null,(function(t){return/^is[A-Z]/.test(t)}));function Oq(t,e,n){if(!Aq.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=Aq.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!Aq.isUndefined(e[t])}))).metaTokens,r=n.visitor||c,s=n.dots,o=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&Aq.isSpecCompliantForm(e);if(!Aq.isFunction(r))throw new TypeError("visitor must be a function");function l(t){if(null===t)return"";if(Aq.isDate(t))return t.toISOString();if(!a&&Aq.isBlob(t))throw new Tq("Blob is not supported. Use a Buffer instead.");return Aq.isArrayBuffer(t)||Aq.isTypedArray(t)?a&&"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}function c(t,n,r){let a=t;if(t&&!r&&"object"==typeof t)if(Aq.endsWith(n,"{}"))n=i?n:n.slice(0,-2),t=JSON.stringify(t);else if(Aq.isArray(t)&&function(t){return Aq.isArray(t)&&!t.some(Rq)}(t)||(Aq.isFileList(t)||Aq.endsWith(n,"[]"))&&(a=Aq.toArray(t)))return n=Nq(n),a.forEach((function(t,i){!Aq.isUndefined(t)&&null!==t&&e.append(!0===o?Dq([n],i,s):null===o?n:n+"[]",l(t))})),!1;return!!Rq(t)||(e.append(Dq(r,n,s),l(t)),!1)}const u=[],h=Object.assign(Lq,{defaultVisitor:c,convertValue:l,isVisitable:Rq});if(!Aq.isObject(t))throw new TypeError("data must be an object");return function t(n,i){if(!Aq.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+i.join("."));u.push(n),Aq.forEach(n,(function(n,s){!0===(!(Aq.isUndefined(n)||null===n)&&r.call(e,n,Aq.isString(s)?s.trim():s,i,h))&&t(n,i?i.concat(s):[s])})),u.pop()}}(t),e}function kq(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function Pq(t,e){this._pairs=[],t&&Oq(t,this,e)}const Fq=Pq.prototype;function Bq(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zq(t,e,n){if(!e)return t;const i=n&&n.encode||Bq,r=n&&n.serialize;let s;if(s=r?r(e,n):Aq.isURLSearchParams(e)?e.toString():new Pq(e,n).toString(i),s){const e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}Fq.append=function(t,e){this._pairs.push([t,e])},Fq.toString=function(t){const e=t?function(e){return t.call(this,e,kq)}:kq;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};const Uq=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Aq.forEach(this.handlers,(function(e){null!==e&&t(e)}))}},Vq={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Wq={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Pq,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Gq="undefined"!=typeof window&&"undefined"!=typeof document,Hq=(jq="undefined"!=typeof navigator&&navigator.product,Gq&&["ReactNative","NativeScript","NS"].indexOf(jq)<0);var jq;const qq="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Xq=Gq&&window.location.href||"http://localhost",Yq={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Gq,hasStandardBrowserWebWorkerEnv:qq,hasStandardBrowserEnv:Hq,origin:Xq},Symbol.toStringTag,{value:"Module"})),...Wq};function Zq(t){function e(t,n,i,r){let s=t[r++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),a=r>=t.length;if(s=!s&&Aq.isArray(i)?i.length:s,a)return Aq.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!o;i[s]&&Aq.isObject(i[s])||(i[s]=[]);return e(t,n,i[s],r)&&Aq.isArray(i[s])&&(i[s]=function(t){const e={},n=Object.keys(t);let i;const r=n.length;let s;for(i=0;i<r;i++)s=n[i],e[s]=t[s];return e}(i[s])),!o}if(Aq.isFormData(t)&&Aq.isFunction(t.entries)){const n={};return Aq.forEachEntry(t,((t,i)=>{e(function(t){return Aq.matchAll(/\w+|\[(\w*)]/g,t).map((t=>"[]"===t[0]?"":t[1]||t[0]))}(t),i,n,0)})),n}return null}const Kq={transitional:Vq,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=Aq.isObject(t);r&&Aq.isHTMLForm(t)&&(t=new FormData(t));if(Aq.isFormData(t))return i?JSON.stringify(Zq(t)):t;if(Aq.isArrayBuffer(t)||Aq.isBuffer(t)||Aq.isStream(t)||Aq.isFile(t)||Aq.isBlob(t)||Aq.isReadableStream(t))return t;if(Aq.isArrayBufferView(t))return t.buffer;if(Aq.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return Oq(t,new Yq.classes.URLSearchParams,Object.assign({visitor:function(t,e,n,i){return Yq.isNode&&Aq.isBuffer(t)?(this.append(e,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((s=Aq.isFileList(t))||n.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return Oq(s?{"files[]":t}:t,e&&new e,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(t,e,n){if(Aq.isString(t))try{return(e||JSON.parse)(t),Aq.trim(t)}catch(xW){if("SyntaxError"!==xW.name)throw xW}return(n||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){const e=this.transitional||Kq.transitional,n=e&&e.forcedJSONParsing,i="json"===this.responseType;if(Aq.isResponse(t)||Aq.isReadableStream(t))return t;if(t&&Aq.isString(t)&&(n&&!this.responseType||i)){const n=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(xW){if(n){if("SyntaxError"===xW.name)throw Tq.from(xW,Tq.ERR_BAD_RESPONSE,this,null,this.response);throw xW}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yq.classes.FormData,Blob:Yq.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Aq.forEach(["delete","get","head","post","put","patch"],(t=>{Kq.headers[t]={}}));const $q=Kq,Jq=Aq.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Qq=Symbol("internals");function tX(t){return t&&String(t).trim().toLowerCase()}function eX(t){return!1===t||null==t?t:Aq.isArray(t)?t.map(eX):String(t)}function nX(t,e,n,i,r){return Aq.isFunction(i)?i.call(this,e,n):(r&&(e=n),Aq.isString(e)?Aq.isString(i)?-1!==e.indexOf(i):Aq.isRegExp(i)?i.test(e):void 0:void 0)}class iX{constructor(t){t&&this.set(t)}set(t,e,n){const i=this;function r(t,e,n){const r=tX(e);if(!r)throw new Error("header name must be a non-empty string");const s=Aq.findKey(i,r);(!s||void 0===i[s]||!0===n||void 0===n&&!1!==i[s])&&(i[s||e]=eX(t))}const s=(t,e)=>Aq.forEach(t,((t,n)=>r(t,n,e)));if(Aq.isPlainObject(t)||t instanceof this.constructor)s(t,e);else if(Aq.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim()))s((t=>{const e={};let n,i,r;return t&&t.split("\n").forEach((function(t){r=t.indexOf(":"),n=t.substring(0,r).trim().toLowerCase(),i=t.substring(r+1).trim(),!n||e[n]&&Jq[n]||("set-cookie"===n?e[n]?e[n].push(i):e[n]=[i]:e[n]=e[n]?e[n]+", "+i:i)})),e})(t),e);else if(Aq.isHeaders(t))for(const[o,a]of t.entries())r(a,o,n);else null!=t&&r(e,t,n);return this}get(t,e){if(t=tX(t)){const n=Aq.findKey(this,t);if(n){const t=this[n];if(!e)return t;if(!0===e)return function(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)e[i[1]]=i[2];return e}(t);if(Aq.isFunction(e))return e.call(this,t,n);if(Aq.isRegExp(e))return e.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=tX(t)){const n=Aq.findKey(this,t);return!(!n||void 0===this[n]||e&&!nX(0,this[n],n,e))}return!1}delete(t,e){const n=this;let i=!1;function r(t){if(t=tX(t)){const r=Aq.findKey(n,t);!r||e&&!nX(0,n[r],r,e)||(delete n[r],i=!0)}}return Aq.isArray(t)?t.forEach(r):r(t),i}clear(t){const e=Object.keys(this);let n=e.length,i=!1;for(;n--;){const r=e[n];t&&!nX(0,this[r],r,t,!0)||(delete this[r],i=!0)}return i}normalize(t){const e=this,n={};return Aq.forEach(this,((i,r)=>{const s=Aq.findKey(n,r);if(s)return e[s]=eX(i),void delete e[r];const o=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((t,e,n)=>e.toUpperCase()+n))}(r):String(r).trim();o!==r&&delete e[r],e[o]=eX(i),n[o]=!0})),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return Aq.forEach(this,((n,i)=>{null!=n&&!1!==n&&(e[i]=t&&Aq.isArray(n)?n.join(", "):n)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([t,e])=>t+": "+e)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const n=new this(t);return e.forEach((t=>n.set(t))),n}static accessor(t){const e=(this[Qq]=this[Qq]={accessors:{}}).accessors,n=this.prototype;function i(t){const i=tX(t);e[i]||(!function(t,e){const n=Aq.toCamelCase(" "+e);["get","set","has"].forEach((i=>{Object.defineProperty(t,i+n,{value:function(t,n,r){return this[i].call(this,e,t,n,r)},configurable:!0})}))}(n,t),e[i]=!0)}return Aq.isArray(t)?t.forEach(i):i(t),this}}iX.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Aq.reduceDescriptors(iX.prototype,(({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(t){this[n]=t}}})),Aq.freezeMethods(iX);const rX=iX;function sX(t,e){const n=this||$q,i=e||n,r=rX.from(i.headers);let s=i.data;return Aq.forEach(t,(function(t){s=t.call(n,s,r.normalize(),e?e.status:void 0)})),r.normalize(),s}function oX(t){return!(!t||!t.__CANCEL__)}function aX(t,e,n){Tq.call(this,null==t?"canceled":t,Tq.ERR_CANCELED,e,n),this.name="CanceledError"}function lX(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new Tq("Request failed with status code "+n.status,[Tq.ERR_BAD_REQUEST,Tq.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}Aq.inherits(aX,Tq,{__CANCEL__:!0});const cX=(t,e,n=3)=>{let i=0;const r=function(t,e){t=t||10;const n=new Array(t),i=new Array(t);let r,s=0,o=0;return e=void 0!==e?e:1e3,function(a){const l=Date.now(),c=i[o];r||(r=l),n[s]=a,i[s]=l;let u=o,h=0;for(;u!==s;)h+=n[u++],u%=t;if(s=(s+1)%t,s===o&&(o=(o+1)%t),l-r<e)return;const d=c&&l-c;return d?Math.round(1e3*h/d):void 0}}(50,250);return function(t,e){let n=0;const i=1e3/e;let r=null;return function(){const e=!0===this,s=Date.now();if(e||s-n>i)return r&&(clearTimeout(r),r=null),n=s,t.apply(null,arguments);r||(r=setTimeout((()=>(r=null,n=Date.now(),t.apply(null,arguments))),i-(s-n)))}}((n=>{const s=n.loaded,o=n.lengthComputable?n.total:void 0,a=s-i,l=r(a);i=s;const c={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:n,lengthComputable:null!=o};c[e?"download":"upload"]=!0,t(c)}),n)},uX=Yq.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function i(n){let i=n;return t&&(e.setAttribute("href",i),i=e.href),e.setAttribute("href",i),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:"/"===e.pathname.charAt(0)?e.pathname:"/"+e.pathname}}return n=i(window.location.href),function(t){const e=Aq.isString(t)?i(t):t;return e.protocol===n.protocol&&e.host===n.host}}():function(){return!0},hX=Yq.hasStandardBrowserEnv?{write(t,e,n,i,r,s){const o=[t+"="+encodeURIComponent(e)];Aq.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Aq.isString(i)&&o.push("path="+i),Aq.isString(r)&&o.push("domain="+r),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function dX(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}const pX=t=>t instanceof rX?{...t}:t;function fX(t,e){e=e||{};const n={};function i(t,e,n){return Aq.isPlainObject(t)&&Aq.isPlainObject(e)?Aq.merge.call({caseless:n},t,e):Aq.isPlainObject(e)?Aq.merge({},e):Aq.isArray(e)?e.slice():e}function r(t,e,n){return Aq.isUndefined(e)?Aq.isUndefined(t)?void 0:i(void 0,t,n):i(t,e,n)}function s(t,e){if(!Aq.isUndefined(e))return i(void 0,e)}function o(t,e){return Aq.isUndefined(e)?Aq.isUndefined(t)?void 0:i(void 0,t):i(void 0,e)}function a(n,r,s){return s in e?i(n,r):s in t?i(void 0,n):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(t,e)=>r(pX(t),pX(e),!0)};return Aq.forEach(Object.keys(Object.assign({},t,e)),(function(i){const s=l[i]||r,o=s(t[i],e[i],i);Aq.isUndefined(o)&&s!==a||(n[i]=o)})),n}const mX=t=>{const e=fX({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:l}=e;if(e.headers=a=rX.from(a),e.url=zq(dX(e.baseURL,e.url),t.params,t.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Aq.isFormData(i))if(Yq.hasStandardBrowserEnv||Yq.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(n=a.getContentType())){const[t,...e]=n?n.split(";").map((t=>t.trim())).filter(Boolean):[];a.setContentType([t||"multipart/form-data",...e].join("; "))}if(Yq.hasStandardBrowserEnv&&(r&&Aq.isFunction(r)&&(r=r(e)),r||!1!==r&&uX(e.url))){const t=s&&o&&hX.read(o);t&&a.set(s,t)}return e},gX="undefined"!=typeof XMLHttpRequest&&function(t){return new Promise((function(e,n){const i=mX(t);let r=i.data;const s=rX.from(i.headers).normalize();let o,{responseType:a}=i;function l(){i.cancelToken&&i.cancelToken.unsubscribe(o),i.signal&&i.signal.removeEventListener("abort",o)}let c=new XMLHttpRequest;function u(){if(!c)return;const i=rX.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());lX((function(t){e(t),l()}),(function(t){n(t),l()}),{data:a&&"text"!==a&&"json"!==a?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:i,config:t,request:c}),c=null}c.open(i.method.toUpperCase(),i.url,!0),c.timeout=i.timeout,"onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(u)},c.onabort=function(){c&&(n(new Tq("Request aborted",Tq.ECONNABORTED,i,c)),c=null)},c.onerror=function(){n(new Tq("Network Error",Tq.ERR_NETWORK,i,c)),c=null},c.ontimeout=function(){let t=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const e=i.transitional||Vq;i.timeoutErrorMessage&&(t=i.timeoutErrorMessage),n(new Tq(t,e.clarifyTimeoutError?Tq.ETIMEDOUT:Tq.ECONNABORTED,i,c)),c=null},void 0===r&&s.setContentType(null),"setRequestHeader"in c&&Aq.forEach(s.toJSON(),(function(t,e){c.setRequestHeader(e,t)})),Aq.isUndefined(i.withCredentials)||(c.withCredentials=!!i.withCredentials),a&&"json"!==a&&(c.responseType=i.responseType),"function"==typeof i.onDownloadProgress&&c.addEventListener("progress",cX(i.onDownloadProgress,!0)),"function"==typeof i.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",cX(i.onUploadProgress)),(i.cancelToken||i.signal)&&(o=e=>{c&&(n(!e||e.type?new aX(null,t,c):e),c.abort(),c=null)},i.cancelToken&&i.cancelToken.subscribe(o),i.signal&&(i.signal.aborted?o():i.signal.addEventListener("abort",o)));const h=function(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}(i.url);h&&-1===Yq.protocols.indexOf(h)?n(new Tq("Unsupported protocol "+h+":",Tq.ERR_BAD_REQUEST,t)):c.send(r||null)}))},vX=(t,e)=>{let n,i=new AbortController;const r=function(t){if(!n){n=!0,o();const e=t instanceof Error?t:this.reason;i.abort(e instanceof Tq?e:new aX(e instanceof Error?e.message:e))}};let s=e&&setTimeout((()=>{r(new Tq(`timeout ${e} of ms exceeded`,Tq.ETIMEDOUT))}),e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach((t=>{t&&(t.removeEventListener?t.removeEventListener("abort",r):t.unsubscribe(r))})),t=null)};t.forEach((t=>t&&t.addEventListener&&t.addEventListener("abort",r)));const{signal:a}=i;return a.unsubscribe=o,[a,()=>{s&&clearTimeout(s),s=null}]},yX=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},_X=(t,e,n,i,r)=>{const s=async function*(t,e,n){for await(const i of t)yield*yX(ArrayBuffer.isView(i)?i:await n(String(i)),e)}(t,e,r);let o=0;return new ReadableStream({type:"bytes",async pull(t){const{done:e,value:r}=await s.next();if(e)return t.close(),void i();let a=r.byteLength;n&&n(o+=a),t.enqueue(new Uint8Array(r))},cancel:t=>(i(t),s.return())},{highWaterMark:2})},bX=(t,e)=>{const n=null!=t;return i=>setTimeout((()=>e({lengthComputable:n,total:t,loaded:i})))},xX="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,wX=xX&&"function"==typeof ReadableStream,SX=xX&&("function"==typeof TextEncoder?(MX=new TextEncoder,t=>MX.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var MX;const CX=wX&&(()=>{let t=!1;const e=new Request(Yq.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})(),AX=wX&&!!(()=>{try{return Aq.isReadableStream(new Response("").body)}catch(t){}})(),TX={stream:AX&&(t=>t.body)};var EX;xX&&(EX=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((t=>{!TX[t]&&(TX[t]=Aq.isFunction(EX[t])?e=>e[t]():(e,n)=>{throw new Tq(`Response type '${t}' is not supported`,Tq.ERR_NOT_SUPPORT,n)})})));const IX=async(t,e)=>{const n=Aq.toFiniteNumber(t.getContentLength());return null==n?(async t=>null==t?0:Aq.isBlob(t)?t.size:Aq.isSpecCompliantForm(t)?(await new Request(t).arrayBuffer()).byteLength:Aq.isArrayBufferView(t)?t.byteLength:(Aq.isURLSearchParams(t)&&(t+=""),Aq.isString(t)?(await SX(t)).byteLength:void 0))(e):n},RX={http:null,xhr:gX,fetch:xX&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:u,withCredentials:h="same-origin",fetchOptions:d}=mX(t);c=c?(c+"").toLowerCase():"text";let p,f,[m,g]=r||s||o?vX([r,s],o):[];const v=()=>{!p&&setTimeout((()=>{m&&m.unsubscribe()})),p=!0};let y;try{if(l&&CX&&"get"!==n&&"head"!==n&&0!==(y=await IX(u,i))){let t,n=new Request(e,{method:"POST",body:i,duplex:"half"});Aq.isFormData(i)&&(t=n.headers.get("content-type"))&&u.setContentType(t),n.body&&(i=_X(n.body,65536,bX(y,cX(l)),null,SX))}Aq.isString(h)||(h=h?"cors":"omit"),f=new Request(e,{...d,signal:m,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",withCredentials:h});let r=await fetch(f);const s=AX&&("stream"===c||"response"===c);if(AX&&(a||s)){const t={};["status","statusText","headers"].forEach((e=>{t[e]=r[e]}));const e=Aq.toFiniteNumber(r.headers.get("content-length"));r=new Response(_X(r.body,65536,a&&bX(e,cX(a,!0)),s&&v,SX),t)}c=c||"text";let o=await TX[Aq.findKey(TX,c)||"text"](r,t);return!s&&v(),g&&g(),await new Promise(((e,n)=>{lX(e,n,{data:o,headers:rX.from(r.headers),status:r.status,statusText:r.statusText,config:t,request:f})}))}catch(_){if(v(),_&&"TypeError"===_.name&&/fetch/i.test(_.message))throw Object.assign(new Tq("Network Error",Tq.ERR_NETWORK,t,f),{cause:_.cause||_});throw Tq.from(_,_&&_.code,t,f)}})};Aq.forEach(RX,((t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(xW){}Object.defineProperty(t,"adapterName",{value:e})}}));const NX=t=>`- ${t}`,DX=t=>Aq.isFunction(t)||null===t||!1===t,LX=t=>{t=Aq.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let s=0;s<e;s++){let e;if(n=t[s],i=n,!DX(n)&&(i=RX[(e=String(n)).toLowerCase()],void 0===i))throw new Tq(`Unknown adapter '${e}'`);if(i)break;r[e||"#"+s]=i}if(!i){const t=Object.entries(r).map((([t,e])=>`adapter ${t} `+(!1===e?"is not supported by the environment":"is not available in the build")));throw new Tq("There is no suitable adapter to dispatch the request "+(e?t.length>1?"since :\n"+t.map(NX).join("\n"):" "+NX(t[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function OX(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new aX(null,t)}function kX(t){OX(t),t.headers=rX.from(t.headers),t.data=sX.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1);return LX(t.adapter||$q.adapter)(t).then((function(e){return OX(t),e.data=sX.call(t,t.transformResponse,e),e.headers=rX.from(e.headers),e}),(function(e){return oX(e)||(OX(t),e&&e.response&&(e.response.data=sX.call(t,t.transformResponse,e.response),e.response.headers=rX.from(e.response.headers))),Promise.reject(e)}))}const PX="1.7.2",FX={};["object","boolean","number","function","string","symbol"].forEach(((t,e)=>{FX[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}}));const BX={};FX.transitional=function(t,e,n){return(i,r,s)=>{if(!1===t)throw new Tq(function(t,e){return"[Axios v1.7.2] Transitional option '"+t+"'"+e+(n?". "+n:"")}(r," has been removed"+(e?" in "+e:"")),Tq.ERR_DEPRECATED);return e&&!BX[r]&&(BX[r]=!0),!t||t(i,r,s)}};const zX={assertOptions:function(t,e,n){if("object"!=typeof t)throw new Tq("options must be an object",Tq.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],o=e[s];if(o){const e=t[s],n=void 0===e||o(e,s,t);if(!0!==n)throw new Tq("option "+s+" must be "+n,Tq.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Tq("Unknown option "+s,Tq.ERR_BAD_OPTION)}},validators:FX},UX=zX.validators;class VX{constructor(t){this.defaults=t,this.interceptors={request:new Uq,response:new Uq}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const e=t.stack?t.stack.replace(/^.+\n/,""):"";try{n.stack?e&&!String(n.stack).endsWith(e.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+e):n.stack=e}catch(xW){}}throw n}}_request(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},e=fX(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;void 0!==n&&zX.assertOptions(n,{silentJSONParsing:UX.transitional(UX.boolean),forcedJSONParsing:UX.transitional(UX.boolean),clarifyTimeoutError:UX.transitional(UX.boolean)},!1),null!=i&&(Aq.isFunction(i)?e.paramsSerializer={serialize:i}:zX.assertOptions(i,{encode:UX.function,serialize:UX.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&Aq.merge(r.common,r[e.method]);r&&Aq.forEach(["delete","get","head","post","put","patch","common"],(t=>{delete r[t]})),e.headers=rX.concat(s,r);const o=[];let a=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(a=a&&t.synchronous,o.unshift(t.fulfilled,t.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(t){l.push(t.fulfilled,t.rejected)}));let u,h=0;if(!a){const t=[kX.bind(this),void 0];for(t.unshift.apply(t,o),t.push.apply(t,l),u=t.length,c=Promise.resolve(e);h<u;)c=c.then(t[h++],t[h++]);return c}u=o.length;let d=e;for(h=0;h<u;){const t=o[h++],e=o[h++];try{d=t(d)}catch(p){e.call(this,p);break}}try{c=kX.call(this,d)}catch(p){return Promise.reject(p)}for(h=0,u=l.length;h<u;)c=c.then(l[h++],l[h++]);return c}getUri(t){return zq(dX((t=fX(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}Aq.forEach(["delete","get","head","options"],(function(t){VX.prototype[t]=function(e,n){return this.request(fX(n||{},{method:t,url:e,data:(n||{}).data}))}})),Aq.forEach(["post","put","patch"],(function(t){function e(e){return function(n,i,r){return this.request(fX(r||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}VX.prototype[t]=e(),VX.prototype[t+"Form"]=e(!0)}));const WX=VX;class GX{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(t){e=t}));const n=this;this.promise.then((t=>{if(!n._listeners)return;let e=n._listeners.length;for(;e-- >0;)n._listeners[e](t);n._listeners=null})),this.promise.then=t=>{let e;const i=new Promise((t=>{n.subscribe(t),e=t})).then(t);return i.cancel=function(){n.unsubscribe(e)},i},t((function(t,i,r){n.reason||(n.reason=new aX(t,i,r),e(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}static source(){let t;const e=new GX((function(e){t=e}));return{token:e,cancel:t}}}const HX=GX;const jX={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(jX).forEach((([t,e])=>{jX[e]=t}));const qX=jX;const XX=function t(e){const n=new WX(e),i=Wj(WX.prototype.request,n);return Aq.extend(i,WX.prototype,n,{allOwnKeys:!0}),Aq.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return t(fX(e,n))},i}($q);XX.Axios=WX,XX.CanceledError=aX,XX.CancelToken=HX,XX.isCancel=oX,XX.VERSION=PX,XX.toFormData=Oq,XX.AxiosError=Tq,XX.Cancel=XX.CanceledError,XX.all=function(t){return Promise.all(t)},XX.spread=function(t){return function(e){return t.apply(null,e)}},XX.isAxiosError=function(t){return Aq.isObject(t)&&!0===t.isAxiosError},XX.mergeConfig=fX,XX.AxiosHeaders=rX,XX.formToJSON=t=>Zq(Aq.isHTMLForm(t)?new FormData(t):t),XX.getAdapter=LX,XX.HttpStatusCode=qX,XX.default=XX;const YX=XX;export{dx as $,ox as A,la as B,Vu as C,sx as D,A_ as E,nr as F,Uv as G,Gu as H,hT as I,BS as J,fn as K,Oy as L,qf as M,tl as N,Qp as O,xa as P,DT as Q,Ec as R,Kv as S,Ka as T,yn as U,Jd as V,Yv as W,ET as X,jy as Y,Ky as Z,Ef as _,vr as a,$x as a$,ZL as a0,BD as a1,Ud as a2,Fx as a3,Cd as a4,v_ as a5,YL as a6,qc as a7,jO as a8,KL as a9,Wu as aA,Qc as aB,Pb as aC,td as aD,gM as aE,mM as aF,db as aG,kb as aH,qd as aI,ty as aJ,fy as aK,zD as aL,ub as aM,WD as aN,x_ as aO,Zv as aP,Qx as aQ,tw as aR,Ep as aS,Bp as aT,qb as aU,cj as aV,cb as aW,Md as aX,Wb as aY,o_ as aZ,Uy as a_,sk as aa,ok as ab,IF as ac,Px as ad,_b as ae,qx as af,Vx as ag,Hu as ah,hb as ai,ob as aj,__ as ak,ab as al,Bu as am,vf as an,Cn as ao,U as ap,$ as aq,CV as ar,wr as as,xr as at,pU as au,sj as av,$d as aw,tm as ax,ix as ay,Jy as az,yr as b,HM as b0,Dw as b1,iw as b2,qM as b3,Sw as b4,T_ as b5,rb as b6,y_ as b7,Hr as b8,yx as b9,Mj as bA,Cj as bB,_j as bC,Aj as bD,wj as bE,Cx as bF,jh as bG,Vj as bH,Za as bI,ln as bJ,YX as bK,_x as ba,Mx as bb,hx as bc,cM as bd,JM as be,yw as bf,mw as bg,jx as bh,bM as bi,jM as bj,dw as bk,Xv as bl,Am as bm,Jx as bn,Ou as bo,hj as bp,dj as bq,km as br,Jb as bs,Sn as bt,ps as bu,pj as bv,Zc as bw,cm as bx,Ls as by,be as bz,dr as c,en as d,br as e,Dc as f,tn as g,Lc as h,Xl as i,Vs as j,js as k,Fa as l,em as m,mm as n,lr as o,Qe as p,lb as q,xe as r,Kc as s,sb as t,Me as u,ff as v,Bs as w,Yf as x,Gy as y,Hb as z};
