import{_ as n,c as s,o as a,a2 as p}from"./chunks/framework.lL4UzoDo.js";const e="/wcdocs/assets/octtree_album.DBcRwKiu.png",l="/wcdocs/assets/octtree1.CI4vh-nG.png",i="/wcdocs/assets/octtree2.B97XXmhZ.png",f=JSON.parse('{"title":"å…«å‰æ ‘é‡åŒ–æ³•æå–å›¾ç‰‡ä¸»é¢˜è‰²","description":"","frontmatter":{},"headers":[],"relativePath":"ç®—æ³•æ•°æ®ç»“æ„ç›¸å…³/å…«å‰æ ‘é¢œè‰²é‡åŒ–æ³•.md","filePath":"ç®—æ³•æ•°æ®ç»“æ„ç›¸å…³/å…«å‰æ ‘é¢œè‰²é‡åŒ–æ³•.md","lastUpdated":1671940758000}'),c={name:"ç®—æ³•æ•°æ®ç»“æ„ç›¸å…³/å…«å‰æ ‘é¢œè‰²é‡åŒ–æ³•.md"},t=p('<h1 id="å…«å‰æ ‘é‡åŒ–æ³•æå–å›¾ç‰‡ä¸»é¢˜è‰²" tabindex="-1">å…«å‰æ ‘é‡åŒ–æ³•æå–å›¾ç‰‡ä¸»é¢˜è‰² <a class="header-anchor" href="#å…«å‰æ ‘é‡åŒ–æ³•æå–å›¾ç‰‡ä¸»é¢˜è‰²" aria-label="Permalink to &quot;å…«å‰æ ‘é‡åŒ–æ³•æå–å›¾ç‰‡ä¸»é¢˜è‰²&quot;">â€‹</a></h1><h2 id="æ€è·¯" tabindex="-1">æ€è·¯ <a class="header-anchor" href="#æ€è·¯" aria-label="Permalink to &quot;æ€è·¯&quot;">â€‹</a></h2><p><img src="'+e+`" alt="69816822e12769b2c4f6e52c945acb55.png"></p><ul><li>1.æ„å»ºå…«å‰æ ‘ï¼Œå°† rgb é¢œè‰²å¾ªç¯æ·»åŠ åˆ°æ ‘é‡Œï¼ˆç›¸åŒçš„é¢œè‰²ä¼šè·‘åˆ°åŒä¸€å±‚çš„åŒä¸€ä¸ªå¶å­ç»“ç‚¹ä¸Šï¼Œç´¯åŠ  countï¼‰ï¼›</li><li>2.å¶å­ç»“ç‚¹åˆå¹¶ï¼ˆç›¸ä¼¼çš„é¢œè‰²ä¼šè·‘åˆ°åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œä¸å…„å¼Ÿç»“ç‚¹åŒçº§ï¼Œå› æ­¤å¯ä»¥åˆå¹¶åˆ°ä»–ä»¬çš„çˆ¶èŠ‚ç‚¹ï¼‰ï¼›</li><li>3.è®¡ç®—è°ƒè‰²ç›˜ï¼ˆé€’å½’éå†å…«å‰æ ‘ï¼Œç´¯åŠ æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„ r,g,b é¢œè‰²å€¼å†å¹³å‡ï¼‰ï¼›</li></ul><h2 id="ä¸ºä»€ä¹ˆæ˜¯å…«å‰æ ‘" tabindex="-1">ä¸ºä»€ä¹ˆæ˜¯å…«å‰æ ‘ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ˜¯å…«å‰æ ‘" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆæ˜¯å…«å‰æ ‘ï¼Ÿ&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€ä¸ªé¢œè‰² rgb = [31, 31, 30]ï¼Œç»™å‡ºå®ƒçš„å…¥æ ‘è¿‡ç¨‹ï¼</span></span>
<span class="line"><span>//r = 31 =&gt;  00011111</span></span>
<span class="line"><span>//g = 31 =&gt;  00011111</span></span>
<span class="line"><span>//b = 30 =&gt;  00011110</span></span>
<span class="line"><span></span></span>
<span class="line"><span>r,g,bæ¯ä¸ªé¢œè‰²ä½è½¬æ¢æˆäº†8ä½äºŒè¿›åˆ¶ç”¨0,1è¡¨ç¤ºï¼ŒåŒæ—¶ä»å·¦åˆ°å³å–r,g,bçš„æ¯ä¸€ä½ç»„æˆ3ä½äºŒè¿›åˆ¶æ•°ã€‚</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬1ä½ï¼Œç»„æˆåˆ—ï¼š000ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 0ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬1å±‚ï¼Œçš„ç¬¬1ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬2ä½ï¼Œç»„æˆåˆ—ï¼š000ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 0ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬2å±‚ï¼Œçš„ç¬¬1ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬3ä½ï¼Œç»„æˆåˆ—ï¼š000ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 0ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬3å±‚ï¼Œçš„ç¬¬1ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬4ä½ï¼Œç»„æˆåˆ—ï¼š111ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 7ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬4å±‚ï¼Œçš„ç¬¬8ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬5ä½ï¼Œç»„æˆåˆ—ï¼š111ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 7ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬5å±‚ï¼Œçš„ç¬¬8ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬6ä½ï¼Œç»„æˆåˆ—ï¼š111ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 7ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬6å±‚ï¼Œçš„ç¬¬8ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬7ä½ï¼Œç»„æˆåˆ—ï¼š111ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 7ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬7å±‚ï¼Œçš„ç¬¬8ä¸ªç»“ç‚¹ï¼›</span></span>
<span class="line"><span>æ¯”å¦‚å–ç¬¬8ä½ï¼Œç»„æˆåˆ—ï¼š110ï¼Œè½¬æ¢æˆåè¿›åˆ¶å°±æ˜¯ 6ï¼Œè¿›å…¥å…«å‰æ ‘ä¸­ç¬¬8å±‚ï¼Œçš„ç¬¬7ä¸ªç»“ç‚¹ï¼ˆå¶å­ç»“ç‚¹ï¼Œç´¯åŠ r,g,båˆ†é‡ï¼Œç´¯åŠ pixelCountï¼‰ï¼›</span></span></code></pre></div><p>æŒ‰ç…§ä¸Šè¿°è§„åˆ™ï¼Œèƒ½å¤Ÿå°†é‡å¤å‡ºç°çš„é¢œè‰²ç´¯åŠ åˆ°ç¬¬ 8 å±‚çš„æŸä¸€ä¸ªå¶å­ç»“ç‚¹ä¸­! <img src="`+l+`" alt="d9d39a8969c6bf406779edc1a7086902.png"></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>// æ¯”å¦‚æœ‰è¿™ä¹ˆå‡ ä¸ªåƒç´ é¢œè‰²ä¿¡æ¯ï¼š</span></span>
<span class="line"><span>let pixels = [</span></span>
<span class="line"><span>    [31, 31, 30],</span></span>
<span class="line"><span>    [31, 31, 31],</span></span>
<span class="line"><span>    [31, 31, 31],</span></span>
<span class="line"><span>]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æœ€ç»ˆå¾—åˆ°é¢œè‰²çš„ç»Ÿè®¡æƒ…å†µä¼šæ˜¯ï¼š</span></span>
<span class="line"><span>let colors = { &#39;31,31,30&#39;: 1, &#39;31,31,31&#39;: 2 }</span></span></code></pre></div><h4 id="æ„å»ºæ ‘ç»“ç‚¹" tabindex="-1">æ„å»ºæ ‘ç»“ç‚¹ <a class="header-anchor" href="#æ„å»ºæ ‘ç»“ç‚¹" aria-label="Permalink to &quot;æ„å»ºæ ‘ç»“ç‚¹&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>class OctTreeNode {</span></span>
<span class="line"><span>  constructor(level) {</span></span>
<span class="line"><span>    this.color = [];</span></span>
<span class="line"><span>    this.level = level;</span></span>
<span class="line"><span>    this.isLeaf = false;</span></span>
<span class="line"><span>    this.pixelCount = 0; //è¯¥èŠ‚ç‚¹å‡ºç°æ¬¡æ•°ï¼Œå½“ä¸ºå¶å­ç»“ç‚¹æ—¶ï¼Œä»£è¡¨äº†æŸç§é¢œè‰²å‡ºç°æ¬¡æ•°</span></span>
<span class="line"><span>    this.r = 0; //redé€šé“ç´¯åŠ å€¼</span></span>
<span class="line"><span>    this.g = 0; //greené€šé“ç´¯åŠ å€¼</span></span>
<span class="line"><span>    this.b = 0; //blueé€šé“ç´¯åŠ å€¼</span></span>
<span class="line"><span>    this.children = [null, null, null, null, null, null, null, null]; //å…«ä¸ªå­èŠ‚ç‚¹</span></span>
<span class="line"><span>    this.next = null; //åœ¨ reducible é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="ä¾æ¬¡è½½å…¥åƒç´ ä¿¡æ¯-ç”Ÿæˆå…«å‰æ ‘ç»“æ„" tabindex="-1">ä¾æ¬¡è½½å…¥åƒç´ ä¿¡æ¯ï¼Œç”Ÿæˆå…«å‰æ ‘ç»“æ„ <a class="header-anchor" href="#ä¾æ¬¡è½½å…¥åƒç´ ä¿¡æ¯-ç”Ÿæˆå…«å‰æ ‘ç»“æ„" aria-label="Permalink to &quot;ä¾æ¬¡è½½å…¥åƒç´ ä¿¡æ¯ï¼Œç”Ÿæˆå…«å‰æ ‘ç»“æ„&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>function dec2bin(decnum, displayLength) {</span></span>
<span class="line"><span>  let bin = decnum.toString(2);</span></span>
<span class="line"><span>  if (displayLength) {</span></span>
<span class="line"><span>    while (bin.length &lt; displayLength) {</span></span>
<span class="line"><span>      bin = \`0\${bin}\`;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  return bin;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>function addColor(parentNode, color, level) {</span></span>
<span class="line"><span>  if (!color) {</span></span>
<span class="line"><span>    throw new Error(&quot;color must be providedï¼Œlike [255, 0, 0]&quot;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  let [r, g, b] = color;</span></span>
<span class="line"><span>  if (parentNode.isLeaf) {</span></span>
<span class="line"><span>    // console.warn(\`å·²æ»¡å…«å±‚ï¼Œæ˜¯å¶å­èŠ‚ç‚¹ï¼Œrgb(\${color})\`);</span></span>
<span class="line"><span>    parentNode.pixelCount++;</span></span>
<span class="line"><span>    parentNode.r += r;</span></span>
<span class="line"><span>    parentNode.g += g;</span></span>
<span class="line"><span>    parentNode.b += b;</span></span>
<span class="line"><span>    return;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  let binR = dec2bin(r, 8);</span></span>
<span class="line"><span>  let binG = dec2bin(g, 8);</span></span>
<span class="line"><span>  let binB = dec2bin(b, 8);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // é€åˆ—åˆå¹¶binï¼Œå…±3è¡Œ8åˆ—ï¼Œéœ€é€’å½’æ‰§è¡Œ8æ¬¡ï¼Œç”Ÿæˆ8å±‚æ ‘ç»“æ„</span></span>
<span class="line"><span>  let concatColBin = \`\${binR[level]}\${binG[level]}\${binB[level]}\`;</span></span>
<span class="line"><span>  let index = bin2dec(concatColBin);</span></span>
<span class="line"><span>  if (!parentNode.children[index]) {</span></span>
<span class="line"><span>    parentNode.children[index] = createNode(level);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // é€’å½’ç”Ÿæˆä¸‹ä¸€å±‚</span></span>
<span class="line"><span>  addColor(parentNode.children[index], color, level + 1);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œå¶å­ç»“ç‚¹åˆå¹¶" tabindex="-1">ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œå¶å­ç»“ç‚¹åˆå¹¶ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œå¶å­ç»“ç‚¹åˆå¹¶" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œå¶å­ç»“ç‚¹åˆå¹¶ï¼Ÿ&quot;">â€‹</a></h4><p>ä¸€ä¸ªå›¾ç‰‡ä¸­çš„é¢œè‰²ä¿¡æ¯ä¼šéå¸¸å¤šï¼Œç»è¿‡å…«å‰æ ‘é‡åŒ–åï¼ŒæŸäº›åƒç´ é¢œè‰²å æ¯”å¾ˆå¤§ï¼Œæœ‰äº›å¾ˆå°ã€‚å¾ˆå°çš„åŸå› å¯èƒ½æ˜¯è¿™ç§é¢œè‰²æœ¬èº«å°±å°‘ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºå®ƒä»¬æ˜¯ç›¸ä¼¼çš„é¢œè‰²ï¼Œé‚£ä¹ˆå°†ç›¸ä¼¼çš„é¢œè‰²åˆå¹¶ï¼Œå‡å°‘æå–çš„é¢œè‰²èºç‚¹ï¼ˆæ•°é‡æå¤šå´æå…¶ç›¸ä¼¼çš„é¢œè‰²ï¼‰æµ“ç¼©å°±æ˜¯ç²¾åï¼</p><h4 id="ä¸ºä»€ä¹ˆèƒ½å°†å¶å­èŠ‚ç‚¹åˆå¹¶" tabindex="-1">ä¸ºä»€ä¹ˆèƒ½å°†å¶å­èŠ‚ç‚¹åˆå¹¶ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆèƒ½å°†å¶å­èŠ‚ç‚¹åˆå¹¶" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆèƒ½å°†å¶å­èŠ‚ç‚¹åˆå¹¶ï¼Ÿ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>let pixel1 = [31, 31, 30]</span></span>
<span class="line"><span>// 00011111</span></span>
<span class="line"><span>// 00011111</span></span>
<span class="line"><span>// 00011110</span></span>
<span class="line"><span></span></span>
<span class="line"><span>let pixel2 = [31, 31, 31]</span></span>
<span class="line"><span>// 00011111</span></span>
<span class="line"><span>// 00011111</span></span>
<span class="line"><span>// 00011111</span></span></code></pre></div><p>å¯¹æ¯”<code>pixel1</code>å’Œ<code>pixel2</code>å¯ä»¥çœ‹å‡ºï¼š å‰ä¸ƒä½å®Œå…¨ä¸€è‡´ï¼Œåªæœ‰ç¬¬å…«ä½ï¼ˆæ ‘ä¸­çš„ç¬¬å…«å±‚ï¼Œå¶å­èŠ‚ç‚¹ï¼‰æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªé¢œè‰²æ˜¯ååˆ†ç›¸è¿‘çš„é¢œè‰²ï¼Œ å› æ­¤å¯ä»¥å°†å¶å­ç»“ç‚¹çš„<code>r,g,b</code>åˆ†é‡å’Œ<code>pixelCount</code>åˆå¹¶åˆ°ä»–ä»¬çš„çˆ¶èŠ‚ç‚¹å»ã€‚åˆå¹¶åï¼Œå¶å­ç»“ç‚¹ä¼šè¢«å‰”é™¤ï¼Œä»–ä»¬çš„çˆ¶èŠ‚ç‚¹å˜æˆæ–°çš„å¶å­ç»“ç‚¹ã€‚</p><h4 id="å¦‚ä½•åˆå¹¶å¶å­ç»“ç‚¹" tabindex="-1">å¦‚ä½•åˆå¹¶å¶å­ç»“ç‚¹ï¼Ÿ <a class="header-anchor" href="#å¦‚ä½•åˆå¹¶å¶å­ç»“ç‚¹" aria-label="Permalink to &quot;å¦‚ä½•åˆå¹¶å¶å­ç»“ç‚¹ï¼Ÿ&quot;">â€‹</a></h4><blockquote><p>ç¨‹åºä¸­æœ‰ä¸€ä¸ªè®¾è®¡æŠ€å·§ï¼Œå°±æ˜¯æ¯ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ç”¨ä¸€ä¸ªé“¾è¡¨å­˜å‚¨èµ·æ¥ï¼Œ<code>reducible[i]</code>è®°å½•äº†è¿™äº›é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œæ¯ä¸€æ¬¡åˆå¹¶æ“ä½œéƒ½æ˜¯ä»æœ€åº•å±‚å¼€å§‹ï¼Œä»ä¸‹åˆ°ä¸Šä¾æ¬¡è¿›è¡Œçš„ã€‚</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/**</span></span>
<span class="line"><span> * ç”Ÿæˆæ–°ç»“ç‚¹æ—¶ï¼Œé¡ºä¾¿è®°å½•reducibleé“¾è¡¨å¤´ä¿¡æ¯</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>function createNode(level) {</span></span>
<span class="line"><span>  let node = new OctTreeNode(level);</span></span>
<span class="line"><span>  if (level == 7) {</span></span>
<span class="line"><span>    node.isLeaf = true;</span></span>
<span class="line"><span>    leafNum++;</span></span>
<span class="line"><span>  } else {</span></span>
<span class="line"><span>    // å°†å…¶ä¸¢åˆ°ç¬¬ level å±‚çš„ reducible é“¾è¡¨ä¸­ï¼ˆè¿™ä¸¤è¡Œä»£ç ä¸èƒ½åï¼Œå¦åˆ™ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ï¼‰</span></span>
<span class="line"><span>    node.next = reducible[level]; //æ­¤æ—¶reducible[level]ä¸ºä¸Šä¸€ä¸ªé¢œè‰²å¯¹åº”çš„</span></span>
<span class="line"><span>    reducible[level] = node;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  return node;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * åˆå¹¶å¶å­ç»“ç‚¹</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>function reduceTree() {</span></span>
<span class="line"><span>  // æ‰¾åˆ°æœ€æ·±å±‚æ¬¡çš„å¹¶ä¸”æœ‰å¯åˆå¹¶èŠ‚ç‚¹çš„é“¾è¡¨</span></span>
<span class="line"><span>  let lv = 6;</span></span>
<span class="line"><span>  while (reducible[lv] == null) lv--;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // å–å‡ºé“¾è¡¨å¤´å¹¶å°†å…¶ä»é“¾è¡¨ä¸­ç§»é™¤</span></span>
<span class="line"><span>  let node = reducible[lv];</span></span>
<span class="line"><span>  reducible[lv] = node.next; //OctTreeNode or null</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // åˆå¹¶å­èŠ‚ç‚¹</span></span>
<span class="line"><span>  let r = 0;</span></span>
<span class="line"><span>  let g = 0;</span></span>
<span class="line"><span>  let b = 0;</span></span>
<span class="line"><span>  let count = 0;</span></span>
<span class="line"><span>  for (let i = 0; i &lt; 8; i++) {</span></span>
<span class="line"><span>    if (null === node.children[i]) continue;</span></span>
<span class="line"><span>    r += node.children[i].r;</span></span>
<span class="line"><span>    g += node.children[i].g;</span></span>
<span class="line"><span>    b += node.children[i].b;</span></span>
<span class="line"><span>    count += node.children[i].pixelCount;</span></span>
<span class="line"><span>    leafNum--; //å¶å­æ•°é‡å‡1ï¼ˆå…¶å®åœ¨æ ‘ç»“æ„ä¸­å­˜åœ¨ï¼Œåªæ˜¯å¶å­ç»“ç‚¹çš„å±‚çº§ç§»åˆ°äº†ä¸Šä¸€å±‚ï¼‰</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // çˆ¶èŠ‚ç‚¹å˜å¶å­èŠ‚ç‚¹ï¼Œåˆ†é‡åˆå¹¶</span></span>
<span class="line"><span>  node.isLeaf = true;</span></span>
<span class="line"><span>  node.r = r;</span></span>
<span class="line"><span>  node.g = g;</span></span>
<span class="line"><span>  node.b = b;</span></span>
<span class="line"><span>  node.pixelCount = count;</span></span>
<span class="line"><span>  leafNum++;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><img src="`+i+`" alt="eb6901ddc4efb5b45bcd12b95f237a40.png"></p><h4 id="ç»Ÿè®¡é¢œè‰²ä¿¡æ¯" tabindex="-1">ç»Ÿè®¡é¢œè‰²ä¿¡æ¯ï¼ <a class="header-anchor" href="#ç»Ÿè®¡é¢œè‰²ä¿¡æ¯" aria-label="Permalink to &quot;ç»Ÿè®¡é¢œè‰²ä¿¡æ¯ï¼&quot;">â€‹</a></h4><p>æµç¨‹æ¯”è¾ƒæ¸…æ™°ï¼šè·å–æ‰€æœ‰å¶å­èŠ‚ç‚¹<code>r,g,b</code>åˆ†é‡å’Œ<code>pixelCount</code>å¯¹åº”çš„å¹³å‡å€¼ colorï¼Œä»¥<code>color</code>ä¸ºé”®ï¼Œå‡ºç°æ¬¡æ•°<code>count</code>ä¸ºå€¼ï¼Œè®°å½•åˆ°ä¸€ä¸ª<code>palette</code>å¯¹è±¡ä¸­ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªåæ˜ å„ä¸ªé¢œè‰²å æ¯”çš„å¯¹è±¡ã€‚æœ€åå†è½¬æ¢æˆæ•°ç»„ï¼Œå¹¶æŒ‰ç…§<code>count</code>è¿›è¡Œé™åºæ’åºã€‚ç¬¬ä¸€é¡¹å°±æ˜¯ä¸»è‰²è°ƒï¼Œåç»­é¡¹å°±æ˜¯è°ƒè‰²ç›˜é¢œè‰²ç»„äº†ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/**</span></span>
<span class="line"><span> * è®¡ç®—æœ€ç»ˆçš„é¢œè‰²åˆ—è¡¨</span></span>
<span class="line"><span> * @param {*} node</span></span>
<span class="line"><span> * @param {*} paletteMap</span></span>
<span class="line"><span> * @returns</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>function colorsStats(node, paletteMap) {</span></span>
<span class="line"><span>  // åˆ¤æ–­æ˜¯å¦æ˜¯å¶å­èŠ‚ç‚¹</span></span>
<span class="line"><span>  if (node.isLeaf) {</span></span>
<span class="line"><span>    // è®¡ç®—å½“å‰é¢œè‰²çš„å¹³å‡</span></span>
<span class="line"><span>    let r = parseInt(node.r / node.pixelCount);</span></span>
<span class="line"><span>    let g = parseInt(node.g / node.pixelCount);</span></span>
<span class="line"><span>    let b = parseInt(node.b / node.pixelCount);</span></span>
<span class="line"><span>    let color = \`\${r},\${g},\${b}\`;</span></span>
<span class="line"><span>    // ç»Ÿè®¡å½“å‰é¢œè‰²åˆå¹¶ç´¯è®¡çš„æ¬¡æ•°</span></span>
<span class="line"><span>    if (paletteMap[color]) paletteMap[color] += node.pixelCount;</span></span>
<span class="line"><span>    else paletteMap[color] = node.pixelCount;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // bfsé€’å½’å¤„ç†é¢œè‰²ä¿¡æ¯</span></span>
<span class="line"><span>  for (let i = 0; i &lt; 8; i++) {</span></span>
<span class="line"><span>    node.children[i] &amp;&amp; colorsStats(node.children[i], paletteMap);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="æœ€åè°ƒç”¨å¾—å‡ºæŒ‡å®šæ•°é‡çš„é¢œè‰²-ğŸ¨" tabindex="-1">æœ€åè°ƒç”¨å¾—å‡ºæŒ‡å®šæ•°é‡çš„é¢œè‰² ğŸ¨ <a class="header-anchor" href="#æœ€åè°ƒç”¨å¾—å‡ºæŒ‡å®šæ•°é‡çš„é¢œè‰²-ğŸ¨" aria-label="Permalink to &quot;æœ€åè°ƒç”¨å¾—å‡ºæŒ‡å®šæ•°é‡çš„é¢œè‰² ğŸ¨&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>let leafNum = 0; //å¶å­ç»“ç‚¹æ•°é‡</span></span>
<span class="line"><span>let reducible = [null, null, null, null, null, null, null]; //å­˜å‚¨æ¯ä¸€å±‚é“¾è¡¨çš„è¡¨å¤´çš„æ•°ç»„</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function colorThief(pixels = [], maxColors = 8) {</span></span>
<span class="line"><span>  leafNum = 0;</span></span>
<span class="line"><span>  let rootNode = new OctTreeNode(0);</span></span>
<span class="line"><span>  pixels.map((item) =&gt; {</span></span>
<span class="line"><span>    addColor(rootNode, item, 0);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // è¾¹æ„å»ºï¼Œè¾¹åˆå¹¶å¶å­ç»“ç‚¹ï¼</span></span>
<span class="line"><span>    while (leafNum &gt; maxColors) reduceTree();</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  console.log(&quot;åˆå¹¶åçš„å…«å‰æ ‘ç»“æ„ï¼š&quot;, rootNode);</span></span>
<span class="line"><span>  console.log(\`å…±æœ‰\${leafNum}ä¸ªå¶å­ç»“ç‚¹\`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  let paletteMap = {};</span></span>
<span class="line"><span>  colorsStats(rootNode, paletteMap);</span></span>
<span class="line"><span>  console.log(&quot;å…«å‰æ ‘æ³•æå–çš„é¢œè‰²æœ‰ï¼š&quot;, paletteMap);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  let palette = [];</span></span>
<span class="line"><span>  for (let key in paletteMap) {</span></span>
<span class="line"><span>    palette.push({</span></span>
<span class="line"><span>        color: \`\${key}\`,</span></span>
<span class="line"><span>        count: paletteMap[key],</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  palette.sort((a, b) =&gt; {</span></span>
<span class="line"><span>      return b.count - a.count;</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  return palette;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å‚è€ƒåœ°å€" tabindex="-1">å‚è€ƒåœ°å€ï¼š <a class="header-anchor" href="#å‚è€ƒåœ°å€" aria-label="Permalink to &quot;å‚è€ƒåœ°å€ï¼š&quot;">â€‹</a></h3><p><a href="https://blog.csdn.net/shanglianlm/article/details/50051269" target="_blank" rel="noreferrer">å›¾åƒä¸»é¢˜è‰²æå–æ³•</a></p><p><a href="https://xcoder.in/2014/09/17/theme-color-extract/#%E6%8F%92%E5%85%A5%E9%A2%9C%E8%89%B2" target="_blank" rel="noreferrer">å›¾ç‰‡ä¸»é¢˜è‰²æå–ç®—æ³•å°ç»“</a></p>`,29),o=[t];function r(d,u,h,b,g,m){return a(),s("div",null,o)}const x=n(c,[["render",r]]);export{f as __pageData,x as default};
